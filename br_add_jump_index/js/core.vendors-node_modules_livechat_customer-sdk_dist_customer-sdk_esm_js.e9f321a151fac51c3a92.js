/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(self["webpackChunk"] = self["webpackChunk"] || []).push([["vendors-node_modules_livechat_customer-sdk_dist_customer-sdk_esm_js"],{

/***/ "../../../node_modules/@livechat/customer-auth/dist/customer-auth.esm.js":
/*!*******************************************************************************!*\
  !*** ../../../node_modules/@livechat/customer-auth/dist/customer-auth.esm.js ***!
  \*******************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   \"isExpiredToken\": () => (/* binding */ isExpiredToken),\n/* harmony export */   \"validateConfig\": () => (/* binding */ validateConfig)\n/* harmony export */ });\n/* harmony import */ var _livechat_url_utils__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @livechat/url-utils */ \"../../../node_modules/@livechat/url-utils/dist/url-utils.esm.js\");\n/* harmony import */ var _livechat_dom_utils__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @livechat/dom-utils */ \"../../../node_modules/@livechat/dom-utils/dist/dom-utils.es.js\");\n/* harmony import */ var _livechat_isomorphic_storage__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @livechat/isomorphic-storage */ \"../../../node_modules/@livechat/isomorphic-storage/dist/isomorphic-storage.es.js\");\n\n\n\n\n// this is the same as \"https://accounts.livechatinc.com\"\n// it's hardcoded here because chat.io has its own ACCOUNTS_URL\n// but this variable has to have the same value for both LiveChat and chat.io\nvar POST_MESSAGE_ORIGIN = 'https://accounts.livechatinc.com'; // as const\n\nvar CUSTOMER_AUTH_FOOTPRINT = '@livechat/customer-auth'; // as const\n\nvar ACCOUNTS_URL = \"https://accounts.livechatinc.com\";\n\nvar buildParams = function buildParams(_ref, redirectUri) {\n  var clientId = _ref.clientId,\n      licenseId = _ref.licenseId;\n  return {\n    license_id: String(licenseId),\n    flow: 'button',\n    response_type: 'token',\n    client_id: clientId,\n    redirect_uri: redirectUri,\n    post_message_uri: redirectUri,\n    state: CUSTOMER_AUTH_FOOTPRINT\n  };\n};\n\nvar buildPath = function buildPath(_ref2) {\n  var uniqueGroups = _ref2.uniqueGroups,\n      licenseId = _ref2.licenseId,\n      groupId = _ref2.groupId;\n  return (uniqueGroups ? \"/licence/g\" + licenseId + \"_\" + groupId : '') + \"/customer\";\n};\n\nvar buildSrc = function buildSrc(config, redirectUri, env) {\n  var url = env === 'production' ? ACCOUNTS_URL : ACCOUNTS_URL.replace('accounts.', \"accounts.\" + env + \".\");\n  var path = buildPath(config);\n  var query = (0,_livechat_url_utils__WEBPACK_IMPORTED_MODULE_0__.buildQueryString)(buildParams(config, redirectUri));\n  return \"\" + url + path + \"?\" + query;\n};\n\nvar createError = function createError(_ref) {\n  var code = _ref.code,\n      message = _ref.message;\n  var err = new Error(message);\n  err.code = code;\n  return err;\n};\n\nvar parseTokenResponse = function parseTokenResponse(token, licenseId) {\n  if ('identity_exception' in token) {\n    throw createError({\n      code: 'SSO_IDENTITY_EXCEPTION',\n      message: token.identity_exception\n    });\n  }\n\n  if ('oauth_exception' in token) {\n    throw createError({\n      code: 'SSO_OAUTH_EXCEPTION',\n      message: token.oauth_exception\n    });\n  }\n\n  return {\n    accessToken: token.access_token,\n    entityId: token.entity_id,\n    expiresIn: token.expires_in * 1000,\n    tokenType: token.token_type,\n    creationDate: Date.now(),\n    licenseId: licenseId\n  };\n};\n\nvar getPostMessageOrigin = function getPostMessageOrigin(env) {\n  return env === 'production' ? POST_MESSAGE_ORIGIN : POST_MESSAGE_ORIGIN.replace('accounts.', \"accounts.\" + env + \".\");\n};\n\nvar buildIframe = function buildIframe(config, env) {\n  var iframe = document.createElement('iframe');\n  iframe.style.display = 'none';\n  iframe.setAttribute('src', buildSrc(config, (0,_livechat_url_utils__WEBPACK_IMPORTED_MODULE_0__.getOrigin)(String(window.location)) + window.location.pathname, env));\n  return iframe;\n};\n\nvar isTokenResponse = function isTokenResponse(data) {\n  return data && data.state === CUSTOMER_AUTH_FOOTPRINT;\n};\n\nvar fetchToken = function fetchToken(config, env) {\n  var licenseId = config.licenseId;\n  var postMessageOrigin = getPostMessageOrigin(env);\n  return new Promise(function (resolve, reject) {\n    var iframe = buildIframe(config, env);\n\n    var cleanup = function cleanup() {\n      (0,_livechat_dom_utils__WEBPACK_IMPORTED_MODULE_1__.removeNode)(iframe); // eslint-disable-next-line no-use-before-define\n\n      window.removeEventListener('message', listener, false);\n    };\n\n    var timeoutId = setTimeout(function () {\n      cleanup();\n      reject(createError({\n        message: 'Request timed out.',\n        code: 'REQUEST_TIMEOUT'\n      }));\n    }, 15 * 1000);\n\n    var listener = function listener(_ref) {\n      var origin = _ref.origin,\n          data = _ref.data;\n\n      if (origin !== postMessageOrigin) {\n        return;\n      }\n\n      if (!isTokenResponse(data)) {\n        return;\n      }\n\n      clearTimeout(timeoutId);\n      cleanup();\n\n      try {\n        resolve(parseTokenResponse(data, licenseId));\n      } catch (err) {\n        reject(err);\n      }\n    };\n\n    window.addEventListener('message', listener, false);\n    (0,_livechat_dom_utils__WEBPACK_IMPORTED_MODULE_1__.getRoot)().then(function (body) {\n      body.appendChild(iframe);\n    });\n  });\n};\n\nvar validateConfig = function validateConfig(_ref) {\n  var licenseId = _ref.licenseId,\n      clientId = _ref.clientId;\n\n  if (typeof licenseId !== 'number' || typeof clientId !== 'string') {\n    throw new Error('You need to pass valid configuration object: { licenseId, clientId }.');\n  }\n};\n\nvar isExpiredToken = function isExpiredToken(_ref) {\n  var creationDate = _ref.creationDate,\n      expiresIn = _ref.expiresIn;\n  return Date.now() >= creationDate + expiresIn;\n};\n\nvar createAuth = function createAuth(config, env) {\n  validateConfig(config);\n  var cacheKey = \"\" + \"@@lc_auth_token:\" + config.licenseId + (config.uniqueGroups ? \":\" + config.groupId : '');\n  var pendingTokenRequest = null;\n  var cachedToken = null;\n  var retrievingToken = _livechat_isomorphic_storage__WEBPACK_IMPORTED_MODULE_2__.default.getItem(cacheKey).then(function (token) {\n    if (retrievingToken === null) {\n      return;\n    }\n\n    retrievingToken = null;\n\n    if (!token) {\n      return;\n    }\n\n    cachedToken = JSON.parse(token);\n  });\n\n  var getFreshToken = function getFreshToken() {\n    pendingTokenRequest = fetchToken(config, env).then(function (token) {\n      pendingTokenRequest = null;\n      _livechat_isomorphic_storage__WEBPACK_IMPORTED_MODULE_2__.default.setItem(cacheKey, JSON.stringify(token));\n      cachedToken = token;\n      return token;\n    }, function (err) {\n      pendingTokenRequest = null;\n      throw err;\n    });\n    return pendingTokenRequest;\n  };\n\n  var getToken = function getToken() {\n    if (pendingTokenRequest) {\n      return pendingTokenRequest;\n    }\n\n    if (cachedToken && !isExpiredToken(cachedToken)) {\n      return Promise.resolve(cachedToken);\n    }\n\n    if (retrievingToken) {\n      return retrievingToken.then(getToken);\n    }\n\n    return getFreshToken();\n  };\n\n  var hasToken = function hasToken() {\n    if (retrievingToken) {\n      return retrievingToken.then(hasToken);\n    }\n\n    return Promise.resolve(!!cachedToken);\n  };\n\n  var invalidate = function invalidate() {\n    cachedToken = null;\n    retrievingToken = null;\n    return _livechat_isomorphic_storage__WEBPACK_IMPORTED_MODULE_2__.default.removeItem(cacheKey);\n  };\n\n  return {\n    getFreshToken: getFreshToken,\n    getToken: getToken,\n    hasToken: hasToken,\n    invalidate: invalidate\n  };\n};\n\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (createAuth);\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi4vLi4vLi4vbm9kZV9tb2R1bGVzL0BsaXZlY2hhdC9jdXN0b21lci1hdXRoL2Rpc3QvY3VzdG9tZXItYXV0aC5lc20uanMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi4vLi4vLi4vbm9kZV9tb2R1bGVzL0BsaXZlY2hhdC9jdXN0b21lci1hdXRoL2Rpc3QvY3VzdG9tZXItYXV0aC5lc20uanM/ODk3NCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBidWlsZFF1ZXJ5U3RyaW5nLCBnZXRPcmlnaW4gfSBmcm9tICdAbGl2ZWNoYXQvdXJsLXV0aWxzJztcbmltcG9ydCB7IGdldFJvb3QsIHJlbW92ZU5vZGUgfSBmcm9tICdAbGl2ZWNoYXQvZG9tLXV0aWxzJztcbmltcG9ydCBzdG9yYWdlIGZyb20gJ0BsaXZlY2hhdC9pc29tb3JwaGljLXN0b3JhZ2UnO1xuXG4vLyB0aGlzIGlzIHRoZSBzYW1lIGFzIFwiaHR0cHM6Ly9hY2NvdW50cy5saXZlY2hhdGluYy5jb21cIlxuLy8gaXQncyBoYXJkY29kZWQgaGVyZSBiZWNhdXNlIGNoYXQuaW8gaGFzIGl0cyBvd24gQUNDT1VOVFNfVVJMXG4vLyBidXQgdGhpcyB2YXJpYWJsZSBoYXMgdG8gaGF2ZSB0aGUgc2FtZSB2YWx1ZSBmb3IgYm90aCBMaXZlQ2hhdCBhbmQgY2hhdC5pb1xudmFyIFBPU1RfTUVTU0FHRV9PUklHSU4gPSAnaHR0cHM6Ly9hY2NvdW50cy5saXZlY2hhdGluYy5jb20nOyAvLyBhcyBjb25zdFxuXG52YXIgQ1VTVE9NRVJfQVVUSF9GT09UUFJJTlQgPSAnQGxpdmVjaGF0L2N1c3RvbWVyLWF1dGgnOyAvLyBhcyBjb25zdFxuXG52YXIgQUNDT1VOVFNfVVJMID0gXCJodHRwczovL2FjY291bnRzLmxpdmVjaGF0aW5jLmNvbVwiO1xuXG52YXIgYnVpbGRQYXJhbXMgPSBmdW5jdGlvbiBidWlsZFBhcmFtcyhfcmVmLCByZWRpcmVjdFVyaSkge1xuICB2YXIgY2xpZW50SWQgPSBfcmVmLmNsaWVudElkLFxuICAgICAgbGljZW5zZUlkID0gX3JlZi5saWNlbnNlSWQ7XG4gIHJldHVybiB7XG4gICAgbGljZW5zZV9pZDogU3RyaW5nKGxpY2Vuc2VJZCksXG4gICAgZmxvdzogJ2J1dHRvbicsXG4gICAgcmVzcG9uc2VfdHlwZTogJ3Rva2VuJyxcbiAgICBjbGllbnRfaWQ6IGNsaWVudElkLFxuICAgIHJlZGlyZWN0X3VyaTogcmVkaXJlY3RVcmksXG4gICAgcG9zdF9tZXNzYWdlX3VyaTogcmVkaXJlY3RVcmksXG4gICAgc3RhdGU6IENVU1RPTUVSX0FVVEhfRk9PVFBSSU5UXG4gIH07XG59O1xuXG52YXIgYnVpbGRQYXRoID0gZnVuY3Rpb24gYnVpbGRQYXRoKF9yZWYyKSB7XG4gIHZhciB1bmlxdWVHcm91cHMgPSBfcmVmMi51bmlxdWVHcm91cHMsXG4gICAgICBsaWNlbnNlSWQgPSBfcmVmMi5saWNlbnNlSWQsXG4gICAgICBncm91cElkID0gX3JlZjIuZ3JvdXBJZDtcbiAgcmV0dXJuICh1bmlxdWVHcm91cHMgPyBcIi9saWNlbmNlL2dcIiArIGxpY2Vuc2VJZCArIFwiX1wiICsgZ3JvdXBJZCA6ICcnKSArIFwiL2N1c3RvbWVyXCI7XG59O1xuXG52YXIgYnVpbGRTcmMgPSBmdW5jdGlvbiBidWlsZFNyYyhjb25maWcsIHJlZGlyZWN0VXJpLCBlbnYpIHtcbiAgdmFyIHVybCA9IGVudiA9PT0gJ3Byb2R1Y3Rpb24nID8gQUNDT1VOVFNfVVJMIDogQUNDT1VOVFNfVVJMLnJlcGxhY2UoJ2FjY291bnRzLicsIFwiYWNjb3VudHMuXCIgKyBlbnYgKyBcIi5cIik7XG4gIHZhciBwYXRoID0gYnVpbGRQYXRoKGNvbmZpZyk7XG4gIHZhciBxdWVyeSA9IGJ1aWxkUXVlcnlTdHJpbmcoYnVpbGRQYXJhbXMoY29uZmlnLCByZWRpcmVjdFVyaSkpO1xuICByZXR1cm4gXCJcIiArIHVybCArIHBhdGggKyBcIj9cIiArIHF1ZXJ5O1xufTtcblxudmFyIGNyZWF0ZUVycm9yID0gZnVuY3Rpb24gY3JlYXRlRXJyb3IoX3JlZikge1xuICB2YXIgY29kZSA9IF9yZWYuY29kZSxcbiAgICAgIG1lc3NhZ2UgPSBfcmVmLm1lc3NhZ2U7XG4gIHZhciBlcnIgPSBuZXcgRXJyb3IobWVzc2FnZSk7XG4gIGVyci5jb2RlID0gY29kZTtcbiAgcmV0dXJuIGVycjtcbn07XG5cbnZhciBwYXJzZVRva2VuUmVzcG9uc2UgPSBmdW5jdGlvbiBwYXJzZVRva2VuUmVzcG9uc2UodG9rZW4sIGxpY2Vuc2VJZCkge1xuICBpZiAoJ2lkZW50aXR5X2V4Y2VwdGlvbicgaW4gdG9rZW4pIHtcbiAgICB0aHJvdyBjcmVhdGVFcnJvcih7XG4gICAgICBjb2RlOiAnU1NPX0lERU5USVRZX0VYQ0VQVElPTicsXG4gICAgICBtZXNzYWdlOiB0b2tlbi5pZGVudGl0eV9leGNlcHRpb25cbiAgICB9KTtcbiAgfVxuXG4gIGlmICgnb2F1dGhfZXhjZXB0aW9uJyBpbiB0b2tlbikge1xuICAgIHRocm93IGNyZWF0ZUVycm9yKHtcbiAgICAgIGNvZGU6ICdTU09fT0FVVEhfRVhDRVBUSU9OJyxcbiAgICAgIG1lc3NhZ2U6IHRva2VuLm9hdXRoX2V4Y2VwdGlvblxuICAgIH0pO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBhY2Nlc3NUb2tlbjogdG9rZW4uYWNjZXNzX3Rva2VuLFxuICAgIGVudGl0eUlkOiB0b2tlbi5lbnRpdHlfaWQsXG4gICAgZXhwaXJlc0luOiB0b2tlbi5leHBpcmVzX2luICogMTAwMCxcbiAgICB0b2tlblR5cGU6IHRva2VuLnRva2VuX3R5cGUsXG4gICAgY3JlYXRpb25EYXRlOiBEYXRlLm5vdygpLFxuICAgIGxpY2Vuc2VJZDogbGljZW5zZUlkXG4gIH07XG59O1xuXG52YXIgZ2V0UG9zdE1lc3NhZ2VPcmlnaW4gPSBmdW5jdGlvbiBnZXRQb3N0TWVzc2FnZU9yaWdpbihlbnYpIHtcbiAgcmV0dXJuIGVudiA9PT0gJ3Byb2R1Y3Rpb24nID8gUE9TVF9NRVNTQUdFX09SSUdJTiA6IFBPU1RfTUVTU0FHRV9PUklHSU4ucmVwbGFjZSgnYWNjb3VudHMuJywgXCJhY2NvdW50cy5cIiArIGVudiArIFwiLlwiKTtcbn07XG5cbnZhciBidWlsZElmcmFtZSA9IGZ1bmN0aW9uIGJ1aWxkSWZyYW1lKGNvbmZpZywgZW52KSB7XG4gIHZhciBpZnJhbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpZnJhbWUnKTtcbiAgaWZyYW1lLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XG4gIGlmcmFtZS5zZXRBdHRyaWJ1dGUoJ3NyYycsIGJ1aWxkU3JjKGNvbmZpZywgZ2V0T3JpZ2luKFN0cmluZyh3aW5kb3cubG9jYXRpb24pKSArIHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZSwgZW52KSk7XG4gIHJldHVybiBpZnJhbWU7XG59O1xuXG52YXIgaXNUb2tlblJlc3BvbnNlID0gZnVuY3Rpb24gaXNUb2tlblJlc3BvbnNlKGRhdGEpIHtcbiAgcmV0dXJuIGRhdGEgJiYgZGF0YS5zdGF0ZSA9PT0gQ1VTVE9NRVJfQVVUSF9GT09UUFJJTlQ7XG59O1xuXG52YXIgZmV0Y2hUb2tlbiA9IGZ1bmN0aW9uIGZldGNoVG9rZW4oY29uZmlnLCBlbnYpIHtcbiAgdmFyIGxpY2Vuc2VJZCA9IGNvbmZpZy5saWNlbnNlSWQ7XG4gIHZhciBwb3N0TWVzc2FnZU9yaWdpbiA9IGdldFBvc3RNZXNzYWdlT3JpZ2luKGVudik7XG4gIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgdmFyIGlmcmFtZSA9IGJ1aWxkSWZyYW1lKGNvbmZpZywgZW52KTtcblxuICAgIHZhciBjbGVhbnVwID0gZnVuY3Rpb24gY2xlYW51cCgpIHtcbiAgICAgIHJlbW92ZU5vZGUoaWZyYW1lKTsgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXVzZS1iZWZvcmUtZGVmaW5lXG5cbiAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdtZXNzYWdlJywgbGlzdGVuZXIsIGZhbHNlKTtcbiAgICB9O1xuXG4gICAgdmFyIHRpbWVvdXRJZCA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgY2xlYW51cCgpO1xuICAgICAgcmVqZWN0KGNyZWF0ZUVycm9yKHtcbiAgICAgICAgbWVzc2FnZTogJ1JlcXVlc3QgdGltZWQgb3V0LicsXG4gICAgICAgIGNvZGU6ICdSRVFVRVNUX1RJTUVPVVQnXG4gICAgICB9KSk7XG4gICAgfSwgMTUgKiAxMDAwKTtcblxuICAgIHZhciBsaXN0ZW5lciA9IGZ1bmN0aW9uIGxpc3RlbmVyKF9yZWYpIHtcbiAgICAgIHZhciBvcmlnaW4gPSBfcmVmLm9yaWdpbixcbiAgICAgICAgICBkYXRhID0gX3JlZi5kYXRhO1xuXG4gICAgICBpZiAob3JpZ2luICE9PSBwb3N0TWVzc2FnZU9yaWdpbikge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGlmICghaXNUb2tlblJlc3BvbnNlKGRhdGEpKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgY2xlYXJUaW1lb3V0KHRpbWVvdXRJZCk7XG4gICAgICBjbGVhbnVwKCk7XG5cbiAgICAgIHRyeSB7XG4gICAgICAgIHJlc29sdmUocGFyc2VUb2tlblJlc3BvbnNlKGRhdGEsIGxpY2Vuc2VJZCkpO1xuICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIGxpc3RlbmVyLCBmYWxzZSk7XG4gICAgZ2V0Um9vdCgpLnRoZW4oZnVuY3Rpb24gKGJvZHkpIHtcbiAgICAgIGJvZHkuYXBwZW5kQ2hpbGQoaWZyYW1lKTtcbiAgICB9KTtcbiAgfSk7XG59O1xuXG52YXIgdmFsaWRhdGVDb25maWcgPSBmdW5jdGlvbiB2YWxpZGF0ZUNvbmZpZyhfcmVmKSB7XG4gIHZhciBsaWNlbnNlSWQgPSBfcmVmLmxpY2Vuc2VJZCxcbiAgICAgIGNsaWVudElkID0gX3JlZi5jbGllbnRJZDtcblxuICBpZiAodHlwZW9mIGxpY2Vuc2VJZCAhPT0gJ251bWJlcicgfHwgdHlwZW9mIGNsaWVudElkICE9PSAnc3RyaW5nJykge1xuICAgIHRocm93IG5ldyBFcnJvcignWW91IG5lZWQgdG8gcGFzcyB2YWxpZCBjb25maWd1cmF0aW9uIG9iamVjdDogeyBsaWNlbnNlSWQsIGNsaWVudElkIH0uJyk7XG4gIH1cbn07XG5cbnZhciBpc0V4cGlyZWRUb2tlbiA9IGZ1bmN0aW9uIGlzRXhwaXJlZFRva2VuKF9yZWYpIHtcbiAgdmFyIGNyZWF0aW9uRGF0ZSA9IF9yZWYuY3JlYXRpb25EYXRlLFxuICAgICAgZXhwaXJlc0luID0gX3JlZi5leHBpcmVzSW47XG4gIHJldHVybiBEYXRlLm5vdygpID49IGNyZWF0aW9uRGF0ZSArIGV4cGlyZXNJbjtcbn07XG5cbnZhciBjcmVhdGVBdXRoID0gZnVuY3Rpb24gY3JlYXRlQXV0aChjb25maWcsIGVudikge1xuICB2YWxpZGF0ZUNvbmZpZyhjb25maWcpO1xuICB2YXIgY2FjaGVLZXkgPSBcIlwiICsgXCJAQGxjX2F1dGhfdG9rZW46XCIgKyBjb25maWcubGljZW5zZUlkICsgKGNvbmZpZy51bmlxdWVHcm91cHMgPyBcIjpcIiArIGNvbmZpZy5ncm91cElkIDogJycpO1xuICB2YXIgcGVuZGluZ1Rva2VuUmVxdWVzdCA9IG51bGw7XG4gIHZhciBjYWNoZWRUb2tlbiA9IG51bGw7XG4gIHZhciByZXRyaWV2aW5nVG9rZW4gPSBzdG9yYWdlLmdldEl0ZW0oY2FjaGVLZXkpLnRoZW4oZnVuY3Rpb24gKHRva2VuKSB7XG4gICAgaWYgKHJldHJpZXZpbmdUb2tlbiA9PT0gbnVsbCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHJldHJpZXZpbmdUb2tlbiA9IG51bGw7XG5cbiAgICBpZiAoIXRva2VuKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY2FjaGVkVG9rZW4gPSBKU09OLnBhcnNlKHRva2VuKTtcbiAgfSk7XG5cbiAgdmFyIGdldEZyZXNoVG9rZW4gPSBmdW5jdGlvbiBnZXRGcmVzaFRva2VuKCkge1xuICAgIHBlbmRpbmdUb2tlblJlcXVlc3QgPSBmZXRjaFRva2VuKGNvbmZpZywgZW52KS50aGVuKGZ1bmN0aW9uICh0b2tlbikge1xuICAgICAgcGVuZGluZ1Rva2VuUmVxdWVzdCA9IG51bGw7XG4gICAgICBzdG9yYWdlLnNldEl0ZW0oY2FjaGVLZXksIEpTT04uc3RyaW5naWZ5KHRva2VuKSk7XG4gICAgICBjYWNoZWRUb2tlbiA9IHRva2VuO1xuICAgICAgcmV0dXJuIHRva2VuO1xuICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgIHBlbmRpbmdUb2tlblJlcXVlc3QgPSBudWxsO1xuICAgICAgdGhyb3cgZXJyO1xuICAgIH0pO1xuICAgIHJldHVybiBwZW5kaW5nVG9rZW5SZXF1ZXN0O1xuICB9O1xuXG4gIHZhciBnZXRUb2tlbiA9IGZ1bmN0aW9uIGdldFRva2VuKCkge1xuICAgIGlmIChwZW5kaW5nVG9rZW5SZXF1ZXN0KSB7XG4gICAgICByZXR1cm4gcGVuZGluZ1Rva2VuUmVxdWVzdDtcbiAgICB9XG5cbiAgICBpZiAoY2FjaGVkVG9rZW4gJiYgIWlzRXhwaXJlZFRva2VuKGNhY2hlZFRva2VuKSkge1xuICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShjYWNoZWRUb2tlbik7XG4gICAgfVxuXG4gICAgaWYgKHJldHJpZXZpbmdUb2tlbikge1xuICAgICAgcmV0dXJuIHJldHJpZXZpbmdUb2tlbi50aGVuKGdldFRva2VuKTtcbiAgICB9XG5cbiAgICByZXR1cm4gZ2V0RnJlc2hUb2tlbigpO1xuICB9O1xuXG4gIHZhciBoYXNUb2tlbiA9IGZ1bmN0aW9uIGhhc1Rva2VuKCkge1xuICAgIGlmIChyZXRyaWV2aW5nVG9rZW4pIHtcbiAgICAgIHJldHVybiByZXRyaWV2aW5nVG9rZW4udGhlbihoYXNUb2tlbik7XG4gICAgfVxuXG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSghIWNhY2hlZFRva2VuKTtcbiAgfTtcblxuICB2YXIgaW52YWxpZGF0ZSA9IGZ1bmN0aW9uIGludmFsaWRhdGUoKSB7XG4gICAgY2FjaGVkVG9rZW4gPSBudWxsO1xuICAgIHJldHJpZXZpbmdUb2tlbiA9IG51bGw7XG4gICAgcmV0dXJuIHN0b3JhZ2UucmVtb3ZlSXRlbShjYWNoZUtleSk7XG4gIH07XG5cbiAgcmV0dXJuIHtcbiAgICBnZXRGcmVzaFRva2VuOiBnZXRGcmVzaFRva2VuLFxuICAgIGdldFRva2VuOiBnZXRUb2tlbixcbiAgICBoYXNUb2tlbjogaGFzVG9rZW4sXG4gICAgaW52YWxpZGF0ZTogaW52YWxpZGF0ZVxuICB9O1xufTtcblxuZXhwb3J0IGRlZmF1bHQgY3JlYXRlQXV0aDtcbmV4cG9ydCB7IGlzRXhwaXJlZFRva2VuLCB2YWxpZGF0ZUNvbmZpZyB9O1xuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///../../../node_modules/@livechat/customer-auth/dist/customer-auth.esm.js\n");

/***/ }),

/***/ "../../../node_modules/@livechat/customer-sdk/dist/customer-sdk.esm.js":
/*!*****************************************************************************!*\
  !*** ../../../node_modules/@livechat/customer-sdk/dist/customer-sdk.esm.js ***!
  \*****************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"init\": () => (/* binding */ init),\n/* harmony export */   \"debug\": () => (/* binding */ debug),\n/* harmony export */   \"parseFile\": () => (/* binding */ parseFile),\n/* harmony export */   \"parseFilledForm\": () => (/* binding */ parseFilledForm),\n/* harmony export */   \"parseMessage\": () => (/* binding */ parseMessage),\n/* harmony export */   \"parseRichMessage\": () => (/* binding */ parseRichMessage),\n/* harmony export */   \"parseSystemMessage\": () => (/* binding */ parseSystemMessage),\n/* harmony export */   \"parseEvent\": () => (/* binding */ parseEvent$1),\n/* harmony export */   \"parseGreeting\": () => (/* binding */ parseGreeting)\n/* harmony export */ });\n/* harmony import */ var _livechat_data_utils__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @livechat/data-utils */ \"../../../node_modules/@livechat/data-utils/dist/data-utils.es.js\");\n/* harmony import */ var _livechat_deferred__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @livechat/deferred */ \"../../../node_modules/@livechat/deferred/dist/deferred.esm.js\");\n/* harmony import */ var redux__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! redux */ \"../../../node_modules/redux/es/redux.js\");\n/* harmony import */ var _livechat_side_effects_middleware__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @livechat/side-effects-middleware */ \"../../../node_modules/@livechat/side-effects-middleware/es/index.js\");\n/* harmony import */ var _livechat_isomorphic_storage__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @livechat/isomorphic-storage */ \"../../../node_modules/@livechat/isomorphic-storage/dist/isomorphic-storage.es.js\");\n/* harmony import */ var _livechat_promise_try__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @livechat/promise-try */ \"../../../node_modules/@livechat/promise-try/dist/promise-try.es.js\");\n/* harmony import */ var backo2__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! backo2 */ \"../../../node_modules/backo2/index.js\");\n/* harmony import */ var backo2__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(backo2__WEBPACK_IMPORTED_MODULE_5__);\n/* harmony import */ var unfetch__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! unfetch */ \"../../../node_modules/unfetch/dist/unfetch.es.js\");\n/* harmony import */ var _livechat_url_utils__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! @livechat/url-utils */ \"../../../node_modules/@livechat/url-utils/dist/url-utils.esm.js\");\n/* harmony import */ var _livechat_platform_client__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! @livechat/platform-client */ \"../../../node_modules/@livechat/platform-client/dist/platform-client.esm.js\");\n/* harmony import */ var _livechat_mitt__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! @livechat/mitt */ \"../../../node_modules/@livechat/mitt/dist/livechat-mitt.es.js\");\n/* harmony import */ var _livechat_file_upload__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! @livechat/file-upload */ \"../../../node_modules/@livechat/file-upload/dist/file-upload.es.js\");\n/* harmony import */ var _livechat_customer_auth__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! @livechat/customer-auth */ \"../../../node_modules/@livechat/customer-auth/dist/customer-auth.esm.js\");\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nfunction _extends() {\n  _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n\n  return _extends.apply(this, arguments);\n}\n\nfunction _objectWithoutPropertiesLoose(source, excluded) {\n  if (source == null) return {};\n  var target = {};\n  var sourceKeys = Object.keys(source);\n  var key, i;\n\n  for (i = 0; i < sourceKeys.length; i++) {\n    key = sourceKeys[i];\n    if (excluded.indexOf(key) >= 0) continue;\n    target[key] = source[key];\n  }\n\n  return target;\n}\n\nfunction _toPrimitive(input, hint) {\n  if (typeof input !== \"object\" || input === null) return input;\n  var prim = input[Symbol.toPrimitive];\n\n  if (prim !== undefined) {\n    var res = prim.call(input, hint || \"default\");\n    if (typeof res !== \"object\") return res;\n    throw new TypeError(\"@@toPrimitive must return a primitive value.\");\n  }\n\n  return (hint === \"string\" ? String : Number)(input);\n}\n\nfunction _toPropertyKey(arg) {\n  var key = _toPrimitive(arg, \"string\");\n\n  return typeof key === \"symbol\" ? key : String(key);\n}\n\nvar CHANGE_REGION = 'change_region';\nvar CHECK_GOALS = 'check_goals';\nvar DESTROY = 'destroy';\nvar FAIL_ALL_REQUESTS = 'fail_all_requests';\nvar LOGIN_SUCCESS = 'login_success';\nvar PAUSE_CONNECTION = 'pause_connection';\nvar PREFETCH_TOKEN = 'prefetch_token';\nvar PUSH_RECEIVED = 'push_received';\nvar PUSH_RESPONSE_RECEIVED = 'push_response_received';\nvar RECONNECT = 'reconnect';\nvar REQUEST_FAILED = 'request_failed';\nvar RESPONSE_RECEIVED = 'response_received';\nvar SEND_REQUEST = 'send_request';\nvar SET_CHAT_ACTIVE = 'set_chat_active';\nvar SET_SELF_ID = 'set_self_id';\nvar SOCKET_CONNECTED = 'socket_connected';\nvar SOCKET_DISCONNECTED = 'socket_disconnected';\nvar SOCKET_RECOVERED = 'socket_recovered';\nvar SOCKET_UNSTABLE = 'socket_unstable';\nvar START_CONNECTION = 'start_connection';\nvar UPDATE_CUSTOMER_PAGE = 'update_customer_page';\n\nvar CONNECTION_LOST = 'CONNECTION_LOST';\nvar IDENTITY_MISMATCH = 'IDENTITY_MISMATCH';\nvar MISDIRECTED_CONNECTION = 'MISDIRECTED_CONNECTION';\nvar MISSING_CHAT_THREAD = 'MISSING_CHAT_THREAD';\nvar REQUEST_TIMEOUT = 'REQUEST_TIMEOUT';\nvar TOO_MANY_UNAUTHORIZED_CONNECTIONS = 'TOO_MANY_UNAUTHORIZED_CONNECTIONS';\n\nvar ACCEPT_GREETING = 'accept_greeting';\nvar ACTIVATE_CHAT = 'activate_chat';\nvar CANCEL_GREETING = 'cancel_greeting';\nvar CHECK_GOALS$1 = 'check_goals';\nvar DEACTIVATE_CHAT = 'deactivate_chat';\nvar DELETE_CHAT_PROPERTIES = 'delete_chat_properties';\nvar DELETE_EVENT_PROPERTIES = 'delete_event_properties';\nvar DELETE_THREAD_PROPERTIES = 'delete_thread_properties';\nvar GET_CHAT = 'get_chat';\nvar GET_CUSTOMER = 'get_customer';\nvar GET_FORM = 'get_form';\nvar GET_PREDICTED_AGENT = 'get_predicted_agent';\nvar GET_URL_INFO = 'get_url_info';\nvar LIST_CHATS = 'list_chats';\nvar LIST_GROUP_STATUSES = 'list_group_statuses';\nvar LIST_THREADS = 'list_threads';\nvar LOGIN = 'login';\nvar MARK_EVENTS_AS_SEEN = 'mark_events_as_seen';\nvar SEND_EVENT = 'send_event';\nvar SEND_RICH_MESSAGE_POSTBACK = 'send_rich_message_postback';\nvar SEND_SNEAK_PEEK = 'send_sneak_peek';\nvar SET_CUSTOMER_SESSION_FIELDS = 'set_customer_session_fields';\nvar START_CHAT = 'start_chat';\nvar UPDATE_CHAT_PROPERTIES = 'update_chat_properties';\nvar UPDATE_CUSTOMER = 'update_customer';\nvar UPDATE_CUSTOMER_PAGE$1 = 'update_customer_page';\nvar UPDATE_EVENT_PROPERTIES = 'update_event_properties';\nvar UPDATE_THREAD_PROPERTIES = 'update_thread_properties';\nvar UPLOAD_FILE = 'upload_file';\n\nvar DESC = 'desc';\n\nvar createReducer = function createReducer(initialState, reducersMap) {\n  if (false) {}\n\n  return function reducer(state, action) {\n    if (state === void 0) {\n      state = initialState;\n    }\n\n    if ((0,_livechat_data_utils__WEBPACK_IMPORTED_MODULE_0__.hasOwn)(action.type, reducersMap)) {\n      return reducersMap[action.type](state, action.payload);\n    }\n\n    return state;\n  };\n}; // TODO: this is the same as built-in redux's combineReducers, should be remobed\n\nvar CONNECTED = 'connected';\nvar DESTROYED = 'destroyed';\nvar DISCONNECTED = 'disconnected';\nvar PAUSED = 'paused';\nvar RECONNECTING = 'reconnecting';\n\nvar AGENT = 'agent';\nvar CUSTOMER = 'customer';\n\nvar getAllRequests = function getAllRequests(state) {\n  return state.requests;\n};\nvar getConnectionStatus = function getConnectionStatus(state) {\n  return state.connection.status;\n};\nvar getRequest = function getRequest(state, id) {\n  return state.requests[id];\n};\nvar getSelfId = function getSelfId(state) {\n  return state.users.self.id;\n};\nvar isChatActive = function isChatActive(state, chatId) {\n  var chat = state.chats[chatId];\n  return !!chat && chat.active;\n};\nvar isConnected = function isConnected(state) {\n  return getConnectionStatus(state) === CONNECTED;\n};\nvar isDestroyed = function isDestroyed(state) {\n  return getConnectionStatus(state) === DESTROYED;\n};\n\nvar getEnvPart = function getEnvPart(_ref) {\n  var licenseId = _ref.licenseId,\n      env = _ref.env;\n\n  if (licenseId === 1520) {\n    return '.staging';\n  }\n\n  if (env === 'production') {\n    return '';\n  }\n\n  return \".\" + env;\n};\n\nvar getApiOrigin = function getApiOrigin(state) {\n  var region = state.region;\n  var regionPart = region ? \"-\" + region : '';\n  return \"https://api\" + regionPart + getEnvPart(state) + \".livechatinc.com\";\n};\nvar getServerUrl = function getServerUrl(state) {\n  return getApiOrigin(state) + \"/v3.2/customer\";\n};\nvar createInitialState = function createInitialState(initialStateData) {\n  var _initialStateData$app = initialStateData.application,\n      application = _initialStateData$app === void 0 ? {} : _initialStateData$app,\n      licenseId = initialStateData.licenseId,\n      _initialStateData$gro = initialStateData.groupId,\n      groupId = _initialStateData$gro === void 0 ? null : _initialStateData$gro,\n      env = initialStateData.env,\n      _initialStateData$pag = initialStateData.page,\n      page = _initialStateData$pag === void 0 ? null : _initialStateData$pag,\n      _initialStateData$reg = initialStateData.region,\n      region = _initialStateData$reg === void 0 ? null : _initialStateData$reg,\n      _initialStateData$ref = initialStateData.referrer,\n      referrer = _initialStateData$ref === void 0 ? null : _initialStateData$ref,\n      _initialStateData$uni = initialStateData.uniqueGroups,\n      uniqueGroups = _initialStateData$uni === void 0 ? false : _initialStateData$uni,\n      _initialStateData$mob = initialStateData.mobile,\n      mobile = _initialStateData$mob === void 0 ? false : _initialStateData$mob;\n  return {\n    application: _extends({}, application, {\n      name: \"customer_sdk\",\n      version: \"2.0.4\"\n    }),\n    licenseId: licenseId,\n    env: env,\n    groupId: groupId,\n    chats: {},\n    connection: {\n      status: DISCONNECTED\n    },\n    page: page,\n    region: region,\n    referrer: referrer,\n    requests: {},\n    users: {\n      self: {\n        id: null,\n        type: CUSTOMER\n      },\n      others: {}\n    },\n    uniqueGroups: uniqueGroups,\n    mobile: mobile\n  };\n};\n\nvar removeStoredRequest = function removeStoredRequest(state, _ref2) {\n  var id = _ref2.id;\n\n  // eslint-disable-next-line no-unused-vars\n  var _state$requests = state.requests,\n      requests = _objectWithoutPropertiesLoose(_state$requests, [id].map(_toPropertyKey));\n\n  return _extends({}, state, {\n    requests: requests\n  });\n};\n\nvar setConnectionStatus = function setConnectionStatus(status, state) {\n  return _extends({}, state, {\n    connection: _extends({}, state.connection, {\n      status: status\n    })\n  });\n};\n\nvar createReducer$1 = (function (state) {\n  var _createReducer;\n\n  return createReducer(state, (_createReducer = {}, _createReducer[CHANGE_REGION] = function (state, _ref3) {\n    var region = _ref3.region;\n    return _extends({}, state, {\n      region: region\n    });\n  }, _createReducer[DESTROY] = function (state) {\n    return setConnectionStatus(DESTROYED, state);\n  }, _createReducer[LOGIN_SUCCESS] = function (state) {\n    return setConnectionStatus(CONNECTED, state);\n  }, _createReducer[PAUSE_CONNECTION] = function (state) {\n    return setConnectionStatus(PAUSED, state);\n  }, _createReducer[REQUEST_FAILED] = removeStoredRequest, _createReducer[RESPONSE_RECEIVED] = removeStoredRequest, _createReducer[SEND_REQUEST] = function (state, _ref4) {\n    var _extends2;\n\n    var promise = _ref4.promise,\n        resolve = _ref4.resolve,\n        reject = _ref4.reject,\n        id = _ref4.id,\n        request = _ref4.request;\n    return _extends({}, state, {\n      requests: _extends({}, state.requests, (_extends2 = {}, _extends2[id] = {\n        id: id,\n        promise: promise,\n        resolve: resolve,\n        reject: reject,\n        request: request\n      }, _extends2))\n    });\n  }, _createReducer[SET_CHAT_ACTIVE] = function (state, _ref5) {\n    var _extends3;\n\n    var id = _ref5.id,\n        active = _ref5.active;\n    return _extends({}, state, {\n      chats: _extends({}, state.chats, (_extends3 = {}, _extends3[id] = _extends({}, state.chats[id], {\n        active: active\n      }), _extends3))\n    });\n  }, _createReducer[SET_SELF_ID] = function (state, payload) {\n    return _extends({}, state, {\n      users: _extends({}, state.users, {\n        self: _extends({}, state.users.self, {\n          id: payload.id\n        })\n      })\n    });\n  }, _createReducer[SOCKET_DISCONNECTED] = function (state) {\n    var previousStatus = getConnectionStatus(state);\n\n    if ( true && (previousStatus === PAUSED || previousStatus === DESTROYED)) {\n      throw new Error(\"Got 'socket_disconnected' action when in \" + previousStatus + \" state. This should be an impossible state.\");\n    }\n\n    var state1 = setConnectionStatus(previousStatus === DISCONNECTED ? DISCONNECTED : RECONNECTING, state);\n    return _extends({}, state1, {\n      requests: {}\n    });\n  }, _createReducer[UPDATE_CUSTOMER_PAGE] = function (state, page) {\n    return _extends({}, state, {\n      page: _extends({}, state.page, page)\n    });\n  }, _createReducer));\n});\n\nfunction finalCreateStore(initialStateData) {\n  var compose =  true && typeof window !== 'undefined' && window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ ? window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__({\n    name: '@livechat/customer-sdk'\n  }) : _livechat_data_utils__WEBPACK_IMPORTED_MODULE_0__.identity;\n  var sideEffectsMiddleware = (0,_livechat_side_effects_middleware__WEBPACK_IMPORTED_MODULE_2__.default)();\n  var store = (0,redux__WEBPACK_IMPORTED_MODULE_12__.createStore)(createReducer$1(createInitialState(initialStateData)), compose((0,redux__WEBPACK_IMPORTED_MODULE_12__.applyMiddleware)(sideEffectsMiddleware)));\n  store.addSideEffectsHandler = sideEffectsMiddleware.add;\n  return store;\n}\n\nfunction createError(_ref) {\n  var message = _ref.message,\n      code = _ref.code;\n  var error = new Error(message);\n  error.code = code;\n  return error;\n}\n\nvar ACCESS_TOKEN_EXPIRED = 'access_token_expired';\nvar CUSTOMER_BANNED = 'customer_banned';\nvar CUSTOMER_TEMPORARILY_BLOCKED = 'customer_temporarily_blocked';\nvar LICENSE_NOT_FOUND = 'license_not_found';\nvar MISDIRECTED_CONNECTION$1 = 'misdirected_connection';\nvar PRODUCT_VERSION_CHANGED = 'product_version_changed';\nvar TOO_MANY_CONNECTIONS = 'too_many_connections'; // the limit of unauthorized connections is per IP\n\nvar TOO_MANY_UNAUTHORIZED_CONNECTIONS$1 = 'too_many_unauthorized_connections';\nvar UNSUPPORTED_VERSION = 'unsupported_version';\n\nvar CHAT_DEACTIVATED = 'chat_deactivated';\nvar CHAT_PROPERTIES_DELETED = 'chat_properties_deleted';\nvar CHAT_PROPERTIES_UPDATED = 'chat_properties_updated';\nvar CHAT_TRANSFERRED = 'chat_transferred';\nvar CUSTOMER_DISCONNECTED = 'customer_disconnected';\nvar CUSTOMER_PAGE_UPDATED = 'customer_page_updated';\nvar CUSTOMER_SIDE_STORAGE_UPDATED = 'customer_side_storage_updated';\nvar CUSTOMER_UPDATED = 'customer_updated';\nvar EVENT_PROPERTIES_DELETED = 'event_properties_deleted';\nvar EVENT_PROPERTIES_UPDATED = 'event_properties_updated';\nvar EVENT_UPDATED = 'event_updated';\nvar EVENTS_MARKED_AS_SEEN = 'events_marked_as_seen';\nvar GREETING_ACCEPTED = 'greeting_accepted';\nvar GREETING_CANCELED = 'greeting_canceled';\nvar INCOMING_CHAT = 'incoming_chat';\nvar INCOMING_EVENT = 'incoming_event';\nvar INCOMING_GREETING = 'incoming_greeting';\nvar INCOMING_MULTICAST = 'incoming_multicast';\nvar INCOMING_RICH_MESSAGE_POSTBACK = 'incoming_rich_message_postback';\nvar INCOMING_TYPING_INDICATOR = 'incoming_typing_indicator';\nvar QUEUE_POSITION_UPDATED = 'queue_position_updated';\nvar THREAD_PROPERTIES_DELETED = 'thread_properties_deleted';\nvar THREAD_PROPERTIES_UPDATED = 'thread_properties_updated';\nvar USER_ADDED_TO_CHAT = 'user_added_to_chat';\nvar USER_REMOVED_FROM_CHAT = 'user_removed_from_chat';\n\nvar FILE = 'file';\nvar FILLED_FORM = 'filled_form';\nvar MESSAGE = 'message';\nvar RICH_MESSAGE = 'rich_message';\nvar SYSTEM_MESSAGE = 'system_message';\n\nvar createEventBase = function createEventBase(event) {\n  var base = {};\n\n  if (typeof event.customId === 'string') {\n    base.custom_id = event.customId;\n  }\n\n  if ((0,_livechat_data_utils__WEBPACK_IMPORTED_MODULE_0__.isObject)(event.properties)) {\n    base.properties = event.properties;\n  }\n\n  return base;\n}; // TODO: we could validate and throw here\n// but should we? maybe only in DEV mode?\n\n\nvar parseEvent = function parseEvent(event) {\n  switch (event.type) {\n    case MESSAGE:\n      {\n        var message = _extends({}, createEventBase(event), {\n          type: event.type,\n          text: event.text\n        });\n\n        if (event.postback) {\n          message.postback = {\n            id: event.postback.id,\n            thread_id: event.postback.threadId,\n            event_id: event.postback.eventId,\n            type: event.postback.type,\n            value: event.postback.value\n          };\n        }\n\n        return message;\n      }\n\n    case FILE:\n      {\n        var file = _extends({}, createEventBase(event), {\n          type: event.type,\n          url: event.url\n        });\n\n        return file;\n      }\n\n    case FILLED_FORM:\n      {\n        var filledForm = _extends({}, createEventBase(event), {\n          type: event.type,\n          form_id: event.formId,\n          fields: event.fields.map(function (field) {\n            switch (field.type) {\n              case 'group_chooser':\n                {\n                  if (!field.answer) {\n                    return field;\n                  }\n\n                  var _field$answer = field.answer,\n                      groupId = _field$answer.groupId,\n                      answer = _objectWithoutPropertiesLoose(_field$answer, [\"groupId\"]);\n\n                  return _extends({}, field, {\n                    answer: _extends({}, answer, {\n                      group_id: groupId\n                    })\n                  });\n                }\n\n              default:\n                return field;\n            }\n          })\n        });\n\n        return filledForm;\n      }\n\n    case SYSTEM_MESSAGE:\n      {\n        var systemMessage = _extends({}, createEventBase(event), {\n          type: event.type,\n          text: event.text,\n          system_message_type: event.systemMessageType\n        });\n\n        if (event.recipients) {\n          systemMessage.recipients = event.recipients;\n        }\n\n        return systemMessage;\n      }\n  }\n};\n\nvar parseThreadData = function parseThreadData(thread) {\n  var data = {};\n  var events = thread.events,\n      properties = thread.properties;\n\n  if (events) {\n    data.events = events.map(parseEvent);\n  }\n\n  if (properties) {\n    data.properties = properties;\n  }\n\n  return data;\n};\n\nvar parseStartChatData = function parseStartChatData(_ref) {\n  var chat = _ref.chat,\n      continuous = _ref.continuous;\n  var data = {\n    chat: {}\n  };\n\n  if (typeof continuous === 'boolean') {\n    data.continuous = continuous;\n  }\n\n  if (!chat) {\n    return data;\n  }\n\n  var access = chat.access,\n      thread = chat.thread,\n      properties = chat.properties;\n\n  if (access && access.groupIds) {\n    data.chat.access = {\n      group_ids: access.groupIds\n    };\n  }\n\n  if (properties) {\n    data.chat.properties = properties;\n  }\n\n  if (thread) {\n    data.chat.thread = parseThreadData(thread);\n  }\n\n  return data;\n};\nvar parseActivateChatData = function parseActivateChatData(requestData) {\n  var data = parseStartChatData(requestData);\n  return _extends({}, data, {\n    chat: _extends({}, data.chat, {\n      id: requestData.chat.id\n    })\n  });\n};\nvar parseCustomerSessionFields = function parseCustomerSessionFields(sessionFields) {\n  return (0,_livechat_data_utils__WEBPACK_IMPORTED_MODULE_0__.toPairs)(sessionFields).map(function (_ref2) {\n    var _ref3;\n\n    var key = _ref2[0],\n        value = _ref2[1];\n    return _ref3 = {}, _ref3[key] = value, _ref3;\n  });\n};\nvar parseCustomerUpdate = function parseCustomerUpdate(update) {\n  var result = (0,_livechat_data_utils__WEBPACK_IMPORTED_MODULE_0__.pickOwn)(['avatar', 'name', 'email'], update);\n\n  if (update.sessionFields) {\n    result.session_fields = parseCustomerSessionFields(update.sessionFields);\n  }\n\n  return result;\n};\n\nvar destroy = function destroy(reason) {\n  return {\n    type: DESTROY,\n    payload: {\n      reason: reason\n    }\n  };\n};\nvar loginSuccess = function loginSuccess(payload) {\n  return {\n    type: LOGIN_SUCCESS,\n    payload: payload\n  };\n};\nvar prefetchToken = function prefetchToken(fresh) {\n  if (fresh === void 0) {\n    fresh = false;\n  }\n\n  return {\n    type: PREFETCH_TOKEN,\n    payload: {\n      fresh: fresh\n    }\n  };\n};\nvar reconnect = function reconnect(delay) {\n  return {\n    type: RECONNECT,\n    payload: {\n      delay: delay\n    }\n  };\n}; // TODO: this one was currently pretty hard to type in full\n// we should explore providing stricter types for this in the future\n\nvar sendRequest = function sendRequest(action, payload, source) {\n  return {\n    type: SEND_REQUEST,\n    payload: _extends({\n      request: {\n        action: action,\n        payload: payload\n      }\n    }, source && {\n      source: source\n    })\n  };\n};\nvar sendEvent = function sendEvent(_ref) {\n  var chatId = _ref.chatId,\n      event = _ref.event,\n      attachToLastThread = _ref.attachToLastThread;\n  var payload = {\n    chat_id: chatId,\n    event: parseEvent(event)\n  };\n\n  if (attachToLastThread) {\n    payload.attach_to_last_thread = true;\n  }\n\n  return sendRequest(SEND_EVENT, payload);\n};\nvar setChatActive = function setChatActive(id, active) {\n  return {\n    type: SET_CHAT_ACTIVE,\n    payload: {\n      id: id,\n      active: active\n    }\n  };\n};\nvar setSelfId = function setSelfId(id) {\n  return {\n    type: SET_SELF_ID,\n    payload: {\n      id: id\n    }\n  };\n};\nvar socketDisconnected = function socketDisconnected() {\n  return {\n    type: SOCKET_DISCONNECTED\n  };\n};\n\n// TODO: this thing is not really well typed and should be improved\nvar sendRequestAction = function sendRequestAction(store, action) {\n  action.payload.id = (0,_livechat_data_utils__WEBPACK_IMPORTED_MODULE_0__.generateUniqueId)(store.getState().requests);\n\n  var _deferred = (0,_livechat_deferred__WEBPACK_IMPORTED_MODULE_1__.default)(),\n      resolve = _deferred.resolve,\n      reject = _deferred.reject,\n      promise = _deferred.promise;\n\n  action.payload.promise = promise;\n  action.payload.resolve = resolve;\n  action.payload.reject = reject;\n  store.dispatch(action);\n  return promise;\n};\n\nvar AUTHENTICATION = 'AUTHENTICATION';\nvar CUSTOMER_BANNED$1 = 'CUSTOMER_BANNED';\nvar USERS_LIMIT_REACHED = 'USERS_LIMIT_REACHED';\nvar WRONG_PRODUCT_VERSION = 'WRONG_PRODUCT_VERSION';\n\nvar getSideStorageKey = function getSideStorageKey(store) {\n  var _store$getState = store.getState(),\n      licenseId = _store$getState.licenseId,\n      groupId = _store$getState.groupId,\n      uniqueGroups = _store$getState.uniqueGroups;\n\n  return \"side_storage_\" + licenseId + (uniqueGroups ? \":\" + groupId : '');\n};\n\nvar getSideStorage = function getSideStorage(store) {\n  return _livechat_isomorphic_storage__WEBPACK_IMPORTED_MODULE_3__.default.getItem(getSideStorageKey(store)).catch(_livechat_data_utils__WEBPACK_IMPORTED_MODULE_0__.noop).then(function (sideStorage) {\n    return JSON.parse(sideStorage || '{}');\n  }) // shouldnt get triggered, just a defensive measure against malformed storage entries\n  .catch(function () {\n    return {};\n  });\n};\nvar saveSideStorage = function saveSideStorage(store, sideStorage) {\n  return _livechat_isomorphic_storage__WEBPACK_IMPORTED_MODULE_3__.default.setItem(getSideStorageKey(store), JSON.stringify(sideStorage)).catch(_livechat_data_utils__WEBPACK_IMPORTED_MODULE_0__.noop);\n};\n\nvar taskChain = function taskChain(_ref, onSuccess, onError) {\n  var steps = _ref.slice(0);\n\n  var cancelled = false;\n\n  var next = function next(intermediateResult) {\n    var step = steps.shift();\n    (0,_livechat_promise_try__WEBPACK_IMPORTED_MODULE_4__.default)(function () {\n      return step(intermediateResult);\n    }).then(function (result) {\n      if (cancelled) {\n        return;\n      }\n\n      if (steps.length) {\n        next(result);\n        return;\n      }\n\n      onSuccess(result);\n    }, function (error) {\n      if (cancelled) {\n        return;\n      }\n\n      onError(error);\n    });\n  };\n\n  next();\n  return {\n    cancel: function cancel() {\n      cancelled = true;\n    }\n  };\n};\n\nvar sendLoginFlowRequest = function sendLoginFlowRequest(store, type, payload) {\n  return sendRequestAction(store, sendRequest(type, payload, 'login'));\n};\n\nvar delay = function delay(ms) {\n  return new Promise(function (resolve) {\n    setTimeout(resolve, ms);\n  });\n};\n\nfunction createLoginTask(auth, customerDataProvider) {\n  var store;\n  var sentPage = null;\n  var task;\n  var backoff = new (backo2__WEBPACK_IMPORTED_MODULE_5___default())({\n    min: 300,\n    max: 60000,\n    jitter: 0.3\n  });\n\n  var destroy$$1 = function destroy$$1(reason) {\n    return store.dispatch(destroy(reason));\n  };\n\n  var reconnect$$1 = function reconnect$$1() {\n    return store.dispatch(reconnect(backoff.duration()));\n  };\n\n  var getTokenAndSideStorage = function getTokenAndSideStorage() {\n    return Promise.all([auth.getToken(), getSideStorage(store)]);\n  };\n\n  var dispatchSelfId = function dispatchSelfId(_ref2) {\n    var token = _ref2[0],\n        sideStorage = _ref2[1];\n    var selfId = getSelfId(store.getState());\n\n    if (selfId === null) {\n      store.dispatch(setSelfId(token.entityId));\n    } else if (selfId !== token.entityId) {\n      var err = new Error('Identity has changed.');\n      err.code = IDENTITY_MISMATCH;\n      throw err;\n    }\n\n    return [token, sideStorage];\n  };\n\n  var sendLogin = function sendLogin(_ref3) {\n    var token = _ref3[0],\n        sideStorage = _ref3[1];\n    var state = store.getState();\n    var application = state.application,\n        groupId = state.groupId,\n        page = state.page,\n        referrer = state.referrer,\n        mobile = state.mobile;\n    var payload = {\n      token: token.tokenType + \" \" + token.accessToken,\n      customer: typeof customerDataProvider === 'function' ? parseCustomerUpdate(customerDataProvider()) : {},\n      customer_side_storage: sideStorage,\n      is_mobile: mobile,\n      application: (0,_livechat_data_utils__WEBPACK_IMPORTED_MODULE_0__.pick)(['name', 'version'], application)\n    };\n\n    if (typeof groupId === 'number') {\n      payload.group_id = groupId;\n    }\n\n    if (application.channelType) {\n      payload.application.channel_type = application.channelType;\n    }\n\n    if (page !== null) {\n      sentPage = page;\n      payload.customer_page = page;\n    }\n\n    if (referrer !== null) {\n      payload.referrer = referrer;\n    }\n\n    return Promise.race([sendLoginFlowRequest(store, LOGIN, payload), delay(15 * 1000).then(function () {\n      return Promise.reject(createError({\n        message: 'Request timed out.',\n        code: REQUEST_TIMEOUT\n      }));\n    })]);\n  };\n\n  var updateCustomerPageIfNeeded = function updateCustomerPageIfNeeded() {\n    var _store$getState = store.getState(),\n        page = _store$getState.page;\n\n    if (sentPage !== page) {\n      sendLoginFlowRequest(store, UPDATE_CUSTOMER_PAGE$1, page).catch(_livechat_data_utils__WEBPACK_IMPORTED_MODULE_0__.noop);\n    }\n\n    sentPage = null;\n  };\n\n  return function (_store) {\n    // after switching to callbags, we should be able to use smth similar to redux-observable\n    // and thus just use store given to epic\n    store = _store;\n\n    if (task) {\n      task.cancel();\n    }\n\n    task = taskChain([getTokenAndSideStorage, dispatchSelfId, sendLogin], function (loginResponse) {\n      task = null;\n      backoff.reset(); // TODO: rethink if this should be handled by SDK consumer\n\n      updateCustomerPageIfNeeded();\n      store.dispatch(loginSuccess(loginResponse));\n    }, function (error) {\n      if (true) {\n        console.error('[Customer SDK] Login flow has thrown code', error.code, 'with', error);\n      }\n\n      switch (error.code) {\n        case AUTHENTICATION:\n          auth.getFreshToken();\n          reconnect$$1();\n          return;\n\n        case CONNECTION_LOST:\n          // this is connectivity problem, not a server error\n          // and is taken care of in socket module\n          // as it has its own backoff implementation\n          return;\n\n        case MISDIRECTED_CONNECTION:\n          // socket gets reinitialized on this anyway, so just ignore it here\n          return;\n        // those are auth errors, we should maybe export those constants from the auth package\n\n        case 'SSO_IDENTITY_EXCEPTION':\n        case 'SSO_OAUTH_EXCEPTION':\n          if (error.message === 'server_error' || error.message === 'temporarily_unavailable') {\n            reconnect$$1();\n            return;\n          }\n\n          destroy$$1(error.message);\n          return;\n\n        case IDENTITY_MISMATCH:\n        case CUSTOMER_BANNED$1:\n        case USERS_LIMIT_REACHED:\n        case WRONG_PRODUCT_VERSION:\n          destroy$$1(error.code.toLowerCase());\n          return;\n\n        default:\n          reconnect$$1();\n          return;\n      }\n    });\n  };\n}\n\nvar checkGoals = function checkGoals(store, auth, sessionFields) {\n  return auth.getToken().then(function (token) {\n    var state = store.getState();\n\n    if (getSelfId(state) === null) {\n      store.dispatch(setSelfId(token.entityId));\n    }\n\n    var page = state.page;\n\n    if (!page || !page.url) {\n      return;\n    }\n\n    var query = (0,_livechat_url_utils__WEBPACK_IMPORTED_MODULE_7__.buildQueryString)({\n      license_id: state.licenseId\n    });\n    var payload = {\n      // TODO: remove sending customer_fields once API releases their changes\n      customer_fields: sessionFields || {},\n      session_fields: parseCustomerSessionFields(sessionFields || {}),\n      group_id: state.groupId || 0,\n      page_url: page.url\n    };\n    return (0,unfetch__WEBPACK_IMPORTED_MODULE_6__.default)(getServerUrl(state) + \"/action/\" + CHECK_GOALS$1 + \"?\" + query, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        Authorization: token.tokenType + \" \" + token.accessToken\n      },\n      body: JSON.stringify(payload)\n    }).then(function () {\n      // TODO: we should actually normalize response here\n      return undefined;\n    });\n  });\n};\n\nvar failAllRequests = function failAllRequests(_ref, reason) {\n  var getState = _ref.getState,\n      dispatch = _ref.dispatch;\n  var state = getState();\n  var requests = getAllRequests(state);\n  dispatch({\n    type: FAIL_ALL_REQUESTS,\n    payload: {\n      rejects: Object.keys(requests).map(function (requestId) {\n        return requests[requestId].reject;\n      }),\n      reason: reason\n    }\n  });\n};\nvar failRequest = function failRequest(_ref2, requestAction, error) {\n  var getState = _ref2.getState,\n      dispatch = _ref2.dispatch;\n  var requestId = requestAction.payload.id;\n  dispatch({\n    type: REQUEST_FAILED,\n    payload: {\n      id: requestId,\n      reject: getState().requests[requestId].reject,\n      error: error\n    }\n  });\n};\n\nvar SUCCESS = Object.freeze({\n  success: true\n});\n\nvar parseCommonEventProps = function parseCommonEventProps(threadId, event) {\n  var parsed = {\n    id: event.id,\n    authorId: event.author_id,\n    createdAt: event.created_at,\n    threadId: threadId,\n    properties: event.properties || {}\n  };\n\n  if (event.custom_id !== undefined) {\n    parsed.customId = event.custom_id;\n  }\n\n  return parsed;\n};\n\nvar downsizeWithRatio = function downsizeWithRatio(max, dimensions) {\n  var _ref;\n\n  var biggerProp;\n  var smallerProp;\n  var bigger;\n  var smaller;\n\n  if (dimensions.height > dimensions.width) {\n    biggerProp = 'height';\n    smallerProp = 'width';\n    bigger = dimensions.height;\n    smaller = dimensions.width;\n  } else {\n    biggerProp = 'width';\n    smallerProp = 'height';\n    bigger = dimensions.width;\n    smaller = dimensions.height;\n  }\n\n  var ratio = max / bigger;\n  return _ref = {}, _ref[biggerProp] = Math.ceil(Math.min(bigger, max)), _ref[smallerProp] = Math.ceil(Math.min(ratio * smaller, smaller)), _ref;\n};\n\nvar parseImage = function parseImage(thread, image) {\n  return _extends({}, parseCommonEventProps(thread, image), {\n    type: FILE,\n    contentType: image.content_type,\n    url: image.url,\n    name: image.name,\n    width: image.width,\n    height: image.height,\n    thumbnails: {\n      default: _extends({\n        url: image.thumbnail_url\n      }, downsizeWithRatio(300, image)),\n      high: _extends({\n        url: image.thumbnail2x_url\n      }, downsizeWithRatio(600, image))\n    }\n  });\n};\n\nvar parseFile = function parseFile(thread, file) {\n  if (file.width !== undefined && file.height !== undefined) {\n    return parseImage(thread, file);\n  }\n\n  return _extends({}, parseCommonEventProps(thread, file), {\n    type: FILE,\n    contentType: file.content_type,\n    url: file.url,\n    name: file.name\n  });\n};\nvar parseFilledForm = function parseFilledForm(thread, filledForm) {\n  return _extends({}, parseCommonEventProps(thread, filledForm), {\n    type: FILLED_FORM,\n    formId: filledForm.form_id,\n    fields: filledForm.fields.map(function (field) {\n      switch (field.type) {\n        case 'group_chooser':\n          {\n            if (!field.answer) {\n              return field;\n            }\n\n            var _field$answer = field.answer,\n                groupId = _field$answer.group_id,\n                answer = _objectWithoutPropertiesLoose(_field$answer, [\"group_id\"]);\n\n            return _extends({}, field, {\n              answer: _extends({}, answer, {\n                groupId: groupId\n              })\n            });\n          }\n\n        default:\n          return field;\n      }\n    })\n  });\n};\nvar parseMessage = function parseMessage(thread, message) {\n  return _extends({}, parseCommonEventProps(thread, message), {\n    type: MESSAGE,\n    text: message.text\n  });\n};\n\nvar parseRichMessageElement = function parseRichMessageElement(element) {\n  var parsed = {};\n\n  if (typeof element.title === 'string') {\n    parsed.title = element.title;\n  }\n\n  if (typeof element.subtitle === 'string') {\n    parsed.subtitle = element.subtitle;\n  }\n\n  if (element.image) {\n    // TODO: we should reuse parseImage here\n    var image = element.image;\n    parsed.image = {\n      url: image.url,\n      name: image.name\n    };\n  }\n\n  if (element.buttons) {\n    parsed.buttons = element.buttons.map(function (serverButton) {\n      switch (serverButton.type) {\n        case 'message':\n        case 'phone':\n          {\n            return {\n              type: serverButton.type,\n              text: serverButton.text,\n              postbackId: serverButton.postback_id,\n              userIds: serverButton.user_ids,\n              value: serverButton.value,\n              role: serverButton.role || 'default'\n            };\n          }\n\n        case 'url':\n          {\n            var button = {\n              type: serverButton.type,\n              text: serverButton.text,\n              postbackId: serverButton.postback_id,\n              userIds: serverButton.user_ids,\n              value: serverButton.value,\n              role: serverButton.role || 'default'\n            };\n\n            if (serverButton.target) {\n              button.target = serverButton.target;\n            }\n\n            return button;\n          }\n\n        case 'webview':\n          {\n            var _button = {\n              type: serverButton.type,\n              text: serverButton.text,\n              postbackId: serverButton.postback_id,\n              userIds: serverButton.user_ids,\n              value: serverButton.value,\n              role: serverButton.role || 'default'\n            };\n\n            if (typeof serverButton.webview_height === 'string') {\n              _button.webviewHeight = serverButton.webview_height;\n            }\n\n            return _button;\n          }\n\n        default:\n          {\n            return {\n              text: serverButton.text,\n              postbackId: serverButton.postback_id,\n              userIds: serverButton.user_ids,\n              role: serverButton.role || 'default'\n            };\n          }\n      }\n    });\n  }\n\n  return parsed;\n};\n\nvar parseRichMessage = function parseRichMessage(thread, richMessage) {\n  switch (richMessage.template_id) {\n    case 'cards':\n    case 'quick_replies':\n    case 'sticker':\n      return _extends({}, parseCommonEventProps(thread, richMessage), {\n        type: RICH_MESSAGE,\n        template: richMessage.template_id,\n        elements: richMessage.elements.map(parseRichMessageElement)\n      });\n\n    default:\n      return null;\n  }\n};\nvar parseSystemMessage = function parseSystemMessage(thread, systemMessage) {\n  var parsed = _extends({}, parseCommonEventProps(thread, _extends({}, systemMessage, {\n    author_id: 'system'\n  })), {\n    type: SYSTEM_MESSAGE,\n    text: systemMessage.text,\n    systemMessageType: systemMessage.system_message_type\n  });\n\n  if (systemMessage.text_vars) {\n    parsed.textVars = systemMessage.text_vars;\n  }\n\n  return parsed;\n};\nvar parseEvent$1 = function parseEvent(thread, event) {\n  switch (event.type) {\n    case FILE:\n      return parseFile(thread, event);\n\n    case FILLED_FORM:\n      return parseFilledForm(thread, event);\n\n    case MESSAGE:\n      return parseMessage(thread, event);\n\n    case RICH_MESSAGE:\n      return parseRichMessage(thread, event);\n\n    case SYSTEM_MESSAGE:\n      return parseSystemMessage(thread, event);\n\n    default:\n      return null;\n  }\n};\nvar parseGreeting = function parseGreeting(greeting) {\n  return {\n    id: greeting.id,\n    addon: greeting.addon || null,\n    uniqueId: greeting.unique_id,\n    displayedFirstTime: greeting.displayed_first_time,\n    accepted: greeting.accepted || false,\n    // threadId is typed as nonoptional string but for greetings it doesn't exist\n    event: parseEvent$1(null, greeting.event),\n    agent: {\n      id: greeting.agent.id,\n      name: greeting.agent.name,\n      avatar: greeting.agent.avatar,\n      jobTitle: greeting.agent.job_title,\n      isBot: greeting.agent.is_bot || false\n    }\n  };\n};\n\n// so it's better to rely on a custom implementation\n\nvar parseCustomerSessionFields$1 = function parseCustomerSessionFields(sessionFields) {\n  return sessionFields.reduce(function (acc, field) {\n    var _Object$keys = Object.keys(field),\n        key = _Object$keys[0];\n\n    acc[key] = field[key];\n    return acc;\n  }, {});\n};\n\nvar parseAccess = function parseAccess(access) {\n  if (access === void 0) {\n    access = {};\n  }\n\n  return access.group_ids ? {\n    groupIds: access.group_ids\n  } : {};\n};\nvar getEventsSeenUpToMap = function getEventsSeenUpToMap(users) {\n  return (0,_livechat_data_utils__WEBPACK_IMPORTED_MODULE_0__.mapValues)(function (user) {\n    return user.events_seen_up_to ? user.events_seen_up_to : null;\n  }, (0,_livechat_data_utils__WEBPACK_IMPORTED_MODULE_0__.keyBy)('id', users));\n};\nvar parseThread = function parseThread(chatId, thread) {\n  var properties = thread.properties || {};\n  return {\n    id: thread.id,\n    chatId: chatId,\n    active: thread.active,\n    access: parseAccess(thread.access),\n    createdAt: thread.created_at,\n    userIds: thread.user_ids,\n    events: thread.events.map(function (event) {\n      return parseEvent$1(thread.id, event);\n    }).filter(Boolean),\n    properties: properties,\n    previousThreadId: thread.previous_thread_id || null,\n    nextThreadId: thread.next_thread_id || null,\n    queue: thread.queue ? parseQueue(thread.queue) : null\n  };\n};\nvar parseIncomingChat = function parseIncomingChat(chat) {\n  return {\n    id: chat.id,\n    access: parseAccess(chat.access),\n    users: chat.users.map(parseChatUser),\n    properties: chat.properties || {},\n    thread: parseThread(chat.id, chat.thread),\n    eventsSeenUpToMap: getEventsSeenUpToMap(chat.users)\n  };\n};\nvar parseChatAgent = function parseChatAgent(agent) {\n  return {\n    id: agent.id,\n    // keep literal here, so every non-customer gets treated as agent\n    // currently there are only 2 types of users - customer & agent (bots have type: \"agent\")\n    // so this is purely defensive measure, trying to stay future-proof\n    type: AGENT,\n    name: agent.name,\n    avatar: agent.avatar,\n    jobTitle: agent.job_title,\n    present: agent.present\n  };\n};\nvar parseCustomerOptionalProps = function parseCustomerOptionalProps(customerProps) {\n  var optionalProps = (0,_livechat_data_utils__WEBPACK_IMPORTED_MODULE_0__.pickOwn)(['avatar', 'email', 'name'], customerProps);\n\n  if (customerProps.session_fields) {\n    optionalProps.sessionFields = parseCustomerSessionFields$1(customerProps.session_fields);\n  }\n\n  return optionalProps;\n};\n\nvar parseCustomerCommonProps = function parseCustomerCommonProps(customer) {\n  var optionalProps = parseCustomerOptionalProps(customer);\n  return _extends({\n    id: customer.id,\n    type: CUSTOMER\n  }, optionalProps, {\n    sessionFields: optionalProps.sessionFields || {}\n  });\n};\n\nvar parseChatCustomer = function parseChatCustomer(customer) {\n  return _extends({}, parseCustomerCommonProps(customer), {\n    present: customer.present\n  });\n};\nvar parseCustomer = function parseCustomer(customer) {\n  var statistics = customer.statistics;\n  return _extends({}, parseCustomerCommonProps(customer), {\n    statistics: {\n      chatsCount: statistics.chats_count,\n      threadsCount: statistics.threads_count,\n      visitsCount: statistics.visits_count,\n      pageViewsCount: statistics.page_views_count,\n      greetingsShownCount: statistics.greetings_shown_count,\n      greetingsAcceptedCount: statistics.greetings_accepted_count\n    }\n  });\n};\nvar parsePredictedAgent = function parsePredictedAgent(agent) {\n  return {\n    id: agent.id,\n    type: AGENT,\n    name: agent.name,\n    avatar: agent.avatar,\n    jobTitle: agent.job_title,\n    isBot: agent.is_bot\n  };\n};\nvar parseQueueUpdate = function parseQueueUpdate(queueUpdate) {\n  return {\n    position: queueUpdate.position,\n    waitTime: queueUpdate.wait_time\n  };\n};\nvar parseQueue = function parseQueue(queue) {\n  return _extends({}, parseQueueUpdate(queue), {\n    queuedAt: queue.queued_at\n  });\n};\nvar parseChatUser = function parseChatUser(user) {\n  return user.type === CUSTOMER ? parseChatCustomer(user) : parseChatAgent(user);\n};\nvar parseGroupStatus = function parseGroupStatus(status) {\n  return status === 'offline' ? 'offline' : 'online';\n};\n\nvar _FAIL_ALL_REQUESTS_ME;\n\nvar SMALL_RECONNECT_DELAY = 100;\nvar FAIL_ALL_REQUESTS_MESSAGES = (_FAIL_ALL_REQUESTS_ME = {}, _FAIL_ALL_REQUESTS_ME[CONNECTION_LOST] = 'Connection lost.', _FAIL_ALL_REQUESTS_ME[MISDIRECTED_CONNECTION] = 'Connected to wrong region.', _FAIL_ALL_REQUESTS_ME);\n\nvar updateStateIfNeeded = function updateStateIfNeeded(store, action) {\n  var state = store.getState();\n\n  switch (action.type) {\n    case PUSH_RESPONSE_RECEIVED:\n    case PUSH_RECEIVED:\n      switch (action.payload.action) {\n        case CHAT_DEACTIVATED:\n          store.dispatch(setChatActive(action.payload.payload.chatId, false));\n          return;\n\n        case INCOMING_CHAT:\n          store.dispatch(setChatActive(action.payload.payload.chat.id, true));\n          return;\n\n        default:\n          return;\n      }\n\n    case RESPONSE_RECEIVED:\n      switch (action.payload.action) {\n        case LIST_CHATS:\n          action.payload.payload.chatsSummary.filter(function (_ref) {\n            var id = _ref.id,\n                active = _ref.active;\n            return isChatActive(state, id) !== active;\n          }).forEach(function (_ref2) {\n            var id = _ref2.id,\n                active = _ref2.active;\n            store.dispatch(setChatActive(id, active));\n          });\n          return;\n\n        default:\n          return;\n      }\n\n  }\n};\n\nvar sendRequest$1 = function sendRequest$$1(socket, _ref3) {\n  var _ref3$payload = _ref3.payload,\n      id = _ref3$payload.id,\n      request = _ref3$payload.request;\n\n  var frame = _extends({\n    request_id: id\n  }, request);\n\n  socket.emit(frame);\n};\n\nvar emitUsers = function emitUsers(emit, users) {\n  users.forEach(function (user) {\n    if ('present' in user) {\n      var rest = _objectWithoutPropertiesLoose(user, [\"present\"]);\n\n      emit('user_data', rest);\n      return;\n    }\n\n    if (user.type === CUSTOMER) {\n      var _rest = _objectWithoutPropertiesLoose(user, [\"statistics\"]);\n\n      emit('user_data', _rest);\n      return;\n    }\n\n    emit('user_data', user);\n  });\n};\n\nvar handleMulticast = function handleMulticast(emit, _ref4) {\n  var type = _ref4.type,\n      content = _ref4.content;\n\n  if (type !== 'lc2') {\n    return;\n  }\n\n  if (content.name === 'groups_update' && 'groups' in content && !(0,_livechat_data_utils__WEBPACK_IMPORTED_MODULE_0__.isEmpty)(content.groups)) {\n    var _content$groups = content.groups,\n        group = _content$groups[0];\n    var availability = parseGroupStatus(group.status);\n    emit('availability_updated', {\n      availability: availability\n    });\n  }\n};\n\nvar handlePush = function handlePush(_ref5, _ref6) {\n  var emit = _ref5.emit,\n      store = _ref5.store;\n  var payload = _ref6.payload;\n\n  switch (payload.action) {\n    case THREAD_PROPERTIES_UPDATED:\n      if (payload.payload.properties.lc2 && 'queue_pos' in payload.payload.properties.lc2) {\n        emit(QUEUE_POSITION_UPDATED, {\n          chatId: payload.payload.chatId,\n          threadId: payload.payload.threadId,\n          queue: {\n            position: payload.payload.properties.lc2.queue_pos,\n            waitTime: payload.payload.properties.lc2.queue_waiting_time\n          }\n        });\n      }\n\n      emit('thread_properties_updated', payload.payload);\n      return;\n\n    case CUSTOMER_SIDE_STORAGE_UPDATED:\n      saveSideStorage(store, payload.payload.customer_side_storage);\n      return;\n\n    case CUSTOMER_DISCONNECTED:\n      // each of those should currently lead to either reconnect or destroy call\n      // after receiving this push server closes the connection with us\n      // which results in SOCKET_DISCONNECTED action being dispatched\n      // we don't want to rely on this (nor we want to risk emitting 'disconnected' twice)\n      // so we should handle all cases ourselves and close the connection preemptively\n      switch (payload.payload.reason) {\n        case ACCESS_TOKEN_EXPIRED:\n          // we passthrough access_token_expired here, so pending requests receive CONNECTION_LOST error\n          // we could fail them with ACCESS_TOKEN_EXPIRED, but it could force people to handle it in special manner\n          // but actually they should handle it exactly like CONNECTION_LOST:\n          // a request could succeed, who knows, it has to be checked after being reconnected\n          store.dispatch(prefetchToken(true));\n          store.dispatch(reconnect(SMALL_RECONNECT_DELAY));\n          emit('disconnected', payload.payload);\n          break;\n\n        case CUSTOMER_BANNED:\n        case CUSTOMER_TEMPORARILY_BLOCKED:\n        case LICENSE_NOT_FOUND:\n        case PRODUCT_VERSION_CHANGED:\n        case TOO_MANY_CONNECTIONS:\n        case UNSUPPORTED_VERSION:\n          // this also emits `disconnected` event - but it's handled in response to this action by destroy handler\n          store.dispatch(destroy(payload.payload.reason));\n          break;\n\n        case MISDIRECTED_CONNECTION$1:\n          failAllRequests(store, MISDIRECTED_CONNECTION);\n          store.dispatch({\n            type: CHANGE_REGION,\n            payload: payload.payload.data\n          });\n          break;\n\n        case TOO_MANY_UNAUTHORIZED_CONNECTIONS$1:\n          // this should only really fail a `login` request - as it's the only one sent before authorization\n          // and login should reconnect on its own right now\n          failAllRequests(store, TOO_MANY_UNAUTHORIZED_CONNECTIONS);\n          break;\n\n        default:\n          store.dispatch(reconnect(SMALL_RECONNECT_DELAY));\n          emit('disconnected', payload.payload);\n          break;\n      }\n\n      return;\n\n    case INCOMING_CHAT:\n      emitUsers(emit, payload.payload.chat.users);\n      emit(payload.action, payload.payload);\n      return;\n\n    case INCOMING_EVENT:\n      if (payload.payload.event === null) {\n        return;\n      }\n\n      emit(payload.action, payload.payload);\n      return;\n\n    case INCOMING_TYPING_INDICATOR:\n      emit(payload.action, payload.payload);\n      return;\n\n    case INCOMING_MULTICAST:\n      handleMulticast(emit, payload.payload); // we passthrough this action even if it was already handled above\n\n      emit(payload.action, payload.payload);\n      return;\n\n    case USER_ADDED_TO_CHAT:\n      emitUsers(emit, [payload.payload.user]);\n      emit(payload.action, payload.payload);\n      return;\n\n    default:\n      emit(payload.action, payload.payload);\n      return;\n  }\n};\n\nvar handleResponse = function handleResponse(_ref7, _ref8) {\n  var emit = _ref7.emit;\n  var payload = _ref8.payload;\n\n  switch (payload.action) {\n    case CHAT_DEACTIVATED:\n      payload.resolve(SUCCESS);\n      return;\n\n    case GET_CHAT:\n      emitUsers(emit, payload.payload.users);\n      payload.resolve(payload.payload);\n      return;\n\n    case INCOMING_CHAT:\n      emitUsers(emit, payload.payload.chat.users);\n      payload.resolve(payload.payload);\n      return;\n\n    case INCOMING_EVENT:\n      payload.resolve(payload.payload.event);\n      return;\n\n    case LIST_CHATS:\n      emitUsers(emit, payload.payload.users);\n      payload.resolve(payload.payload);\n      return;\n\n    default:\n      payload.resolve(payload.payload);\n      return;\n  }\n};\n\nvar createSideEffectsHandler = (function (_ref9) {\n  var auth = _ref9.auth,\n      customerDataProvider = _ref9.customerDataProvider,\n      emitter = _ref9.emitter,\n      socket = _ref9.socket;\n  var emit = emitter.emit;\n  var login = createLoginTask(auth, customerDataProvider); // TODO: using Store type here is a lie, middleware only provides MiddlewareAPI here\n\n  return function (action, store) {\n    switch (action.type) {\n      case CHANGE_REGION:\n        socket.reinitialize();\n        return;\n\n      case CHECK_GOALS:\n        checkGoals(store, auth, action.payload.sessionFields).catch(_livechat_data_utils__WEBPACK_IMPORTED_MODULE_0__.noop);\n        return;\n\n      case DESTROY:\n        {\n          var payload = action.payload;\n          socket.destroy();\n\n          if (payload.reason !== 'manual') {\n            emit('disconnected', payload);\n          }\n\n          emitter.off();\n          return;\n        }\n\n      case FAIL_ALL_REQUESTS:\n        {\n          var _action$payload = action.payload,\n              reason = _action$payload.reason,\n              rejects = _action$payload.rejects;\n          var error = {\n            message: FAIL_ALL_REQUESTS_MESSAGES[reason],\n            code: reason\n          };\n          rejects.forEach(function (reject) {\n            reject(createError(error));\n          });\n          return;\n        }\n\n      case LOGIN_SUCCESS:\n        {\n          var _action$payload2 = action.payload,\n              dynamicConfig = _action$payload2.dynamicConfig,\n              customer = _action$payload2.customer,\n              chats = _action$payload2.chats,\n              greeting = _action$payload2.greeting,\n              availability = _action$payload2.availability;\n\n          var eventData = _extends({\n            customer: customer,\n            availability: availability\n          }, greeting && {\n            greeting: greeting\n          });\n\n          Object.defineProperty(eventData, '__unsafeDynamicConfig', {\n            value: dynamicConfig\n          });\n          Object.defineProperty(eventData, '__unsafeChats', {\n            value: chats\n          });\n          emit('connected', eventData);\n          return;\n        }\n\n      case PAUSE_CONNECTION:\n        socket.disconnect();\n        return;\n\n      case PREFETCH_TOKEN:\n        if (action.payload.fresh) {\n          auth.getFreshToken().catch(_livechat_data_utils__WEBPACK_IMPORTED_MODULE_0__.noop);\n          return;\n        }\n\n        auth.hasToken().then(function (hasToken) {\n          if (!hasToken) {\n            return auth.getToken();\n          }\n\n          return auth.getToken().then(function (_ref10) {\n            var creationDate = _ref10.creationDate,\n                expiresIn = _ref10.expiresIn;\n            var ONE_HOUR = 60 * 60 * 1000; // check if the token is worth reusing\n            // we don't want to get disconnected in a moment because of expired token\n\n            if (creationDate + expiresIn - Date.now() > ONE_HOUR) {\n              return;\n            }\n\n            return auth.invalidate().then(auth.getFreshToken);\n          });\n        }).catch(_livechat_data_utils__WEBPACK_IMPORTED_MODULE_0__.noop);\n        return;\n\n      case PUSH_RECEIVED:\n        // TODO: this if doesn't seem to make much sense\n        // I'm too afraid to remove it right now though\n        if (action.payload.action === CUSTOMER_DISCONNECTED) {\n          handlePush({\n            emit: emit,\n            store: store\n          }, action);\n          return;\n        }\n\n        updateStateIfNeeded(store, action);\n        handlePush({\n          emit: emit,\n          store: store\n        }, action);\n        return;\n\n      case PUSH_RESPONSE_RECEIVED:\n        updateStateIfNeeded(store, action);\n        handleResponse({\n          emit: emit\n        }, action);\n        return;\n\n      case RECONNECT:\n        socket.reconnect(action.payload.delay);\n        return;\n\n      case REQUEST_FAILED:\n        {\n          var _action$payload3 = action.payload,\n              reject = _action$payload3.reject,\n              _error = _action$payload3.error;\n          reject(createError(_error));\n          return;\n        }\n\n      case RESPONSE_RECEIVED:\n        updateStateIfNeeded(store, action);\n        handleResponse({\n          emit: emit\n        }, action);\n        return;\n\n      case SEND_REQUEST:\n        {\n          var state = store.getState();\n\n          if (isDestroyed(state)) {\n            failRequest(store, action, {\n              code: 'SDK_DESTROYED',\n              message: 'SDK destroyed.'\n            });\n            return;\n          }\n\n          if (!isConnected(state) && action.payload.source !== 'login') {\n            failRequest(store, action, {\n              code: 'NO_CONNECTION',\n              message: 'No connection.'\n            });\n            return;\n          }\n\n          sendRequest$1(socket, action);\n        }\n        return;\n\n      case SET_SELF_ID:\n        emit('customer_id', action.payload.id);\n        return;\n\n      case SOCKET_DISCONNECTED:\n        emit('disconnected', {\n          reason: 'connection_lost'\n        });\n        return;\n\n      case SOCKET_CONNECTED:\n        login(store);\n        return;\n\n      case SOCKET_RECOVERED:\n        // don't emit if from consumer's perspective we haven't been connected\n        if (!isConnected(store.getState())) {\n          return;\n        }\n\n        emit('connection_recovered');\n        return;\n\n      case SOCKET_UNSTABLE:\n        // don't emit if from consumer's perspective we haven't been connected\n        if (!isConnected(store.getState())) {\n          return;\n        }\n\n        emit('connection_unstable');\n        return;\n\n      case START_CONNECTION:\n        socket.connect();\n        store.dispatch(prefetchToken());\n        return;\n\n      case UPDATE_CUSTOMER_PAGE:\n        if (!isConnected(store.getState())) {\n          return;\n        }\n\n        sendRequestAction(store, sendRequest(UPDATE_CUSTOMER_PAGE$1, action.payload)).catch(_livechat_data_utils__WEBPACK_IMPORTED_MODULE_0__.noop);\n        return;\n\n      default:\n        return;\n    }\n  };\n});\n\nvar HISTORY_EVENT_COUNT_TARGET = 25;\n\nvar createState = function createState() {\n  return {\n    status: 'idle',\n    queuedTasks: [],\n    nextPageId: null\n  };\n};\n\nvar createChatHistoryIterator = function createChatHistoryIterator(sdk, chatId) {\n  var historyState = createState();\n\n  var next = function next(resolve, reject) {\n    switch (historyState.status) {\n      case 'idle':\n        historyState.status = 'fetching';\n        sdk.listThreads({\n          chatId: chatId,\n          minEventsCount: HISTORY_EVENT_COUNT_TARGET,\n          pageId: historyState.nextPageId || undefined\n        }).then(function (_ref) {\n          var threads = _ref.threads,\n              nextPageId = _ref.nextPageId;\n          historyState.nextPageId = nextPageId;\n\n          if (!historyState.nextPageId) {\n            historyState.status = 'done';\n            resolve({\n              value: {\n                threads: [].concat(threads).reverse()\n              },\n              done: true\n            });\n          } else {\n            historyState.status = 'idle';\n            resolve({\n              value: {\n                threads: [].concat(threads).reverse()\n              },\n              done: false\n            });\n          }\n\n          var queuedTask = historyState.queuedTasks.shift();\n\n          if (!queuedTask) {\n            return;\n          }\n\n          next(queuedTask.resolve, queuedTask.reject);\n        }, function (err) {\n          var queuedTasks = historyState.queuedTasks;\n          historyState.status = 'idle';\n          historyState.queuedTasks = [];\n          reject(err);\n          queuedTasks.forEach(function (queuedTask) {\n            return queuedTask.reject(err);\n          });\n        });\n        return;\n\n      case 'fetching':\n        historyState.queuedTasks.push({\n          resolve: resolve,\n          reject: reject\n        });\n        return;\n\n      case 'done':\n        resolve({\n          value: undefined,\n          done: true\n        });\n        return;\n    }\n  };\n\n  return {\n    next: function (_next) {\n      function next() {\n        return _next.apply(this, arguments);\n      }\n\n      next.toString = function () {\n        return _next.toString();\n      };\n\n      return next;\n    }(function () {\n      return new Promise(next);\n    })\n  };\n};\n\nvar initialize = function initialize(store, emitter) {\n  var state = store.getState();\n  var url = getServerUrl(state) + \"/rtm/sjs\";\n  return (0,_livechat_platform_client__WEBPACK_IMPORTED_MODULE_8__.default)(url, {\n    query: {\n      license_id: state.licenseId\n    },\n    emitter: emitter\n  });\n};\n\nvar createSocketClient = function createSocketClient(store) {\n  var emitter = (0,_livechat_mitt__WEBPACK_IMPORTED_MODULE_9__.default)();\n  var client = initialize(store, emitter);\n  return _extends({}, Object.keys(client).reduce(function (proxy, method) {\n    proxy[method] = function () {\n      var _client;\n\n      return (_client = client)[method].apply(_client, arguments);\n    };\n\n    return proxy;\n  }, {}), {\n    reinitialize: function reinitialize() {\n      client.disconnect();\n      client = initialize(store, emitter);\n      client.connect();\n    }\n  });\n};\n\nvar parseChatPropertiesDeletedPush = function parseChatPropertiesDeletedPush(payload) {\n  return {\n    chatId: payload.chat_id,\n    properties: payload.properties\n  };\n};\n\nvar parseChatPropertiesUpdatedPush = function parseChatPropertiesUpdatedPush(payload) {\n  return {\n    chatId: payload.chat_id,\n    properties: payload.properties\n  };\n};\n\nvar parseChatTransferredPush = function parseChatTransferredPush(payload) {\n  var basePayload = {\n    chatId: payload.chat_id,\n    threadId: payload.thread_id,\n    transferredTo: _extends({}, payload.transferred_to.agent_ids && {\n      agentIds: payload.transferred_to.agent_ids\n    }, payload.transferred_to.group_ids && {\n      groupIds: payload.transferred_to.group_ids\n    }),\n    queue: payload.queue ? parseQueue(payload.queue) : null\n  };\n\n  if (payload.reason === 'manual') {\n    return _extends({}, basePayload, {\n      reason: payload.reason,\n      requesterId: payload.requester_id\n    });\n  }\n\n  return _extends({}, basePayload, {\n    reason: payload.reason\n  });\n};\n\nvar parseCustomerPageUpdatedPush = function parseCustomerPageUpdatedPush(payload) {\n  return {\n    url: payload.url,\n    title: payload.title,\n    timestamp: payload.timestamp * 1000\n  };\n};\n\nvar parseCustomerUpdatedPush = function parseCustomerUpdatedPush(payload) {\n  return {\n    customer: _extends({\n      id: payload.customer.id\n    }, parseCustomerOptionalProps(payload.customer))\n  };\n};\n\nvar parseEventPropertiesDeletedPush = function parseEventPropertiesDeletedPush(payload) {\n  return {\n    chatId: payload.chat_id,\n    threadId: payload.thread_id,\n    eventId: payload.event_id,\n    properties: payload.properties\n  };\n};\n\nvar parseEventPropertiesUpdatedPush = function parseEventPropertiesUpdatedPush(payload) {\n  return {\n    chatId: payload.chat_id,\n    threadId: payload.thread_id,\n    eventId: payload.event_id,\n    properties: payload.properties\n  };\n};\n\nvar parseEventUpdatedPush = function parseEventUpdatedPush(payload) {\n  var threadId = payload.thread_id;\n  return {\n    chatId: payload.chat_id,\n    threadId: threadId,\n    event: parseEvent$1(threadId, payload.event)\n  };\n};\n\nvar parseEventsMarkedAsSeenPush = function parseEventsMarkedAsSeenPush(payload) {\n  return {\n    chatId: payload.chat_id,\n    userId: payload.user_id,\n    seenUpTo: payload.seen_up_to\n  };\n};\n\nvar parseGreetingAcceptedPush = function parseGreetingAcceptedPush(payload) {\n  return {\n    uniqueId: payload.unique_id\n  };\n};\n\nvar parseGetChatResponse = function parseGetChatResponse(payload) {\n  return parseIncomingChat(payload);\n};\n\nvar parseIncomingChatPush = function parseIncomingChatPush(payload) {\n  return {\n    chat: parseIncomingChat(payload.chat)\n  };\n};\n\nvar parseIncomingEventPush = function parseIncomingEventPush(payload) {\n  return {\n    chatId: payload.chat_id,\n    event: parseEvent$1(payload.thread_id, payload.event)\n  };\n};\n\nvar parseIncomingGreetingPush = function parseIncomingGreetingPush(payload) {\n  return parseGreeting(payload);\n};\n\nvar parseIncomingRichMessagePostbackPush = function parseIncomingRichMessagePostbackPush(payload) {\n  return {\n    userId: payload.user_id,\n    chatId: payload.chat_id,\n    threadId: payload.thread_id,\n    eventId: payload.event_id,\n    postback: payload.postback\n  };\n};\n\nvar parseIncomingTypingIndicatorPush = function parseIncomingTypingIndicatorPush(payload) {\n  var chatId = payload.chat_id,\n      typingIndicator = payload.typing_indicator;\n  return {\n    chatId: chatId,\n    typingIndicator: {\n      authorId: typingIndicator.author_id,\n      isTyping: typingIndicator.is_typing\n    }\n  };\n};\n\nvar parseQueuePositionUpdatedPush = function parseQueuePositionUpdatedPush(payload) {\n  return {\n    chatId: payload.chat_id,\n    threadId: payload.thread_id,\n    queue: parseQueueUpdate(payload.queue)\n  };\n};\n\nvar parseThreadPropertiesDeletedPush = function parseThreadPropertiesDeletedPush(payload) {\n  return {\n    chatId: payload.chat_id,\n    threadId: payload.thread_id,\n    properties: payload.properties\n  };\n};\n\nvar parseThreadPropertiesUpdatedPush = function parseThreadPropertiesUpdatedPush(payload) {\n  return {\n    chatId: payload.chat_id,\n    threadId: payload.thread_id,\n    properties: payload.properties\n  };\n};\n\nvar parseUserAddedToChatPush = function parseUserAddedToChatPush(payload) {\n  return {\n    chatId: payload.chat_id,\n    user: parseChatUser(payload.user),\n    present: payload.user.present\n  };\n};\n\nvar parseUserRemovedFromChatPush = function parseUserRemovedFromChatPush(payload) {\n  return {\n    chatId: payload.chat_id,\n    userId: payload.user_id\n  };\n};\n\nvar parseFields = function parseFields(fields) {\n  return fields.map(function (field) {\n    switch (field.type) {\n      case 'group_chooser':\n        return _extends({}, field, {\n          options: field.options.map(function (_ref) {\n            var groupId = _ref.group_id,\n                option = _objectWithoutPropertiesLoose(_ref, [\"group_id\"]);\n\n            return _extends({}, option, {\n              groupId: groupId\n            });\n          })\n        });\n\n      case 'rating':\n        {\n          var commentLabel = field.comment_label,\n              parsed = _objectWithoutPropertiesLoose(field, [\"comment_label\"]);\n\n          return _extends({}, parsed, {\n            commentLabel: commentLabel\n          });\n        }\n\n      default:\n        return field;\n    }\n  });\n};\n\nvar parseTicketFormFields = function parseTicketFormFields(fields) {\n  var withFakeIds = fields.map(function (field, index) {\n    return _extends({}, field, {\n      id: String(index)\n    });\n  });\n  return parseFields(withFakeIds);\n};\n\nvar parseGetFormResponse = function parseGetFormResponse(payload) {\n  if (!payload.enabled) {\n    return payload;\n  }\n\n  return _extends({}, payload, {\n    form: 'id' in payload.form.fields[0] ? {\n      id: payload.form.id,\n      fields: parseFields(payload.form.fields)\n    } : {\n      // TODO: should we fake id for this one?\n      id: 'ticket',\n      fields: parseTicketFormFields(payload.form.fields)\n    }\n  });\n};\n\nvar parseGetUrlInfoResponse = function parseGetUrlInfoResponse(payload) {\n  var urlInfo = {\n    url: payload.url\n  };\n\n  if (payload.title) {\n    urlInfo.title = payload.title;\n  }\n\n  if (payload.description) {\n    urlInfo.description = payload.description;\n  }\n\n  if (payload.image_url) {\n    urlInfo.imageUrl = \"https://\" + payload.image_url;\n\n    if (payload.image_width && payload.image_height) {\n      urlInfo.imageWidth = payload.image_width;\n      urlInfo.imageHeight = payload.image_height;\n    }\n  }\n\n  return urlInfo;\n};\n\nvar getAvailabilityBasedOnDynamicConfig = function getAvailabilityBasedOnDynamicConfig(_ref2) {\n  var onlineGroups = _ref2.online_groups_ids,\n      customerGroups = _ref2.customer_groups;\n\n  // this might be missing if all groups are offline\n  if (!onlineGroups) {\n    return 'offline';\n  }\n\n  var monitoringGroupId = customerGroups.monitoring.id;\n  return (0,_livechat_data_utils__WEBPACK_IMPORTED_MODULE_0__.includes)(monitoringGroupId, onlineGroups) ? 'online' : 'offline';\n};\n\nvar parseListChatsResponse = function parseListChatsResponse(payload) {\n  var chatsSummary = payload.chats_summary.map(function (_ref3) {\n    var id = _ref3.id,\n        active = _ref3.active,\n        access = _ref3.access,\n        lastThreadCreatedAt = _ref3.last_thread_created_at,\n        lastThreadId = _ref3.last_thread_id,\n        lastEventsPerType = _ref3.last_event_per_type,\n        _ref3$properties = _ref3.properties,\n        properties = _ref3$properties === void 0 ? {} : _ref3$properties,\n        users = _ref3.users;\n    var chatSummary = {\n      id: id,\n      active: active,\n      access: parseAccess(access),\n      properties: properties,\n      users: users.map(parseChatUser),\n      lastThreadId: lastThreadId || null,\n      lastThreadCreatedAt: lastThreadCreatedAt || null,\n      eventsSeenUpToMap: getEventsSeenUpToMap(users)\n    };\n\n    if (!lastEventsPerType) {\n      return chatSummary;\n    }\n\n    chatSummary.lastEventsPerType = (0,_livechat_data_utils__WEBPACK_IMPORTED_MODULE_0__.mapValues)(function (lastEventPerType) {\n      return parseEvent$1(lastEventPerType.thread_id, lastEventPerType.event);\n    }, lastEventsPerType);\n    var refinedLastEventsPerType = lastEventsPerType;\n    var lastEventSummariesArray = Object.keys(refinedLastEventsPerType).map(function (eventType) {\n      return refinedLastEventsPerType[eventType];\n    });\n    var lastEventSummary = (0,_livechat_data_utils__WEBPACK_IMPORTED_MODULE_0__.last)(lastEventSummariesArray.sort(function (eventSummaryA, eventSummaryB) {\n      return eventSummaryA.thread_id === eventSummaryB.thread_id ? (0,_livechat_data_utils__WEBPACK_IMPORTED_MODULE_0__.stringCompare)(eventSummaryA.event.created_at, eventSummaryB.event.created_at) : (0,_livechat_data_utils__WEBPACK_IMPORTED_MODULE_0__.stringCompare)(eventSummaryA.thread_created_at, eventSummaryB.thread_created_at);\n    }));\n\n    if (lastEventSummary) {\n      chatSummary.lastEvent = chatSummary.lastEventsPerType[lastEventSummary.event.type];\n    }\n\n    return chatSummary;\n  });\n  return {\n    chatsSummary: (0,_livechat_data_utils__WEBPACK_IMPORTED_MODULE_0__.numericSortBy)(function (_ref4) {\n      var lastEvent = _ref4.lastEvent,\n          order = _ref4.order;\n      return -1 * (lastEvent !== undefined ? lastEvent.timestamp : order);\n    }, chatsSummary),\n    totalChats: payload.total_chats,\n    users: (0,_livechat_data_utils__WEBPACK_IMPORTED_MODULE_0__.uniqBy)(function (user) {\n      return user.id;\n    }, (0,_livechat_data_utils__WEBPACK_IMPORTED_MODULE_0__.flatMap)(function (summary) {\n      return summary.users;\n    }, chatsSummary)),\n    previousPageId: payload.previous_page_id || null,\n    nextPageId: payload.next_page_id || null\n  };\n};\n\nvar parseListGroupStatusesResponse = function parseListGroupStatusesResponse(payload) {\n  return payload.groups_status;\n};\n\nvar parseListThreadsResponse = function parseListThreadsResponse(request, payload) {\n  return {\n    threads: payload.threads.map(function (thread) {\n      return parseThread(request.payload.chat_id, thread);\n    }),\n    previousPageId: payload.previous_page_id || null,\n    nextPageId: payload.next_page_id || null\n  };\n};\n\nvar parseLoginResponse = function parseLoginResponse(payload) {\n  var dynamicConfig = payload.__priv_dynamic_config,\n      chats = payload.chats;\n  var greeting = payload.greeting || dynamicConfig.greeting; // TODO: remove the fallback after API release the new greeting object position to the prod env\n\n  return _extends({\n    dynamicConfig: dynamicConfig,\n    customer: parseCustomer(payload.customer),\n    availability: getAvailabilityBasedOnDynamicConfig(dynamicConfig),\n    chats: chats.map(function (chat) {\n      return {\n        id: chat.chat_id,\n        active: 'has_active_thread' in chat ? chat.has_active_thread : // temporary fallback, waiting for API to move this flag into `chats` array\n        payload.has_active_thread,\n        hasUnreadEvents: chat.has_unread_events\n      };\n    })\n  }, greeting && {\n    greeting: parseGreeting(greeting)\n  });\n};\n\nvar parsePush = function parsePush(push) {\n  switch (push.action) {\n    case CHAT_DEACTIVATED:\n      return {\n        action: push.action,\n        payload: {\n          chatId: push.payload.chat_id\n        }\n      };\n\n    case CHAT_PROPERTIES_DELETED:\n      return {\n        action: push.action,\n        payload: parseChatPropertiesDeletedPush(push.payload)\n      };\n\n    case CHAT_PROPERTIES_UPDATED:\n      return {\n        action: push.action,\n        payload: parseChatPropertiesUpdatedPush(push.payload)\n      };\n\n    case CHAT_TRANSFERRED:\n      return {\n        action: push.action,\n        payload: parseChatTransferredPush(push.payload)\n      };\n\n    case CUSTOMER_SIDE_STORAGE_UPDATED:\n      return {\n        action: push.action,\n        payload: push.payload\n      };\n\n    case CUSTOMER_DISCONNECTED:\n      return {\n        action: push.action,\n        payload: push.payload\n      };\n\n    case CUSTOMER_PAGE_UPDATED:\n      return {\n        action: push.action,\n        payload: parseCustomerPageUpdatedPush(push.payload)\n      };\n\n    case CUSTOMER_UPDATED:\n      return {\n        action: push.action,\n        payload: parseCustomerUpdatedPush(push.payload)\n      };\n\n    case EVENT_PROPERTIES_DELETED:\n      return {\n        action: push.action,\n        payload: parseEventPropertiesDeletedPush(push.payload)\n      };\n\n    case EVENT_PROPERTIES_UPDATED:\n      return {\n        action: push.action,\n        payload: parseEventPropertiesUpdatedPush(push.payload)\n      };\n\n    case EVENT_UPDATED:\n      return {\n        action: push.action,\n        payload: parseEventUpdatedPush(push.payload)\n      };\n\n    case EVENTS_MARKED_AS_SEEN:\n      return {\n        action: push.action,\n        payload: parseEventsMarkedAsSeenPush(push.payload)\n      };\n\n    case GREETING_ACCEPTED:\n      return {\n        action: push.action,\n        payload: parseGreetingAcceptedPush(push.payload)\n      };\n\n    case GREETING_CANCELED:\n      return {\n        action: push.action,\n        // 'greeting_canceled' has the same payload as `greeting_accepted`\n        payload: parseGreetingAcceptedPush(push.payload)\n      };\n\n    case INCOMING_CHAT:\n      return {\n        action: push.action,\n        payload: parseIncomingChatPush(push.payload)\n      };\n\n    case INCOMING_EVENT:\n      return {\n        action: push.action,\n        payload: parseIncomingEventPush(push.payload)\n      };\n\n    case INCOMING_GREETING:\n      return {\n        action: push.action,\n        payload: parseIncomingGreetingPush(push.payload)\n      };\n\n    case INCOMING_MULTICAST:\n      return {\n        action: push.action,\n        payload: push.payload\n      };\n\n    case INCOMING_RICH_MESSAGE_POSTBACK:\n      return {\n        action: push.action,\n        payload: parseIncomingRichMessagePostbackPush(push.payload)\n      };\n\n    case INCOMING_TYPING_INDICATOR:\n      return {\n        action: push.action,\n        payload: parseIncomingTypingIndicatorPush(push.payload)\n      };\n\n    case QUEUE_POSITION_UPDATED:\n      return {\n        action: push.action,\n        payload: parseQueuePositionUpdatedPush(push.payload)\n      };\n\n    case THREAD_PROPERTIES_DELETED:\n      return {\n        action: push.action,\n        payload: parseThreadPropertiesDeletedPush(push.payload)\n      };\n\n    case THREAD_PROPERTIES_UPDATED:\n      return {\n        action: push.action,\n        payload: parseThreadPropertiesUpdatedPush(push.payload)\n      };\n\n    case USER_ADDED_TO_CHAT:\n      return {\n        action: push.action,\n        payload: parseUserAddedToChatPush(push.payload)\n      };\n\n    case USER_REMOVED_FROM_CHAT:\n      return {\n        action: push.action,\n        payload: parseUserRemovedFromChatPush(push.payload) // TODO: remove those once we sync with the API on prod\n\n      };\n\n    case 'chat_user_added':\n      return {\n        action: USER_ADDED_TO_CHAT,\n        payload: parseUserAddedToChatPush(push.payload)\n      };\n\n    case 'chat_user_removed':\n      return {\n        action: USER_REMOVED_FROM_CHAT,\n        payload: parseUserRemovedFromChatPush(push.payload)\n      };\n  }\n};\nvar parseResponse = function parseResponse(_ref5) {\n  var request = _ref5.request,\n      response = _ref5.response;\n\n  switch (response.action) {\n    case ACCEPT_GREETING:\n      return {\n        action: response.action,\n        payload: SUCCESS\n      };\n\n    case CANCEL_GREETING:\n      return {\n        action: response.action,\n        payload: SUCCESS\n      };\n\n    case DELETE_CHAT_PROPERTIES:\n      return {\n        action: response.action,\n        payload: SUCCESS\n      };\n\n    case DELETE_EVENT_PROPERTIES:\n      return {\n        action: response.action,\n        payload: SUCCESS\n      };\n\n    case DELETE_THREAD_PROPERTIES:\n      return {\n        action: response.action,\n        payload: SUCCESS\n      };\n\n    case GET_CHAT:\n      return {\n        action: response.action,\n        payload: parseGetChatResponse(response.payload)\n      };\n\n    case GET_CUSTOMER:\n      return {\n        action: response.action,\n        payload: parseCustomer(response.payload)\n      };\n\n    case GET_FORM:\n      return {\n        action: response.action,\n        payload: parseGetFormResponse(response.payload)\n      };\n\n    case GET_PREDICTED_AGENT:\n      return {\n        action: response.action,\n        payload: parsePredictedAgent(response.payload)\n      };\n\n    case GET_URL_INFO:\n      return {\n        action: response.action,\n        payload: parseGetUrlInfoResponse(response.payload)\n      };\n\n    case LIST_CHATS:\n      return {\n        action: response.action,\n        payload: parseListChatsResponse(response.payload)\n      };\n\n    case LIST_GROUP_STATUSES:\n      return {\n        action: response.action,\n        payload: parseListGroupStatusesResponse(response.payload)\n      };\n\n    case LIST_THREADS:\n      return {\n        action: response.action,\n        payload: parseListThreadsResponse(request, response.payload)\n      };\n\n    case LOGIN:\n      return {\n        action: response.action,\n        payload: parseLoginResponse(response.payload)\n      };\n\n    case MARK_EVENTS_AS_SEEN:\n      return {\n        action: response.action,\n        payload: SUCCESS\n      };\n\n    case SEND_SNEAK_PEEK:\n      return {\n        action: response.action,\n        payload: SUCCESS\n      };\n\n    case SET_CUSTOMER_SESSION_FIELDS:\n      return {\n        action: response.action,\n        payload: SUCCESS\n      };\n\n    case SEND_RICH_MESSAGE_POSTBACK:\n      return {\n        action: response.action,\n        payload: SUCCESS\n      };\n\n    case UPDATE_CHAT_PROPERTIES:\n      return {\n        action: response.action,\n        payload: SUCCESS\n      };\n\n    case UPDATE_CUSTOMER:\n      return {\n        action: response.action,\n        payload: SUCCESS\n      };\n\n    case UPDATE_CUSTOMER_PAGE$1:\n      return {\n        action: response.action,\n        payload: SUCCESS\n      };\n\n    case UPDATE_EVENT_PROPERTIES:\n      return {\n        action: response.action,\n        payload: SUCCESS\n      };\n\n    case UPDATE_THREAD_PROPERTIES:\n      return {\n        action: response.action,\n        payload: SUCCESS\n      };\n  }\n};\nvar parseServerError = function parseServerError(error) {\n  return {\n    code: error.type.toUpperCase(),\n    message: error.message\n  };\n};\n\nvar handleResponseError = function handleResponseError(_ref, response) {\n  var dispatch = _ref.dispatch,\n      getState = _ref.getState;\n  var requestId = response.request_id,\n      payload = response.payload;\n\n  var _getRequest = getRequest(getState(), requestId),\n      reject = _getRequest.reject;\n\n  dispatch({\n    type: REQUEST_FAILED,\n    payload: {\n      id: requestId,\n      reject: reject,\n      error: parseServerError(payload.error)\n    }\n  });\n};\n\nvar handleResponse$1 = function handleResponse(_ref2, response) {\n  var dispatch = _ref2.dispatch,\n      getState = _ref2.getState;\n  var requestId = response.request_id;\n\n  var _getRequest2 = getRequest(getState(), requestId),\n      promise = _getRequest2.promise,\n      resolve = _getRequest2.resolve,\n      request = _getRequest2.request;\n\n  var parsedResponse = parseResponse({\n    request: request,\n    response: response\n  });\n  dispatch({\n    type: RESPONSE_RECEIVED,\n    payload: _extends({\n      id: requestId,\n      promise: promise,\n      resolve: resolve\n    }, parsedResponse)\n  });\n};\n\nvar handlePushResponse = function handlePushResponse(_ref3, response) {\n  var dispatch = _ref3.dispatch,\n      getState = _ref3.getState;\n  var requestId = response.request_id;\n\n  var _getRequest3 = getRequest(getState(), requestId),\n      promise = _getRequest3.promise,\n      resolve = _getRequest3.resolve;\n\n  var parsedPush = parsePush(response);\n  dispatch({\n    type: PUSH_RESPONSE_RECEIVED,\n    payload: _extends({\n      id: requestId,\n      promise: promise,\n      resolve: resolve\n    }, parsedPush)\n  });\n};\n\nvar handlePush$1 = function handlePush(store, push) {\n  var parsedPush = parsePush(push);\n\n  if (!parsedPush) {\n    // defensive measure against receiving unknown push\n    return;\n  }\n\n  store.dispatch({\n    type: PUSH_RECEIVED,\n    payload: parsedPush\n  });\n};\n\nvar socketListener = (function (store, socket) {\n  var dispatch = store.dispatch;\n  socket.on('connect', function () {\n    dispatch({\n      type: SOCKET_CONNECTED\n    });\n  });\n  socket.on('message', function (message) {\n    if (message.type === 'response') {\n      if (!message.success) {\n        handleResponseError(store, message);\n        return;\n      }\n\n      switch (message.action) {\n        case ACTIVATE_CHAT:\n        case DEACTIVATE_CHAT:\n        case SEND_EVENT:\n        case START_CHAT:\n          // those are requests with indirect responses\n          return;\n\n        default:\n          handleResponse$1(store, message);\n          return;\n      }\n    }\n\n    if ('request_id' in message) {\n      switch (message.action) {\n        case CHAT_DEACTIVATED:\n        case INCOMING_CHAT:\n        case INCOMING_EVENT:\n          // those are acting as indirect responses\n          handlePushResponse(store, message);\n          return;\n      }\n    }\n\n    handlePush$1(store, message);\n  });\n  socket.on('disconnect', function () {\n    failAllRequests(store, CONNECTION_LOST);\n\n    if (getConnectionStatus(store.getState()) === CONNECTED) {\n      store.dispatch(socketDisconnected());\n    }\n  });\n  socket.on('connection_unstable', function () {\n    dispatch({\n      type: SOCKET_UNSTABLE\n    });\n  });\n  socket.on('connection_recovered', function () {\n    dispatch({\n      type: SOCKET_RECOVERED\n    });\n  });\n  return socket.off;\n});\n\nvar INCORRECT_REQUESTER_STRUCTURE = 'incorrect requester structure';\n\nvar appendString = function appendString(input, str) {\n  return input.length ? input + \"\\n\" + str : str;\n};\n\nvar createTicketBody = function createTicketBody(state, _ref) {\n  var fields = _ref.fields,\n      customerId = _ref.customerId,\n      _ref$groupId = _ref.groupId,\n      groupId = _ref$groupId === void 0 ? state.groupId : _ref$groupId,\n      timeZone = _ref.timeZone;\n\n  var ticketBody = _extends({\n    licence_id: state.licenseId,\n    ticket_message: '',\n    offline_message: '',\n    visitor_id: customerId,\n    requester: {}\n  }, typeof groupId === 'number' && {\n    group: groupId\n  }, state.page && {\n    source: {\n      url: state.page.url\n    }\n  }, timeZone && {\n    timezone: timeZone\n  });\n\n  return fields.reduce(function (body, field) {\n    switch (field.type) {\n      case 'subject':\n        {\n          var value = field.answer;\n          var text = value ? field.label + \" \" + value : field.label;\n\n          if (value) {\n            body.subject = value;\n          }\n\n          body.offline_message = appendString(body.offline_message, text);\n          return body;\n        }\n\n      case 'name':\n        {\n          var _value = field.answer;\n\n          var _text = _value ? field.label + \" \" + _value : field.label;\n\n          if (_value) {\n            body.requester.name = _value;\n          }\n\n          body.offline_message = appendString(body.offline_message, _text);\n          return body;\n        }\n\n      case 'email':\n        {\n          var _value2 = field.answer;\n\n          var _text2 = _value2 ? field.label + \" \" + _value2 : field.label;\n\n          body.requester.mail = _value2;\n          body.offline_message = appendString(body.offline_message, _text2);\n          return body;\n        }\n\n      case 'question':\n      case 'textarea':\n        {\n          var _value3 = field.answer;\n\n          var _text3 = _value3 ? field.label + \" \" + _value3 : field.label;\n\n          body.offline_message = appendString(body.offline_message, _text3);\n          body.ticket_message = appendString(body.ticket_message, _text3);\n          return body;\n        }\n\n      case 'radio':\n      case 'select':\n        {\n          var _value4 = field.answer && field.answer.label;\n\n          var _text4 = _value4 ? field.label + \" \" + _value4 : field.label;\n\n          body.offline_message = appendString(body.offline_message, _text4);\n          body.ticket_message = appendString(body.ticket_message, _text4);\n          return body;\n        }\n\n      case 'checkbox':\n        {\n          var _value5 = field.answers && field.answers.map(function (answer) {\n            return answer.label;\n          }).join(', ');\n\n          var _text5 = _value5 ? field.label + \" \" + _value5 : field.label;\n\n          body.offline_message = appendString(body.offline_message, _text5);\n          body.ticket_message = appendString(body.ticket_message, _text5);\n          return body;\n        }\n\n      default:\n        return body;\n    }\n  }, ticketBody);\n};\n\nvar sendTicketForm = function sendTicketForm(store, auth, _ref2) {\n  var filledForm = _ref2.filledForm,\n      groupId = _ref2.groupId,\n      timeZone = _ref2.timeZone;\n  return auth.getToken().then(function (token) {\n    var state = store.getState();\n\n    if (getSelfId(state) === null) {\n      store.dispatch(setSelfId(token.entityId));\n    }\n\n    var url = getApiOrigin(state) + \"/v2/tickets/new\";\n    var body = createTicketBody(state, {\n      fields: filledForm.fields,\n      customerId: token.entityId,\n      groupId: groupId,\n      timeZone: timeZone\n    });\n    return (0,unfetch__WEBPACK_IMPORTED_MODULE_6__.default)(url, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify(body)\n    }).then(function (response) {\n      if (response.ok) {\n        return response.json().then(function (res) {\n          return _extends({}, res, {\n            text: body.ticket_message\n          });\n        });\n      } // we actually should normalize this somehow\n\n\n      if (response.status === 400 || response.status === 422) {\n        var errHandler = function errHandler(error) {\n          if (!error || !error.errors) {\n            // TODO: I honestly don't know if this can even be reached and even if it is - What error should be thrown here\n            throw new Error();\n          } // we receive some hardcore aggregate error here 😱\n\n\n          var firstError = error.errors[0];\n          var type = Object.keys(firstError)[0];\n\n          if (type === INCORRECT_REQUESTER_STRUCTURE) {\n            throw createError({\n              message: firstError[INCORRECT_REQUESTER_STRUCTURE][0],\n              code: 'VALIDATION'\n            });\n          }\n\n          throw new Error();\n        };\n\n        return response.json().then(errHandler, errHandler);\n      }\n\n      throw new Error();\n    });\n  });\n};\n\nvar KILOBYTE = 1024;\nvar MEGABYTE = 1024 * KILOBYTE;\nvar GIGABYTE = 1024 * MEGABYTE;\nvar SIZE_LIMIT = 10 * MEGABYTE;\n\nvar formatBytes = function formatBytes(bytes, precision) {\n  if (precision === void 0) {\n    precision = 2;\n  }\n\n  if (bytes < KILOBYTE) {\n    return bytes + \" b\";\n  }\n\n  var kilobytes = bytes / 1024;\n\n  if (bytes < MEGABYTE) {\n    return kilobytes.toFixed(precision) + \" kb\";\n  }\n\n  var megabytes = kilobytes / 1024;\n\n  if (bytes < GIGABYTE) {\n    return megabytes.toFixed(precision) + \" MB\";\n  }\n\n  var gigabytes = megabytes / 1024;\n  return gigabytes.toFixed(precision) + \" GB\";\n};\n\nvar validateFile = function validateFile(file) {\n  if (file.size > SIZE_LIMIT) {\n    throw createError({\n      message: \"The file is too big (max size is \" + formatBytes(SIZE_LIMIT) + \").\",\n      code: 'TOO_BIG_FILE'\n    });\n  }\n};\n\nvar uploadFile = function uploadFile(_ref, _ref2) {\n  var auth = _ref.auth,\n      store = _ref.store;\n  var file = _ref2.file,\n      onProgress = _ref2.onProgress;\n  var upload;\n  var cancelled = false;\n  var send = new Promise(function (resolve, reject) {\n    validateFile(file);\n    var state = store.getState();\n    var query = (0,_livechat_url_utils__WEBPACK_IMPORTED_MODULE_7__.buildQueryString)({\n      license_id: state.licenseId\n    });\n    var url = getServerUrl(state) + \"/action/\" + UPLOAD_FILE + \"?\" + query;\n    var payload = {\n      file: file\n    };\n    auth.getToken().then(function (token) {\n      if (cancelled) {\n        reject(new Error('Upload cancelled.'));\n        return;\n      }\n\n      upload = (0,_livechat_file_upload__WEBPACK_IMPORTED_MODULE_10__.default)(url, payload, {\n        headers: {\n          Authorization: token.tokenType + \" \" + token.accessToken\n        },\n        onProgress: onProgress\n      });\n      upload.promise.then(resolve, function (uploadError) {\n        // an error might not come from a server\n        if (!uploadError.response) {\n          reject(uploadError);\n          return;\n        }\n\n        var _uploadError$response = uploadError.response.error,\n            type = _uploadError$response.type,\n            message = _uploadError$response.message;\n        reject(createError({\n          message: message,\n          code: type.toUpperCase()\n        }));\n      });\n    });\n  });\n  return {\n    promise: send,\n    cancel: function cancel() {\n      if (cancelled) {\n        return;\n      }\n\n      cancelled = true;\n\n      if (upload) {\n        upload.cancel();\n      }\n    }\n  };\n};\n\nvar makeGraylogRequest = function makeGraylogRequest(url, body) {\n  return new Promise(function (resolve) {\n    var img = new Image();\n    img.src = url + \"?\" + body;\n    img.onerror = _livechat_data_utils__WEBPACK_IMPORTED_MODULE_0__.noop;\n\n    img.onload = function () {\n      return resolve();\n    };\n  });\n};\n\n/**\n * Logs event to Graylog with provided config data.\n * Logging request is fired only when all of those conditions are true:\n * 1. package is used in lc production environment\n * 2. package is used standalone because only then \"customer_sdk\" will be set to customer_sdk\n */\nvar log = function log(_ref) {\n  var env = _ref.env,\n      licenseId = _ref.licenseId,\n      eventName = _ref.eventName;\n\n  if (env !== 'production' || \"customer_sdk\" !== 'customer_sdk') {\n    return Promise.resolve();\n  }\n\n  var message = {\n    event_name: eventName,\n    severity: 'Informational',\n    sdkVersion: \"2.0.4\"\n  };\n  var body = {\n    licence_id: licenseId,\n    event_id: 'chat_widget_customer_sdk',\n    message: JSON.stringify(message)\n  };\n  return makeGraylogRequest('https://queue.livechatinc.com/logs', (0,_livechat_url_utils__WEBPACK_IMPORTED_MODULE_7__.buildQueryString)(body));\n};\n\nvar LISTENER_IDENTITY = 'LISTENER_IDENTITY';\nvar listenersMap = {};\n\nvar createDebuggedMethods = function createDebuggedMethods(methods, prefix) {\n  if (prefix === void 0) {\n    prefix = '';\n  }\n\n  var methodNames = Object.keys(methods);\n  return methodNames.map(function (methodName) {\n    var method = methods[methodName];\n    return function () {\n      var _console;\n\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n\n      (_console = console).info.apply(_console, [prefix + \".\" + methodName + \"() ===>\"].concat(args));\n\n      var result = method.apply(void 0, args);\n\n      if (result && typeof result.then === 'function') {\n        result.then(function (data) {\n          console.info(prefix + \".\" + methodName + \"() <===\", data);\n        }).catch(function (err) {\n          console.error(prefix + \".\" + methodName + \"() <===\", err);\n        });\n      }\n\n      return result;\n    };\n  }).reduce(function (acc, method, index) {\n    acc[methodNames[index]] = method;\n    return acc;\n  }, {});\n};\n\nvar createEnhancedListener = function createEnhancedListener(label, event, listener) {\n  if (listener[LISTENER_IDENTITY] === undefined) {\n    Object.defineProperty(listener, LISTENER_IDENTITY, {\n      value: {}\n    });\n  }\n\n  if (listener[LISTENER_IDENTITY][event]) {\n    var enhancedListenerId = listener[LISTENER_IDENTITY][event];\n    return listenersMap[enhancedListenerId];\n  }\n\n  var enhancedListener = function enhancedListener(data) {\n    console.info(\".\" + label + \"(\\\"\" + event + \"\\\") <===\", data);\n    listener(data);\n  };\n\n  var uniqueId = (0,_livechat_data_utils__WEBPACK_IMPORTED_MODULE_0__.generateUniqueId)(listenersMap);\n  listener[LISTENER_IDENTITY][event] = uniqueId;\n  listenersMap[uniqueId] = enhancedListener;\n  return enhancedListener;\n}; // TODO: this really should just accept & return CustomerSdk type\n\n\nvar debug = (function (_sdk) {\n  var sdk = _sdk;\n\n  if (false) {}\n\n  var _on = sdk.on,\n      _once = sdk.once,\n      _off = sdk.off,\n      _getChatHistory = sdk.getChatHistory,\n      auth = sdk.auth,\n      rest = _objectWithoutPropertiesLoose(sdk, [\"on\", \"once\", \"off\", \"getChatHistory\", \"auth\"]);\n\n  var methods = createDebuggedMethods(rest);\n  return Object.freeze(_extends({\n    auth: Object.freeze(createDebuggedMethods(auth, '.auth'))\n  }, methods, {\n    getChatHistory: function getChatHistory() {\n      var _console2;\n\n      for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n        args[_key2] = arguments[_key2];\n      }\n\n      (_console2 = console).info.apply(_console2, [\".getChatHistory()\"].concat(args));\n\n      var history = _getChatHistory.apply(void 0, args);\n\n      var logLabel = 'history.next()';\n      return {\n        next: function next() {\n          var _console3;\n\n          (_console3 = console).info.apply(_console3, [logLabel + \" ===>\"].concat(args));\n\n          var result = history.next();\n          result.then(function (data) {\n            var _console4;\n\n            (_console4 = console).info.apply(_console4, [logLabel + \" <===\"].concat(args, [data]));\n          }).catch(function (err) {\n            var _console5;\n\n            (_console5 = console).error.apply(_console5, [logLabel + \" <===\"].concat(args, [err]));\n          });\n          return result;\n        }\n      };\n    },\n    off: function off(event, listener) {\n      console.info(\".off(\\\"\" + event + \"\\\", \" + (listener.name || 'anonymous') + \")\");\n      var enhancedListener = listener;\n\n      if (listener[LISTENER_IDENTITY] !== undefined) {\n        var enhancedListenerId = listener[LISTENER_IDENTITY][event];\n        enhancedListener = listenersMap[enhancedListenerId];\n      }\n\n      _off(event, enhancedListener);\n    },\n    on: function on(event, listener) {\n      _on(event, createEnhancedListener('on', event, listener));\n    },\n    once: function once(event, listener) {\n      _once(event, createEnhancedListener('once', event, listener));\n    }\n  }));\n});\n\nvar CHATS_PAGINATION_MAX_LIMIT = 25;\nvar init = function init(config, env) {\n  if (env === void 0) {\n    env = 'production';\n  }\n\n  (0,_livechat_customer_auth__WEBPACK_IMPORTED_MODULE_11__.validateConfig)(config);\n\n  var _config$autoConnect = config.autoConnect,\n      autoConnect = _config$autoConnect === void 0 ? true : _config$autoConnect,\n      customerDataProvider = config.customerDataProvider,\n      instanceConfig = _objectWithoutPropertiesLoose(config, [\"autoConnect\", \"customerDataProvider\"]);\n\n  var store = finalCreateStore(_extends({}, instanceConfig, {\n    env: env\n  }));\n  var emitter = (0,_livechat_mitt__WEBPACK_IMPORTED_MODULE_9__.default)();\n  var socket = createSocketClient(store);\n  var auth = (0,_livechat_customer_auth__WEBPACK_IMPORTED_MODULE_11__.default)(instanceConfig, env);\n  store.addSideEffectsHandler(createSideEffectsHandler({\n    emitter: emitter,\n    socket: socket,\n    auth: auth,\n    customerDataProvider: customerDataProvider\n  }));\n  socketListener(store, socket);\n\n  var sendRequestAction$$1 = sendRequestAction.bind(null, store);\n\n  var startConnection = function startConnection() {\n    store.dispatch({\n      type: START_CONNECTION\n    });\n  };\n\n  var api = Object.freeze({\n    acceptGreeting: function acceptGreeting(_ref) {\n      var greetingId = _ref.greetingId,\n          uniqueId = _ref.uniqueId;\n      return sendRequestAction$$1(sendRequest(ACCEPT_GREETING, {\n        greeting_id: greetingId,\n        unique_id: uniqueId\n      }));\n    },\n    activateChat: function activateChat(data) {\n      log({\n        env: env,\n        licenseId: config.licenseId,\n        eventName: 'chat_started'\n      });\n      return sendRequestAction$$1(sendRequest(ACTIVATE_CHAT, parseActivateChatData(data)));\n    },\n    auth: auth,\n    cancelGreeting: function cancelGreeting(_ref2) {\n      var uniqueId = _ref2.uniqueId;\n      return sendRequestAction$$1(sendRequest(CANCEL_GREETING, {\n        unique_id: uniqueId\n      }));\n    },\n    cancelRate: function cancelRate(params) {\n      var chatId = params.chatId,\n          _params$properties = params.properties,\n          properties = _params$properties === void 0 ? ['score'] : _params$properties;\n      return api.listThreads({\n        chatId: chatId\n      }).then(function (_ref3) {\n        var threads = _ref3.threads;\n\n        if (!threads.length) {\n          throw createError({\n            message: \"There is no thread in \\\"\" + chatId + \"\\\".\",\n            code: MISSING_CHAT_THREAD\n          });\n        }\n\n        return api.deleteThreadProperties({\n          chatId: chatId,\n          threadId: threads[0].id,\n          properties: {\n            rating: properties\n          }\n        });\n      });\n    },\n    connect: startConnection,\n    deactivateChat: function deactivateChat(_ref4) {\n      var chatId = _ref4.chatId;\n      return sendRequestAction$$1(sendRequest(DEACTIVATE_CHAT, {\n        chat_id: chatId\n      }));\n    },\n    deleteChatProperties: function deleteChatProperties(_ref5) {\n      var chatId = _ref5.chatId,\n          properties = _ref5.properties;\n      return sendRequestAction$$1(sendRequest(DELETE_CHAT_PROPERTIES, {\n        chat_id: chatId,\n        properties: properties\n      }));\n    },\n    deleteEventProperties: function deleteEventProperties(_ref6) {\n      var chatId = _ref6.chatId,\n          threadId = _ref6.threadId,\n          eventId = _ref6.eventId,\n          properties = _ref6.properties;\n      return sendRequestAction$$1(sendRequest(DELETE_EVENT_PROPERTIES, {\n        chat_id: chatId,\n        thread_id: threadId,\n        event_id: eventId,\n        properties: properties\n      }));\n    },\n    deleteThreadProperties: function deleteThreadProperties(_ref7) {\n      var chatId = _ref7.chatId,\n          threadId = _ref7.threadId,\n          properties = _ref7.properties;\n      return sendRequestAction$$1(sendRequest(DELETE_THREAD_PROPERTIES, {\n        chat_id: chatId,\n        thread_id: threadId,\n        properties: properties\n      }));\n    },\n    destroy: function destroy$$1() {\n      store.dispatch(destroy('manual'));\n    },\n    disconnect: function disconnect() {\n      store.dispatch({\n        type: PAUSE_CONNECTION\n      });\n    },\n    getChat: function getChat(_ref8) {\n      var chatId = _ref8.chatId,\n          threadId = _ref8.threadId;\n      return sendRequestAction$$1(sendRequest(GET_CHAT, {\n        chat_id: chatId,\n        thread_id: threadId\n      }));\n    },\n    getChatHistory: function getChatHistory(_ref9) {\n      var chatId = _ref9.chatId;\n      return createChatHistoryIterator(api, chatId);\n    },\n    getCustomer: function getCustomer() {\n      return sendRequestAction$$1(sendRequest(GET_CUSTOMER, {}));\n    },\n    getForm: function getForm(_ref10) {\n      var groupId = _ref10.groupId,\n          type = _ref10.type;\n      return sendRequestAction$$1(sendRequest(GET_FORM, {\n        group_id: groupId,\n        type: type\n      }));\n    },\n    getPredictedAgent: function getPredictedAgent(params) {\n      if (params === void 0) {\n        params = {};\n      }\n\n      var _params = params,\n          groupId = _params.groupId;\n      return sendRequestAction$$1(sendRequest(GET_PREDICTED_AGENT, typeof groupId === 'number' ? {\n        group_id: groupId\n      } : {}));\n    },\n    getUrlInfo: function getUrlInfo(_ref11) {\n      var url = _ref11.url;\n      return sendRequestAction$$1(sendRequest(GET_URL_INFO, {\n        url: url\n      }));\n    },\n    listChats: function listChats(_temp) {\n      var _ref12 = _temp === void 0 ? {} : _temp,\n          _ref12$limit = _ref12.limit,\n          limit = _ref12$limit === void 0 ? 10 : _ref12$limit,\n          pageId = _ref12.pageId;\n\n      if (limit > CHATS_PAGINATION_MAX_LIMIT) {\n        return Promise.reject(new Error(\"Specified limit is too high (max \" + CHATS_PAGINATION_MAX_LIMIT + \").\"));\n      }\n\n      return sendRequestAction$$1(sendRequest(LIST_CHATS, {\n        limit: limit,\n        page_id: pageId\n      }));\n    },\n    listGroupStatuses: function listGroupStatuses(_temp2) {\n      var _ref13 = _temp2 === void 0 ? {} : _temp2,\n          groupIds = _ref13.groupIds;\n\n      return sendRequestAction$$1(sendRequest(LIST_GROUP_STATUSES, groupIds ? {\n        group_ids: groupIds\n      } : {\n        all: true\n      }));\n    },\n    listThreads: function listThreads(_ref14) {\n      var chatId = _ref14.chatId,\n          _ref14$sortOrder = _ref14.sortOrder,\n          sortOrder = _ref14$sortOrder === void 0 ? DESC : _ref14$sortOrder,\n          limit = _ref14.limit,\n          pageId = _ref14.pageId,\n          minEventsCount = _ref14.minEventsCount;\n      return sendRequestAction$$1(sendRequest(LIST_THREADS, {\n        chat_id: chatId,\n        sort_order: sortOrder,\n        limit: limit,\n        page_id: pageId,\n        min_events_count: minEventsCount\n      }));\n    },\n    markEventsAsSeen: function markEventsAsSeen(_ref15) {\n      var chatId = _ref15.chatId,\n          seenUpTo = _ref15.seenUpTo;\n      return sendRequestAction$$1(sendRequest(MARK_EVENTS_AS_SEEN, {\n        chat_id: chatId,\n        seen_up_to: seenUpTo\n      }));\n    },\n    on: emitter.on,\n    once: emitter.once,\n    off: emitter.off,\n    rateChat: function rateChat(params) {\n      var chatId = params.chatId,\n          rating = params.rating;\n      return api.listThreads({\n        chatId: chatId\n      }).then(function (_ref16) {\n        var threads = _ref16.threads;\n\n        if (!threads.length) {\n          throw createError({\n            message: \"There is no thread in \\\"\" + chatId + \"\\\".\",\n            code: MISSING_CHAT_THREAD\n          });\n        }\n\n        return api.updateThreadProperties({\n          chatId: chatId,\n          threadId: threads[0].id,\n          properties: {\n            rating: rating\n          }\n        });\n      });\n    },\n    sendEvent: function (_sendEvent) {\n      function sendEvent$$1(_x) {\n        return _sendEvent.apply(this, arguments);\n      }\n\n      sendEvent$$1.toString = function () {\n        return _sendEvent.toString();\n      };\n\n      return sendEvent$$1;\n    }(function (params) {\n      return sendRequestAction$$1(sendEvent(params));\n    }),\n    sendTicketForm: function sendTicketForm$$1(options) {\n      return sendTicketForm(store, auth, options);\n    },\n    sendRichMessagePostback: function sendRichMessagePostback(_ref17) {\n      var chatId = _ref17.chatId,\n          threadId = _ref17.threadId,\n          eventId = _ref17.eventId,\n          postback = _ref17.postback;\n      return sendRequestAction$$1(sendRequest(SEND_RICH_MESSAGE_POSTBACK, {\n        chat_id: chatId,\n        event_id: eventId,\n        thread_id: threadId,\n        postback: postback\n      }));\n    },\n    setCustomerSessionFields: function setCustomerSessionFields(_ref18) {\n      var sessionFields = _ref18.sessionFields;\n      return sendRequestAction$$1(sendRequest(SET_CUSTOMER_SESSION_FIELDS, {\n        session_fields: parseCustomerSessionFields(sessionFields)\n      }));\n    },\n    setSneakPeek: function setSneakPeek(_ref19) {\n      var chatId = _ref19.chatId,\n          sneakPeekText = _ref19.sneakPeekText;\n      var state = store.getState();\n\n      if (!isChatActive(state, chatId) || !isConnected(state)) {\n        return;\n      }\n\n      sendRequestAction$$1(sendRequest(SEND_SNEAK_PEEK, {\n        chat_id: chatId,\n        sneak_peek_text: sneakPeekText\n      })).catch(_livechat_data_utils__WEBPACK_IMPORTED_MODULE_0__.noop);\n    },\n    startChat: function startChat(data) {\n      if (data === void 0) {\n        data = {};\n      }\n\n      log({\n        env: env,\n        licenseId: config.licenseId,\n        eventName: 'chat_started'\n      });\n      return sendRequestAction$$1(sendRequest(START_CHAT, parseStartChatData(data)));\n    },\n    updateChatProperties: function updateChatProperties(_ref20) {\n      var chatId = _ref20.chatId,\n          properties = _ref20.properties;\n      return sendRequestAction$$1(sendRequest(UPDATE_CHAT_PROPERTIES, {\n        chat_id: chatId,\n        properties: properties\n      }));\n    },\n    updateCustomer: function updateCustomer(update) {\n      return sendRequestAction$$1(sendRequest(UPDATE_CUSTOMER, parseCustomerUpdate(update)));\n    },\n    updateCustomerPage: function updateCustomerPage(page) {\n      store.dispatch({\n        type: UPDATE_CUSTOMER_PAGE,\n        payload: (0,_livechat_data_utils__WEBPACK_IMPORTED_MODULE_0__.pickOwn)(['title', 'url'], page)\n      });\n    },\n    updateEventProperties: function updateEventProperties(_ref21) {\n      var chatId = _ref21.chatId,\n          threadId = _ref21.threadId,\n          eventId = _ref21.eventId,\n          properties = _ref21.properties;\n      return sendRequestAction$$1(sendRequest(UPDATE_EVENT_PROPERTIES, {\n        chat_id: chatId,\n        event_id: eventId,\n        thread_id: threadId,\n        properties: properties\n      }));\n    },\n    updateThreadProperties: function updateThreadProperties(_ref22) {\n      var chatId = _ref22.chatId,\n          threadId = _ref22.threadId,\n          properties = _ref22.properties;\n      return sendRequestAction$$1(sendRequest(UPDATE_THREAD_PROPERTIES, {\n        chat_id: chatId,\n        thread_id: threadId,\n        properties: properties\n      }));\n    },\n    uploadFile: function uploadFile$$1(options) {\n      return uploadFile({\n        auth: auth,\n        store: store\n      }, options);\n    }\n  });\n\n  if (autoConnect) {\n    startConnection();\n  } else {\n    store.dispatch({\n      type: CHECK_GOALS,\n      payload: {\n        sessionFields: typeof customerDataProvider === 'function' ? customerDataProvider().sessionFields : {}\n      }\n    });\n  }\n\n  return api;\n};\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi4vLi4vLi4vbm9kZV9tb2R1bGVzL0BsaXZlY2hhdC9jdXN0b21lci1zZGsvZGlzdC9jdXN0b21lci1zZGsuZXNtLmpzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4uLy4uLy4uL25vZGVfbW9kdWxlcy9AbGl2ZWNoYXQvY3VzdG9tZXItc2RrL2Rpc3QvY3VzdG9tZXItc2RrLmVzbS5qcz83ZWE5Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IG1hcFZhbHVlcywgbm9vcCwgaGFzT3duLCBpZGVudGl0eSwgaXNPYmplY3QsIHBpY2tPd24sIHRvUGFpcnMsIGdlbmVyYXRlVW5pcXVlSWQsIHBpY2ssIGtleUJ5LCBpc0VtcHR5LCBmbGF0TWFwLCBpbmNsdWRlcywgbGFzdCwgbnVtZXJpY1NvcnRCeSwgc3RyaW5nQ29tcGFyZSwgdW5pcUJ5IH0gZnJvbSAnQGxpdmVjaGF0L2RhdGEtdXRpbHMnO1xuaW1wb3J0IGRlZmVycmVkIGZyb20gJ0BsaXZlY2hhdC9kZWZlcnJlZCc7XG5pbXBvcnQgeyBjcmVhdGVTdG9yZSwgYXBwbHlNaWRkbGV3YXJlIH0gZnJvbSAncmVkdXgnO1xuaW1wb3J0IGNyZWF0ZVNpZGVFZmZlY3RzTWlkZGxld2FyZSBmcm9tICdAbGl2ZWNoYXQvc2lkZS1lZmZlY3RzLW1pZGRsZXdhcmUnO1xuaW1wb3J0IHN0b3JhZ2UgZnJvbSAnQGxpdmVjaGF0L2lzb21vcnBoaWMtc3RvcmFnZSc7XG5pbXBvcnQgcHJvbWlzZVRyeSBmcm9tICdAbGl2ZWNoYXQvcHJvbWlzZS10cnknO1xuaW1wb3J0IEJhY2tvIGZyb20gJ2JhY2tvMic7XG5pbXBvcnQgdW5mZXRjaCBmcm9tICd1bmZldGNoJztcbmltcG9ydCB7IGJ1aWxkUXVlcnlTdHJpbmcgfSBmcm9tICdAbGl2ZWNoYXQvdXJsLXV0aWxzJztcbmltcG9ydCBjcmVhdGVQbGF0Zm9ybUNsaWVudCBmcm9tICdAbGl2ZWNoYXQvcGxhdGZvcm0tY2xpZW50JztcbmltcG9ydCBtaXR0IGZyb20gJ0BsaXZlY2hhdC9taXR0JztcbmltcG9ydCByYXdVcGxvYWRGaWxlIGZyb20gJ0BsaXZlY2hhdC9maWxlLXVwbG9hZCc7XG5pbXBvcnQgY3JlYXRlQXV0aCwgeyB2YWxpZGF0ZUNvbmZpZyB9IGZyb20gJ0BsaXZlY2hhdC9jdXN0b21lci1hdXRoJztcblxuZnVuY3Rpb24gX2V4dGVuZHMoKSB7XG4gIF9leHRlbmRzID0gT2JqZWN0LmFzc2lnbiB8fCBmdW5jdGlvbiAodGFyZ2V0KSB7XG4gICAgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHtcbiAgICAgIHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV07XG5cbiAgICAgIGZvciAodmFyIGtleSBpbiBzb3VyY2UpIHtcbiAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChzb3VyY2UsIGtleSkpIHtcbiAgICAgICAgICB0YXJnZXRba2V5XSA9IHNvdXJjZVtrZXldO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHRhcmdldDtcbiAgfTtcblxuICByZXR1cm4gX2V4dGVuZHMuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbn1cblxuZnVuY3Rpb24gX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzTG9vc2Uoc291cmNlLCBleGNsdWRlZCkge1xuICBpZiAoc291cmNlID09IG51bGwpIHJldHVybiB7fTtcbiAgdmFyIHRhcmdldCA9IHt9O1xuICB2YXIgc291cmNlS2V5cyA9IE9iamVjdC5rZXlzKHNvdXJjZSk7XG4gIHZhciBrZXksIGk7XG5cbiAgZm9yIChpID0gMDsgaSA8IHNvdXJjZUtleXMubGVuZ3RoOyBpKyspIHtcbiAgICBrZXkgPSBzb3VyY2VLZXlzW2ldO1xuICAgIGlmIChleGNsdWRlZC5pbmRleE9mKGtleSkgPj0gMCkgY29udGludWU7XG4gICAgdGFyZ2V0W2tleV0gPSBzb3VyY2Vba2V5XTtcbiAgfVxuXG4gIHJldHVybiB0YXJnZXQ7XG59XG5cbmZ1bmN0aW9uIF90b1ByaW1pdGl2ZShpbnB1dCwgaGludCkge1xuICBpZiAodHlwZW9mIGlucHV0ICE9PSBcIm9iamVjdFwiIHx8IGlucHV0ID09PSBudWxsKSByZXR1cm4gaW5wdXQ7XG4gIHZhciBwcmltID0gaW5wdXRbU3ltYm9sLnRvUHJpbWl0aXZlXTtcblxuICBpZiAocHJpbSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgdmFyIHJlcyA9IHByaW0uY2FsbChpbnB1dCwgaGludCB8fCBcImRlZmF1bHRcIik7XG4gICAgaWYgKHR5cGVvZiByZXMgIT09IFwib2JqZWN0XCIpIHJldHVybiByZXM7XG4gICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkBAdG9QcmltaXRpdmUgbXVzdCByZXR1cm4gYSBwcmltaXRpdmUgdmFsdWUuXCIpO1xuICB9XG5cbiAgcmV0dXJuIChoaW50ID09PSBcInN0cmluZ1wiID8gU3RyaW5nIDogTnVtYmVyKShpbnB1dCk7XG59XG5cbmZ1bmN0aW9uIF90b1Byb3BlcnR5S2V5KGFyZykge1xuICB2YXIga2V5ID0gX3RvUHJpbWl0aXZlKGFyZywgXCJzdHJpbmdcIik7XG5cbiAgcmV0dXJuIHR5cGVvZiBrZXkgPT09IFwic3ltYm9sXCIgPyBrZXkgOiBTdHJpbmcoa2V5KTtcbn1cblxudmFyIENIQU5HRV9SRUdJT04gPSAnY2hhbmdlX3JlZ2lvbic7XG52YXIgQ0hFQ0tfR09BTFMgPSAnY2hlY2tfZ29hbHMnO1xudmFyIERFU1RST1kgPSAnZGVzdHJveSc7XG52YXIgRkFJTF9BTExfUkVRVUVTVFMgPSAnZmFpbF9hbGxfcmVxdWVzdHMnO1xudmFyIExPR0lOX1NVQ0NFU1MgPSAnbG9naW5fc3VjY2Vzcyc7XG52YXIgUEFVU0VfQ09OTkVDVElPTiA9ICdwYXVzZV9jb25uZWN0aW9uJztcbnZhciBQUkVGRVRDSF9UT0tFTiA9ICdwcmVmZXRjaF90b2tlbic7XG52YXIgUFVTSF9SRUNFSVZFRCA9ICdwdXNoX3JlY2VpdmVkJztcbnZhciBQVVNIX1JFU1BPTlNFX1JFQ0VJVkVEID0gJ3B1c2hfcmVzcG9uc2VfcmVjZWl2ZWQnO1xudmFyIFJFQ09OTkVDVCA9ICdyZWNvbm5lY3QnO1xudmFyIFJFUVVFU1RfRkFJTEVEID0gJ3JlcXVlc3RfZmFpbGVkJztcbnZhciBSRVNQT05TRV9SRUNFSVZFRCA9ICdyZXNwb25zZV9yZWNlaXZlZCc7XG52YXIgU0VORF9SRVFVRVNUID0gJ3NlbmRfcmVxdWVzdCc7XG52YXIgU0VUX0NIQVRfQUNUSVZFID0gJ3NldF9jaGF0X2FjdGl2ZSc7XG52YXIgU0VUX1NFTEZfSUQgPSAnc2V0X3NlbGZfaWQnO1xudmFyIFNPQ0tFVF9DT05ORUNURUQgPSAnc29ja2V0X2Nvbm5lY3RlZCc7XG52YXIgU09DS0VUX0RJU0NPTk5FQ1RFRCA9ICdzb2NrZXRfZGlzY29ubmVjdGVkJztcbnZhciBTT0NLRVRfUkVDT1ZFUkVEID0gJ3NvY2tldF9yZWNvdmVyZWQnO1xudmFyIFNPQ0tFVF9VTlNUQUJMRSA9ICdzb2NrZXRfdW5zdGFibGUnO1xudmFyIFNUQVJUX0NPTk5FQ1RJT04gPSAnc3RhcnRfY29ubmVjdGlvbic7XG52YXIgVVBEQVRFX0NVU1RPTUVSX1BBR0UgPSAndXBkYXRlX2N1c3RvbWVyX3BhZ2UnO1xuXG52YXIgQ09OTkVDVElPTl9MT1NUID0gJ0NPTk5FQ1RJT05fTE9TVCc7XG52YXIgSURFTlRJVFlfTUlTTUFUQ0ggPSAnSURFTlRJVFlfTUlTTUFUQ0gnO1xudmFyIE1JU0RJUkVDVEVEX0NPTk5FQ1RJT04gPSAnTUlTRElSRUNURURfQ09OTkVDVElPTic7XG52YXIgTUlTU0lOR19DSEFUX1RIUkVBRCA9ICdNSVNTSU5HX0NIQVRfVEhSRUFEJztcbnZhciBSRVFVRVNUX1RJTUVPVVQgPSAnUkVRVUVTVF9USU1FT1VUJztcbnZhciBUT09fTUFOWV9VTkFVVEhPUklaRURfQ09OTkVDVElPTlMgPSAnVE9PX01BTllfVU5BVVRIT1JJWkVEX0NPTk5FQ1RJT05TJztcblxudmFyIEFDQ0VQVF9HUkVFVElORyA9ICdhY2NlcHRfZ3JlZXRpbmcnO1xudmFyIEFDVElWQVRFX0NIQVQgPSAnYWN0aXZhdGVfY2hhdCc7XG52YXIgQ0FOQ0VMX0dSRUVUSU5HID0gJ2NhbmNlbF9ncmVldGluZyc7XG52YXIgQ0hFQ0tfR09BTFMkMSA9ICdjaGVja19nb2Fscyc7XG52YXIgREVBQ1RJVkFURV9DSEFUID0gJ2RlYWN0aXZhdGVfY2hhdCc7XG52YXIgREVMRVRFX0NIQVRfUFJPUEVSVElFUyA9ICdkZWxldGVfY2hhdF9wcm9wZXJ0aWVzJztcbnZhciBERUxFVEVfRVZFTlRfUFJPUEVSVElFUyA9ICdkZWxldGVfZXZlbnRfcHJvcGVydGllcyc7XG52YXIgREVMRVRFX1RIUkVBRF9QUk9QRVJUSUVTID0gJ2RlbGV0ZV90aHJlYWRfcHJvcGVydGllcyc7XG52YXIgR0VUX0NIQVQgPSAnZ2V0X2NoYXQnO1xudmFyIEdFVF9DVVNUT01FUiA9ICdnZXRfY3VzdG9tZXInO1xudmFyIEdFVF9GT1JNID0gJ2dldF9mb3JtJztcbnZhciBHRVRfUFJFRElDVEVEX0FHRU5UID0gJ2dldF9wcmVkaWN0ZWRfYWdlbnQnO1xudmFyIEdFVF9VUkxfSU5GTyA9ICdnZXRfdXJsX2luZm8nO1xudmFyIExJU1RfQ0hBVFMgPSAnbGlzdF9jaGF0cyc7XG52YXIgTElTVF9HUk9VUF9TVEFUVVNFUyA9ICdsaXN0X2dyb3VwX3N0YXR1c2VzJztcbnZhciBMSVNUX1RIUkVBRFMgPSAnbGlzdF90aHJlYWRzJztcbnZhciBMT0dJTiA9ICdsb2dpbic7XG52YXIgTUFSS19FVkVOVFNfQVNfU0VFTiA9ICdtYXJrX2V2ZW50c19hc19zZWVuJztcbnZhciBTRU5EX0VWRU5UID0gJ3NlbmRfZXZlbnQnO1xudmFyIFNFTkRfUklDSF9NRVNTQUdFX1BPU1RCQUNLID0gJ3NlbmRfcmljaF9tZXNzYWdlX3Bvc3RiYWNrJztcbnZhciBTRU5EX1NORUFLX1BFRUsgPSAnc2VuZF9zbmVha19wZWVrJztcbnZhciBTRVRfQ1VTVE9NRVJfU0VTU0lPTl9GSUVMRFMgPSAnc2V0X2N1c3RvbWVyX3Nlc3Npb25fZmllbGRzJztcbnZhciBTVEFSVF9DSEFUID0gJ3N0YXJ0X2NoYXQnO1xudmFyIFVQREFURV9DSEFUX1BST1BFUlRJRVMgPSAndXBkYXRlX2NoYXRfcHJvcGVydGllcyc7XG52YXIgVVBEQVRFX0NVU1RPTUVSID0gJ3VwZGF0ZV9jdXN0b21lcic7XG52YXIgVVBEQVRFX0NVU1RPTUVSX1BBR0UkMSA9ICd1cGRhdGVfY3VzdG9tZXJfcGFnZSc7XG52YXIgVVBEQVRFX0VWRU5UX1BST1BFUlRJRVMgPSAndXBkYXRlX2V2ZW50X3Byb3BlcnRpZXMnO1xudmFyIFVQREFURV9USFJFQURfUFJPUEVSVElFUyA9ICd1cGRhdGVfdGhyZWFkX3Byb3BlcnRpZXMnO1xudmFyIFVQTE9BRF9GSUxFID0gJ3VwbG9hZF9maWxlJztcblxudmFyIERFU0MgPSAnZGVzYyc7XG5cbnZhciBjcmVhdGVSZWR1Y2VyID0gZnVuY3Rpb24gY3JlYXRlUmVkdWNlcihpbml0aWFsU3RhdGUsIHJlZHVjZXJzTWFwKSB7XG4gIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ2RldmVsb3BtZW50JyAmJiByZWR1Y2Vyc01hcFt1bmRlZmluZWRdKSB7XG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWNvbnNvbGVcbiAgICBjb25zb2xlLndhcm4oW1wiUmVkdWNlciBjb250YWlucyBhbiAndW5kZWZpbmVkJyBhY3Rpb24gdHlwZS5cIiwgJ0hhdmUgeW91IG1pc3NwZWxsZWQgYSBjb25zdGFudD8nXS5qb2luKCdcXG4nKSk7XG4gIH1cblxuICByZXR1cm4gZnVuY3Rpb24gcmVkdWNlcihzdGF0ZSwgYWN0aW9uKSB7XG4gICAgaWYgKHN0YXRlID09PSB2b2lkIDApIHtcbiAgICAgIHN0YXRlID0gaW5pdGlhbFN0YXRlO1xuICAgIH1cblxuICAgIGlmIChoYXNPd24oYWN0aW9uLnR5cGUsIHJlZHVjZXJzTWFwKSkge1xuICAgICAgcmV0dXJuIHJlZHVjZXJzTWFwW2FjdGlvbi50eXBlXShzdGF0ZSwgYWN0aW9uLnBheWxvYWQpO1xuICAgIH1cblxuICAgIHJldHVybiBzdGF0ZTtcbiAgfTtcbn07IC8vIFRPRE86IHRoaXMgaXMgdGhlIHNhbWUgYXMgYnVpbHQtaW4gcmVkdXgncyBjb21iaW5lUmVkdWNlcnMsIHNob3VsZCBiZSByZW1vYmVkXG5cbnZhciBDT05ORUNURUQgPSAnY29ubmVjdGVkJztcbnZhciBERVNUUk9ZRUQgPSAnZGVzdHJveWVkJztcbnZhciBESVNDT05ORUNURUQgPSAnZGlzY29ubmVjdGVkJztcbnZhciBQQVVTRUQgPSAncGF1c2VkJztcbnZhciBSRUNPTk5FQ1RJTkcgPSAncmVjb25uZWN0aW5nJztcblxudmFyIEFHRU5UID0gJ2FnZW50JztcbnZhciBDVVNUT01FUiA9ICdjdXN0b21lcic7XG5cbnZhciBnZXRBbGxSZXF1ZXN0cyA9IGZ1bmN0aW9uIGdldEFsbFJlcXVlc3RzKHN0YXRlKSB7XG4gIHJldHVybiBzdGF0ZS5yZXF1ZXN0cztcbn07XG52YXIgZ2V0Q29ubmVjdGlvblN0YXR1cyA9IGZ1bmN0aW9uIGdldENvbm5lY3Rpb25TdGF0dXMoc3RhdGUpIHtcbiAgcmV0dXJuIHN0YXRlLmNvbm5lY3Rpb24uc3RhdHVzO1xufTtcbnZhciBnZXRSZXF1ZXN0ID0gZnVuY3Rpb24gZ2V0UmVxdWVzdChzdGF0ZSwgaWQpIHtcbiAgcmV0dXJuIHN0YXRlLnJlcXVlc3RzW2lkXTtcbn07XG52YXIgZ2V0U2VsZklkID0gZnVuY3Rpb24gZ2V0U2VsZklkKHN0YXRlKSB7XG4gIHJldHVybiBzdGF0ZS51c2Vycy5zZWxmLmlkO1xufTtcbnZhciBpc0NoYXRBY3RpdmUgPSBmdW5jdGlvbiBpc0NoYXRBY3RpdmUoc3RhdGUsIGNoYXRJZCkge1xuICB2YXIgY2hhdCA9IHN0YXRlLmNoYXRzW2NoYXRJZF07XG4gIHJldHVybiAhIWNoYXQgJiYgY2hhdC5hY3RpdmU7XG59O1xudmFyIGlzQ29ubmVjdGVkID0gZnVuY3Rpb24gaXNDb25uZWN0ZWQoc3RhdGUpIHtcbiAgcmV0dXJuIGdldENvbm5lY3Rpb25TdGF0dXMoc3RhdGUpID09PSBDT05ORUNURUQ7XG59O1xudmFyIGlzRGVzdHJveWVkID0gZnVuY3Rpb24gaXNEZXN0cm95ZWQoc3RhdGUpIHtcbiAgcmV0dXJuIGdldENvbm5lY3Rpb25TdGF0dXMoc3RhdGUpID09PSBERVNUUk9ZRUQ7XG59O1xuXG52YXIgZ2V0RW52UGFydCA9IGZ1bmN0aW9uIGdldEVudlBhcnQoX3JlZikge1xuICB2YXIgbGljZW5zZUlkID0gX3JlZi5saWNlbnNlSWQsXG4gICAgICBlbnYgPSBfcmVmLmVudjtcblxuICBpZiAobGljZW5zZUlkID09PSAxNTIwKSB7XG4gICAgcmV0dXJuICcuc3RhZ2luZyc7XG4gIH1cblxuICBpZiAoZW52ID09PSAncHJvZHVjdGlvbicpIHtcbiAgICByZXR1cm4gJyc7XG4gIH1cblxuICByZXR1cm4gXCIuXCIgKyBlbnY7XG59O1xuXG52YXIgZ2V0QXBpT3JpZ2luID0gZnVuY3Rpb24gZ2V0QXBpT3JpZ2luKHN0YXRlKSB7XG4gIHZhciByZWdpb24gPSBzdGF0ZS5yZWdpb247XG4gIHZhciByZWdpb25QYXJ0ID0gcmVnaW9uID8gXCItXCIgKyByZWdpb24gOiAnJztcbiAgcmV0dXJuIFwiaHR0cHM6Ly9hcGlcIiArIHJlZ2lvblBhcnQgKyBnZXRFbnZQYXJ0KHN0YXRlKSArIFwiLmxpdmVjaGF0aW5jLmNvbVwiO1xufTtcbnZhciBnZXRTZXJ2ZXJVcmwgPSBmdW5jdGlvbiBnZXRTZXJ2ZXJVcmwoc3RhdGUpIHtcbiAgcmV0dXJuIGdldEFwaU9yaWdpbihzdGF0ZSkgKyBcIi92My4yL2N1c3RvbWVyXCI7XG59O1xudmFyIGNyZWF0ZUluaXRpYWxTdGF0ZSA9IGZ1bmN0aW9uIGNyZWF0ZUluaXRpYWxTdGF0ZShpbml0aWFsU3RhdGVEYXRhKSB7XG4gIHZhciBfaW5pdGlhbFN0YXRlRGF0YSRhcHAgPSBpbml0aWFsU3RhdGVEYXRhLmFwcGxpY2F0aW9uLFxuICAgICAgYXBwbGljYXRpb24gPSBfaW5pdGlhbFN0YXRlRGF0YSRhcHAgPT09IHZvaWQgMCA/IHt9IDogX2luaXRpYWxTdGF0ZURhdGEkYXBwLFxuICAgICAgbGljZW5zZUlkID0gaW5pdGlhbFN0YXRlRGF0YS5saWNlbnNlSWQsXG4gICAgICBfaW5pdGlhbFN0YXRlRGF0YSRncm8gPSBpbml0aWFsU3RhdGVEYXRhLmdyb3VwSWQsXG4gICAgICBncm91cElkID0gX2luaXRpYWxTdGF0ZURhdGEkZ3JvID09PSB2b2lkIDAgPyBudWxsIDogX2luaXRpYWxTdGF0ZURhdGEkZ3JvLFxuICAgICAgZW52ID0gaW5pdGlhbFN0YXRlRGF0YS5lbnYsXG4gICAgICBfaW5pdGlhbFN0YXRlRGF0YSRwYWcgPSBpbml0aWFsU3RhdGVEYXRhLnBhZ2UsXG4gICAgICBwYWdlID0gX2luaXRpYWxTdGF0ZURhdGEkcGFnID09PSB2b2lkIDAgPyBudWxsIDogX2luaXRpYWxTdGF0ZURhdGEkcGFnLFxuICAgICAgX2luaXRpYWxTdGF0ZURhdGEkcmVnID0gaW5pdGlhbFN0YXRlRGF0YS5yZWdpb24sXG4gICAgICByZWdpb24gPSBfaW5pdGlhbFN0YXRlRGF0YSRyZWcgPT09IHZvaWQgMCA/IG51bGwgOiBfaW5pdGlhbFN0YXRlRGF0YSRyZWcsXG4gICAgICBfaW5pdGlhbFN0YXRlRGF0YSRyZWYgPSBpbml0aWFsU3RhdGVEYXRhLnJlZmVycmVyLFxuICAgICAgcmVmZXJyZXIgPSBfaW5pdGlhbFN0YXRlRGF0YSRyZWYgPT09IHZvaWQgMCA/IG51bGwgOiBfaW5pdGlhbFN0YXRlRGF0YSRyZWYsXG4gICAgICBfaW5pdGlhbFN0YXRlRGF0YSR1bmkgPSBpbml0aWFsU3RhdGVEYXRhLnVuaXF1ZUdyb3VwcyxcbiAgICAgIHVuaXF1ZUdyb3VwcyA9IF9pbml0aWFsU3RhdGVEYXRhJHVuaSA9PT0gdm9pZCAwID8gZmFsc2UgOiBfaW5pdGlhbFN0YXRlRGF0YSR1bmksXG4gICAgICBfaW5pdGlhbFN0YXRlRGF0YSRtb2IgPSBpbml0aWFsU3RhdGVEYXRhLm1vYmlsZSxcbiAgICAgIG1vYmlsZSA9IF9pbml0aWFsU3RhdGVEYXRhJG1vYiA9PT0gdm9pZCAwID8gZmFsc2UgOiBfaW5pdGlhbFN0YXRlRGF0YSRtb2I7XG4gIHJldHVybiB7XG4gICAgYXBwbGljYXRpb246IF9leHRlbmRzKHt9LCBhcHBsaWNhdGlvbiwge1xuICAgICAgbmFtZTogXCJjdXN0b21lcl9zZGtcIixcbiAgICAgIHZlcnNpb246IFwiMi4wLjRcIlxuICAgIH0pLFxuICAgIGxpY2Vuc2VJZDogbGljZW5zZUlkLFxuICAgIGVudjogZW52LFxuICAgIGdyb3VwSWQ6IGdyb3VwSWQsXG4gICAgY2hhdHM6IHt9LFxuICAgIGNvbm5lY3Rpb246IHtcbiAgICAgIHN0YXR1czogRElTQ09OTkVDVEVEXG4gICAgfSxcbiAgICBwYWdlOiBwYWdlLFxuICAgIHJlZ2lvbjogcmVnaW9uLFxuICAgIHJlZmVycmVyOiByZWZlcnJlcixcbiAgICByZXF1ZXN0czoge30sXG4gICAgdXNlcnM6IHtcbiAgICAgIHNlbGY6IHtcbiAgICAgICAgaWQ6IG51bGwsXG4gICAgICAgIHR5cGU6IENVU1RPTUVSXG4gICAgICB9LFxuICAgICAgb3RoZXJzOiB7fVxuICAgIH0sXG4gICAgdW5pcXVlR3JvdXBzOiB1bmlxdWVHcm91cHMsXG4gICAgbW9iaWxlOiBtb2JpbGVcbiAgfTtcbn07XG5cbnZhciByZW1vdmVTdG9yZWRSZXF1ZXN0ID0gZnVuY3Rpb24gcmVtb3ZlU3RvcmVkUmVxdWVzdChzdGF0ZSwgX3JlZjIpIHtcbiAgdmFyIGlkID0gX3JlZjIuaWQ7XG5cbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXVudXNlZC12YXJzXG4gIHZhciBfc3RhdGUkcmVxdWVzdHMgPSBzdGF0ZS5yZXF1ZXN0cyxcbiAgICAgIHJlcXVlc3RzID0gX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzTG9vc2UoX3N0YXRlJHJlcXVlc3RzLCBbaWRdLm1hcChfdG9Qcm9wZXJ0eUtleSkpO1xuXG4gIHJldHVybiBfZXh0ZW5kcyh7fSwgc3RhdGUsIHtcbiAgICByZXF1ZXN0czogcmVxdWVzdHNcbiAgfSk7XG59O1xuXG52YXIgc2V0Q29ubmVjdGlvblN0YXR1cyA9IGZ1bmN0aW9uIHNldENvbm5lY3Rpb25TdGF0dXMoc3RhdHVzLCBzdGF0ZSkge1xuICByZXR1cm4gX2V4dGVuZHMoe30sIHN0YXRlLCB7XG4gICAgY29ubmVjdGlvbjogX2V4dGVuZHMoe30sIHN0YXRlLmNvbm5lY3Rpb24sIHtcbiAgICAgIHN0YXR1czogc3RhdHVzXG4gICAgfSlcbiAgfSk7XG59O1xuXG52YXIgY3JlYXRlUmVkdWNlciQxID0gKGZ1bmN0aW9uIChzdGF0ZSkge1xuICB2YXIgX2NyZWF0ZVJlZHVjZXI7XG5cbiAgcmV0dXJuIGNyZWF0ZVJlZHVjZXIoc3RhdGUsIChfY3JlYXRlUmVkdWNlciA9IHt9LCBfY3JlYXRlUmVkdWNlcltDSEFOR0VfUkVHSU9OXSA9IGZ1bmN0aW9uIChzdGF0ZSwgX3JlZjMpIHtcbiAgICB2YXIgcmVnaW9uID0gX3JlZjMucmVnaW9uO1xuICAgIHJldHVybiBfZXh0ZW5kcyh7fSwgc3RhdGUsIHtcbiAgICAgIHJlZ2lvbjogcmVnaW9uXG4gICAgfSk7XG4gIH0sIF9jcmVhdGVSZWR1Y2VyW0RFU1RST1ldID0gZnVuY3Rpb24gKHN0YXRlKSB7XG4gICAgcmV0dXJuIHNldENvbm5lY3Rpb25TdGF0dXMoREVTVFJPWUVELCBzdGF0ZSk7XG4gIH0sIF9jcmVhdGVSZWR1Y2VyW0xPR0lOX1NVQ0NFU1NdID0gZnVuY3Rpb24gKHN0YXRlKSB7XG4gICAgcmV0dXJuIHNldENvbm5lY3Rpb25TdGF0dXMoQ09OTkVDVEVELCBzdGF0ZSk7XG4gIH0sIF9jcmVhdGVSZWR1Y2VyW1BBVVNFX0NPTk5FQ1RJT05dID0gZnVuY3Rpb24gKHN0YXRlKSB7XG4gICAgcmV0dXJuIHNldENvbm5lY3Rpb25TdGF0dXMoUEFVU0VELCBzdGF0ZSk7XG4gIH0sIF9jcmVhdGVSZWR1Y2VyW1JFUVVFU1RfRkFJTEVEXSA9IHJlbW92ZVN0b3JlZFJlcXVlc3QsIF9jcmVhdGVSZWR1Y2VyW1JFU1BPTlNFX1JFQ0VJVkVEXSA9IHJlbW92ZVN0b3JlZFJlcXVlc3QsIF9jcmVhdGVSZWR1Y2VyW1NFTkRfUkVRVUVTVF0gPSBmdW5jdGlvbiAoc3RhdGUsIF9yZWY0KSB7XG4gICAgdmFyIF9leHRlbmRzMjtcblxuICAgIHZhciBwcm9taXNlID0gX3JlZjQucHJvbWlzZSxcbiAgICAgICAgcmVzb2x2ZSA9IF9yZWY0LnJlc29sdmUsXG4gICAgICAgIHJlamVjdCA9IF9yZWY0LnJlamVjdCxcbiAgICAgICAgaWQgPSBfcmVmNC5pZCxcbiAgICAgICAgcmVxdWVzdCA9IF9yZWY0LnJlcXVlc3Q7XG4gICAgcmV0dXJuIF9leHRlbmRzKHt9LCBzdGF0ZSwge1xuICAgICAgcmVxdWVzdHM6IF9leHRlbmRzKHt9LCBzdGF0ZS5yZXF1ZXN0cywgKF9leHRlbmRzMiA9IHt9LCBfZXh0ZW5kczJbaWRdID0ge1xuICAgICAgICBpZDogaWQsXG4gICAgICAgIHByb21pc2U6IHByb21pc2UsXG4gICAgICAgIHJlc29sdmU6IHJlc29sdmUsXG4gICAgICAgIHJlamVjdDogcmVqZWN0LFxuICAgICAgICByZXF1ZXN0OiByZXF1ZXN0XG4gICAgICB9LCBfZXh0ZW5kczIpKVxuICAgIH0pO1xuICB9LCBfY3JlYXRlUmVkdWNlcltTRVRfQ0hBVF9BQ1RJVkVdID0gZnVuY3Rpb24gKHN0YXRlLCBfcmVmNSkge1xuICAgIHZhciBfZXh0ZW5kczM7XG5cbiAgICB2YXIgaWQgPSBfcmVmNS5pZCxcbiAgICAgICAgYWN0aXZlID0gX3JlZjUuYWN0aXZlO1xuICAgIHJldHVybiBfZXh0ZW5kcyh7fSwgc3RhdGUsIHtcbiAgICAgIGNoYXRzOiBfZXh0ZW5kcyh7fSwgc3RhdGUuY2hhdHMsIChfZXh0ZW5kczMgPSB7fSwgX2V4dGVuZHMzW2lkXSA9IF9leHRlbmRzKHt9LCBzdGF0ZS5jaGF0c1tpZF0sIHtcbiAgICAgICAgYWN0aXZlOiBhY3RpdmVcbiAgICAgIH0pLCBfZXh0ZW5kczMpKVxuICAgIH0pO1xuICB9LCBfY3JlYXRlUmVkdWNlcltTRVRfU0VMRl9JRF0gPSBmdW5jdGlvbiAoc3RhdGUsIHBheWxvYWQpIHtcbiAgICByZXR1cm4gX2V4dGVuZHMoe30sIHN0YXRlLCB7XG4gICAgICB1c2VyczogX2V4dGVuZHMoe30sIHN0YXRlLnVzZXJzLCB7XG4gICAgICAgIHNlbGY6IF9leHRlbmRzKHt9LCBzdGF0ZS51c2Vycy5zZWxmLCB7XG4gICAgICAgICAgaWQ6IHBheWxvYWQuaWRcbiAgICAgICAgfSlcbiAgICAgIH0pXG4gICAgfSk7XG4gIH0sIF9jcmVhdGVSZWR1Y2VyW1NPQ0tFVF9ESVNDT05ORUNURURdID0gZnVuY3Rpb24gKHN0YXRlKSB7XG4gICAgdmFyIHByZXZpb3VzU3RhdHVzID0gZ2V0Q29ubmVjdGlvblN0YXR1cyhzdGF0ZSk7XG5cbiAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJyAmJiAocHJldmlvdXNTdGF0dXMgPT09IFBBVVNFRCB8fCBwcmV2aW91c1N0YXR1cyA9PT0gREVTVFJPWUVEKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiR290ICdzb2NrZXRfZGlzY29ubmVjdGVkJyBhY3Rpb24gd2hlbiBpbiBcIiArIHByZXZpb3VzU3RhdHVzICsgXCIgc3RhdGUuIFRoaXMgc2hvdWxkIGJlIGFuIGltcG9zc2libGUgc3RhdGUuXCIpO1xuICAgIH1cblxuICAgIHZhciBzdGF0ZTEgPSBzZXRDb25uZWN0aW9uU3RhdHVzKHByZXZpb3VzU3RhdHVzID09PSBESVNDT05ORUNURUQgPyBESVNDT05ORUNURUQgOiBSRUNPTk5FQ1RJTkcsIHN0YXRlKTtcbiAgICByZXR1cm4gX2V4dGVuZHMoe30sIHN0YXRlMSwge1xuICAgICAgcmVxdWVzdHM6IHt9XG4gICAgfSk7XG4gIH0sIF9jcmVhdGVSZWR1Y2VyW1VQREFURV9DVVNUT01FUl9QQUdFXSA9IGZ1bmN0aW9uIChzdGF0ZSwgcGFnZSkge1xuICAgIHJldHVybiBfZXh0ZW5kcyh7fSwgc3RhdGUsIHtcbiAgICAgIHBhZ2U6IF9leHRlbmRzKHt9LCBzdGF0ZS5wYWdlLCBwYWdlKVxuICAgIH0pO1xuICB9LCBfY3JlYXRlUmVkdWNlcikpO1xufSk7XG5cbmZ1bmN0aW9uIGZpbmFsQ3JlYXRlU3RvcmUoaW5pdGlhbFN0YXRlRGF0YSkge1xuICB2YXIgY29tcG9zZSA9IHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAnZGV2ZWxvcG1lbnQnICYmIHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnICYmIHdpbmRvdy5fX1JFRFVYX0RFVlRPT0xTX0VYVEVOU0lPTl9DT01QT1NFX18gPyB3aW5kb3cuX19SRURVWF9ERVZUT09MU19FWFRFTlNJT05fQ09NUE9TRV9fKHtcbiAgICBuYW1lOiAnQGxpdmVjaGF0L2N1c3RvbWVyLXNkaydcbiAgfSkgOiBpZGVudGl0eTtcbiAgdmFyIHNpZGVFZmZlY3RzTWlkZGxld2FyZSA9IGNyZWF0ZVNpZGVFZmZlY3RzTWlkZGxld2FyZSgpO1xuICB2YXIgc3RvcmUgPSBjcmVhdGVTdG9yZShjcmVhdGVSZWR1Y2VyJDEoY3JlYXRlSW5pdGlhbFN0YXRlKGluaXRpYWxTdGF0ZURhdGEpKSwgY29tcG9zZShhcHBseU1pZGRsZXdhcmUoc2lkZUVmZmVjdHNNaWRkbGV3YXJlKSkpO1xuICBzdG9yZS5hZGRTaWRlRWZmZWN0c0hhbmRsZXIgPSBzaWRlRWZmZWN0c01pZGRsZXdhcmUuYWRkO1xuICByZXR1cm4gc3RvcmU7XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZUVycm9yKF9yZWYpIHtcbiAgdmFyIG1lc3NhZ2UgPSBfcmVmLm1lc3NhZ2UsXG4gICAgICBjb2RlID0gX3JlZi5jb2RlO1xuICB2YXIgZXJyb3IgPSBuZXcgRXJyb3IobWVzc2FnZSk7XG4gIGVycm9yLmNvZGUgPSBjb2RlO1xuICByZXR1cm4gZXJyb3I7XG59XG5cbnZhciBBQ0NFU1NfVE9LRU5fRVhQSVJFRCA9ICdhY2Nlc3NfdG9rZW5fZXhwaXJlZCc7XG52YXIgQ1VTVE9NRVJfQkFOTkVEID0gJ2N1c3RvbWVyX2Jhbm5lZCc7XG52YXIgQ1VTVE9NRVJfVEVNUE9SQVJJTFlfQkxPQ0tFRCA9ICdjdXN0b21lcl90ZW1wb3JhcmlseV9ibG9ja2VkJztcbnZhciBMSUNFTlNFX05PVF9GT1VORCA9ICdsaWNlbnNlX25vdF9mb3VuZCc7XG52YXIgTUlTRElSRUNURURfQ09OTkVDVElPTiQxID0gJ21pc2RpcmVjdGVkX2Nvbm5lY3Rpb24nO1xudmFyIFBST0RVQ1RfVkVSU0lPTl9DSEFOR0VEID0gJ3Byb2R1Y3RfdmVyc2lvbl9jaGFuZ2VkJztcbnZhciBUT09fTUFOWV9DT05ORUNUSU9OUyA9ICd0b29fbWFueV9jb25uZWN0aW9ucyc7IC8vIHRoZSBsaW1pdCBvZiB1bmF1dGhvcml6ZWQgY29ubmVjdGlvbnMgaXMgcGVyIElQXG5cbnZhciBUT09fTUFOWV9VTkFVVEhPUklaRURfQ09OTkVDVElPTlMkMSA9ICd0b29fbWFueV91bmF1dGhvcml6ZWRfY29ubmVjdGlvbnMnO1xudmFyIFVOU1VQUE9SVEVEX1ZFUlNJT04gPSAndW5zdXBwb3J0ZWRfdmVyc2lvbic7XG5cbnZhciBDSEFUX0RFQUNUSVZBVEVEID0gJ2NoYXRfZGVhY3RpdmF0ZWQnO1xudmFyIENIQVRfUFJPUEVSVElFU19ERUxFVEVEID0gJ2NoYXRfcHJvcGVydGllc19kZWxldGVkJztcbnZhciBDSEFUX1BST1BFUlRJRVNfVVBEQVRFRCA9ICdjaGF0X3Byb3BlcnRpZXNfdXBkYXRlZCc7XG52YXIgQ0hBVF9UUkFOU0ZFUlJFRCA9ICdjaGF0X3RyYW5zZmVycmVkJztcbnZhciBDVVNUT01FUl9ESVNDT05ORUNURUQgPSAnY3VzdG9tZXJfZGlzY29ubmVjdGVkJztcbnZhciBDVVNUT01FUl9QQUdFX1VQREFURUQgPSAnY3VzdG9tZXJfcGFnZV91cGRhdGVkJztcbnZhciBDVVNUT01FUl9TSURFX1NUT1JBR0VfVVBEQVRFRCA9ICdjdXN0b21lcl9zaWRlX3N0b3JhZ2VfdXBkYXRlZCc7XG52YXIgQ1VTVE9NRVJfVVBEQVRFRCA9ICdjdXN0b21lcl91cGRhdGVkJztcbnZhciBFVkVOVF9QUk9QRVJUSUVTX0RFTEVURUQgPSAnZXZlbnRfcHJvcGVydGllc19kZWxldGVkJztcbnZhciBFVkVOVF9QUk9QRVJUSUVTX1VQREFURUQgPSAnZXZlbnRfcHJvcGVydGllc191cGRhdGVkJztcbnZhciBFVkVOVF9VUERBVEVEID0gJ2V2ZW50X3VwZGF0ZWQnO1xudmFyIEVWRU5UU19NQVJLRURfQVNfU0VFTiA9ICdldmVudHNfbWFya2VkX2FzX3NlZW4nO1xudmFyIEdSRUVUSU5HX0FDQ0VQVEVEID0gJ2dyZWV0aW5nX2FjY2VwdGVkJztcbnZhciBHUkVFVElOR19DQU5DRUxFRCA9ICdncmVldGluZ19jYW5jZWxlZCc7XG52YXIgSU5DT01JTkdfQ0hBVCA9ICdpbmNvbWluZ19jaGF0JztcbnZhciBJTkNPTUlOR19FVkVOVCA9ICdpbmNvbWluZ19ldmVudCc7XG52YXIgSU5DT01JTkdfR1JFRVRJTkcgPSAnaW5jb21pbmdfZ3JlZXRpbmcnO1xudmFyIElOQ09NSU5HX01VTFRJQ0FTVCA9ICdpbmNvbWluZ19tdWx0aWNhc3QnO1xudmFyIElOQ09NSU5HX1JJQ0hfTUVTU0FHRV9QT1NUQkFDSyA9ICdpbmNvbWluZ19yaWNoX21lc3NhZ2VfcG9zdGJhY2snO1xudmFyIElOQ09NSU5HX1RZUElOR19JTkRJQ0FUT1IgPSAnaW5jb21pbmdfdHlwaW5nX2luZGljYXRvcic7XG52YXIgUVVFVUVfUE9TSVRJT05fVVBEQVRFRCA9ICdxdWV1ZV9wb3NpdGlvbl91cGRhdGVkJztcbnZhciBUSFJFQURfUFJPUEVSVElFU19ERUxFVEVEID0gJ3RocmVhZF9wcm9wZXJ0aWVzX2RlbGV0ZWQnO1xudmFyIFRIUkVBRF9QUk9QRVJUSUVTX1VQREFURUQgPSAndGhyZWFkX3Byb3BlcnRpZXNfdXBkYXRlZCc7XG52YXIgVVNFUl9BRERFRF9UT19DSEFUID0gJ3VzZXJfYWRkZWRfdG9fY2hhdCc7XG52YXIgVVNFUl9SRU1PVkVEX0ZST01fQ0hBVCA9ICd1c2VyX3JlbW92ZWRfZnJvbV9jaGF0JztcblxudmFyIEZJTEUgPSAnZmlsZSc7XG52YXIgRklMTEVEX0ZPUk0gPSAnZmlsbGVkX2Zvcm0nO1xudmFyIE1FU1NBR0UgPSAnbWVzc2FnZSc7XG52YXIgUklDSF9NRVNTQUdFID0gJ3JpY2hfbWVzc2FnZSc7XG52YXIgU1lTVEVNX01FU1NBR0UgPSAnc3lzdGVtX21lc3NhZ2UnO1xuXG52YXIgY3JlYXRlRXZlbnRCYXNlID0gZnVuY3Rpb24gY3JlYXRlRXZlbnRCYXNlKGV2ZW50KSB7XG4gIHZhciBiYXNlID0ge307XG5cbiAgaWYgKHR5cGVvZiBldmVudC5jdXN0b21JZCA9PT0gJ3N0cmluZycpIHtcbiAgICBiYXNlLmN1c3RvbV9pZCA9IGV2ZW50LmN1c3RvbUlkO1xuICB9XG5cbiAgaWYgKGlzT2JqZWN0KGV2ZW50LnByb3BlcnRpZXMpKSB7XG4gICAgYmFzZS5wcm9wZXJ0aWVzID0gZXZlbnQucHJvcGVydGllcztcbiAgfVxuXG4gIHJldHVybiBiYXNlO1xufTsgLy8gVE9ETzogd2UgY291bGQgdmFsaWRhdGUgYW5kIHRocm93IGhlcmVcbi8vIGJ1dCBzaG91bGQgd2U/IG1heWJlIG9ubHkgaW4gREVWIG1vZGU/XG5cblxudmFyIHBhcnNlRXZlbnQgPSBmdW5jdGlvbiBwYXJzZUV2ZW50KGV2ZW50KSB7XG4gIHN3aXRjaCAoZXZlbnQudHlwZSkge1xuICAgIGNhc2UgTUVTU0FHRTpcbiAgICAgIHtcbiAgICAgICAgdmFyIG1lc3NhZ2UgPSBfZXh0ZW5kcyh7fSwgY3JlYXRlRXZlbnRCYXNlKGV2ZW50KSwge1xuICAgICAgICAgIHR5cGU6IGV2ZW50LnR5cGUsXG4gICAgICAgICAgdGV4dDogZXZlbnQudGV4dFxuICAgICAgICB9KTtcblxuICAgICAgICBpZiAoZXZlbnQucG9zdGJhY2spIHtcbiAgICAgICAgICBtZXNzYWdlLnBvc3RiYWNrID0ge1xuICAgICAgICAgICAgaWQ6IGV2ZW50LnBvc3RiYWNrLmlkLFxuICAgICAgICAgICAgdGhyZWFkX2lkOiBldmVudC5wb3N0YmFjay50aHJlYWRJZCxcbiAgICAgICAgICAgIGV2ZW50X2lkOiBldmVudC5wb3N0YmFjay5ldmVudElkLFxuICAgICAgICAgICAgdHlwZTogZXZlbnQucG9zdGJhY2sudHlwZSxcbiAgICAgICAgICAgIHZhbHVlOiBldmVudC5wb3N0YmFjay52YWx1ZVxuICAgICAgICAgIH07XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gbWVzc2FnZTtcbiAgICAgIH1cblxuICAgIGNhc2UgRklMRTpcbiAgICAgIHtcbiAgICAgICAgdmFyIGZpbGUgPSBfZXh0ZW5kcyh7fSwgY3JlYXRlRXZlbnRCYXNlKGV2ZW50KSwge1xuICAgICAgICAgIHR5cGU6IGV2ZW50LnR5cGUsXG4gICAgICAgICAgdXJsOiBldmVudC51cmxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIGZpbGU7XG4gICAgICB9XG5cbiAgICBjYXNlIEZJTExFRF9GT1JNOlxuICAgICAge1xuICAgICAgICB2YXIgZmlsbGVkRm9ybSA9IF9leHRlbmRzKHt9LCBjcmVhdGVFdmVudEJhc2UoZXZlbnQpLCB7XG4gICAgICAgICAgdHlwZTogZXZlbnQudHlwZSxcbiAgICAgICAgICBmb3JtX2lkOiBldmVudC5mb3JtSWQsXG4gICAgICAgICAgZmllbGRzOiBldmVudC5maWVsZHMubWFwKGZ1bmN0aW9uIChmaWVsZCkge1xuICAgICAgICAgICAgc3dpdGNoIChmaWVsZC50eXBlKSB7XG4gICAgICAgICAgICAgIGNhc2UgJ2dyb3VwX2Nob29zZXInOlxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgIGlmICghZmllbGQuYW5zd2VyKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmaWVsZDtcbiAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgdmFyIF9maWVsZCRhbnN3ZXIgPSBmaWVsZC5hbnN3ZXIsXG4gICAgICAgICAgICAgICAgICAgICAgZ3JvdXBJZCA9IF9maWVsZCRhbnN3ZXIuZ3JvdXBJZCxcbiAgICAgICAgICAgICAgICAgICAgICBhbnN3ZXIgPSBfb2JqZWN0V2l0aG91dFByb3BlcnRpZXNMb29zZShfZmllbGQkYW5zd2VyLCBbXCJncm91cElkXCJdKTtcblxuICAgICAgICAgICAgICAgICAgcmV0dXJuIF9leHRlbmRzKHt9LCBmaWVsZCwge1xuICAgICAgICAgICAgICAgICAgICBhbnN3ZXI6IF9leHRlbmRzKHt9LCBhbnN3ZXIsIHtcbiAgICAgICAgICAgICAgICAgICAgICBncm91cF9pZDogZ3JvdXBJZFxuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZpZWxkO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiBmaWxsZWRGb3JtO1xuICAgICAgfVxuXG4gICAgY2FzZSBTWVNURU1fTUVTU0FHRTpcbiAgICAgIHtcbiAgICAgICAgdmFyIHN5c3RlbU1lc3NhZ2UgPSBfZXh0ZW5kcyh7fSwgY3JlYXRlRXZlbnRCYXNlKGV2ZW50KSwge1xuICAgICAgICAgIHR5cGU6IGV2ZW50LnR5cGUsXG4gICAgICAgICAgdGV4dDogZXZlbnQudGV4dCxcbiAgICAgICAgICBzeXN0ZW1fbWVzc2FnZV90eXBlOiBldmVudC5zeXN0ZW1NZXNzYWdlVHlwZVxuICAgICAgICB9KTtcblxuICAgICAgICBpZiAoZXZlbnQucmVjaXBpZW50cykge1xuICAgICAgICAgIHN5c3RlbU1lc3NhZ2UucmVjaXBpZW50cyA9IGV2ZW50LnJlY2lwaWVudHM7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gc3lzdGVtTWVzc2FnZTtcbiAgICAgIH1cbiAgfVxufTtcblxudmFyIHBhcnNlVGhyZWFkRGF0YSA9IGZ1bmN0aW9uIHBhcnNlVGhyZWFkRGF0YSh0aHJlYWQpIHtcbiAgdmFyIGRhdGEgPSB7fTtcbiAgdmFyIGV2ZW50cyA9IHRocmVhZC5ldmVudHMsXG4gICAgICBwcm9wZXJ0aWVzID0gdGhyZWFkLnByb3BlcnRpZXM7XG5cbiAgaWYgKGV2ZW50cykge1xuICAgIGRhdGEuZXZlbnRzID0gZXZlbnRzLm1hcChwYXJzZUV2ZW50KTtcbiAgfVxuXG4gIGlmIChwcm9wZXJ0aWVzKSB7XG4gICAgZGF0YS5wcm9wZXJ0aWVzID0gcHJvcGVydGllcztcbiAgfVxuXG4gIHJldHVybiBkYXRhO1xufTtcblxudmFyIHBhcnNlU3RhcnRDaGF0RGF0YSA9IGZ1bmN0aW9uIHBhcnNlU3RhcnRDaGF0RGF0YShfcmVmKSB7XG4gIHZhciBjaGF0ID0gX3JlZi5jaGF0LFxuICAgICAgY29udGludW91cyA9IF9yZWYuY29udGludW91cztcbiAgdmFyIGRhdGEgPSB7XG4gICAgY2hhdDoge31cbiAgfTtcblxuICBpZiAodHlwZW9mIGNvbnRpbnVvdXMgPT09ICdib29sZWFuJykge1xuICAgIGRhdGEuY29udGludW91cyA9IGNvbnRpbnVvdXM7XG4gIH1cblxuICBpZiAoIWNoYXQpIHtcbiAgICByZXR1cm4gZGF0YTtcbiAgfVxuXG4gIHZhciBhY2Nlc3MgPSBjaGF0LmFjY2VzcyxcbiAgICAgIHRocmVhZCA9IGNoYXQudGhyZWFkLFxuICAgICAgcHJvcGVydGllcyA9IGNoYXQucHJvcGVydGllcztcblxuICBpZiAoYWNjZXNzICYmIGFjY2Vzcy5ncm91cElkcykge1xuICAgIGRhdGEuY2hhdC5hY2Nlc3MgPSB7XG4gICAgICBncm91cF9pZHM6IGFjY2Vzcy5ncm91cElkc1xuICAgIH07XG4gIH1cblxuICBpZiAocHJvcGVydGllcykge1xuICAgIGRhdGEuY2hhdC5wcm9wZXJ0aWVzID0gcHJvcGVydGllcztcbiAgfVxuXG4gIGlmICh0aHJlYWQpIHtcbiAgICBkYXRhLmNoYXQudGhyZWFkID0gcGFyc2VUaHJlYWREYXRhKHRocmVhZCk7XG4gIH1cblxuICByZXR1cm4gZGF0YTtcbn07XG52YXIgcGFyc2VBY3RpdmF0ZUNoYXREYXRhID0gZnVuY3Rpb24gcGFyc2VBY3RpdmF0ZUNoYXREYXRhKHJlcXVlc3REYXRhKSB7XG4gIHZhciBkYXRhID0gcGFyc2VTdGFydENoYXREYXRhKHJlcXVlc3REYXRhKTtcbiAgcmV0dXJuIF9leHRlbmRzKHt9LCBkYXRhLCB7XG4gICAgY2hhdDogX2V4dGVuZHMoe30sIGRhdGEuY2hhdCwge1xuICAgICAgaWQ6IHJlcXVlc3REYXRhLmNoYXQuaWRcbiAgICB9KVxuICB9KTtcbn07XG52YXIgcGFyc2VDdXN0b21lclNlc3Npb25GaWVsZHMgPSBmdW5jdGlvbiBwYXJzZUN1c3RvbWVyU2Vzc2lvbkZpZWxkcyhzZXNzaW9uRmllbGRzKSB7XG4gIHJldHVybiB0b1BhaXJzKHNlc3Npb25GaWVsZHMpLm1hcChmdW5jdGlvbiAoX3JlZjIpIHtcbiAgICB2YXIgX3JlZjM7XG5cbiAgICB2YXIga2V5ID0gX3JlZjJbMF0sXG4gICAgICAgIHZhbHVlID0gX3JlZjJbMV07XG4gICAgcmV0dXJuIF9yZWYzID0ge30sIF9yZWYzW2tleV0gPSB2YWx1ZSwgX3JlZjM7XG4gIH0pO1xufTtcbnZhciBwYXJzZUN1c3RvbWVyVXBkYXRlID0gZnVuY3Rpb24gcGFyc2VDdXN0b21lclVwZGF0ZSh1cGRhdGUpIHtcbiAgdmFyIHJlc3VsdCA9IHBpY2tPd24oWydhdmF0YXInLCAnbmFtZScsICdlbWFpbCddLCB1cGRhdGUpO1xuXG4gIGlmICh1cGRhdGUuc2Vzc2lvbkZpZWxkcykge1xuICAgIHJlc3VsdC5zZXNzaW9uX2ZpZWxkcyA9IHBhcnNlQ3VzdG9tZXJTZXNzaW9uRmllbGRzKHVwZGF0ZS5zZXNzaW9uRmllbGRzKTtcbiAgfVxuXG4gIHJldHVybiByZXN1bHQ7XG59O1xuXG52YXIgZGVzdHJveSA9IGZ1bmN0aW9uIGRlc3Ryb3kocmVhc29uKSB7XG4gIHJldHVybiB7XG4gICAgdHlwZTogREVTVFJPWSxcbiAgICBwYXlsb2FkOiB7XG4gICAgICByZWFzb246IHJlYXNvblxuICAgIH1cbiAgfTtcbn07XG52YXIgbG9naW5TdWNjZXNzID0gZnVuY3Rpb24gbG9naW5TdWNjZXNzKHBheWxvYWQpIHtcbiAgcmV0dXJuIHtcbiAgICB0eXBlOiBMT0dJTl9TVUNDRVNTLFxuICAgIHBheWxvYWQ6IHBheWxvYWRcbiAgfTtcbn07XG52YXIgcHJlZmV0Y2hUb2tlbiA9IGZ1bmN0aW9uIHByZWZldGNoVG9rZW4oZnJlc2gpIHtcbiAgaWYgKGZyZXNoID09PSB2b2lkIDApIHtcbiAgICBmcmVzaCA9IGZhbHNlO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICB0eXBlOiBQUkVGRVRDSF9UT0tFTixcbiAgICBwYXlsb2FkOiB7XG4gICAgICBmcmVzaDogZnJlc2hcbiAgICB9XG4gIH07XG59O1xudmFyIHJlY29ubmVjdCA9IGZ1bmN0aW9uIHJlY29ubmVjdChkZWxheSkge1xuICByZXR1cm4ge1xuICAgIHR5cGU6IFJFQ09OTkVDVCxcbiAgICBwYXlsb2FkOiB7XG4gICAgICBkZWxheTogZGVsYXlcbiAgICB9XG4gIH07XG59OyAvLyBUT0RPOiB0aGlzIG9uZSB3YXMgY3VycmVudGx5IHByZXR0eSBoYXJkIHRvIHR5cGUgaW4gZnVsbFxuLy8gd2Ugc2hvdWxkIGV4cGxvcmUgcHJvdmlkaW5nIHN0cmljdGVyIHR5cGVzIGZvciB0aGlzIGluIHRoZSBmdXR1cmVcblxudmFyIHNlbmRSZXF1ZXN0ID0gZnVuY3Rpb24gc2VuZFJlcXVlc3QoYWN0aW9uLCBwYXlsb2FkLCBzb3VyY2UpIHtcbiAgcmV0dXJuIHtcbiAgICB0eXBlOiBTRU5EX1JFUVVFU1QsXG4gICAgcGF5bG9hZDogX2V4dGVuZHMoe1xuICAgICAgcmVxdWVzdDoge1xuICAgICAgICBhY3Rpb246IGFjdGlvbixcbiAgICAgICAgcGF5bG9hZDogcGF5bG9hZFxuICAgICAgfVxuICAgIH0sIHNvdXJjZSAmJiB7XG4gICAgICBzb3VyY2U6IHNvdXJjZVxuICAgIH0pXG4gIH07XG59O1xudmFyIHNlbmRFdmVudCA9IGZ1bmN0aW9uIHNlbmRFdmVudChfcmVmKSB7XG4gIHZhciBjaGF0SWQgPSBfcmVmLmNoYXRJZCxcbiAgICAgIGV2ZW50ID0gX3JlZi5ldmVudCxcbiAgICAgIGF0dGFjaFRvTGFzdFRocmVhZCA9IF9yZWYuYXR0YWNoVG9MYXN0VGhyZWFkO1xuICB2YXIgcGF5bG9hZCA9IHtcbiAgICBjaGF0X2lkOiBjaGF0SWQsXG4gICAgZXZlbnQ6IHBhcnNlRXZlbnQoZXZlbnQpXG4gIH07XG5cbiAgaWYgKGF0dGFjaFRvTGFzdFRocmVhZCkge1xuICAgIHBheWxvYWQuYXR0YWNoX3RvX2xhc3RfdGhyZWFkID0gdHJ1ZTtcbiAgfVxuXG4gIHJldHVybiBzZW5kUmVxdWVzdChTRU5EX0VWRU5ULCBwYXlsb2FkKTtcbn07XG52YXIgc2V0Q2hhdEFjdGl2ZSA9IGZ1bmN0aW9uIHNldENoYXRBY3RpdmUoaWQsIGFjdGl2ZSkge1xuICByZXR1cm4ge1xuICAgIHR5cGU6IFNFVF9DSEFUX0FDVElWRSxcbiAgICBwYXlsb2FkOiB7XG4gICAgICBpZDogaWQsXG4gICAgICBhY3RpdmU6IGFjdGl2ZVxuICAgIH1cbiAgfTtcbn07XG52YXIgc2V0U2VsZklkID0gZnVuY3Rpb24gc2V0U2VsZklkKGlkKSB7XG4gIHJldHVybiB7XG4gICAgdHlwZTogU0VUX1NFTEZfSUQsXG4gICAgcGF5bG9hZDoge1xuICAgICAgaWQ6IGlkXG4gICAgfVxuICB9O1xufTtcbnZhciBzb2NrZXREaXNjb25uZWN0ZWQgPSBmdW5jdGlvbiBzb2NrZXREaXNjb25uZWN0ZWQoKSB7XG4gIHJldHVybiB7XG4gICAgdHlwZTogU09DS0VUX0RJU0NPTk5FQ1RFRFxuICB9O1xufTtcblxuLy8gVE9ETzogdGhpcyB0aGluZyBpcyBub3QgcmVhbGx5IHdlbGwgdHlwZWQgYW5kIHNob3VsZCBiZSBpbXByb3ZlZFxudmFyIHNlbmRSZXF1ZXN0QWN0aW9uID0gZnVuY3Rpb24gc2VuZFJlcXVlc3RBY3Rpb24oc3RvcmUsIGFjdGlvbikge1xuICBhY3Rpb24ucGF5bG9hZC5pZCA9IGdlbmVyYXRlVW5pcXVlSWQoc3RvcmUuZ2V0U3RhdGUoKS5yZXF1ZXN0cyk7XG5cbiAgdmFyIF9kZWZlcnJlZCA9IGRlZmVycmVkKCksXG4gICAgICByZXNvbHZlID0gX2RlZmVycmVkLnJlc29sdmUsXG4gICAgICByZWplY3QgPSBfZGVmZXJyZWQucmVqZWN0LFxuICAgICAgcHJvbWlzZSA9IF9kZWZlcnJlZC5wcm9taXNlO1xuXG4gIGFjdGlvbi5wYXlsb2FkLnByb21pc2UgPSBwcm9taXNlO1xuICBhY3Rpb24ucGF5bG9hZC5yZXNvbHZlID0gcmVzb2x2ZTtcbiAgYWN0aW9uLnBheWxvYWQucmVqZWN0ID0gcmVqZWN0O1xuICBzdG9yZS5kaXNwYXRjaChhY3Rpb24pO1xuICByZXR1cm4gcHJvbWlzZTtcbn07XG5cbnZhciBBVVRIRU5USUNBVElPTiA9ICdBVVRIRU5USUNBVElPTic7XG52YXIgQ1VTVE9NRVJfQkFOTkVEJDEgPSAnQ1VTVE9NRVJfQkFOTkVEJztcbnZhciBVU0VSU19MSU1JVF9SRUFDSEVEID0gJ1VTRVJTX0xJTUlUX1JFQUNIRUQnO1xudmFyIFdST05HX1BST0RVQ1RfVkVSU0lPTiA9ICdXUk9OR19QUk9EVUNUX1ZFUlNJT04nO1xuXG52YXIgZ2V0U2lkZVN0b3JhZ2VLZXkgPSBmdW5jdGlvbiBnZXRTaWRlU3RvcmFnZUtleShzdG9yZSkge1xuICB2YXIgX3N0b3JlJGdldFN0YXRlID0gc3RvcmUuZ2V0U3RhdGUoKSxcbiAgICAgIGxpY2Vuc2VJZCA9IF9zdG9yZSRnZXRTdGF0ZS5saWNlbnNlSWQsXG4gICAgICBncm91cElkID0gX3N0b3JlJGdldFN0YXRlLmdyb3VwSWQsXG4gICAgICB1bmlxdWVHcm91cHMgPSBfc3RvcmUkZ2V0U3RhdGUudW5pcXVlR3JvdXBzO1xuXG4gIHJldHVybiBcInNpZGVfc3RvcmFnZV9cIiArIGxpY2Vuc2VJZCArICh1bmlxdWVHcm91cHMgPyBcIjpcIiArIGdyb3VwSWQgOiAnJyk7XG59O1xuXG52YXIgZ2V0U2lkZVN0b3JhZ2UgPSBmdW5jdGlvbiBnZXRTaWRlU3RvcmFnZShzdG9yZSkge1xuICByZXR1cm4gc3RvcmFnZS5nZXRJdGVtKGdldFNpZGVTdG9yYWdlS2V5KHN0b3JlKSkuY2F0Y2gobm9vcCkudGhlbihmdW5jdGlvbiAoc2lkZVN0b3JhZ2UpIHtcbiAgICByZXR1cm4gSlNPTi5wYXJzZShzaWRlU3RvcmFnZSB8fCAne30nKTtcbiAgfSkgLy8gc2hvdWxkbnQgZ2V0IHRyaWdnZXJlZCwganVzdCBhIGRlZmVuc2l2ZSBtZWFzdXJlIGFnYWluc3QgbWFsZm9ybWVkIHN0b3JhZ2UgZW50cmllc1xuICAuY2F0Y2goZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB7fTtcbiAgfSk7XG59O1xudmFyIHNhdmVTaWRlU3RvcmFnZSA9IGZ1bmN0aW9uIHNhdmVTaWRlU3RvcmFnZShzdG9yZSwgc2lkZVN0b3JhZ2UpIHtcbiAgcmV0dXJuIHN0b3JhZ2Uuc2V0SXRlbShnZXRTaWRlU3RvcmFnZUtleShzdG9yZSksIEpTT04uc3RyaW5naWZ5KHNpZGVTdG9yYWdlKSkuY2F0Y2gobm9vcCk7XG59O1xuXG52YXIgdGFza0NoYWluID0gZnVuY3Rpb24gdGFza0NoYWluKF9yZWYsIG9uU3VjY2Vzcywgb25FcnJvcikge1xuICB2YXIgc3RlcHMgPSBfcmVmLnNsaWNlKDApO1xuXG4gIHZhciBjYW5jZWxsZWQgPSBmYWxzZTtcblxuICB2YXIgbmV4dCA9IGZ1bmN0aW9uIG5leHQoaW50ZXJtZWRpYXRlUmVzdWx0KSB7XG4gICAgdmFyIHN0ZXAgPSBzdGVwcy5zaGlmdCgpO1xuICAgIHByb21pc2VUcnkoZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHN0ZXAoaW50ZXJtZWRpYXRlUmVzdWx0KTtcbiAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgIGlmIChjYW5jZWxsZWQpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBpZiAoc3RlcHMubGVuZ3RoKSB7XG4gICAgICAgIG5leHQocmVzdWx0KTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBvblN1Y2Nlc3MocmVzdWx0KTtcbiAgICB9LCBmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgIGlmIChjYW5jZWxsZWQpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBvbkVycm9yKGVycm9yKTtcbiAgICB9KTtcbiAgfTtcblxuICBuZXh0KCk7XG4gIHJldHVybiB7XG4gICAgY2FuY2VsOiBmdW5jdGlvbiBjYW5jZWwoKSB7XG4gICAgICBjYW5jZWxsZWQgPSB0cnVlO1xuICAgIH1cbiAgfTtcbn07XG5cbnZhciBzZW5kTG9naW5GbG93UmVxdWVzdCA9IGZ1bmN0aW9uIHNlbmRMb2dpbkZsb3dSZXF1ZXN0KHN0b3JlLCB0eXBlLCBwYXlsb2FkKSB7XG4gIHJldHVybiBzZW5kUmVxdWVzdEFjdGlvbihzdG9yZSwgc2VuZFJlcXVlc3QodHlwZSwgcGF5bG9hZCwgJ2xvZ2luJykpO1xufTtcblxudmFyIGRlbGF5ID0gZnVuY3Rpb24gZGVsYXkobXMpIHtcbiAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlKSB7XG4gICAgc2V0VGltZW91dChyZXNvbHZlLCBtcyk7XG4gIH0pO1xufTtcblxuZnVuY3Rpb24gY3JlYXRlTG9naW5UYXNrKGF1dGgsIGN1c3RvbWVyRGF0YVByb3ZpZGVyKSB7XG4gIHZhciBzdG9yZTtcbiAgdmFyIHNlbnRQYWdlID0gbnVsbDtcbiAgdmFyIHRhc2s7XG4gIHZhciBiYWNrb2ZmID0gbmV3IEJhY2tvKHtcbiAgICBtaW46IDMwMCxcbiAgICBtYXg6IDYwMDAwLFxuICAgIGppdHRlcjogMC4zXG4gIH0pO1xuXG4gIHZhciBkZXN0cm95JCQxID0gZnVuY3Rpb24gZGVzdHJveSQkMShyZWFzb24pIHtcbiAgICByZXR1cm4gc3RvcmUuZGlzcGF0Y2goZGVzdHJveShyZWFzb24pKTtcbiAgfTtcblxuICB2YXIgcmVjb25uZWN0JCQxID0gZnVuY3Rpb24gcmVjb25uZWN0JCQxKCkge1xuICAgIHJldHVybiBzdG9yZS5kaXNwYXRjaChyZWNvbm5lY3QoYmFja29mZi5kdXJhdGlvbigpKSk7XG4gIH07XG5cbiAgdmFyIGdldFRva2VuQW5kU2lkZVN0b3JhZ2UgPSBmdW5jdGlvbiBnZXRUb2tlbkFuZFNpZGVTdG9yYWdlKCkge1xuICAgIHJldHVybiBQcm9taXNlLmFsbChbYXV0aC5nZXRUb2tlbigpLCBnZXRTaWRlU3RvcmFnZShzdG9yZSldKTtcbiAgfTtcblxuICB2YXIgZGlzcGF0Y2hTZWxmSWQgPSBmdW5jdGlvbiBkaXNwYXRjaFNlbGZJZChfcmVmMikge1xuICAgIHZhciB0b2tlbiA9IF9yZWYyWzBdLFxuICAgICAgICBzaWRlU3RvcmFnZSA9IF9yZWYyWzFdO1xuICAgIHZhciBzZWxmSWQgPSBnZXRTZWxmSWQoc3RvcmUuZ2V0U3RhdGUoKSk7XG5cbiAgICBpZiAoc2VsZklkID09PSBudWxsKSB7XG4gICAgICBzdG9yZS5kaXNwYXRjaChzZXRTZWxmSWQodG9rZW4uZW50aXR5SWQpKTtcbiAgICB9IGVsc2UgaWYgKHNlbGZJZCAhPT0gdG9rZW4uZW50aXR5SWQpIHtcbiAgICAgIHZhciBlcnIgPSBuZXcgRXJyb3IoJ0lkZW50aXR5IGhhcyBjaGFuZ2VkLicpO1xuICAgICAgZXJyLmNvZGUgPSBJREVOVElUWV9NSVNNQVRDSDtcbiAgICAgIHRocm93IGVycjtcbiAgICB9XG5cbiAgICByZXR1cm4gW3Rva2VuLCBzaWRlU3RvcmFnZV07XG4gIH07XG5cbiAgdmFyIHNlbmRMb2dpbiA9IGZ1bmN0aW9uIHNlbmRMb2dpbihfcmVmMykge1xuICAgIHZhciB0b2tlbiA9IF9yZWYzWzBdLFxuICAgICAgICBzaWRlU3RvcmFnZSA9IF9yZWYzWzFdO1xuICAgIHZhciBzdGF0ZSA9IHN0b3JlLmdldFN0YXRlKCk7XG4gICAgdmFyIGFwcGxpY2F0aW9uID0gc3RhdGUuYXBwbGljYXRpb24sXG4gICAgICAgIGdyb3VwSWQgPSBzdGF0ZS5ncm91cElkLFxuICAgICAgICBwYWdlID0gc3RhdGUucGFnZSxcbiAgICAgICAgcmVmZXJyZXIgPSBzdGF0ZS5yZWZlcnJlcixcbiAgICAgICAgbW9iaWxlID0gc3RhdGUubW9iaWxlO1xuICAgIHZhciBwYXlsb2FkID0ge1xuICAgICAgdG9rZW46IHRva2VuLnRva2VuVHlwZSArIFwiIFwiICsgdG9rZW4uYWNjZXNzVG9rZW4sXG4gICAgICBjdXN0b21lcjogdHlwZW9mIGN1c3RvbWVyRGF0YVByb3ZpZGVyID09PSAnZnVuY3Rpb24nID8gcGFyc2VDdXN0b21lclVwZGF0ZShjdXN0b21lckRhdGFQcm92aWRlcigpKSA6IHt9LFxuICAgICAgY3VzdG9tZXJfc2lkZV9zdG9yYWdlOiBzaWRlU3RvcmFnZSxcbiAgICAgIGlzX21vYmlsZTogbW9iaWxlLFxuICAgICAgYXBwbGljYXRpb246IHBpY2soWyduYW1lJywgJ3ZlcnNpb24nXSwgYXBwbGljYXRpb24pXG4gICAgfTtcblxuICAgIGlmICh0eXBlb2YgZ3JvdXBJZCA9PT0gJ251bWJlcicpIHtcbiAgICAgIHBheWxvYWQuZ3JvdXBfaWQgPSBncm91cElkO1xuICAgIH1cblxuICAgIGlmIChhcHBsaWNhdGlvbi5jaGFubmVsVHlwZSkge1xuICAgICAgcGF5bG9hZC5hcHBsaWNhdGlvbi5jaGFubmVsX3R5cGUgPSBhcHBsaWNhdGlvbi5jaGFubmVsVHlwZTtcbiAgICB9XG5cbiAgICBpZiAocGFnZSAhPT0gbnVsbCkge1xuICAgICAgc2VudFBhZ2UgPSBwYWdlO1xuICAgICAgcGF5bG9hZC5jdXN0b21lcl9wYWdlID0gcGFnZTtcbiAgICB9XG5cbiAgICBpZiAocmVmZXJyZXIgIT09IG51bGwpIHtcbiAgICAgIHBheWxvYWQucmVmZXJyZXIgPSByZWZlcnJlcjtcbiAgICB9XG5cbiAgICByZXR1cm4gUHJvbWlzZS5yYWNlKFtzZW5kTG9naW5GbG93UmVxdWVzdChzdG9yZSwgTE9HSU4sIHBheWxvYWQpLCBkZWxheSgxNSAqIDEwMDApLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGNyZWF0ZUVycm9yKHtcbiAgICAgICAgbWVzc2FnZTogJ1JlcXVlc3QgdGltZWQgb3V0LicsXG4gICAgICAgIGNvZGU6IFJFUVVFU1RfVElNRU9VVFxuICAgICAgfSkpO1xuICAgIH0pXSk7XG4gIH07XG5cbiAgdmFyIHVwZGF0ZUN1c3RvbWVyUGFnZUlmTmVlZGVkID0gZnVuY3Rpb24gdXBkYXRlQ3VzdG9tZXJQYWdlSWZOZWVkZWQoKSB7XG4gICAgdmFyIF9zdG9yZSRnZXRTdGF0ZSA9IHN0b3JlLmdldFN0YXRlKCksXG4gICAgICAgIHBhZ2UgPSBfc3RvcmUkZ2V0U3RhdGUucGFnZTtcblxuICAgIGlmIChzZW50UGFnZSAhPT0gcGFnZSkge1xuICAgICAgc2VuZExvZ2luRmxvd1JlcXVlc3Qoc3RvcmUsIFVQREFURV9DVVNUT01FUl9QQUdFJDEsIHBhZ2UpLmNhdGNoKG5vb3ApO1xuICAgIH1cblxuICAgIHNlbnRQYWdlID0gbnVsbDtcbiAgfTtcblxuICByZXR1cm4gZnVuY3Rpb24gKF9zdG9yZSkge1xuICAgIC8vIGFmdGVyIHN3aXRjaGluZyB0byBjYWxsYmFncywgd2Ugc2hvdWxkIGJlIGFibGUgdG8gdXNlIHNtdGggc2ltaWxhciB0byByZWR1eC1vYnNlcnZhYmxlXG4gICAgLy8gYW5kIHRodXMganVzdCB1c2Ugc3RvcmUgZ2l2ZW4gdG8gZXBpY1xuICAgIHN0b3JlID0gX3N0b3JlO1xuXG4gICAgaWYgKHRhc2spIHtcbiAgICAgIHRhc2suY2FuY2VsKCk7XG4gICAgfVxuXG4gICAgdGFzayA9IHRhc2tDaGFpbihbZ2V0VG9rZW5BbmRTaWRlU3RvcmFnZSwgZGlzcGF0Y2hTZWxmSWQsIHNlbmRMb2dpbl0sIGZ1bmN0aW9uIChsb2dpblJlc3BvbnNlKSB7XG4gICAgICB0YXNrID0gbnVsbDtcbiAgICAgIGJhY2tvZmYucmVzZXQoKTsgLy8gVE9ETzogcmV0aGluayBpZiB0aGlzIHNob3VsZCBiZSBoYW5kbGVkIGJ5IFNESyBjb25zdW1lclxuXG4gICAgICB1cGRhdGVDdXN0b21lclBhZ2VJZk5lZWRlZCgpO1xuICAgICAgc3RvcmUuZGlzcGF0Y2gobG9naW5TdWNjZXNzKGxvZ2luUmVzcG9uc2UpKTtcbiAgICB9LCBmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ1tDdXN0b21lciBTREtdIExvZ2luIGZsb3cgaGFzIHRocm93biBjb2RlJywgZXJyb3IuY29kZSwgJ3dpdGgnLCBlcnJvcik7XG4gICAgICB9XG5cbiAgICAgIHN3aXRjaCAoZXJyb3IuY29kZSkge1xuICAgICAgICBjYXNlIEFVVEhFTlRJQ0FUSU9OOlxuICAgICAgICAgIGF1dGguZ2V0RnJlc2hUb2tlbigpO1xuICAgICAgICAgIHJlY29ubmVjdCQkMSgpO1xuICAgICAgICAgIHJldHVybjtcblxuICAgICAgICBjYXNlIENPTk5FQ1RJT05fTE9TVDpcbiAgICAgICAgICAvLyB0aGlzIGlzIGNvbm5lY3Rpdml0eSBwcm9ibGVtLCBub3QgYSBzZXJ2ZXIgZXJyb3JcbiAgICAgICAgICAvLyBhbmQgaXMgdGFrZW4gY2FyZSBvZiBpbiBzb2NrZXQgbW9kdWxlXG4gICAgICAgICAgLy8gYXMgaXQgaGFzIGl0cyBvd24gYmFja29mZiBpbXBsZW1lbnRhdGlvblxuICAgICAgICAgIHJldHVybjtcblxuICAgICAgICBjYXNlIE1JU0RJUkVDVEVEX0NPTk5FQ1RJT046XG4gICAgICAgICAgLy8gc29ja2V0IGdldHMgcmVpbml0aWFsaXplZCBvbiB0aGlzIGFueXdheSwgc28ganVzdCBpZ25vcmUgaXQgaGVyZVxuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgLy8gdGhvc2UgYXJlIGF1dGggZXJyb3JzLCB3ZSBzaG91bGQgbWF5YmUgZXhwb3J0IHRob3NlIGNvbnN0YW50cyBmcm9tIHRoZSBhdXRoIHBhY2thZ2VcblxuICAgICAgICBjYXNlICdTU09fSURFTlRJVFlfRVhDRVBUSU9OJzpcbiAgICAgICAgY2FzZSAnU1NPX09BVVRIX0VYQ0VQVElPTic6XG4gICAgICAgICAgaWYgKGVycm9yLm1lc3NhZ2UgPT09ICdzZXJ2ZXJfZXJyb3InIHx8IGVycm9yLm1lc3NhZ2UgPT09ICd0ZW1wb3JhcmlseV91bmF2YWlsYWJsZScpIHtcbiAgICAgICAgICAgIHJlY29ubmVjdCQkMSgpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGRlc3Ryb3kkJDEoZXJyb3IubWVzc2FnZSk7XG4gICAgICAgICAgcmV0dXJuO1xuXG4gICAgICAgIGNhc2UgSURFTlRJVFlfTUlTTUFUQ0g6XG4gICAgICAgIGNhc2UgQ1VTVE9NRVJfQkFOTkVEJDE6XG4gICAgICAgIGNhc2UgVVNFUlNfTElNSVRfUkVBQ0hFRDpcbiAgICAgICAgY2FzZSBXUk9OR19QUk9EVUNUX1ZFUlNJT046XG4gICAgICAgICAgZGVzdHJveSQkMShlcnJvci5jb2RlLnRvTG93ZXJDYXNlKCkpO1xuICAgICAgICAgIHJldHVybjtcblxuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgIHJlY29ubmVjdCQkMSgpO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICB9KTtcbiAgfTtcbn1cblxudmFyIGNoZWNrR29hbHMgPSBmdW5jdGlvbiBjaGVja0dvYWxzKHN0b3JlLCBhdXRoLCBzZXNzaW9uRmllbGRzKSB7XG4gIHJldHVybiBhdXRoLmdldFRva2VuKCkudGhlbihmdW5jdGlvbiAodG9rZW4pIHtcbiAgICB2YXIgc3RhdGUgPSBzdG9yZS5nZXRTdGF0ZSgpO1xuXG4gICAgaWYgKGdldFNlbGZJZChzdGF0ZSkgPT09IG51bGwpIHtcbiAgICAgIHN0b3JlLmRpc3BhdGNoKHNldFNlbGZJZCh0b2tlbi5lbnRpdHlJZCkpO1xuICAgIH1cblxuICAgIHZhciBwYWdlID0gc3RhdGUucGFnZTtcblxuICAgIGlmICghcGFnZSB8fCAhcGFnZS51cmwpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB2YXIgcXVlcnkgPSBidWlsZFF1ZXJ5U3RyaW5nKHtcbiAgICAgIGxpY2Vuc2VfaWQ6IHN0YXRlLmxpY2Vuc2VJZFxuICAgIH0pO1xuICAgIHZhciBwYXlsb2FkID0ge1xuICAgICAgLy8gVE9ETzogcmVtb3ZlIHNlbmRpbmcgY3VzdG9tZXJfZmllbGRzIG9uY2UgQVBJIHJlbGVhc2VzIHRoZWlyIGNoYW5nZXNcbiAgICAgIGN1c3RvbWVyX2ZpZWxkczogc2Vzc2lvbkZpZWxkcyB8fCB7fSxcbiAgICAgIHNlc3Npb25fZmllbGRzOiBwYXJzZUN1c3RvbWVyU2Vzc2lvbkZpZWxkcyhzZXNzaW9uRmllbGRzIHx8IHt9KSxcbiAgICAgIGdyb3VwX2lkOiBzdGF0ZS5ncm91cElkIHx8IDAsXG4gICAgICBwYWdlX3VybDogcGFnZS51cmxcbiAgICB9O1xuICAgIHJldHVybiB1bmZldGNoKGdldFNlcnZlclVybChzdGF0ZSkgKyBcIi9hY3Rpb24vXCIgKyBDSEVDS19HT0FMUyQxICsgXCI/XCIgKyBxdWVyeSwge1xuICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgICAgIEF1dGhvcml6YXRpb246IHRva2VuLnRva2VuVHlwZSArIFwiIFwiICsgdG9rZW4uYWNjZXNzVG9rZW5cbiAgICAgIH0sXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShwYXlsb2FkKVxuICAgIH0pLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgLy8gVE9ETzogd2Ugc2hvdWxkIGFjdHVhbGx5IG5vcm1hbGl6ZSByZXNwb25zZSBoZXJlXG4gICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgIH0pO1xuICB9KTtcbn07XG5cbnZhciBmYWlsQWxsUmVxdWVzdHMgPSBmdW5jdGlvbiBmYWlsQWxsUmVxdWVzdHMoX3JlZiwgcmVhc29uKSB7XG4gIHZhciBnZXRTdGF0ZSA9IF9yZWYuZ2V0U3RhdGUsXG4gICAgICBkaXNwYXRjaCA9IF9yZWYuZGlzcGF0Y2g7XG4gIHZhciBzdGF0ZSA9IGdldFN0YXRlKCk7XG4gIHZhciByZXF1ZXN0cyA9IGdldEFsbFJlcXVlc3RzKHN0YXRlKTtcbiAgZGlzcGF0Y2goe1xuICAgIHR5cGU6IEZBSUxfQUxMX1JFUVVFU1RTLFxuICAgIHBheWxvYWQ6IHtcbiAgICAgIHJlamVjdHM6IE9iamVjdC5rZXlzKHJlcXVlc3RzKS5tYXAoZnVuY3Rpb24gKHJlcXVlc3RJZCkge1xuICAgICAgICByZXR1cm4gcmVxdWVzdHNbcmVxdWVzdElkXS5yZWplY3Q7XG4gICAgICB9KSxcbiAgICAgIHJlYXNvbjogcmVhc29uXG4gICAgfVxuICB9KTtcbn07XG52YXIgZmFpbFJlcXVlc3QgPSBmdW5jdGlvbiBmYWlsUmVxdWVzdChfcmVmMiwgcmVxdWVzdEFjdGlvbiwgZXJyb3IpIHtcbiAgdmFyIGdldFN0YXRlID0gX3JlZjIuZ2V0U3RhdGUsXG4gICAgICBkaXNwYXRjaCA9IF9yZWYyLmRpc3BhdGNoO1xuICB2YXIgcmVxdWVzdElkID0gcmVxdWVzdEFjdGlvbi5wYXlsb2FkLmlkO1xuICBkaXNwYXRjaCh7XG4gICAgdHlwZTogUkVRVUVTVF9GQUlMRUQsXG4gICAgcGF5bG9hZDoge1xuICAgICAgaWQ6IHJlcXVlc3RJZCxcbiAgICAgIHJlamVjdDogZ2V0U3RhdGUoKS5yZXF1ZXN0c1tyZXF1ZXN0SWRdLnJlamVjdCxcbiAgICAgIGVycm9yOiBlcnJvclxuICAgIH1cbiAgfSk7XG59O1xuXG52YXIgU1VDQ0VTUyA9IE9iamVjdC5mcmVlemUoe1xuICBzdWNjZXNzOiB0cnVlXG59KTtcblxudmFyIHBhcnNlQ29tbW9uRXZlbnRQcm9wcyA9IGZ1bmN0aW9uIHBhcnNlQ29tbW9uRXZlbnRQcm9wcyh0aHJlYWRJZCwgZXZlbnQpIHtcbiAgdmFyIHBhcnNlZCA9IHtcbiAgICBpZDogZXZlbnQuaWQsXG4gICAgYXV0aG9ySWQ6IGV2ZW50LmF1dGhvcl9pZCxcbiAgICBjcmVhdGVkQXQ6IGV2ZW50LmNyZWF0ZWRfYXQsXG4gICAgdGhyZWFkSWQ6IHRocmVhZElkLFxuICAgIHByb3BlcnRpZXM6IGV2ZW50LnByb3BlcnRpZXMgfHwge31cbiAgfTtcblxuICBpZiAoZXZlbnQuY3VzdG9tX2lkICE9PSB1bmRlZmluZWQpIHtcbiAgICBwYXJzZWQuY3VzdG9tSWQgPSBldmVudC5jdXN0b21faWQ7XG4gIH1cblxuICByZXR1cm4gcGFyc2VkO1xufTtcblxudmFyIGRvd25zaXplV2l0aFJhdGlvID0gZnVuY3Rpb24gZG93bnNpemVXaXRoUmF0aW8obWF4LCBkaW1lbnNpb25zKSB7XG4gIHZhciBfcmVmO1xuXG4gIHZhciBiaWdnZXJQcm9wO1xuICB2YXIgc21hbGxlclByb3A7XG4gIHZhciBiaWdnZXI7XG4gIHZhciBzbWFsbGVyO1xuXG4gIGlmIChkaW1lbnNpb25zLmhlaWdodCA+IGRpbWVuc2lvbnMud2lkdGgpIHtcbiAgICBiaWdnZXJQcm9wID0gJ2hlaWdodCc7XG4gICAgc21hbGxlclByb3AgPSAnd2lkdGgnO1xuICAgIGJpZ2dlciA9IGRpbWVuc2lvbnMuaGVpZ2h0O1xuICAgIHNtYWxsZXIgPSBkaW1lbnNpb25zLndpZHRoO1xuICB9IGVsc2Uge1xuICAgIGJpZ2dlclByb3AgPSAnd2lkdGgnO1xuICAgIHNtYWxsZXJQcm9wID0gJ2hlaWdodCc7XG4gICAgYmlnZ2VyID0gZGltZW5zaW9ucy53aWR0aDtcbiAgICBzbWFsbGVyID0gZGltZW5zaW9ucy5oZWlnaHQ7XG4gIH1cblxuICB2YXIgcmF0aW8gPSBtYXggLyBiaWdnZXI7XG4gIHJldHVybiBfcmVmID0ge30sIF9yZWZbYmlnZ2VyUHJvcF0gPSBNYXRoLmNlaWwoTWF0aC5taW4oYmlnZ2VyLCBtYXgpKSwgX3JlZltzbWFsbGVyUHJvcF0gPSBNYXRoLmNlaWwoTWF0aC5taW4ocmF0aW8gKiBzbWFsbGVyLCBzbWFsbGVyKSksIF9yZWY7XG59O1xuXG52YXIgcGFyc2VJbWFnZSA9IGZ1bmN0aW9uIHBhcnNlSW1hZ2UodGhyZWFkLCBpbWFnZSkge1xuICByZXR1cm4gX2V4dGVuZHMoe30sIHBhcnNlQ29tbW9uRXZlbnRQcm9wcyh0aHJlYWQsIGltYWdlKSwge1xuICAgIHR5cGU6IEZJTEUsXG4gICAgY29udGVudFR5cGU6IGltYWdlLmNvbnRlbnRfdHlwZSxcbiAgICB1cmw6IGltYWdlLnVybCxcbiAgICBuYW1lOiBpbWFnZS5uYW1lLFxuICAgIHdpZHRoOiBpbWFnZS53aWR0aCxcbiAgICBoZWlnaHQ6IGltYWdlLmhlaWdodCxcbiAgICB0aHVtYm5haWxzOiB7XG4gICAgICBkZWZhdWx0OiBfZXh0ZW5kcyh7XG4gICAgICAgIHVybDogaW1hZ2UudGh1bWJuYWlsX3VybFxuICAgICAgfSwgZG93bnNpemVXaXRoUmF0aW8oMzAwLCBpbWFnZSkpLFxuICAgICAgaGlnaDogX2V4dGVuZHMoe1xuICAgICAgICB1cmw6IGltYWdlLnRodW1ibmFpbDJ4X3VybFxuICAgICAgfSwgZG93bnNpemVXaXRoUmF0aW8oNjAwLCBpbWFnZSkpXG4gICAgfVxuICB9KTtcbn07XG5cbnZhciBwYXJzZUZpbGUgPSBmdW5jdGlvbiBwYXJzZUZpbGUodGhyZWFkLCBmaWxlKSB7XG4gIGlmIChmaWxlLndpZHRoICE9PSB1bmRlZmluZWQgJiYgZmlsZS5oZWlnaHQgIT09IHVuZGVmaW5lZCkge1xuICAgIHJldHVybiBwYXJzZUltYWdlKHRocmVhZCwgZmlsZSk7XG4gIH1cblxuICByZXR1cm4gX2V4dGVuZHMoe30sIHBhcnNlQ29tbW9uRXZlbnRQcm9wcyh0aHJlYWQsIGZpbGUpLCB7XG4gICAgdHlwZTogRklMRSxcbiAgICBjb250ZW50VHlwZTogZmlsZS5jb250ZW50X3R5cGUsXG4gICAgdXJsOiBmaWxlLnVybCxcbiAgICBuYW1lOiBmaWxlLm5hbWVcbiAgfSk7XG59O1xudmFyIHBhcnNlRmlsbGVkRm9ybSA9IGZ1bmN0aW9uIHBhcnNlRmlsbGVkRm9ybSh0aHJlYWQsIGZpbGxlZEZvcm0pIHtcbiAgcmV0dXJuIF9leHRlbmRzKHt9LCBwYXJzZUNvbW1vbkV2ZW50UHJvcHModGhyZWFkLCBmaWxsZWRGb3JtKSwge1xuICAgIHR5cGU6IEZJTExFRF9GT1JNLFxuICAgIGZvcm1JZDogZmlsbGVkRm9ybS5mb3JtX2lkLFxuICAgIGZpZWxkczogZmlsbGVkRm9ybS5maWVsZHMubWFwKGZ1bmN0aW9uIChmaWVsZCkge1xuICAgICAgc3dpdGNoIChmaWVsZC50eXBlKSB7XG4gICAgICAgIGNhc2UgJ2dyb3VwX2Nob29zZXInOlxuICAgICAgICAgIHtcbiAgICAgICAgICAgIGlmICghZmllbGQuYW5zd2VyKSB7XG4gICAgICAgICAgICAgIHJldHVybiBmaWVsZDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIF9maWVsZCRhbnN3ZXIgPSBmaWVsZC5hbnN3ZXIsXG4gICAgICAgICAgICAgICAgZ3JvdXBJZCA9IF9maWVsZCRhbnN3ZXIuZ3JvdXBfaWQsXG4gICAgICAgICAgICAgICAgYW5zd2VyID0gX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzTG9vc2UoX2ZpZWxkJGFuc3dlciwgW1wiZ3JvdXBfaWRcIl0pO1xuXG4gICAgICAgICAgICByZXR1cm4gX2V4dGVuZHMoe30sIGZpZWxkLCB7XG4gICAgICAgICAgICAgIGFuc3dlcjogX2V4dGVuZHMoe30sIGFuc3dlciwge1xuICAgICAgICAgICAgICAgIGdyb3VwSWQ6IGdyb3VwSWRcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cblxuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgIHJldHVybiBmaWVsZDtcbiAgICAgIH1cbiAgICB9KVxuICB9KTtcbn07XG52YXIgcGFyc2VNZXNzYWdlID0gZnVuY3Rpb24gcGFyc2VNZXNzYWdlKHRocmVhZCwgbWVzc2FnZSkge1xuICByZXR1cm4gX2V4dGVuZHMoe30sIHBhcnNlQ29tbW9uRXZlbnRQcm9wcyh0aHJlYWQsIG1lc3NhZ2UpLCB7XG4gICAgdHlwZTogTUVTU0FHRSxcbiAgICB0ZXh0OiBtZXNzYWdlLnRleHRcbiAgfSk7XG59O1xuXG52YXIgcGFyc2VSaWNoTWVzc2FnZUVsZW1lbnQgPSBmdW5jdGlvbiBwYXJzZVJpY2hNZXNzYWdlRWxlbWVudChlbGVtZW50KSB7XG4gIHZhciBwYXJzZWQgPSB7fTtcblxuICBpZiAodHlwZW9mIGVsZW1lbnQudGl0bGUgPT09ICdzdHJpbmcnKSB7XG4gICAgcGFyc2VkLnRpdGxlID0gZWxlbWVudC50aXRsZTtcbiAgfVxuXG4gIGlmICh0eXBlb2YgZWxlbWVudC5zdWJ0aXRsZSA9PT0gJ3N0cmluZycpIHtcbiAgICBwYXJzZWQuc3VidGl0bGUgPSBlbGVtZW50LnN1YnRpdGxlO1xuICB9XG5cbiAgaWYgKGVsZW1lbnQuaW1hZ2UpIHtcbiAgICAvLyBUT0RPOiB3ZSBzaG91bGQgcmV1c2UgcGFyc2VJbWFnZSBoZXJlXG4gICAgdmFyIGltYWdlID0gZWxlbWVudC5pbWFnZTtcbiAgICBwYXJzZWQuaW1hZ2UgPSB7XG4gICAgICB1cmw6IGltYWdlLnVybCxcbiAgICAgIG5hbWU6IGltYWdlLm5hbWVcbiAgICB9O1xuICB9XG5cbiAgaWYgKGVsZW1lbnQuYnV0dG9ucykge1xuICAgIHBhcnNlZC5idXR0b25zID0gZWxlbWVudC5idXR0b25zLm1hcChmdW5jdGlvbiAoc2VydmVyQnV0dG9uKSB7XG4gICAgICBzd2l0Y2ggKHNlcnZlckJ1dHRvbi50eXBlKSB7XG4gICAgICAgIGNhc2UgJ21lc3NhZ2UnOlxuICAgICAgICBjYXNlICdwaG9uZSc6XG4gICAgICAgICAge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgdHlwZTogc2VydmVyQnV0dG9uLnR5cGUsXG4gICAgICAgICAgICAgIHRleHQ6IHNlcnZlckJ1dHRvbi50ZXh0LFxuICAgICAgICAgICAgICBwb3N0YmFja0lkOiBzZXJ2ZXJCdXR0b24ucG9zdGJhY2tfaWQsXG4gICAgICAgICAgICAgIHVzZXJJZHM6IHNlcnZlckJ1dHRvbi51c2VyX2lkcyxcbiAgICAgICAgICAgICAgdmFsdWU6IHNlcnZlckJ1dHRvbi52YWx1ZSxcbiAgICAgICAgICAgICAgcm9sZTogc2VydmVyQnV0dG9uLnJvbGUgfHwgJ2RlZmF1bHQnXG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH1cblxuICAgICAgICBjYXNlICd1cmwnOlxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHZhciBidXR0b24gPSB7XG4gICAgICAgICAgICAgIHR5cGU6IHNlcnZlckJ1dHRvbi50eXBlLFxuICAgICAgICAgICAgICB0ZXh0OiBzZXJ2ZXJCdXR0b24udGV4dCxcbiAgICAgICAgICAgICAgcG9zdGJhY2tJZDogc2VydmVyQnV0dG9uLnBvc3RiYWNrX2lkLFxuICAgICAgICAgICAgICB1c2VySWRzOiBzZXJ2ZXJCdXR0b24udXNlcl9pZHMsXG4gICAgICAgICAgICAgIHZhbHVlOiBzZXJ2ZXJCdXR0b24udmFsdWUsXG4gICAgICAgICAgICAgIHJvbGU6IHNlcnZlckJ1dHRvbi5yb2xlIHx8ICdkZWZhdWx0J1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgaWYgKHNlcnZlckJ1dHRvbi50YXJnZXQpIHtcbiAgICAgICAgICAgICAgYnV0dG9uLnRhcmdldCA9IHNlcnZlckJ1dHRvbi50YXJnZXQ7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBidXR0b247XG4gICAgICAgICAgfVxuXG4gICAgICAgIGNhc2UgJ3dlYnZpZXcnOlxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHZhciBfYnV0dG9uID0ge1xuICAgICAgICAgICAgICB0eXBlOiBzZXJ2ZXJCdXR0b24udHlwZSxcbiAgICAgICAgICAgICAgdGV4dDogc2VydmVyQnV0dG9uLnRleHQsXG4gICAgICAgICAgICAgIHBvc3RiYWNrSWQ6IHNlcnZlckJ1dHRvbi5wb3N0YmFja19pZCxcbiAgICAgICAgICAgICAgdXNlcklkczogc2VydmVyQnV0dG9uLnVzZXJfaWRzLFxuICAgICAgICAgICAgICB2YWx1ZTogc2VydmVyQnV0dG9uLnZhbHVlLFxuICAgICAgICAgICAgICByb2xlOiBzZXJ2ZXJCdXR0b24ucm9sZSB8fCAnZGVmYXVsdCdcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGlmICh0eXBlb2Ygc2VydmVyQnV0dG9uLndlYnZpZXdfaGVpZ2h0ID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICBfYnV0dG9uLndlYnZpZXdIZWlnaHQgPSBzZXJ2ZXJCdXR0b24ud2Vidmlld19oZWlnaHQ7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBfYnV0dG9uO1xuICAgICAgICAgIH1cblxuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgIHRleHQ6IHNlcnZlckJ1dHRvbi50ZXh0LFxuICAgICAgICAgICAgICBwb3N0YmFja0lkOiBzZXJ2ZXJCdXR0b24ucG9zdGJhY2tfaWQsXG4gICAgICAgICAgICAgIHVzZXJJZHM6IHNlcnZlckJ1dHRvbi51c2VyX2lkcyxcbiAgICAgICAgICAgICAgcm9sZTogc2VydmVyQnV0dG9uLnJvbGUgfHwgJ2RlZmF1bHQnXG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIHJldHVybiBwYXJzZWQ7XG59O1xuXG52YXIgcGFyc2VSaWNoTWVzc2FnZSA9IGZ1bmN0aW9uIHBhcnNlUmljaE1lc3NhZ2UodGhyZWFkLCByaWNoTWVzc2FnZSkge1xuICBzd2l0Y2ggKHJpY2hNZXNzYWdlLnRlbXBsYXRlX2lkKSB7XG4gICAgY2FzZSAnY2FyZHMnOlxuICAgIGNhc2UgJ3F1aWNrX3JlcGxpZXMnOlxuICAgIGNhc2UgJ3N0aWNrZXInOlxuICAgICAgcmV0dXJuIF9leHRlbmRzKHt9LCBwYXJzZUNvbW1vbkV2ZW50UHJvcHModGhyZWFkLCByaWNoTWVzc2FnZSksIHtcbiAgICAgICAgdHlwZTogUklDSF9NRVNTQUdFLFxuICAgICAgICB0ZW1wbGF0ZTogcmljaE1lc3NhZ2UudGVtcGxhdGVfaWQsXG4gICAgICAgIGVsZW1lbnRzOiByaWNoTWVzc2FnZS5lbGVtZW50cy5tYXAocGFyc2VSaWNoTWVzc2FnZUVsZW1lbnQpXG4gICAgICB9KTtcblxuICAgIGRlZmF1bHQ6XG4gICAgICByZXR1cm4gbnVsbDtcbiAgfVxufTtcbnZhciBwYXJzZVN5c3RlbU1lc3NhZ2UgPSBmdW5jdGlvbiBwYXJzZVN5c3RlbU1lc3NhZ2UodGhyZWFkLCBzeXN0ZW1NZXNzYWdlKSB7XG4gIHZhciBwYXJzZWQgPSBfZXh0ZW5kcyh7fSwgcGFyc2VDb21tb25FdmVudFByb3BzKHRocmVhZCwgX2V4dGVuZHMoe30sIHN5c3RlbU1lc3NhZ2UsIHtcbiAgICBhdXRob3JfaWQ6ICdzeXN0ZW0nXG4gIH0pKSwge1xuICAgIHR5cGU6IFNZU1RFTV9NRVNTQUdFLFxuICAgIHRleHQ6IHN5c3RlbU1lc3NhZ2UudGV4dCxcbiAgICBzeXN0ZW1NZXNzYWdlVHlwZTogc3lzdGVtTWVzc2FnZS5zeXN0ZW1fbWVzc2FnZV90eXBlXG4gIH0pO1xuXG4gIGlmIChzeXN0ZW1NZXNzYWdlLnRleHRfdmFycykge1xuICAgIHBhcnNlZC50ZXh0VmFycyA9IHN5c3RlbU1lc3NhZ2UudGV4dF92YXJzO1xuICB9XG5cbiAgcmV0dXJuIHBhcnNlZDtcbn07XG52YXIgcGFyc2VFdmVudCQxID0gZnVuY3Rpb24gcGFyc2VFdmVudCh0aHJlYWQsIGV2ZW50KSB7XG4gIHN3aXRjaCAoZXZlbnQudHlwZSkge1xuICAgIGNhc2UgRklMRTpcbiAgICAgIHJldHVybiBwYXJzZUZpbGUodGhyZWFkLCBldmVudCk7XG5cbiAgICBjYXNlIEZJTExFRF9GT1JNOlxuICAgICAgcmV0dXJuIHBhcnNlRmlsbGVkRm9ybSh0aHJlYWQsIGV2ZW50KTtcblxuICAgIGNhc2UgTUVTU0FHRTpcbiAgICAgIHJldHVybiBwYXJzZU1lc3NhZ2UodGhyZWFkLCBldmVudCk7XG5cbiAgICBjYXNlIFJJQ0hfTUVTU0FHRTpcbiAgICAgIHJldHVybiBwYXJzZVJpY2hNZXNzYWdlKHRocmVhZCwgZXZlbnQpO1xuXG4gICAgY2FzZSBTWVNURU1fTUVTU0FHRTpcbiAgICAgIHJldHVybiBwYXJzZVN5c3RlbU1lc3NhZ2UodGhyZWFkLCBldmVudCk7XG5cbiAgICBkZWZhdWx0OlxuICAgICAgcmV0dXJuIG51bGw7XG4gIH1cbn07XG52YXIgcGFyc2VHcmVldGluZyA9IGZ1bmN0aW9uIHBhcnNlR3JlZXRpbmcoZ3JlZXRpbmcpIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogZ3JlZXRpbmcuaWQsXG4gICAgYWRkb246IGdyZWV0aW5nLmFkZG9uIHx8IG51bGwsXG4gICAgdW5pcXVlSWQ6IGdyZWV0aW5nLnVuaXF1ZV9pZCxcbiAgICBkaXNwbGF5ZWRGaXJzdFRpbWU6IGdyZWV0aW5nLmRpc3BsYXllZF9maXJzdF90aW1lLFxuICAgIGFjY2VwdGVkOiBncmVldGluZy5hY2NlcHRlZCB8fCBmYWxzZSxcbiAgICAvLyB0aHJlYWRJZCBpcyB0eXBlZCBhcyBub25vcHRpb25hbCBzdHJpbmcgYnV0IGZvciBncmVldGluZ3MgaXQgZG9lc24ndCBleGlzdFxuICAgIGV2ZW50OiBwYXJzZUV2ZW50JDEobnVsbCwgZ3JlZXRpbmcuZXZlbnQpLFxuICAgIGFnZW50OiB7XG4gICAgICBpZDogZ3JlZXRpbmcuYWdlbnQuaWQsXG4gICAgICBuYW1lOiBncmVldGluZy5hZ2VudC5uYW1lLFxuICAgICAgYXZhdGFyOiBncmVldGluZy5hZ2VudC5hdmF0YXIsXG4gICAgICBqb2JUaXRsZTogZ3JlZXRpbmcuYWdlbnQuam9iX3RpdGxlLFxuICAgICAgaXNCb3Q6IGdyZWV0aW5nLmFnZW50LmlzX2JvdCB8fCBmYWxzZVxuICAgIH1cbiAgfTtcbn07XG5cbi8vIHNvIGl0J3MgYmV0dGVyIHRvIHJlbHkgb24gYSBjdXN0b20gaW1wbGVtZW50YXRpb25cblxudmFyIHBhcnNlQ3VzdG9tZXJTZXNzaW9uRmllbGRzJDEgPSBmdW5jdGlvbiBwYXJzZUN1c3RvbWVyU2Vzc2lvbkZpZWxkcyhzZXNzaW9uRmllbGRzKSB7XG4gIHJldHVybiBzZXNzaW9uRmllbGRzLnJlZHVjZShmdW5jdGlvbiAoYWNjLCBmaWVsZCkge1xuICAgIHZhciBfT2JqZWN0JGtleXMgPSBPYmplY3Qua2V5cyhmaWVsZCksXG4gICAgICAgIGtleSA9IF9PYmplY3Qka2V5c1swXTtcblxuICAgIGFjY1trZXldID0gZmllbGRba2V5XTtcbiAgICByZXR1cm4gYWNjO1xuICB9LCB7fSk7XG59O1xuXG52YXIgcGFyc2VBY2Nlc3MgPSBmdW5jdGlvbiBwYXJzZUFjY2VzcyhhY2Nlc3MpIHtcbiAgaWYgKGFjY2VzcyA9PT0gdm9pZCAwKSB7XG4gICAgYWNjZXNzID0ge307XG4gIH1cblxuICByZXR1cm4gYWNjZXNzLmdyb3VwX2lkcyA/IHtcbiAgICBncm91cElkczogYWNjZXNzLmdyb3VwX2lkc1xuICB9IDoge307XG59O1xudmFyIGdldEV2ZW50c1NlZW5VcFRvTWFwID0gZnVuY3Rpb24gZ2V0RXZlbnRzU2VlblVwVG9NYXAodXNlcnMpIHtcbiAgcmV0dXJuIG1hcFZhbHVlcyhmdW5jdGlvbiAodXNlcikge1xuICAgIHJldHVybiB1c2VyLmV2ZW50c19zZWVuX3VwX3RvID8gdXNlci5ldmVudHNfc2Vlbl91cF90byA6IG51bGw7XG4gIH0sIGtleUJ5KCdpZCcsIHVzZXJzKSk7XG59O1xudmFyIHBhcnNlVGhyZWFkID0gZnVuY3Rpb24gcGFyc2VUaHJlYWQoY2hhdElkLCB0aHJlYWQpIHtcbiAgdmFyIHByb3BlcnRpZXMgPSB0aHJlYWQucHJvcGVydGllcyB8fCB7fTtcbiAgcmV0dXJuIHtcbiAgICBpZDogdGhyZWFkLmlkLFxuICAgIGNoYXRJZDogY2hhdElkLFxuICAgIGFjdGl2ZTogdGhyZWFkLmFjdGl2ZSxcbiAgICBhY2Nlc3M6IHBhcnNlQWNjZXNzKHRocmVhZC5hY2Nlc3MpLFxuICAgIGNyZWF0ZWRBdDogdGhyZWFkLmNyZWF0ZWRfYXQsXG4gICAgdXNlcklkczogdGhyZWFkLnVzZXJfaWRzLFxuICAgIGV2ZW50czogdGhyZWFkLmV2ZW50cy5tYXAoZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICByZXR1cm4gcGFyc2VFdmVudCQxKHRocmVhZC5pZCwgZXZlbnQpO1xuICAgIH0pLmZpbHRlcihCb29sZWFuKSxcbiAgICBwcm9wZXJ0aWVzOiBwcm9wZXJ0aWVzLFxuICAgIHByZXZpb3VzVGhyZWFkSWQ6IHRocmVhZC5wcmV2aW91c190aHJlYWRfaWQgfHwgbnVsbCxcbiAgICBuZXh0VGhyZWFkSWQ6IHRocmVhZC5uZXh0X3RocmVhZF9pZCB8fCBudWxsLFxuICAgIHF1ZXVlOiB0aHJlYWQucXVldWUgPyBwYXJzZVF1ZXVlKHRocmVhZC5xdWV1ZSkgOiBudWxsXG4gIH07XG59O1xudmFyIHBhcnNlSW5jb21pbmdDaGF0ID0gZnVuY3Rpb24gcGFyc2VJbmNvbWluZ0NoYXQoY2hhdCkge1xuICByZXR1cm4ge1xuICAgIGlkOiBjaGF0LmlkLFxuICAgIGFjY2VzczogcGFyc2VBY2Nlc3MoY2hhdC5hY2Nlc3MpLFxuICAgIHVzZXJzOiBjaGF0LnVzZXJzLm1hcChwYXJzZUNoYXRVc2VyKSxcbiAgICBwcm9wZXJ0aWVzOiBjaGF0LnByb3BlcnRpZXMgfHwge30sXG4gICAgdGhyZWFkOiBwYXJzZVRocmVhZChjaGF0LmlkLCBjaGF0LnRocmVhZCksXG4gICAgZXZlbnRzU2VlblVwVG9NYXA6IGdldEV2ZW50c1NlZW5VcFRvTWFwKGNoYXQudXNlcnMpXG4gIH07XG59O1xudmFyIHBhcnNlQ2hhdEFnZW50ID0gZnVuY3Rpb24gcGFyc2VDaGF0QWdlbnQoYWdlbnQpIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogYWdlbnQuaWQsXG4gICAgLy8ga2VlcCBsaXRlcmFsIGhlcmUsIHNvIGV2ZXJ5IG5vbi1jdXN0b21lciBnZXRzIHRyZWF0ZWQgYXMgYWdlbnRcbiAgICAvLyBjdXJyZW50bHkgdGhlcmUgYXJlIG9ubHkgMiB0eXBlcyBvZiB1c2VycyAtIGN1c3RvbWVyICYgYWdlbnQgKGJvdHMgaGF2ZSB0eXBlOiBcImFnZW50XCIpXG4gICAgLy8gc28gdGhpcyBpcyBwdXJlbHkgZGVmZW5zaXZlIG1lYXN1cmUsIHRyeWluZyB0byBzdGF5IGZ1dHVyZS1wcm9vZlxuICAgIHR5cGU6IEFHRU5ULFxuICAgIG5hbWU6IGFnZW50Lm5hbWUsXG4gICAgYXZhdGFyOiBhZ2VudC5hdmF0YXIsXG4gICAgam9iVGl0bGU6IGFnZW50LmpvYl90aXRsZSxcbiAgICBwcmVzZW50OiBhZ2VudC5wcmVzZW50XG4gIH07XG59O1xudmFyIHBhcnNlQ3VzdG9tZXJPcHRpb25hbFByb3BzID0gZnVuY3Rpb24gcGFyc2VDdXN0b21lck9wdGlvbmFsUHJvcHMoY3VzdG9tZXJQcm9wcykge1xuICB2YXIgb3B0aW9uYWxQcm9wcyA9IHBpY2tPd24oWydhdmF0YXInLCAnZW1haWwnLCAnbmFtZSddLCBjdXN0b21lclByb3BzKTtcblxuICBpZiAoY3VzdG9tZXJQcm9wcy5zZXNzaW9uX2ZpZWxkcykge1xuICAgIG9wdGlvbmFsUHJvcHMuc2Vzc2lvbkZpZWxkcyA9IHBhcnNlQ3VzdG9tZXJTZXNzaW9uRmllbGRzJDEoY3VzdG9tZXJQcm9wcy5zZXNzaW9uX2ZpZWxkcyk7XG4gIH1cblxuICByZXR1cm4gb3B0aW9uYWxQcm9wcztcbn07XG5cbnZhciBwYXJzZUN1c3RvbWVyQ29tbW9uUHJvcHMgPSBmdW5jdGlvbiBwYXJzZUN1c3RvbWVyQ29tbW9uUHJvcHMoY3VzdG9tZXIpIHtcbiAgdmFyIG9wdGlvbmFsUHJvcHMgPSBwYXJzZUN1c3RvbWVyT3B0aW9uYWxQcm9wcyhjdXN0b21lcik7XG4gIHJldHVybiBfZXh0ZW5kcyh7XG4gICAgaWQ6IGN1c3RvbWVyLmlkLFxuICAgIHR5cGU6IENVU1RPTUVSXG4gIH0sIG9wdGlvbmFsUHJvcHMsIHtcbiAgICBzZXNzaW9uRmllbGRzOiBvcHRpb25hbFByb3BzLnNlc3Npb25GaWVsZHMgfHwge31cbiAgfSk7XG59O1xuXG52YXIgcGFyc2VDaGF0Q3VzdG9tZXIgPSBmdW5jdGlvbiBwYXJzZUNoYXRDdXN0b21lcihjdXN0b21lcikge1xuICByZXR1cm4gX2V4dGVuZHMoe30sIHBhcnNlQ3VzdG9tZXJDb21tb25Qcm9wcyhjdXN0b21lciksIHtcbiAgICBwcmVzZW50OiBjdXN0b21lci5wcmVzZW50XG4gIH0pO1xufTtcbnZhciBwYXJzZUN1c3RvbWVyID0gZnVuY3Rpb24gcGFyc2VDdXN0b21lcihjdXN0b21lcikge1xuICB2YXIgc3RhdGlzdGljcyA9IGN1c3RvbWVyLnN0YXRpc3RpY3M7XG4gIHJldHVybiBfZXh0ZW5kcyh7fSwgcGFyc2VDdXN0b21lckNvbW1vblByb3BzKGN1c3RvbWVyKSwge1xuICAgIHN0YXRpc3RpY3M6IHtcbiAgICAgIGNoYXRzQ291bnQ6IHN0YXRpc3RpY3MuY2hhdHNfY291bnQsXG4gICAgICB0aHJlYWRzQ291bnQ6IHN0YXRpc3RpY3MudGhyZWFkc19jb3VudCxcbiAgICAgIHZpc2l0c0NvdW50OiBzdGF0aXN0aWNzLnZpc2l0c19jb3VudCxcbiAgICAgIHBhZ2VWaWV3c0NvdW50OiBzdGF0aXN0aWNzLnBhZ2Vfdmlld3NfY291bnQsXG4gICAgICBncmVldGluZ3NTaG93bkNvdW50OiBzdGF0aXN0aWNzLmdyZWV0aW5nc19zaG93bl9jb3VudCxcbiAgICAgIGdyZWV0aW5nc0FjY2VwdGVkQ291bnQ6IHN0YXRpc3RpY3MuZ3JlZXRpbmdzX2FjY2VwdGVkX2NvdW50XG4gICAgfVxuICB9KTtcbn07XG52YXIgcGFyc2VQcmVkaWN0ZWRBZ2VudCA9IGZ1bmN0aW9uIHBhcnNlUHJlZGljdGVkQWdlbnQoYWdlbnQpIHtcbiAgcmV0dXJuIHtcbiAgICBpZDogYWdlbnQuaWQsXG4gICAgdHlwZTogQUdFTlQsXG4gICAgbmFtZTogYWdlbnQubmFtZSxcbiAgICBhdmF0YXI6IGFnZW50LmF2YXRhcixcbiAgICBqb2JUaXRsZTogYWdlbnQuam9iX3RpdGxlLFxuICAgIGlzQm90OiBhZ2VudC5pc19ib3RcbiAgfTtcbn07XG52YXIgcGFyc2VRdWV1ZVVwZGF0ZSA9IGZ1bmN0aW9uIHBhcnNlUXVldWVVcGRhdGUocXVldWVVcGRhdGUpIHtcbiAgcmV0dXJuIHtcbiAgICBwb3NpdGlvbjogcXVldWVVcGRhdGUucG9zaXRpb24sXG4gICAgd2FpdFRpbWU6IHF1ZXVlVXBkYXRlLndhaXRfdGltZVxuICB9O1xufTtcbnZhciBwYXJzZVF1ZXVlID0gZnVuY3Rpb24gcGFyc2VRdWV1ZShxdWV1ZSkge1xuICByZXR1cm4gX2V4dGVuZHMoe30sIHBhcnNlUXVldWVVcGRhdGUocXVldWUpLCB7XG4gICAgcXVldWVkQXQ6IHF1ZXVlLnF1ZXVlZF9hdFxuICB9KTtcbn07XG52YXIgcGFyc2VDaGF0VXNlciA9IGZ1bmN0aW9uIHBhcnNlQ2hhdFVzZXIodXNlcikge1xuICByZXR1cm4gdXNlci50eXBlID09PSBDVVNUT01FUiA/IHBhcnNlQ2hhdEN1c3RvbWVyKHVzZXIpIDogcGFyc2VDaGF0QWdlbnQodXNlcik7XG59O1xudmFyIHBhcnNlR3JvdXBTdGF0dXMgPSBmdW5jdGlvbiBwYXJzZUdyb3VwU3RhdHVzKHN0YXR1cykge1xuICByZXR1cm4gc3RhdHVzID09PSAnb2ZmbGluZScgPyAnb2ZmbGluZScgOiAnb25saW5lJztcbn07XG5cbnZhciBfRkFJTF9BTExfUkVRVUVTVFNfTUU7XG5cbnZhciBTTUFMTF9SRUNPTk5FQ1RfREVMQVkgPSAxMDA7XG52YXIgRkFJTF9BTExfUkVRVUVTVFNfTUVTU0FHRVMgPSAoX0ZBSUxfQUxMX1JFUVVFU1RTX01FID0ge30sIF9GQUlMX0FMTF9SRVFVRVNUU19NRVtDT05ORUNUSU9OX0xPU1RdID0gJ0Nvbm5lY3Rpb24gbG9zdC4nLCBfRkFJTF9BTExfUkVRVUVTVFNfTUVbTUlTRElSRUNURURfQ09OTkVDVElPTl0gPSAnQ29ubmVjdGVkIHRvIHdyb25nIHJlZ2lvbi4nLCBfRkFJTF9BTExfUkVRVUVTVFNfTUUpO1xuXG52YXIgdXBkYXRlU3RhdGVJZk5lZWRlZCA9IGZ1bmN0aW9uIHVwZGF0ZVN0YXRlSWZOZWVkZWQoc3RvcmUsIGFjdGlvbikge1xuICB2YXIgc3RhdGUgPSBzdG9yZS5nZXRTdGF0ZSgpO1xuXG4gIHN3aXRjaCAoYWN0aW9uLnR5cGUpIHtcbiAgICBjYXNlIFBVU0hfUkVTUE9OU0VfUkVDRUlWRUQ6XG4gICAgY2FzZSBQVVNIX1JFQ0VJVkVEOlxuICAgICAgc3dpdGNoIChhY3Rpb24ucGF5bG9hZC5hY3Rpb24pIHtcbiAgICAgICAgY2FzZSBDSEFUX0RFQUNUSVZBVEVEOlxuICAgICAgICAgIHN0b3JlLmRpc3BhdGNoKHNldENoYXRBY3RpdmUoYWN0aW9uLnBheWxvYWQucGF5bG9hZC5jaGF0SWQsIGZhbHNlKSk7XG4gICAgICAgICAgcmV0dXJuO1xuXG4gICAgICAgIGNhc2UgSU5DT01JTkdfQ0hBVDpcbiAgICAgICAgICBzdG9yZS5kaXNwYXRjaChzZXRDaGF0QWN0aXZlKGFjdGlvbi5wYXlsb2FkLnBheWxvYWQuY2hhdC5pZCwgdHJ1ZSkpO1xuICAgICAgICAgIHJldHVybjtcblxuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgIGNhc2UgUkVTUE9OU0VfUkVDRUlWRUQ6XG4gICAgICBzd2l0Y2ggKGFjdGlvbi5wYXlsb2FkLmFjdGlvbikge1xuICAgICAgICBjYXNlIExJU1RfQ0hBVFM6XG4gICAgICAgICAgYWN0aW9uLnBheWxvYWQucGF5bG9hZC5jaGF0c1N1bW1hcnkuZmlsdGVyKGZ1bmN0aW9uIChfcmVmKSB7XG4gICAgICAgICAgICB2YXIgaWQgPSBfcmVmLmlkLFxuICAgICAgICAgICAgICAgIGFjdGl2ZSA9IF9yZWYuYWN0aXZlO1xuICAgICAgICAgICAgcmV0dXJuIGlzQ2hhdEFjdGl2ZShzdGF0ZSwgaWQpICE9PSBhY3RpdmU7XG4gICAgICAgICAgfSkuZm9yRWFjaChmdW5jdGlvbiAoX3JlZjIpIHtcbiAgICAgICAgICAgIHZhciBpZCA9IF9yZWYyLmlkLFxuICAgICAgICAgICAgICAgIGFjdGl2ZSA9IF9yZWYyLmFjdGl2ZTtcbiAgICAgICAgICAgIHN0b3JlLmRpc3BhdGNoKHNldENoYXRBY3RpdmUoaWQsIGFjdGl2ZSkpO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIHJldHVybjtcblxuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICB9XG59O1xuXG52YXIgc2VuZFJlcXVlc3QkMSA9IGZ1bmN0aW9uIHNlbmRSZXF1ZXN0JCQxKHNvY2tldCwgX3JlZjMpIHtcbiAgdmFyIF9yZWYzJHBheWxvYWQgPSBfcmVmMy5wYXlsb2FkLFxuICAgICAgaWQgPSBfcmVmMyRwYXlsb2FkLmlkLFxuICAgICAgcmVxdWVzdCA9IF9yZWYzJHBheWxvYWQucmVxdWVzdDtcblxuICB2YXIgZnJhbWUgPSBfZXh0ZW5kcyh7XG4gICAgcmVxdWVzdF9pZDogaWRcbiAgfSwgcmVxdWVzdCk7XG5cbiAgc29ja2V0LmVtaXQoZnJhbWUpO1xufTtcblxudmFyIGVtaXRVc2VycyA9IGZ1bmN0aW9uIGVtaXRVc2VycyhlbWl0LCB1c2Vycykge1xuICB1c2Vycy5mb3JFYWNoKGZ1bmN0aW9uICh1c2VyKSB7XG4gICAgaWYgKCdwcmVzZW50JyBpbiB1c2VyKSB7XG4gICAgICB2YXIgcmVzdCA9IF9vYmplY3RXaXRob3V0UHJvcGVydGllc0xvb3NlKHVzZXIsIFtcInByZXNlbnRcIl0pO1xuXG4gICAgICBlbWl0KCd1c2VyX2RhdGEnLCByZXN0KTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAodXNlci50eXBlID09PSBDVVNUT01FUikge1xuICAgICAgdmFyIF9yZXN0ID0gX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzTG9vc2UodXNlciwgW1wic3RhdGlzdGljc1wiXSk7XG5cbiAgICAgIGVtaXQoJ3VzZXJfZGF0YScsIF9yZXN0KTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBlbWl0KCd1c2VyX2RhdGEnLCB1c2VyKTtcbiAgfSk7XG59O1xuXG52YXIgaGFuZGxlTXVsdGljYXN0ID0gZnVuY3Rpb24gaGFuZGxlTXVsdGljYXN0KGVtaXQsIF9yZWY0KSB7XG4gIHZhciB0eXBlID0gX3JlZjQudHlwZSxcbiAgICAgIGNvbnRlbnQgPSBfcmVmNC5jb250ZW50O1xuXG4gIGlmICh0eXBlICE9PSAnbGMyJykge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGlmIChjb250ZW50Lm5hbWUgPT09ICdncm91cHNfdXBkYXRlJyAmJiAnZ3JvdXBzJyBpbiBjb250ZW50ICYmICFpc0VtcHR5KGNvbnRlbnQuZ3JvdXBzKSkge1xuICAgIHZhciBfY29udGVudCRncm91cHMgPSBjb250ZW50Lmdyb3VwcyxcbiAgICAgICAgZ3JvdXAgPSBfY29udGVudCRncm91cHNbMF07XG4gICAgdmFyIGF2YWlsYWJpbGl0eSA9IHBhcnNlR3JvdXBTdGF0dXMoZ3JvdXAuc3RhdHVzKTtcbiAgICBlbWl0KCdhdmFpbGFiaWxpdHlfdXBkYXRlZCcsIHtcbiAgICAgIGF2YWlsYWJpbGl0eTogYXZhaWxhYmlsaXR5XG4gICAgfSk7XG4gIH1cbn07XG5cbnZhciBoYW5kbGVQdXNoID0gZnVuY3Rpb24gaGFuZGxlUHVzaChfcmVmNSwgX3JlZjYpIHtcbiAgdmFyIGVtaXQgPSBfcmVmNS5lbWl0LFxuICAgICAgc3RvcmUgPSBfcmVmNS5zdG9yZTtcbiAgdmFyIHBheWxvYWQgPSBfcmVmNi5wYXlsb2FkO1xuXG4gIHN3aXRjaCAocGF5bG9hZC5hY3Rpb24pIHtcbiAgICBjYXNlIFRIUkVBRF9QUk9QRVJUSUVTX1VQREFURUQ6XG4gICAgICBpZiAocGF5bG9hZC5wYXlsb2FkLnByb3BlcnRpZXMubGMyICYmICdxdWV1ZV9wb3MnIGluIHBheWxvYWQucGF5bG9hZC5wcm9wZXJ0aWVzLmxjMikge1xuICAgICAgICBlbWl0KFFVRVVFX1BPU0lUSU9OX1VQREFURUQsIHtcbiAgICAgICAgICBjaGF0SWQ6IHBheWxvYWQucGF5bG9hZC5jaGF0SWQsXG4gICAgICAgICAgdGhyZWFkSWQ6IHBheWxvYWQucGF5bG9hZC50aHJlYWRJZCxcbiAgICAgICAgICBxdWV1ZToge1xuICAgICAgICAgICAgcG9zaXRpb246IHBheWxvYWQucGF5bG9hZC5wcm9wZXJ0aWVzLmxjMi5xdWV1ZV9wb3MsXG4gICAgICAgICAgICB3YWl0VGltZTogcGF5bG9hZC5wYXlsb2FkLnByb3BlcnRpZXMubGMyLnF1ZXVlX3dhaXRpbmdfdGltZVxuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGVtaXQoJ3RocmVhZF9wcm9wZXJ0aWVzX3VwZGF0ZWQnLCBwYXlsb2FkLnBheWxvYWQpO1xuICAgICAgcmV0dXJuO1xuXG4gICAgY2FzZSBDVVNUT01FUl9TSURFX1NUT1JBR0VfVVBEQVRFRDpcbiAgICAgIHNhdmVTaWRlU3RvcmFnZShzdG9yZSwgcGF5bG9hZC5wYXlsb2FkLmN1c3RvbWVyX3NpZGVfc3RvcmFnZSk7XG4gICAgICByZXR1cm47XG5cbiAgICBjYXNlIENVU1RPTUVSX0RJU0NPTk5FQ1RFRDpcbiAgICAgIC8vIGVhY2ggb2YgdGhvc2Ugc2hvdWxkIGN1cnJlbnRseSBsZWFkIHRvIGVpdGhlciByZWNvbm5lY3Qgb3IgZGVzdHJveSBjYWxsXG4gICAgICAvLyBhZnRlciByZWNlaXZpbmcgdGhpcyBwdXNoIHNlcnZlciBjbG9zZXMgdGhlIGNvbm5lY3Rpb24gd2l0aCB1c1xuICAgICAgLy8gd2hpY2ggcmVzdWx0cyBpbiBTT0NLRVRfRElTQ09OTkVDVEVEIGFjdGlvbiBiZWluZyBkaXNwYXRjaGVkXG4gICAgICAvLyB3ZSBkb24ndCB3YW50IHRvIHJlbHkgb24gdGhpcyAobm9yIHdlIHdhbnQgdG8gcmlzayBlbWl0dGluZyAnZGlzY29ubmVjdGVkJyB0d2ljZSlcbiAgICAgIC8vIHNvIHdlIHNob3VsZCBoYW5kbGUgYWxsIGNhc2VzIG91cnNlbHZlcyBhbmQgY2xvc2UgdGhlIGNvbm5lY3Rpb24gcHJlZW1wdGl2ZWx5XG4gICAgICBzd2l0Y2ggKHBheWxvYWQucGF5bG9hZC5yZWFzb24pIHtcbiAgICAgICAgY2FzZSBBQ0NFU1NfVE9LRU5fRVhQSVJFRDpcbiAgICAgICAgICAvLyB3ZSBwYXNzdGhyb3VnaCBhY2Nlc3NfdG9rZW5fZXhwaXJlZCBoZXJlLCBzbyBwZW5kaW5nIHJlcXVlc3RzIHJlY2VpdmUgQ09OTkVDVElPTl9MT1NUIGVycm9yXG4gICAgICAgICAgLy8gd2UgY291bGQgZmFpbCB0aGVtIHdpdGggQUNDRVNTX1RPS0VOX0VYUElSRUQsIGJ1dCBpdCBjb3VsZCBmb3JjZSBwZW9wbGUgdG8gaGFuZGxlIGl0IGluIHNwZWNpYWwgbWFubmVyXG4gICAgICAgICAgLy8gYnV0IGFjdHVhbGx5IHRoZXkgc2hvdWxkIGhhbmRsZSBpdCBleGFjdGx5IGxpa2UgQ09OTkVDVElPTl9MT1NUOlxuICAgICAgICAgIC8vIGEgcmVxdWVzdCBjb3VsZCBzdWNjZWVkLCB3aG8ga25vd3MsIGl0IGhhcyB0byBiZSBjaGVja2VkIGFmdGVyIGJlaW5nIHJlY29ubmVjdGVkXG4gICAgICAgICAgc3RvcmUuZGlzcGF0Y2gocHJlZmV0Y2hUb2tlbih0cnVlKSk7XG4gICAgICAgICAgc3RvcmUuZGlzcGF0Y2gocmVjb25uZWN0KFNNQUxMX1JFQ09OTkVDVF9ERUxBWSkpO1xuICAgICAgICAgIGVtaXQoJ2Rpc2Nvbm5lY3RlZCcsIHBheWxvYWQucGF5bG9hZCk7XG4gICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgY2FzZSBDVVNUT01FUl9CQU5ORUQ6XG4gICAgICAgIGNhc2UgQ1VTVE9NRVJfVEVNUE9SQVJJTFlfQkxPQ0tFRDpcbiAgICAgICAgY2FzZSBMSUNFTlNFX05PVF9GT1VORDpcbiAgICAgICAgY2FzZSBQUk9EVUNUX1ZFUlNJT05fQ0hBTkdFRDpcbiAgICAgICAgY2FzZSBUT09fTUFOWV9DT05ORUNUSU9OUzpcbiAgICAgICAgY2FzZSBVTlNVUFBPUlRFRF9WRVJTSU9OOlxuICAgICAgICAgIC8vIHRoaXMgYWxzbyBlbWl0cyBgZGlzY29ubmVjdGVkYCBldmVudCAtIGJ1dCBpdCdzIGhhbmRsZWQgaW4gcmVzcG9uc2UgdG8gdGhpcyBhY3Rpb24gYnkgZGVzdHJveSBoYW5kbGVyXG4gICAgICAgICAgc3RvcmUuZGlzcGF0Y2goZGVzdHJveShwYXlsb2FkLnBheWxvYWQucmVhc29uKSk7XG4gICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgY2FzZSBNSVNESVJFQ1RFRF9DT05ORUNUSU9OJDE6XG4gICAgICAgICAgZmFpbEFsbFJlcXVlc3RzKHN0b3JlLCBNSVNESVJFQ1RFRF9DT05ORUNUSU9OKTtcbiAgICAgICAgICBzdG9yZS5kaXNwYXRjaCh7XG4gICAgICAgICAgICB0eXBlOiBDSEFOR0VfUkVHSU9OLFxuICAgICAgICAgICAgcGF5bG9hZDogcGF5bG9hZC5wYXlsb2FkLmRhdGFcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBicmVhaztcblxuICAgICAgICBjYXNlIFRPT19NQU5ZX1VOQVVUSE9SSVpFRF9DT05ORUNUSU9OUyQxOlxuICAgICAgICAgIC8vIHRoaXMgc2hvdWxkIG9ubHkgcmVhbGx5IGZhaWwgYSBgbG9naW5gIHJlcXVlc3QgLSBhcyBpdCdzIHRoZSBvbmx5IG9uZSBzZW50IGJlZm9yZSBhdXRob3JpemF0aW9uXG4gICAgICAgICAgLy8gYW5kIGxvZ2luIHNob3VsZCByZWNvbm5lY3Qgb24gaXRzIG93biByaWdodCBub3dcbiAgICAgICAgICBmYWlsQWxsUmVxdWVzdHMoc3RvcmUsIFRPT19NQU5ZX1VOQVVUSE9SSVpFRF9DT05ORUNUSU9OUyk7XG4gICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICBzdG9yZS5kaXNwYXRjaChyZWNvbm5lY3QoU01BTExfUkVDT05ORUNUX0RFTEFZKSk7XG4gICAgICAgICAgZW1pdCgnZGlzY29ubmVjdGVkJywgcGF5bG9hZC5wYXlsb2FkKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgIH1cblxuICAgICAgcmV0dXJuO1xuXG4gICAgY2FzZSBJTkNPTUlOR19DSEFUOlxuICAgICAgZW1pdFVzZXJzKGVtaXQsIHBheWxvYWQucGF5bG9hZC5jaGF0LnVzZXJzKTtcbiAgICAgIGVtaXQocGF5bG9hZC5hY3Rpb24sIHBheWxvYWQucGF5bG9hZCk7XG4gICAgICByZXR1cm47XG5cbiAgICBjYXNlIElOQ09NSU5HX0VWRU5UOlxuICAgICAgaWYgKHBheWxvYWQucGF5bG9hZC5ldmVudCA9PT0gbnVsbCkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGVtaXQocGF5bG9hZC5hY3Rpb24sIHBheWxvYWQucGF5bG9hZCk7XG4gICAgICByZXR1cm47XG5cbiAgICBjYXNlIElOQ09NSU5HX1RZUElOR19JTkRJQ0FUT1I6XG4gICAgICBlbWl0KHBheWxvYWQuYWN0aW9uLCBwYXlsb2FkLnBheWxvYWQpO1xuICAgICAgcmV0dXJuO1xuXG4gICAgY2FzZSBJTkNPTUlOR19NVUxUSUNBU1Q6XG4gICAgICBoYW5kbGVNdWx0aWNhc3QoZW1pdCwgcGF5bG9hZC5wYXlsb2FkKTsgLy8gd2UgcGFzc3Rocm91Z2ggdGhpcyBhY3Rpb24gZXZlbiBpZiBpdCB3YXMgYWxyZWFkeSBoYW5kbGVkIGFib3ZlXG5cbiAgICAgIGVtaXQocGF5bG9hZC5hY3Rpb24sIHBheWxvYWQucGF5bG9hZCk7XG4gICAgICByZXR1cm47XG5cbiAgICBjYXNlIFVTRVJfQURERURfVE9fQ0hBVDpcbiAgICAgIGVtaXRVc2VycyhlbWl0LCBbcGF5bG9hZC5wYXlsb2FkLnVzZXJdKTtcbiAgICAgIGVtaXQocGF5bG9hZC5hY3Rpb24sIHBheWxvYWQucGF5bG9hZCk7XG4gICAgICByZXR1cm47XG5cbiAgICBkZWZhdWx0OlxuICAgICAgZW1pdChwYXlsb2FkLmFjdGlvbiwgcGF5bG9hZC5wYXlsb2FkKTtcbiAgICAgIHJldHVybjtcbiAgfVxufTtcblxudmFyIGhhbmRsZVJlc3BvbnNlID0gZnVuY3Rpb24gaGFuZGxlUmVzcG9uc2UoX3JlZjcsIF9yZWY4KSB7XG4gIHZhciBlbWl0ID0gX3JlZjcuZW1pdDtcbiAgdmFyIHBheWxvYWQgPSBfcmVmOC5wYXlsb2FkO1xuXG4gIHN3aXRjaCAocGF5bG9hZC5hY3Rpb24pIHtcbiAgICBjYXNlIENIQVRfREVBQ1RJVkFURUQ6XG4gICAgICBwYXlsb2FkLnJlc29sdmUoU1VDQ0VTUyk7XG4gICAgICByZXR1cm47XG5cbiAgICBjYXNlIEdFVF9DSEFUOlxuICAgICAgZW1pdFVzZXJzKGVtaXQsIHBheWxvYWQucGF5bG9hZC51c2Vycyk7XG4gICAgICBwYXlsb2FkLnJlc29sdmUocGF5bG9hZC5wYXlsb2FkKTtcbiAgICAgIHJldHVybjtcblxuICAgIGNhc2UgSU5DT01JTkdfQ0hBVDpcbiAgICAgIGVtaXRVc2VycyhlbWl0LCBwYXlsb2FkLnBheWxvYWQuY2hhdC51c2Vycyk7XG4gICAgICBwYXlsb2FkLnJlc29sdmUocGF5bG9hZC5wYXlsb2FkKTtcbiAgICAgIHJldHVybjtcblxuICAgIGNhc2UgSU5DT01JTkdfRVZFTlQ6XG4gICAgICBwYXlsb2FkLnJlc29sdmUocGF5bG9hZC5wYXlsb2FkLmV2ZW50KTtcbiAgICAgIHJldHVybjtcblxuICAgIGNhc2UgTElTVF9DSEFUUzpcbiAgICAgIGVtaXRVc2VycyhlbWl0LCBwYXlsb2FkLnBheWxvYWQudXNlcnMpO1xuICAgICAgcGF5bG9hZC5yZXNvbHZlKHBheWxvYWQucGF5bG9hZCk7XG4gICAgICByZXR1cm47XG5cbiAgICBkZWZhdWx0OlxuICAgICAgcGF5bG9hZC5yZXNvbHZlKHBheWxvYWQucGF5bG9hZCk7XG4gICAgICByZXR1cm47XG4gIH1cbn07XG5cbnZhciBjcmVhdGVTaWRlRWZmZWN0c0hhbmRsZXIgPSAoZnVuY3Rpb24gKF9yZWY5KSB7XG4gIHZhciBhdXRoID0gX3JlZjkuYXV0aCxcbiAgICAgIGN1c3RvbWVyRGF0YVByb3ZpZGVyID0gX3JlZjkuY3VzdG9tZXJEYXRhUHJvdmlkZXIsXG4gICAgICBlbWl0dGVyID0gX3JlZjkuZW1pdHRlcixcbiAgICAgIHNvY2tldCA9IF9yZWY5LnNvY2tldDtcbiAgdmFyIGVtaXQgPSBlbWl0dGVyLmVtaXQ7XG4gIHZhciBsb2dpbiA9IGNyZWF0ZUxvZ2luVGFzayhhdXRoLCBjdXN0b21lckRhdGFQcm92aWRlcik7IC8vIFRPRE86IHVzaW5nIFN0b3JlIHR5cGUgaGVyZSBpcyBhIGxpZSwgbWlkZGxld2FyZSBvbmx5IHByb3ZpZGVzIE1pZGRsZXdhcmVBUEkgaGVyZVxuXG4gIHJldHVybiBmdW5jdGlvbiAoYWN0aW9uLCBzdG9yZSkge1xuICAgIHN3aXRjaCAoYWN0aW9uLnR5cGUpIHtcbiAgICAgIGNhc2UgQ0hBTkdFX1JFR0lPTjpcbiAgICAgICAgc29ja2V0LnJlaW5pdGlhbGl6ZSgpO1xuICAgICAgICByZXR1cm47XG5cbiAgICAgIGNhc2UgQ0hFQ0tfR09BTFM6XG4gICAgICAgIGNoZWNrR29hbHMoc3RvcmUsIGF1dGgsIGFjdGlvbi5wYXlsb2FkLnNlc3Npb25GaWVsZHMpLmNhdGNoKG5vb3ApO1xuICAgICAgICByZXR1cm47XG5cbiAgICAgIGNhc2UgREVTVFJPWTpcbiAgICAgICAge1xuICAgICAgICAgIHZhciBwYXlsb2FkID0gYWN0aW9uLnBheWxvYWQ7XG4gICAgICAgICAgc29ja2V0LmRlc3Ryb3koKTtcblxuICAgICAgICAgIGlmIChwYXlsb2FkLnJlYXNvbiAhPT0gJ21hbnVhbCcpIHtcbiAgICAgICAgICAgIGVtaXQoJ2Rpc2Nvbm5lY3RlZCcsIHBheWxvYWQpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGVtaXR0ZXIub2ZmKCk7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgIGNhc2UgRkFJTF9BTExfUkVRVUVTVFM6XG4gICAgICAgIHtcbiAgICAgICAgICB2YXIgX2FjdGlvbiRwYXlsb2FkID0gYWN0aW9uLnBheWxvYWQsXG4gICAgICAgICAgICAgIHJlYXNvbiA9IF9hY3Rpb24kcGF5bG9hZC5yZWFzb24sXG4gICAgICAgICAgICAgIHJlamVjdHMgPSBfYWN0aW9uJHBheWxvYWQucmVqZWN0cztcbiAgICAgICAgICB2YXIgZXJyb3IgPSB7XG4gICAgICAgICAgICBtZXNzYWdlOiBGQUlMX0FMTF9SRVFVRVNUU19NRVNTQUdFU1tyZWFzb25dLFxuICAgICAgICAgICAgY29kZTogcmVhc29uXG4gICAgICAgICAgfTtcbiAgICAgICAgICByZWplY3RzLmZvckVhY2goZnVuY3Rpb24gKHJlamVjdCkge1xuICAgICAgICAgICAgcmVqZWN0KGNyZWF0ZUVycm9yKGVycm9yKSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgIGNhc2UgTE9HSU5fU1VDQ0VTUzpcbiAgICAgICAge1xuICAgICAgICAgIHZhciBfYWN0aW9uJHBheWxvYWQyID0gYWN0aW9uLnBheWxvYWQsXG4gICAgICAgICAgICAgIGR5bmFtaWNDb25maWcgPSBfYWN0aW9uJHBheWxvYWQyLmR5bmFtaWNDb25maWcsXG4gICAgICAgICAgICAgIGN1c3RvbWVyID0gX2FjdGlvbiRwYXlsb2FkMi5jdXN0b21lcixcbiAgICAgICAgICAgICAgY2hhdHMgPSBfYWN0aW9uJHBheWxvYWQyLmNoYXRzLFxuICAgICAgICAgICAgICBncmVldGluZyA9IF9hY3Rpb24kcGF5bG9hZDIuZ3JlZXRpbmcsXG4gICAgICAgICAgICAgIGF2YWlsYWJpbGl0eSA9IF9hY3Rpb24kcGF5bG9hZDIuYXZhaWxhYmlsaXR5O1xuXG4gICAgICAgICAgdmFyIGV2ZW50RGF0YSA9IF9leHRlbmRzKHtcbiAgICAgICAgICAgIGN1c3RvbWVyOiBjdXN0b21lcixcbiAgICAgICAgICAgIGF2YWlsYWJpbGl0eTogYXZhaWxhYmlsaXR5XG4gICAgICAgICAgfSwgZ3JlZXRpbmcgJiYge1xuICAgICAgICAgICAgZ3JlZXRpbmc6IGdyZWV0aW5nXG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXZlbnREYXRhLCAnX191bnNhZmVEeW5hbWljQ29uZmlnJywge1xuICAgICAgICAgICAgdmFsdWU6IGR5bmFtaWNDb25maWdcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXZlbnREYXRhLCAnX191bnNhZmVDaGF0cycsIHtcbiAgICAgICAgICAgIHZhbHVlOiBjaGF0c1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIGVtaXQoJ2Nvbm5lY3RlZCcsIGV2ZW50RGF0YSk7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgIGNhc2UgUEFVU0VfQ09OTkVDVElPTjpcbiAgICAgICAgc29ja2V0LmRpc2Nvbm5lY3QoKTtcbiAgICAgICAgcmV0dXJuO1xuXG4gICAgICBjYXNlIFBSRUZFVENIX1RPS0VOOlxuICAgICAgICBpZiAoYWN0aW9uLnBheWxvYWQuZnJlc2gpIHtcbiAgICAgICAgICBhdXRoLmdldEZyZXNoVG9rZW4oKS5jYXRjaChub29wKTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBhdXRoLmhhc1Rva2VuKCkudGhlbihmdW5jdGlvbiAoaGFzVG9rZW4pIHtcbiAgICAgICAgICBpZiAoIWhhc1Rva2VuKSB7XG4gICAgICAgICAgICByZXR1cm4gYXV0aC5nZXRUb2tlbigpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHJldHVybiBhdXRoLmdldFRva2VuKCkudGhlbihmdW5jdGlvbiAoX3JlZjEwKSB7XG4gICAgICAgICAgICB2YXIgY3JlYXRpb25EYXRlID0gX3JlZjEwLmNyZWF0aW9uRGF0ZSxcbiAgICAgICAgICAgICAgICBleHBpcmVzSW4gPSBfcmVmMTAuZXhwaXJlc0luO1xuICAgICAgICAgICAgdmFyIE9ORV9IT1VSID0gNjAgKiA2MCAqIDEwMDA7IC8vIGNoZWNrIGlmIHRoZSB0b2tlbiBpcyB3b3J0aCByZXVzaW5nXG4gICAgICAgICAgICAvLyB3ZSBkb24ndCB3YW50IHRvIGdldCBkaXNjb25uZWN0ZWQgaW4gYSBtb21lbnQgYmVjYXVzZSBvZiBleHBpcmVkIHRva2VuXG5cbiAgICAgICAgICAgIGlmIChjcmVhdGlvbkRhdGUgKyBleHBpcmVzSW4gLSBEYXRlLm5vdygpID4gT05FX0hPVVIpIHtcbiAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gYXV0aC5pbnZhbGlkYXRlKCkudGhlbihhdXRoLmdldEZyZXNoVG9rZW4pO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KS5jYXRjaChub29wKTtcbiAgICAgICAgcmV0dXJuO1xuXG4gICAgICBjYXNlIFBVU0hfUkVDRUlWRUQ6XG4gICAgICAgIC8vIFRPRE86IHRoaXMgaWYgZG9lc24ndCBzZWVtIHRvIG1ha2UgbXVjaCBzZW5zZVxuICAgICAgICAvLyBJJ20gdG9vIGFmcmFpZCB0byByZW1vdmUgaXQgcmlnaHQgbm93IHRob3VnaFxuICAgICAgICBpZiAoYWN0aW9uLnBheWxvYWQuYWN0aW9uID09PSBDVVNUT01FUl9ESVNDT05ORUNURUQpIHtcbiAgICAgICAgICBoYW5kbGVQdXNoKHtcbiAgICAgICAgICAgIGVtaXQ6IGVtaXQsXG4gICAgICAgICAgICBzdG9yZTogc3RvcmVcbiAgICAgICAgICB9LCBhY3Rpb24pO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIHVwZGF0ZVN0YXRlSWZOZWVkZWQoc3RvcmUsIGFjdGlvbik7XG4gICAgICAgIGhhbmRsZVB1c2goe1xuICAgICAgICAgIGVtaXQ6IGVtaXQsXG4gICAgICAgICAgc3RvcmU6IHN0b3JlXG4gICAgICAgIH0sIGFjdGlvbik7XG4gICAgICAgIHJldHVybjtcblxuICAgICAgY2FzZSBQVVNIX1JFU1BPTlNFX1JFQ0VJVkVEOlxuICAgICAgICB1cGRhdGVTdGF0ZUlmTmVlZGVkKHN0b3JlLCBhY3Rpb24pO1xuICAgICAgICBoYW5kbGVSZXNwb25zZSh7XG4gICAgICAgICAgZW1pdDogZW1pdFxuICAgICAgICB9LCBhY3Rpb24pO1xuICAgICAgICByZXR1cm47XG5cbiAgICAgIGNhc2UgUkVDT05ORUNUOlxuICAgICAgICBzb2NrZXQucmVjb25uZWN0KGFjdGlvbi5wYXlsb2FkLmRlbGF5KTtcbiAgICAgICAgcmV0dXJuO1xuXG4gICAgICBjYXNlIFJFUVVFU1RfRkFJTEVEOlxuICAgICAgICB7XG4gICAgICAgICAgdmFyIF9hY3Rpb24kcGF5bG9hZDMgPSBhY3Rpb24ucGF5bG9hZCxcbiAgICAgICAgICAgICAgcmVqZWN0ID0gX2FjdGlvbiRwYXlsb2FkMy5yZWplY3QsXG4gICAgICAgICAgICAgIF9lcnJvciA9IF9hY3Rpb24kcGF5bG9hZDMuZXJyb3I7XG4gICAgICAgICAgcmVqZWN0KGNyZWF0ZUVycm9yKF9lcnJvcikpO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICBjYXNlIFJFU1BPTlNFX1JFQ0VJVkVEOlxuICAgICAgICB1cGRhdGVTdGF0ZUlmTmVlZGVkKHN0b3JlLCBhY3Rpb24pO1xuICAgICAgICBoYW5kbGVSZXNwb25zZSh7XG4gICAgICAgICAgZW1pdDogZW1pdFxuICAgICAgICB9LCBhY3Rpb24pO1xuICAgICAgICByZXR1cm47XG5cbiAgICAgIGNhc2UgU0VORF9SRVFVRVNUOlxuICAgICAgICB7XG4gICAgICAgICAgdmFyIHN0YXRlID0gc3RvcmUuZ2V0U3RhdGUoKTtcblxuICAgICAgICAgIGlmIChpc0Rlc3Ryb3llZChzdGF0ZSkpIHtcbiAgICAgICAgICAgIGZhaWxSZXF1ZXN0KHN0b3JlLCBhY3Rpb24sIHtcbiAgICAgICAgICAgICAgY29kZTogJ1NES19ERVNUUk9ZRUQnLFxuICAgICAgICAgICAgICBtZXNzYWdlOiAnU0RLIGRlc3Ryb3llZC4nXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBpZiAoIWlzQ29ubmVjdGVkKHN0YXRlKSAmJiBhY3Rpb24ucGF5bG9hZC5zb3VyY2UgIT09ICdsb2dpbicpIHtcbiAgICAgICAgICAgIGZhaWxSZXF1ZXN0KHN0b3JlLCBhY3Rpb24sIHtcbiAgICAgICAgICAgICAgY29kZTogJ05PX0NPTk5FQ1RJT04nLFxuICAgICAgICAgICAgICBtZXNzYWdlOiAnTm8gY29ubmVjdGlvbi4nXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBzZW5kUmVxdWVzdCQxKHNvY2tldCwgYWN0aW9uKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm47XG5cbiAgICAgIGNhc2UgU0VUX1NFTEZfSUQ6XG4gICAgICAgIGVtaXQoJ2N1c3RvbWVyX2lkJywgYWN0aW9uLnBheWxvYWQuaWQpO1xuICAgICAgICByZXR1cm47XG5cbiAgICAgIGNhc2UgU09DS0VUX0RJU0NPTk5FQ1RFRDpcbiAgICAgICAgZW1pdCgnZGlzY29ubmVjdGVkJywge1xuICAgICAgICAgIHJlYXNvbjogJ2Nvbm5lY3Rpb25fbG9zdCdcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybjtcblxuICAgICAgY2FzZSBTT0NLRVRfQ09OTkVDVEVEOlxuICAgICAgICBsb2dpbihzdG9yZSk7XG4gICAgICAgIHJldHVybjtcblxuICAgICAgY2FzZSBTT0NLRVRfUkVDT1ZFUkVEOlxuICAgICAgICAvLyBkb24ndCBlbWl0IGlmIGZyb20gY29uc3VtZXIncyBwZXJzcGVjdGl2ZSB3ZSBoYXZlbid0IGJlZW4gY29ubmVjdGVkXG4gICAgICAgIGlmICghaXNDb25uZWN0ZWQoc3RvcmUuZ2V0U3RhdGUoKSkpIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBlbWl0KCdjb25uZWN0aW9uX3JlY292ZXJlZCcpO1xuICAgICAgICByZXR1cm47XG5cbiAgICAgIGNhc2UgU09DS0VUX1VOU1RBQkxFOlxuICAgICAgICAvLyBkb24ndCBlbWl0IGlmIGZyb20gY29uc3VtZXIncyBwZXJzcGVjdGl2ZSB3ZSBoYXZlbid0IGJlZW4gY29ubmVjdGVkXG4gICAgICAgIGlmICghaXNDb25uZWN0ZWQoc3RvcmUuZ2V0U3RhdGUoKSkpIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBlbWl0KCdjb25uZWN0aW9uX3Vuc3RhYmxlJyk7XG4gICAgICAgIHJldHVybjtcblxuICAgICAgY2FzZSBTVEFSVF9DT05ORUNUSU9OOlxuICAgICAgICBzb2NrZXQuY29ubmVjdCgpO1xuICAgICAgICBzdG9yZS5kaXNwYXRjaChwcmVmZXRjaFRva2VuKCkpO1xuICAgICAgICByZXR1cm47XG5cbiAgICAgIGNhc2UgVVBEQVRFX0NVU1RPTUVSX1BBR0U6XG4gICAgICAgIGlmICghaXNDb25uZWN0ZWQoc3RvcmUuZ2V0U3RhdGUoKSkpIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBzZW5kUmVxdWVzdEFjdGlvbihzdG9yZSwgc2VuZFJlcXVlc3QoVVBEQVRFX0NVU1RPTUVSX1BBR0UkMSwgYWN0aW9uLnBheWxvYWQpKS5jYXRjaChub29wKTtcbiAgICAgICAgcmV0dXJuO1xuXG4gICAgICBkZWZhdWx0OlxuICAgICAgICByZXR1cm47XG4gICAgfVxuICB9O1xufSk7XG5cbnZhciBISVNUT1JZX0VWRU5UX0NPVU5UX1RBUkdFVCA9IDI1O1xuXG52YXIgY3JlYXRlU3RhdGUgPSBmdW5jdGlvbiBjcmVhdGVTdGF0ZSgpIHtcbiAgcmV0dXJuIHtcbiAgICBzdGF0dXM6ICdpZGxlJyxcbiAgICBxdWV1ZWRUYXNrczogW10sXG4gICAgbmV4dFBhZ2VJZDogbnVsbFxuICB9O1xufTtcblxudmFyIGNyZWF0ZUNoYXRIaXN0b3J5SXRlcmF0b3IgPSBmdW5jdGlvbiBjcmVhdGVDaGF0SGlzdG9yeUl0ZXJhdG9yKHNkaywgY2hhdElkKSB7XG4gIHZhciBoaXN0b3J5U3RhdGUgPSBjcmVhdGVTdGF0ZSgpO1xuXG4gIHZhciBuZXh0ID0gZnVuY3Rpb24gbmV4dChyZXNvbHZlLCByZWplY3QpIHtcbiAgICBzd2l0Y2ggKGhpc3RvcnlTdGF0ZS5zdGF0dXMpIHtcbiAgICAgIGNhc2UgJ2lkbGUnOlxuICAgICAgICBoaXN0b3J5U3RhdGUuc3RhdHVzID0gJ2ZldGNoaW5nJztcbiAgICAgICAgc2RrLmxpc3RUaHJlYWRzKHtcbiAgICAgICAgICBjaGF0SWQ6IGNoYXRJZCxcbiAgICAgICAgICBtaW5FdmVudHNDb3VudDogSElTVE9SWV9FVkVOVF9DT1VOVF9UQVJHRVQsXG4gICAgICAgICAgcGFnZUlkOiBoaXN0b3J5U3RhdGUubmV4dFBhZ2VJZCB8fCB1bmRlZmluZWRcbiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAoX3JlZikge1xuICAgICAgICAgIHZhciB0aHJlYWRzID0gX3JlZi50aHJlYWRzLFxuICAgICAgICAgICAgICBuZXh0UGFnZUlkID0gX3JlZi5uZXh0UGFnZUlkO1xuICAgICAgICAgIGhpc3RvcnlTdGF0ZS5uZXh0UGFnZUlkID0gbmV4dFBhZ2VJZDtcblxuICAgICAgICAgIGlmICghaGlzdG9yeVN0YXRlLm5leHRQYWdlSWQpIHtcbiAgICAgICAgICAgIGhpc3RvcnlTdGF0ZS5zdGF0dXMgPSAnZG9uZSc7XG4gICAgICAgICAgICByZXNvbHZlKHtcbiAgICAgICAgICAgICAgdmFsdWU6IHtcbiAgICAgICAgICAgICAgICB0aHJlYWRzOiBbXS5jb25jYXQodGhyZWFkcykucmV2ZXJzZSgpXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIGRvbmU6IHRydWVcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBoaXN0b3J5U3RhdGUuc3RhdHVzID0gJ2lkbGUnO1xuICAgICAgICAgICAgcmVzb2x2ZSh7XG4gICAgICAgICAgICAgIHZhbHVlOiB7XG4gICAgICAgICAgICAgICAgdGhyZWFkczogW10uY29uY2F0KHRocmVhZHMpLnJldmVyc2UoKVxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBkb25lOiBmYWxzZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgdmFyIHF1ZXVlZFRhc2sgPSBoaXN0b3J5U3RhdGUucXVldWVkVGFza3Muc2hpZnQoKTtcblxuICAgICAgICAgIGlmICghcXVldWVkVGFzaykge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIG5leHQocXVldWVkVGFzay5yZXNvbHZlLCBxdWV1ZWRUYXNrLnJlamVjdCk7XG4gICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICB2YXIgcXVldWVkVGFza3MgPSBoaXN0b3J5U3RhdGUucXVldWVkVGFza3M7XG4gICAgICAgICAgaGlzdG9yeVN0YXRlLnN0YXR1cyA9ICdpZGxlJztcbiAgICAgICAgICBoaXN0b3J5U3RhdGUucXVldWVkVGFza3MgPSBbXTtcbiAgICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgICAgICBxdWV1ZWRUYXNrcy5mb3JFYWNoKGZ1bmN0aW9uIChxdWV1ZWRUYXNrKSB7XG4gICAgICAgICAgICByZXR1cm4gcXVldWVkVGFzay5yZWplY3QoZXJyKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybjtcblxuICAgICAgY2FzZSAnZmV0Y2hpbmcnOlxuICAgICAgICBoaXN0b3J5U3RhdGUucXVldWVkVGFza3MucHVzaCh7XG4gICAgICAgICAgcmVzb2x2ZTogcmVzb2x2ZSxcbiAgICAgICAgICByZWplY3Q6IHJlamVjdFxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuO1xuXG4gICAgICBjYXNlICdkb25lJzpcbiAgICAgICAgcmVzb2x2ZSh7XG4gICAgICAgICAgdmFsdWU6IHVuZGVmaW5lZCxcbiAgICAgICAgICBkb25lOiB0cnVlXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICB9O1xuXG4gIHJldHVybiB7XG4gICAgbmV4dDogZnVuY3Rpb24gKF9uZXh0KSB7XG4gICAgICBmdW5jdGlvbiBuZXh0KCkge1xuICAgICAgICByZXR1cm4gX25leHQuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgIH1cblxuICAgICAgbmV4dC50b1N0cmluZyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIF9uZXh0LnRvU3RyaW5nKCk7XG4gICAgICB9O1xuXG4gICAgICByZXR1cm4gbmV4dDtcbiAgICB9KGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShuZXh0KTtcbiAgICB9KVxuICB9O1xufTtcblxudmFyIGluaXRpYWxpemUgPSBmdW5jdGlvbiBpbml0aWFsaXplKHN0b3JlLCBlbWl0dGVyKSB7XG4gIHZhciBzdGF0ZSA9IHN0b3JlLmdldFN0YXRlKCk7XG4gIHZhciB1cmwgPSBnZXRTZXJ2ZXJVcmwoc3RhdGUpICsgXCIvcnRtL3Nqc1wiO1xuICByZXR1cm4gY3JlYXRlUGxhdGZvcm1DbGllbnQodXJsLCB7XG4gICAgcXVlcnk6IHtcbiAgICAgIGxpY2Vuc2VfaWQ6IHN0YXRlLmxpY2Vuc2VJZFxuICAgIH0sXG4gICAgZW1pdHRlcjogZW1pdHRlclxuICB9KTtcbn07XG5cbnZhciBjcmVhdGVTb2NrZXRDbGllbnQgPSBmdW5jdGlvbiBjcmVhdGVTb2NrZXRDbGllbnQoc3RvcmUpIHtcbiAgdmFyIGVtaXR0ZXIgPSBtaXR0KCk7XG4gIHZhciBjbGllbnQgPSBpbml0aWFsaXplKHN0b3JlLCBlbWl0dGVyKTtcbiAgcmV0dXJuIF9leHRlbmRzKHt9LCBPYmplY3Qua2V5cyhjbGllbnQpLnJlZHVjZShmdW5jdGlvbiAocHJveHksIG1ldGhvZCkge1xuICAgIHByb3h5W21ldGhvZF0gPSBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgX2NsaWVudDtcblxuICAgICAgcmV0dXJuIChfY2xpZW50ID0gY2xpZW50KVttZXRob2RdLmFwcGx5KF9jbGllbnQsIGFyZ3VtZW50cyk7XG4gICAgfTtcblxuICAgIHJldHVybiBwcm94eTtcbiAgfSwge30pLCB7XG4gICAgcmVpbml0aWFsaXplOiBmdW5jdGlvbiByZWluaXRpYWxpemUoKSB7XG4gICAgICBjbGllbnQuZGlzY29ubmVjdCgpO1xuICAgICAgY2xpZW50ID0gaW5pdGlhbGl6ZShzdG9yZSwgZW1pdHRlcik7XG4gICAgICBjbGllbnQuY29ubmVjdCgpO1xuICAgIH1cbiAgfSk7XG59O1xuXG52YXIgcGFyc2VDaGF0UHJvcGVydGllc0RlbGV0ZWRQdXNoID0gZnVuY3Rpb24gcGFyc2VDaGF0UHJvcGVydGllc0RlbGV0ZWRQdXNoKHBheWxvYWQpIHtcbiAgcmV0dXJuIHtcbiAgICBjaGF0SWQ6IHBheWxvYWQuY2hhdF9pZCxcbiAgICBwcm9wZXJ0aWVzOiBwYXlsb2FkLnByb3BlcnRpZXNcbiAgfTtcbn07XG5cbnZhciBwYXJzZUNoYXRQcm9wZXJ0aWVzVXBkYXRlZFB1c2ggPSBmdW5jdGlvbiBwYXJzZUNoYXRQcm9wZXJ0aWVzVXBkYXRlZFB1c2gocGF5bG9hZCkge1xuICByZXR1cm4ge1xuICAgIGNoYXRJZDogcGF5bG9hZC5jaGF0X2lkLFxuICAgIHByb3BlcnRpZXM6IHBheWxvYWQucHJvcGVydGllc1xuICB9O1xufTtcblxudmFyIHBhcnNlQ2hhdFRyYW5zZmVycmVkUHVzaCA9IGZ1bmN0aW9uIHBhcnNlQ2hhdFRyYW5zZmVycmVkUHVzaChwYXlsb2FkKSB7XG4gIHZhciBiYXNlUGF5bG9hZCA9IHtcbiAgICBjaGF0SWQ6IHBheWxvYWQuY2hhdF9pZCxcbiAgICB0aHJlYWRJZDogcGF5bG9hZC50aHJlYWRfaWQsXG4gICAgdHJhbnNmZXJyZWRUbzogX2V4dGVuZHMoe30sIHBheWxvYWQudHJhbnNmZXJyZWRfdG8uYWdlbnRfaWRzICYmIHtcbiAgICAgIGFnZW50SWRzOiBwYXlsb2FkLnRyYW5zZmVycmVkX3RvLmFnZW50X2lkc1xuICAgIH0sIHBheWxvYWQudHJhbnNmZXJyZWRfdG8uZ3JvdXBfaWRzICYmIHtcbiAgICAgIGdyb3VwSWRzOiBwYXlsb2FkLnRyYW5zZmVycmVkX3RvLmdyb3VwX2lkc1xuICAgIH0pLFxuICAgIHF1ZXVlOiBwYXlsb2FkLnF1ZXVlID8gcGFyc2VRdWV1ZShwYXlsb2FkLnF1ZXVlKSA6IG51bGxcbiAgfTtcblxuICBpZiAocGF5bG9hZC5yZWFzb24gPT09ICdtYW51YWwnKSB7XG4gICAgcmV0dXJuIF9leHRlbmRzKHt9LCBiYXNlUGF5bG9hZCwge1xuICAgICAgcmVhc29uOiBwYXlsb2FkLnJlYXNvbixcbiAgICAgIHJlcXVlc3RlcklkOiBwYXlsb2FkLnJlcXVlc3Rlcl9pZFxuICAgIH0pO1xuICB9XG5cbiAgcmV0dXJuIF9leHRlbmRzKHt9LCBiYXNlUGF5bG9hZCwge1xuICAgIHJlYXNvbjogcGF5bG9hZC5yZWFzb25cbiAgfSk7XG59O1xuXG52YXIgcGFyc2VDdXN0b21lclBhZ2VVcGRhdGVkUHVzaCA9IGZ1bmN0aW9uIHBhcnNlQ3VzdG9tZXJQYWdlVXBkYXRlZFB1c2gocGF5bG9hZCkge1xuICByZXR1cm4ge1xuICAgIHVybDogcGF5bG9hZC51cmwsXG4gICAgdGl0bGU6IHBheWxvYWQudGl0bGUsXG4gICAgdGltZXN0YW1wOiBwYXlsb2FkLnRpbWVzdGFtcCAqIDEwMDBcbiAgfTtcbn07XG5cbnZhciBwYXJzZUN1c3RvbWVyVXBkYXRlZFB1c2ggPSBmdW5jdGlvbiBwYXJzZUN1c3RvbWVyVXBkYXRlZFB1c2gocGF5bG9hZCkge1xuICByZXR1cm4ge1xuICAgIGN1c3RvbWVyOiBfZXh0ZW5kcyh7XG4gICAgICBpZDogcGF5bG9hZC5jdXN0b21lci5pZFxuICAgIH0sIHBhcnNlQ3VzdG9tZXJPcHRpb25hbFByb3BzKHBheWxvYWQuY3VzdG9tZXIpKVxuICB9O1xufTtcblxudmFyIHBhcnNlRXZlbnRQcm9wZXJ0aWVzRGVsZXRlZFB1c2ggPSBmdW5jdGlvbiBwYXJzZUV2ZW50UHJvcGVydGllc0RlbGV0ZWRQdXNoKHBheWxvYWQpIHtcbiAgcmV0dXJuIHtcbiAgICBjaGF0SWQ6IHBheWxvYWQuY2hhdF9pZCxcbiAgICB0aHJlYWRJZDogcGF5bG9hZC50aHJlYWRfaWQsXG4gICAgZXZlbnRJZDogcGF5bG9hZC5ldmVudF9pZCxcbiAgICBwcm9wZXJ0aWVzOiBwYXlsb2FkLnByb3BlcnRpZXNcbiAgfTtcbn07XG5cbnZhciBwYXJzZUV2ZW50UHJvcGVydGllc1VwZGF0ZWRQdXNoID0gZnVuY3Rpb24gcGFyc2VFdmVudFByb3BlcnRpZXNVcGRhdGVkUHVzaChwYXlsb2FkKSB7XG4gIHJldHVybiB7XG4gICAgY2hhdElkOiBwYXlsb2FkLmNoYXRfaWQsXG4gICAgdGhyZWFkSWQ6IHBheWxvYWQudGhyZWFkX2lkLFxuICAgIGV2ZW50SWQ6IHBheWxvYWQuZXZlbnRfaWQsXG4gICAgcHJvcGVydGllczogcGF5bG9hZC5wcm9wZXJ0aWVzXG4gIH07XG59O1xuXG52YXIgcGFyc2VFdmVudFVwZGF0ZWRQdXNoID0gZnVuY3Rpb24gcGFyc2VFdmVudFVwZGF0ZWRQdXNoKHBheWxvYWQpIHtcbiAgdmFyIHRocmVhZElkID0gcGF5bG9hZC50aHJlYWRfaWQ7XG4gIHJldHVybiB7XG4gICAgY2hhdElkOiBwYXlsb2FkLmNoYXRfaWQsXG4gICAgdGhyZWFkSWQ6IHRocmVhZElkLFxuICAgIGV2ZW50OiBwYXJzZUV2ZW50JDEodGhyZWFkSWQsIHBheWxvYWQuZXZlbnQpXG4gIH07XG59O1xuXG52YXIgcGFyc2VFdmVudHNNYXJrZWRBc1NlZW5QdXNoID0gZnVuY3Rpb24gcGFyc2VFdmVudHNNYXJrZWRBc1NlZW5QdXNoKHBheWxvYWQpIHtcbiAgcmV0dXJuIHtcbiAgICBjaGF0SWQ6IHBheWxvYWQuY2hhdF9pZCxcbiAgICB1c2VySWQ6IHBheWxvYWQudXNlcl9pZCxcbiAgICBzZWVuVXBUbzogcGF5bG9hZC5zZWVuX3VwX3RvXG4gIH07XG59O1xuXG52YXIgcGFyc2VHcmVldGluZ0FjY2VwdGVkUHVzaCA9IGZ1bmN0aW9uIHBhcnNlR3JlZXRpbmdBY2NlcHRlZFB1c2gocGF5bG9hZCkge1xuICByZXR1cm4ge1xuICAgIHVuaXF1ZUlkOiBwYXlsb2FkLnVuaXF1ZV9pZFxuICB9O1xufTtcblxudmFyIHBhcnNlR2V0Q2hhdFJlc3BvbnNlID0gZnVuY3Rpb24gcGFyc2VHZXRDaGF0UmVzcG9uc2UocGF5bG9hZCkge1xuICByZXR1cm4gcGFyc2VJbmNvbWluZ0NoYXQocGF5bG9hZCk7XG59O1xuXG52YXIgcGFyc2VJbmNvbWluZ0NoYXRQdXNoID0gZnVuY3Rpb24gcGFyc2VJbmNvbWluZ0NoYXRQdXNoKHBheWxvYWQpIHtcbiAgcmV0dXJuIHtcbiAgICBjaGF0OiBwYXJzZUluY29taW5nQ2hhdChwYXlsb2FkLmNoYXQpXG4gIH07XG59O1xuXG52YXIgcGFyc2VJbmNvbWluZ0V2ZW50UHVzaCA9IGZ1bmN0aW9uIHBhcnNlSW5jb21pbmdFdmVudFB1c2gocGF5bG9hZCkge1xuICByZXR1cm4ge1xuICAgIGNoYXRJZDogcGF5bG9hZC5jaGF0X2lkLFxuICAgIGV2ZW50OiBwYXJzZUV2ZW50JDEocGF5bG9hZC50aHJlYWRfaWQsIHBheWxvYWQuZXZlbnQpXG4gIH07XG59O1xuXG52YXIgcGFyc2VJbmNvbWluZ0dyZWV0aW5nUHVzaCA9IGZ1bmN0aW9uIHBhcnNlSW5jb21pbmdHcmVldGluZ1B1c2gocGF5bG9hZCkge1xuICByZXR1cm4gcGFyc2VHcmVldGluZyhwYXlsb2FkKTtcbn07XG5cbnZhciBwYXJzZUluY29taW5nUmljaE1lc3NhZ2VQb3N0YmFja1B1c2ggPSBmdW5jdGlvbiBwYXJzZUluY29taW5nUmljaE1lc3NhZ2VQb3N0YmFja1B1c2gocGF5bG9hZCkge1xuICByZXR1cm4ge1xuICAgIHVzZXJJZDogcGF5bG9hZC51c2VyX2lkLFxuICAgIGNoYXRJZDogcGF5bG9hZC5jaGF0X2lkLFxuICAgIHRocmVhZElkOiBwYXlsb2FkLnRocmVhZF9pZCxcbiAgICBldmVudElkOiBwYXlsb2FkLmV2ZW50X2lkLFxuICAgIHBvc3RiYWNrOiBwYXlsb2FkLnBvc3RiYWNrXG4gIH07XG59O1xuXG52YXIgcGFyc2VJbmNvbWluZ1R5cGluZ0luZGljYXRvclB1c2ggPSBmdW5jdGlvbiBwYXJzZUluY29taW5nVHlwaW5nSW5kaWNhdG9yUHVzaChwYXlsb2FkKSB7XG4gIHZhciBjaGF0SWQgPSBwYXlsb2FkLmNoYXRfaWQsXG4gICAgICB0eXBpbmdJbmRpY2F0b3IgPSBwYXlsb2FkLnR5cGluZ19pbmRpY2F0b3I7XG4gIHJldHVybiB7XG4gICAgY2hhdElkOiBjaGF0SWQsXG4gICAgdHlwaW5nSW5kaWNhdG9yOiB7XG4gICAgICBhdXRob3JJZDogdHlwaW5nSW5kaWNhdG9yLmF1dGhvcl9pZCxcbiAgICAgIGlzVHlwaW5nOiB0eXBpbmdJbmRpY2F0b3IuaXNfdHlwaW5nXG4gICAgfVxuICB9O1xufTtcblxudmFyIHBhcnNlUXVldWVQb3NpdGlvblVwZGF0ZWRQdXNoID0gZnVuY3Rpb24gcGFyc2VRdWV1ZVBvc2l0aW9uVXBkYXRlZFB1c2gocGF5bG9hZCkge1xuICByZXR1cm4ge1xuICAgIGNoYXRJZDogcGF5bG9hZC5jaGF0X2lkLFxuICAgIHRocmVhZElkOiBwYXlsb2FkLnRocmVhZF9pZCxcbiAgICBxdWV1ZTogcGFyc2VRdWV1ZVVwZGF0ZShwYXlsb2FkLnF1ZXVlKVxuICB9O1xufTtcblxudmFyIHBhcnNlVGhyZWFkUHJvcGVydGllc0RlbGV0ZWRQdXNoID0gZnVuY3Rpb24gcGFyc2VUaHJlYWRQcm9wZXJ0aWVzRGVsZXRlZFB1c2gocGF5bG9hZCkge1xuICByZXR1cm4ge1xuICAgIGNoYXRJZDogcGF5bG9hZC5jaGF0X2lkLFxuICAgIHRocmVhZElkOiBwYXlsb2FkLnRocmVhZF9pZCxcbiAgICBwcm9wZXJ0aWVzOiBwYXlsb2FkLnByb3BlcnRpZXNcbiAgfTtcbn07XG5cbnZhciBwYXJzZVRocmVhZFByb3BlcnRpZXNVcGRhdGVkUHVzaCA9IGZ1bmN0aW9uIHBhcnNlVGhyZWFkUHJvcGVydGllc1VwZGF0ZWRQdXNoKHBheWxvYWQpIHtcbiAgcmV0dXJuIHtcbiAgICBjaGF0SWQ6IHBheWxvYWQuY2hhdF9pZCxcbiAgICB0aHJlYWRJZDogcGF5bG9hZC50aHJlYWRfaWQsXG4gICAgcHJvcGVydGllczogcGF5bG9hZC5wcm9wZXJ0aWVzXG4gIH07XG59O1xuXG52YXIgcGFyc2VVc2VyQWRkZWRUb0NoYXRQdXNoID0gZnVuY3Rpb24gcGFyc2VVc2VyQWRkZWRUb0NoYXRQdXNoKHBheWxvYWQpIHtcbiAgcmV0dXJuIHtcbiAgICBjaGF0SWQ6IHBheWxvYWQuY2hhdF9pZCxcbiAgICB1c2VyOiBwYXJzZUNoYXRVc2VyKHBheWxvYWQudXNlciksXG4gICAgcHJlc2VudDogcGF5bG9hZC51c2VyLnByZXNlbnRcbiAgfTtcbn07XG5cbnZhciBwYXJzZVVzZXJSZW1vdmVkRnJvbUNoYXRQdXNoID0gZnVuY3Rpb24gcGFyc2VVc2VyUmVtb3ZlZEZyb21DaGF0UHVzaChwYXlsb2FkKSB7XG4gIHJldHVybiB7XG4gICAgY2hhdElkOiBwYXlsb2FkLmNoYXRfaWQsXG4gICAgdXNlcklkOiBwYXlsb2FkLnVzZXJfaWRcbiAgfTtcbn07XG5cbnZhciBwYXJzZUZpZWxkcyA9IGZ1bmN0aW9uIHBhcnNlRmllbGRzKGZpZWxkcykge1xuICByZXR1cm4gZmllbGRzLm1hcChmdW5jdGlvbiAoZmllbGQpIHtcbiAgICBzd2l0Y2ggKGZpZWxkLnR5cGUpIHtcbiAgICAgIGNhc2UgJ2dyb3VwX2Nob29zZXInOlxuICAgICAgICByZXR1cm4gX2V4dGVuZHMoe30sIGZpZWxkLCB7XG4gICAgICAgICAgb3B0aW9uczogZmllbGQub3B0aW9ucy5tYXAoZnVuY3Rpb24gKF9yZWYpIHtcbiAgICAgICAgICAgIHZhciBncm91cElkID0gX3JlZi5ncm91cF9pZCxcbiAgICAgICAgICAgICAgICBvcHRpb24gPSBfb2JqZWN0V2l0aG91dFByb3BlcnRpZXNMb29zZShfcmVmLCBbXCJncm91cF9pZFwiXSk7XG5cbiAgICAgICAgICAgIHJldHVybiBfZXh0ZW5kcyh7fSwgb3B0aW9uLCB7XG4gICAgICAgICAgICAgIGdyb3VwSWQ6IGdyb3VwSWRcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0pXG4gICAgICAgIH0pO1xuXG4gICAgICBjYXNlICdyYXRpbmcnOlxuICAgICAgICB7XG4gICAgICAgICAgdmFyIGNvbW1lbnRMYWJlbCA9IGZpZWxkLmNvbW1lbnRfbGFiZWwsXG4gICAgICAgICAgICAgIHBhcnNlZCA9IF9vYmplY3RXaXRob3V0UHJvcGVydGllc0xvb3NlKGZpZWxkLCBbXCJjb21tZW50X2xhYmVsXCJdKTtcblxuICAgICAgICAgIHJldHVybiBfZXh0ZW5kcyh7fSwgcGFyc2VkLCB7XG4gICAgICAgICAgICBjb21tZW50TGFiZWw6IGNvbW1lbnRMYWJlbFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHJldHVybiBmaWVsZDtcbiAgICB9XG4gIH0pO1xufTtcblxudmFyIHBhcnNlVGlja2V0Rm9ybUZpZWxkcyA9IGZ1bmN0aW9uIHBhcnNlVGlja2V0Rm9ybUZpZWxkcyhmaWVsZHMpIHtcbiAgdmFyIHdpdGhGYWtlSWRzID0gZmllbGRzLm1hcChmdW5jdGlvbiAoZmllbGQsIGluZGV4KSB7XG4gICAgcmV0dXJuIF9leHRlbmRzKHt9LCBmaWVsZCwge1xuICAgICAgaWQ6IFN0cmluZyhpbmRleClcbiAgICB9KTtcbiAgfSk7XG4gIHJldHVybiBwYXJzZUZpZWxkcyh3aXRoRmFrZUlkcyk7XG59O1xuXG52YXIgcGFyc2VHZXRGb3JtUmVzcG9uc2UgPSBmdW5jdGlvbiBwYXJzZUdldEZvcm1SZXNwb25zZShwYXlsb2FkKSB7XG4gIGlmICghcGF5bG9hZC5lbmFibGVkKSB7XG4gICAgcmV0dXJuIHBheWxvYWQ7XG4gIH1cblxuICByZXR1cm4gX2V4dGVuZHMoe30sIHBheWxvYWQsIHtcbiAgICBmb3JtOiAnaWQnIGluIHBheWxvYWQuZm9ybS5maWVsZHNbMF0gPyB7XG4gICAgICBpZDogcGF5bG9hZC5mb3JtLmlkLFxuICAgICAgZmllbGRzOiBwYXJzZUZpZWxkcyhwYXlsb2FkLmZvcm0uZmllbGRzKVxuICAgIH0gOiB7XG4gICAgICAvLyBUT0RPOiBzaG91bGQgd2UgZmFrZSBpZCBmb3IgdGhpcyBvbmU/XG4gICAgICBpZDogJ3RpY2tldCcsXG4gICAgICBmaWVsZHM6IHBhcnNlVGlja2V0Rm9ybUZpZWxkcyhwYXlsb2FkLmZvcm0uZmllbGRzKVxuICAgIH1cbiAgfSk7XG59O1xuXG52YXIgcGFyc2VHZXRVcmxJbmZvUmVzcG9uc2UgPSBmdW5jdGlvbiBwYXJzZUdldFVybEluZm9SZXNwb25zZShwYXlsb2FkKSB7XG4gIHZhciB1cmxJbmZvID0ge1xuICAgIHVybDogcGF5bG9hZC51cmxcbiAgfTtcblxuICBpZiAocGF5bG9hZC50aXRsZSkge1xuICAgIHVybEluZm8udGl0bGUgPSBwYXlsb2FkLnRpdGxlO1xuICB9XG5cbiAgaWYgKHBheWxvYWQuZGVzY3JpcHRpb24pIHtcbiAgICB1cmxJbmZvLmRlc2NyaXB0aW9uID0gcGF5bG9hZC5kZXNjcmlwdGlvbjtcbiAgfVxuXG4gIGlmIChwYXlsb2FkLmltYWdlX3VybCkge1xuICAgIHVybEluZm8uaW1hZ2VVcmwgPSBcImh0dHBzOi8vXCIgKyBwYXlsb2FkLmltYWdlX3VybDtcblxuICAgIGlmIChwYXlsb2FkLmltYWdlX3dpZHRoICYmIHBheWxvYWQuaW1hZ2VfaGVpZ2h0KSB7XG4gICAgICB1cmxJbmZvLmltYWdlV2lkdGggPSBwYXlsb2FkLmltYWdlX3dpZHRoO1xuICAgICAgdXJsSW5mby5pbWFnZUhlaWdodCA9IHBheWxvYWQuaW1hZ2VfaGVpZ2h0O1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiB1cmxJbmZvO1xufTtcblxudmFyIGdldEF2YWlsYWJpbGl0eUJhc2VkT25EeW5hbWljQ29uZmlnID0gZnVuY3Rpb24gZ2V0QXZhaWxhYmlsaXR5QmFzZWRPbkR5bmFtaWNDb25maWcoX3JlZjIpIHtcbiAgdmFyIG9ubGluZUdyb3VwcyA9IF9yZWYyLm9ubGluZV9ncm91cHNfaWRzLFxuICAgICAgY3VzdG9tZXJHcm91cHMgPSBfcmVmMi5jdXN0b21lcl9ncm91cHM7XG5cbiAgLy8gdGhpcyBtaWdodCBiZSBtaXNzaW5nIGlmIGFsbCBncm91cHMgYXJlIG9mZmxpbmVcbiAgaWYgKCFvbmxpbmVHcm91cHMpIHtcbiAgICByZXR1cm4gJ29mZmxpbmUnO1xuICB9XG5cbiAgdmFyIG1vbml0b3JpbmdHcm91cElkID0gY3VzdG9tZXJHcm91cHMubW9uaXRvcmluZy5pZDtcbiAgcmV0dXJuIGluY2x1ZGVzKG1vbml0b3JpbmdHcm91cElkLCBvbmxpbmVHcm91cHMpID8gJ29ubGluZScgOiAnb2ZmbGluZSc7XG59O1xuXG52YXIgcGFyc2VMaXN0Q2hhdHNSZXNwb25zZSA9IGZ1bmN0aW9uIHBhcnNlTGlzdENoYXRzUmVzcG9uc2UocGF5bG9hZCkge1xuICB2YXIgY2hhdHNTdW1tYXJ5ID0gcGF5bG9hZC5jaGF0c19zdW1tYXJ5Lm1hcChmdW5jdGlvbiAoX3JlZjMpIHtcbiAgICB2YXIgaWQgPSBfcmVmMy5pZCxcbiAgICAgICAgYWN0aXZlID0gX3JlZjMuYWN0aXZlLFxuICAgICAgICBhY2Nlc3MgPSBfcmVmMy5hY2Nlc3MsXG4gICAgICAgIGxhc3RUaHJlYWRDcmVhdGVkQXQgPSBfcmVmMy5sYXN0X3RocmVhZF9jcmVhdGVkX2F0LFxuICAgICAgICBsYXN0VGhyZWFkSWQgPSBfcmVmMy5sYXN0X3RocmVhZF9pZCxcbiAgICAgICAgbGFzdEV2ZW50c1BlclR5cGUgPSBfcmVmMy5sYXN0X2V2ZW50X3Blcl90eXBlLFxuICAgICAgICBfcmVmMyRwcm9wZXJ0aWVzID0gX3JlZjMucHJvcGVydGllcyxcbiAgICAgICAgcHJvcGVydGllcyA9IF9yZWYzJHByb3BlcnRpZXMgPT09IHZvaWQgMCA/IHt9IDogX3JlZjMkcHJvcGVydGllcyxcbiAgICAgICAgdXNlcnMgPSBfcmVmMy51c2VycztcbiAgICB2YXIgY2hhdFN1bW1hcnkgPSB7XG4gICAgICBpZDogaWQsXG4gICAgICBhY3RpdmU6IGFjdGl2ZSxcbiAgICAgIGFjY2VzczogcGFyc2VBY2Nlc3MoYWNjZXNzKSxcbiAgICAgIHByb3BlcnRpZXM6IHByb3BlcnRpZXMsXG4gICAgICB1c2VyczogdXNlcnMubWFwKHBhcnNlQ2hhdFVzZXIpLFxuICAgICAgbGFzdFRocmVhZElkOiBsYXN0VGhyZWFkSWQgfHwgbnVsbCxcbiAgICAgIGxhc3RUaHJlYWRDcmVhdGVkQXQ6IGxhc3RUaHJlYWRDcmVhdGVkQXQgfHwgbnVsbCxcbiAgICAgIGV2ZW50c1NlZW5VcFRvTWFwOiBnZXRFdmVudHNTZWVuVXBUb01hcCh1c2VycylcbiAgICB9O1xuXG4gICAgaWYgKCFsYXN0RXZlbnRzUGVyVHlwZSkge1xuICAgICAgcmV0dXJuIGNoYXRTdW1tYXJ5O1xuICAgIH1cblxuICAgIGNoYXRTdW1tYXJ5Lmxhc3RFdmVudHNQZXJUeXBlID0gbWFwVmFsdWVzKGZ1bmN0aW9uIChsYXN0RXZlbnRQZXJUeXBlKSB7XG4gICAgICByZXR1cm4gcGFyc2VFdmVudCQxKGxhc3RFdmVudFBlclR5cGUudGhyZWFkX2lkLCBsYXN0RXZlbnRQZXJUeXBlLmV2ZW50KTtcbiAgICB9LCBsYXN0RXZlbnRzUGVyVHlwZSk7XG4gICAgdmFyIHJlZmluZWRMYXN0RXZlbnRzUGVyVHlwZSA9IGxhc3RFdmVudHNQZXJUeXBlO1xuICAgIHZhciBsYXN0RXZlbnRTdW1tYXJpZXNBcnJheSA9IE9iamVjdC5rZXlzKHJlZmluZWRMYXN0RXZlbnRzUGVyVHlwZSkubWFwKGZ1bmN0aW9uIChldmVudFR5cGUpIHtcbiAgICAgIHJldHVybiByZWZpbmVkTGFzdEV2ZW50c1BlclR5cGVbZXZlbnRUeXBlXTtcbiAgICB9KTtcbiAgICB2YXIgbGFzdEV2ZW50U3VtbWFyeSA9IGxhc3QobGFzdEV2ZW50U3VtbWFyaWVzQXJyYXkuc29ydChmdW5jdGlvbiAoZXZlbnRTdW1tYXJ5QSwgZXZlbnRTdW1tYXJ5Qikge1xuICAgICAgcmV0dXJuIGV2ZW50U3VtbWFyeUEudGhyZWFkX2lkID09PSBldmVudFN1bW1hcnlCLnRocmVhZF9pZCA/IHN0cmluZ0NvbXBhcmUoZXZlbnRTdW1tYXJ5QS5ldmVudC5jcmVhdGVkX2F0LCBldmVudFN1bW1hcnlCLmV2ZW50LmNyZWF0ZWRfYXQpIDogc3RyaW5nQ29tcGFyZShldmVudFN1bW1hcnlBLnRocmVhZF9jcmVhdGVkX2F0LCBldmVudFN1bW1hcnlCLnRocmVhZF9jcmVhdGVkX2F0KTtcbiAgICB9KSk7XG5cbiAgICBpZiAobGFzdEV2ZW50U3VtbWFyeSkge1xuICAgICAgY2hhdFN1bW1hcnkubGFzdEV2ZW50ID0gY2hhdFN1bW1hcnkubGFzdEV2ZW50c1BlclR5cGVbbGFzdEV2ZW50U3VtbWFyeS5ldmVudC50eXBlXTtcbiAgICB9XG5cbiAgICByZXR1cm4gY2hhdFN1bW1hcnk7XG4gIH0pO1xuICByZXR1cm4ge1xuICAgIGNoYXRzU3VtbWFyeTogbnVtZXJpY1NvcnRCeShmdW5jdGlvbiAoX3JlZjQpIHtcbiAgICAgIHZhciBsYXN0RXZlbnQgPSBfcmVmNC5sYXN0RXZlbnQsXG4gICAgICAgICAgb3JkZXIgPSBfcmVmNC5vcmRlcjtcbiAgICAgIHJldHVybiAtMSAqIChsYXN0RXZlbnQgIT09IHVuZGVmaW5lZCA/IGxhc3RFdmVudC50aW1lc3RhbXAgOiBvcmRlcik7XG4gICAgfSwgY2hhdHNTdW1tYXJ5KSxcbiAgICB0b3RhbENoYXRzOiBwYXlsb2FkLnRvdGFsX2NoYXRzLFxuICAgIHVzZXJzOiB1bmlxQnkoZnVuY3Rpb24gKHVzZXIpIHtcbiAgICAgIHJldHVybiB1c2VyLmlkO1xuICAgIH0sIGZsYXRNYXAoZnVuY3Rpb24gKHN1bW1hcnkpIHtcbiAgICAgIHJldHVybiBzdW1tYXJ5LnVzZXJzO1xuICAgIH0sIGNoYXRzU3VtbWFyeSkpLFxuICAgIHByZXZpb3VzUGFnZUlkOiBwYXlsb2FkLnByZXZpb3VzX3BhZ2VfaWQgfHwgbnVsbCxcbiAgICBuZXh0UGFnZUlkOiBwYXlsb2FkLm5leHRfcGFnZV9pZCB8fCBudWxsXG4gIH07XG59O1xuXG52YXIgcGFyc2VMaXN0R3JvdXBTdGF0dXNlc1Jlc3BvbnNlID0gZnVuY3Rpb24gcGFyc2VMaXN0R3JvdXBTdGF0dXNlc1Jlc3BvbnNlKHBheWxvYWQpIHtcbiAgcmV0dXJuIHBheWxvYWQuZ3JvdXBzX3N0YXR1cztcbn07XG5cbnZhciBwYXJzZUxpc3RUaHJlYWRzUmVzcG9uc2UgPSBmdW5jdGlvbiBwYXJzZUxpc3RUaHJlYWRzUmVzcG9uc2UocmVxdWVzdCwgcGF5bG9hZCkge1xuICByZXR1cm4ge1xuICAgIHRocmVhZHM6IHBheWxvYWQudGhyZWFkcy5tYXAoZnVuY3Rpb24gKHRocmVhZCkge1xuICAgICAgcmV0dXJuIHBhcnNlVGhyZWFkKHJlcXVlc3QucGF5bG9hZC5jaGF0X2lkLCB0aHJlYWQpO1xuICAgIH0pLFxuICAgIHByZXZpb3VzUGFnZUlkOiBwYXlsb2FkLnByZXZpb3VzX3BhZ2VfaWQgfHwgbnVsbCxcbiAgICBuZXh0UGFnZUlkOiBwYXlsb2FkLm5leHRfcGFnZV9pZCB8fCBudWxsXG4gIH07XG59O1xuXG52YXIgcGFyc2VMb2dpblJlc3BvbnNlID0gZnVuY3Rpb24gcGFyc2VMb2dpblJlc3BvbnNlKHBheWxvYWQpIHtcbiAgdmFyIGR5bmFtaWNDb25maWcgPSBwYXlsb2FkLl9fcHJpdl9keW5hbWljX2NvbmZpZyxcbiAgICAgIGNoYXRzID0gcGF5bG9hZC5jaGF0cztcbiAgdmFyIGdyZWV0aW5nID0gcGF5bG9hZC5ncmVldGluZyB8fCBkeW5hbWljQ29uZmlnLmdyZWV0aW5nOyAvLyBUT0RPOiByZW1vdmUgdGhlIGZhbGxiYWNrIGFmdGVyIEFQSSByZWxlYXNlIHRoZSBuZXcgZ3JlZXRpbmcgb2JqZWN0IHBvc2l0aW9uIHRvIHRoZSBwcm9kIGVudlxuXG4gIHJldHVybiBfZXh0ZW5kcyh7XG4gICAgZHluYW1pY0NvbmZpZzogZHluYW1pY0NvbmZpZyxcbiAgICBjdXN0b21lcjogcGFyc2VDdXN0b21lcihwYXlsb2FkLmN1c3RvbWVyKSxcbiAgICBhdmFpbGFiaWxpdHk6IGdldEF2YWlsYWJpbGl0eUJhc2VkT25EeW5hbWljQ29uZmlnKGR5bmFtaWNDb25maWcpLFxuICAgIGNoYXRzOiBjaGF0cy5tYXAoZnVuY3Rpb24gKGNoYXQpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGlkOiBjaGF0LmNoYXRfaWQsXG4gICAgICAgIGFjdGl2ZTogJ2hhc19hY3RpdmVfdGhyZWFkJyBpbiBjaGF0ID8gY2hhdC5oYXNfYWN0aXZlX3RocmVhZCA6IC8vIHRlbXBvcmFyeSBmYWxsYmFjaywgd2FpdGluZyBmb3IgQVBJIHRvIG1vdmUgdGhpcyBmbGFnIGludG8gYGNoYXRzYCBhcnJheVxuICAgICAgICBwYXlsb2FkLmhhc19hY3RpdmVfdGhyZWFkLFxuICAgICAgICBoYXNVbnJlYWRFdmVudHM6IGNoYXQuaGFzX3VucmVhZF9ldmVudHNcbiAgICAgIH07XG4gICAgfSlcbiAgfSwgZ3JlZXRpbmcgJiYge1xuICAgIGdyZWV0aW5nOiBwYXJzZUdyZWV0aW5nKGdyZWV0aW5nKVxuICB9KTtcbn07XG5cbnZhciBwYXJzZVB1c2ggPSBmdW5jdGlvbiBwYXJzZVB1c2gocHVzaCkge1xuICBzd2l0Y2ggKHB1c2guYWN0aW9uKSB7XG4gICAgY2FzZSBDSEFUX0RFQUNUSVZBVEVEOlxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgYWN0aW9uOiBwdXNoLmFjdGlvbixcbiAgICAgICAgcGF5bG9hZDoge1xuICAgICAgICAgIGNoYXRJZDogcHVzaC5wYXlsb2FkLmNoYXRfaWRcbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgIGNhc2UgQ0hBVF9QUk9QRVJUSUVTX0RFTEVURUQ6XG4gICAgICByZXR1cm4ge1xuICAgICAgICBhY3Rpb246IHB1c2guYWN0aW9uLFxuICAgICAgICBwYXlsb2FkOiBwYXJzZUNoYXRQcm9wZXJ0aWVzRGVsZXRlZFB1c2gocHVzaC5wYXlsb2FkKVxuICAgICAgfTtcblxuICAgIGNhc2UgQ0hBVF9QUk9QRVJUSUVTX1VQREFURUQ6XG4gICAgICByZXR1cm4ge1xuICAgICAgICBhY3Rpb246IHB1c2guYWN0aW9uLFxuICAgICAgICBwYXlsb2FkOiBwYXJzZUNoYXRQcm9wZXJ0aWVzVXBkYXRlZFB1c2gocHVzaC5wYXlsb2FkKVxuICAgICAgfTtcblxuICAgIGNhc2UgQ0hBVF9UUkFOU0ZFUlJFRDpcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGFjdGlvbjogcHVzaC5hY3Rpb24sXG4gICAgICAgIHBheWxvYWQ6IHBhcnNlQ2hhdFRyYW5zZmVycmVkUHVzaChwdXNoLnBheWxvYWQpXG4gICAgICB9O1xuXG4gICAgY2FzZSBDVVNUT01FUl9TSURFX1NUT1JBR0VfVVBEQVRFRDpcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGFjdGlvbjogcHVzaC5hY3Rpb24sXG4gICAgICAgIHBheWxvYWQ6IHB1c2gucGF5bG9hZFxuICAgICAgfTtcblxuICAgIGNhc2UgQ1VTVE9NRVJfRElTQ09OTkVDVEVEOlxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgYWN0aW9uOiBwdXNoLmFjdGlvbixcbiAgICAgICAgcGF5bG9hZDogcHVzaC5wYXlsb2FkXG4gICAgICB9O1xuXG4gICAgY2FzZSBDVVNUT01FUl9QQUdFX1VQREFURUQ6XG4gICAgICByZXR1cm4ge1xuICAgICAgICBhY3Rpb246IHB1c2guYWN0aW9uLFxuICAgICAgICBwYXlsb2FkOiBwYXJzZUN1c3RvbWVyUGFnZVVwZGF0ZWRQdXNoKHB1c2gucGF5bG9hZClcbiAgICAgIH07XG5cbiAgICBjYXNlIENVU1RPTUVSX1VQREFURUQ6XG4gICAgICByZXR1cm4ge1xuICAgICAgICBhY3Rpb246IHB1c2guYWN0aW9uLFxuICAgICAgICBwYXlsb2FkOiBwYXJzZUN1c3RvbWVyVXBkYXRlZFB1c2gocHVzaC5wYXlsb2FkKVxuICAgICAgfTtcblxuICAgIGNhc2UgRVZFTlRfUFJPUEVSVElFU19ERUxFVEVEOlxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgYWN0aW9uOiBwdXNoLmFjdGlvbixcbiAgICAgICAgcGF5bG9hZDogcGFyc2VFdmVudFByb3BlcnRpZXNEZWxldGVkUHVzaChwdXNoLnBheWxvYWQpXG4gICAgICB9O1xuXG4gICAgY2FzZSBFVkVOVF9QUk9QRVJUSUVTX1VQREFURUQ6XG4gICAgICByZXR1cm4ge1xuICAgICAgICBhY3Rpb246IHB1c2guYWN0aW9uLFxuICAgICAgICBwYXlsb2FkOiBwYXJzZUV2ZW50UHJvcGVydGllc1VwZGF0ZWRQdXNoKHB1c2gucGF5bG9hZClcbiAgICAgIH07XG5cbiAgICBjYXNlIEVWRU5UX1VQREFURUQ6XG4gICAgICByZXR1cm4ge1xuICAgICAgICBhY3Rpb246IHB1c2guYWN0aW9uLFxuICAgICAgICBwYXlsb2FkOiBwYXJzZUV2ZW50VXBkYXRlZFB1c2gocHVzaC5wYXlsb2FkKVxuICAgICAgfTtcblxuICAgIGNhc2UgRVZFTlRTX01BUktFRF9BU19TRUVOOlxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgYWN0aW9uOiBwdXNoLmFjdGlvbixcbiAgICAgICAgcGF5bG9hZDogcGFyc2VFdmVudHNNYXJrZWRBc1NlZW5QdXNoKHB1c2gucGF5bG9hZClcbiAgICAgIH07XG5cbiAgICBjYXNlIEdSRUVUSU5HX0FDQ0VQVEVEOlxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgYWN0aW9uOiBwdXNoLmFjdGlvbixcbiAgICAgICAgcGF5bG9hZDogcGFyc2VHcmVldGluZ0FjY2VwdGVkUHVzaChwdXNoLnBheWxvYWQpXG4gICAgICB9O1xuXG4gICAgY2FzZSBHUkVFVElOR19DQU5DRUxFRDpcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGFjdGlvbjogcHVzaC5hY3Rpb24sXG4gICAgICAgIC8vICdncmVldGluZ19jYW5jZWxlZCcgaGFzIHRoZSBzYW1lIHBheWxvYWQgYXMgYGdyZWV0aW5nX2FjY2VwdGVkYFxuICAgICAgICBwYXlsb2FkOiBwYXJzZUdyZWV0aW5nQWNjZXB0ZWRQdXNoKHB1c2gucGF5bG9hZClcbiAgICAgIH07XG5cbiAgICBjYXNlIElOQ09NSU5HX0NIQVQ6XG4gICAgICByZXR1cm4ge1xuICAgICAgICBhY3Rpb246IHB1c2guYWN0aW9uLFxuICAgICAgICBwYXlsb2FkOiBwYXJzZUluY29taW5nQ2hhdFB1c2gocHVzaC5wYXlsb2FkKVxuICAgICAgfTtcblxuICAgIGNhc2UgSU5DT01JTkdfRVZFTlQ6XG4gICAgICByZXR1cm4ge1xuICAgICAgICBhY3Rpb246IHB1c2guYWN0aW9uLFxuICAgICAgICBwYXlsb2FkOiBwYXJzZUluY29taW5nRXZlbnRQdXNoKHB1c2gucGF5bG9hZClcbiAgICAgIH07XG5cbiAgICBjYXNlIElOQ09NSU5HX0dSRUVUSU5HOlxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgYWN0aW9uOiBwdXNoLmFjdGlvbixcbiAgICAgICAgcGF5bG9hZDogcGFyc2VJbmNvbWluZ0dyZWV0aW5nUHVzaChwdXNoLnBheWxvYWQpXG4gICAgICB9O1xuXG4gICAgY2FzZSBJTkNPTUlOR19NVUxUSUNBU1Q6XG4gICAgICByZXR1cm4ge1xuICAgICAgICBhY3Rpb246IHB1c2guYWN0aW9uLFxuICAgICAgICBwYXlsb2FkOiBwdXNoLnBheWxvYWRcbiAgICAgIH07XG5cbiAgICBjYXNlIElOQ09NSU5HX1JJQ0hfTUVTU0FHRV9QT1NUQkFDSzpcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGFjdGlvbjogcHVzaC5hY3Rpb24sXG4gICAgICAgIHBheWxvYWQ6IHBhcnNlSW5jb21pbmdSaWNoTWVzc2FnZVBvc3RiYWNrUHVzaChwdXNoLnBheWxvYWQpXG4gICAgICB9O1xuXG4gICAgY2FzZSBJTkNPTUlOR19UWVBJTkdfSU5ESUNBVE9SOlxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgYWN0aW9uOiBwdXNoLmFjdGlvbixcbiAgICAgICAgcGF5bG9hZDogcGFyc2VJbmNvbWluZ1R5cGluZ0luZGljYXRvclB1c2gocHVzaC5wYXlsb2FkKVxuICAgICAgfTtcblxuICAgIGNhc2UgUVVFVUVfUE9TSVRJT05fVVBEQVRFRDpcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGFjdGlvbjogcHVzaC5hY3Rpb24sXG4gICAgICAgIHBheWxvYWQ6IHBhcnNlUXVldWVQb3NpdGlvblVwZGF0ZWRQdXNoKHB1c2gucGF5bG9hZClcbiAgICAgIH07XG5cbiAgICBjYXNlIFRIUkVBRF9QUk9QRVJUSUVTX0RFTEVURUQ6XG4gICAgICByZXR1cm4ge1xuICAgICAgICBhY3Rpb246IHB1c2guYWN0aW9uLFxuICAgICAgICBwYXlsb2FkOiBwYXJzZVRocmVhZFByb3BlcnRpZXNEZWxldGVkUHVzaChwdXNoLnBheWxvYWQpXG4gICAgICB9O1xuXG4gICAgY2FzZSBUSFJFQURfUFJPUEVSVElFU19VUERBVEVEOlxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgYWN0aW9uOiBwdXNoLmFjdGlvbixcbiAgICAgICAgcGF5bG9hZDogcGFyc2VUaHJlYWRQcm9wZXJ0aWVzVXBkYXRlZFB1c2gocHVzaC5wYXlsb2FkKVxuICAgICAgfTtcblxuICAgIGNhc2UgVVNFUl9BRERFRF9UT19DSEFUOlxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgYWN0aW9uOiBwdXNoLmFjdGlvbixcbiAgICAgICAgcGF5bG9hZDogcGFyc2VVc2VyQWRkZWRUb0NoYXRQdXNoKHB1c2gucGF5bG9hZClcbiAgICAgIH07XG5cbiAgICBjYXNlIFVTRVJfUkVNT1ZFRF9GUk9NX0NIQVQ6XG4gICAgICByZXR1cm4ge1xuICAgICAgICBhY3Rpb246IHB1c2guYWN0aW9uLFxuICAgICAgICBwYXlsb2FkOiBwYXJzZVVzZXJSZW1vdmVkRnJvbUNoYXRQdXNoKHB1c2gucGF5bG9hZCkgLy8gVE9ETzogcmVtb3ZlIHRob3NlIG9uY2Ugd2Ugc3luYyB3aXRoIHRoZSBBUEkgb24gcHJvZFxuXG4gICAgICB9O1xuXG4gICAgY2FzZSAnY2hhdF91c2VyX2FkZGVkJzpcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGFjdGlvbjogVVNFUl9BRERFRF9UT19DSEFULFxuICAgICAgICBwYXlsb2FkOiBwYXJzZVVzZXJBZGRlZFRvQ2hhdFB1c2gocHVzaC5wYXlsb2FkKVxuICAgICAgfTtcblxuICAgIGNhc2UgJ2NoYXRfdXNlcl9yZW1vdmVkJzpcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGFjdGlvbjogVVNFUl9SRU1PVkVEX0ZST01fQ0hBVCxcbiAgICAgICAgcGF5bG9hZDogcGFyc2VVc2VyUmVtb3ZlZEZyb21DaGF0UHVzaChwdXNoLnBheWxvYWQpXG4gICAgICB9O1xuICB9XG59O1xudmFyIHBhcnNlUmVzcG9uc2UgPSBmdW5jdGlvbiBwYXJzZVJlc3BvbnNlKF9yZWY1KSB7XG4gIHZhciByZXF1ZXN0ID0gX3JlZjUucmVxdWVzdCxcbiAgICAgIHJlc3BvbnNlID0gX3JlZjUucmVzcG9uc2U7XG5cbiAgc3dpdGNoIChyZXNwb25zZS5hY3Rpb24pIHtcbiAgICBjYXNlIEFDQ0VQVF9HUkVFVElORzpcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGFjdGlvbjogcmVzcG9uc2UuYWN0aW9uLFxuICAgICAgICBwYXlsb2FkOiBTVUNDRVNTXG4gICAgICB9O1xuXG4gICAgY2FzZSBDQU5DRUxfR1JFRVRJTkc6XG4gICAgICByZXR1cm4ge1xuICAgICAgICBhY3Rpb246IHJlc3BvbnNlLmFjdGlvbixcbiAgICAgICAgcGF5bG9hZDogU1VDQ0VTU1xuICAgICAgfTtcblxuICAgIGNhc2UgREVMRVRFX0NIQVRfUFJPUEVSVElFUzpcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGFjdGlvbjogcmVzcG9uc2UuYWN0aW9uLFxuICAgICAgICBwYXlsb2FkOiBTVUNDRVNTXG4gICAgICB9O1xuXG4gICAgY2FzZSBERUxFVEVfRVZFTlRfUFJPUEVSVElFUzpcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGFjdGlvbjogcmVzcG9uc2UuYWN0aW9uLFxuICAgICAgICBwYXlsb2FkOiBTVUNDRVNTXG4gICAgICB9O1xuXG4gICAgY2FzZSBERUxFVEVfVEhSRUFEX1BST1BFUlRJRVM6XG4gICAgICByZXR1cm4ge1xuICAgICAgICBhY3Rpb246IHJlc3BvbnNlLmFjdGlvbixcbiAgICAgICAgcGF5bG9hZDogU1VDQ0VTU1xuICAgICAgfTtcblxuICAgIGNhc2UgR0VUX0NIQVQ6XG4gICAgICByZXR1cm4ge1xuICAgICAgICBhY3Rpb246IHJlc3BvbnNlLmFjdGlvbixcbiAgICAgICAgcGF5bG9hZDogcGFyc2VHZXRDaGF0UmVzcG9uc2UocmVzcG9uc2UucGF5bG9hZClcbiAgICAgIH07XG5cbiAgICBjYXNlIEdFVF9DVVNUT01FUjpcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGFjdGlvbjogcmVzcG9uc2UuYWN0aW9uLFxuICAgICAgICBwYXlsb2FkOiBwYXJzZUN1c3RvbWVyKHJlc3BvbnNlLnBheWxvYWQpXG4gICAgICB9O1xuXG4gICAgY2FzZSBHRVRfRk9STTpcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGFjdGlvbjogcmVzcG9uc2UuYWN0aW9uLFxuICAgICAgICBwYXlsb2FkOiBwYXJzZUdldEZvcm1SZXNwb25zZShyZXNwb25zZS5wYXlsb2FkKVxuICAgICAgfTtcblxuICAgIGNhc2UgR0VUX1BSRURJQ1RFRF9BR0VOVDpcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGFjdGlvbjogcmVzcG9uc2UuYWN0aW9uLFxuICAgICAgICBwYXlsb2FkOiBwYXJzZVByZWRpY3RlZEFnZW50KHJlc3BvbnNlLnBheWxvYWQpXG4gICAgICB9O1xuXG4gICAgY2FzZSBHRVRfVVJMX0lORk86XG4gICAgICByZXR1cm4ge1xuICAgICAgICBhY3Rpb246IHJlc3BvbnNlLmFjdGlvbixcbiAgICAgICAgcGF5bG9hZDogcGFyc2VHZXRVcmxJbmZvUmVzcG9uc2UocmVzcG9uc2UucGF5bG9hZClcbiAgICAgIH07XG5cbiAgICBjYXNlIExJU1RfQ0hBVFM6XG4gICAgICByZXR1cm4ge1xuICAgICAgICBhY3Rpb246IHJlc3BvbnNlLmFjdGlvbixcbiAgICAgICAgcGF5bG9hZDogcGFyc2VMaXN0Q2hhdHNSZXNwb25zZShyZXNwb25zZS5wYXlsb2FkKVxuICAgICAgfTtcblxuICAgIGNhc2UgTElTVF9HUk9VUF9TVEFUVVNFUzpcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGFjdGlvbjogcmVzcG9uc2UuYWN0aW9uLFxuICAgICAgICBwYXlsb2FkOiBwYXJzZUxpc3RHcm91cFN0YXR1c2VzUmVzcG9uc2UocmVzcG9uc2UucGF5bG9hZClcbiAgICAgIH07XG5cbiAgICBjYXNlIExJU1RfVEhSRUFEUzpcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGFjdGlvbjogcmVzcG9uc2UuYWN0aW9uLFxuICAgICAgICBwYXlsb2FkOiBwYXJzZUxpc3RUaHJlYWRzUmVzcG9uc2UocmVxdWVzdCwgcmVzcG9uc2UucGF5bG9hZClcbiAgICAgIH07XG5cbiAgICBjYXNlIExPR0lOOlxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgYWN0aW9uOiByZXNwb25zZS5hY3Rpb24sXG4gICAgICAgIHBheWxvYWQ6IHBhcnNlTG9naW5SZXNwb25zZShyZXNwb25zZS5wYXlsb2FkKVxuICAgICAgfTtcblxuICAgIGNhc2UgTUFSS19FVkVOVFNfQVNfU0VFTjpcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGFjdGlvbjogcmVzcG9uc2UuYWN0aW9uLFxuICAgICAgICBwYXlsb2FkOiBTVUNDRVNTXG4gICAgICB9O1xuXG4gICAgY2FzZSBTRU5EX1NORUFLX1BFRUs6XG4gICAgICByZXR1cm4ge1xuICAgICAgICBhY3Rpb246IHJlc3BvbnNlLmFjdGlvbixcbiAgICAgICAgcGF5bG9hZDogU1VDQ0VTU1xuICAgICAgfTtcblxuICAgIGNhc2UgU0VUX0NVU1RPTUVSX1NFU1NJT05fRklFTERTOlxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgYWN0aW9uOiByZXNwb25zZS5hY3Rpb24sXG4gICAgICAgIHBheWxvYWQ6IFNVQ0NFU1NcbiAgICAgIH07XG5cbiAgICBjYXNlIFNFTkRfUklDSF9NRVNTQUdFX1BPU1RCQUNLOlxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgYWN0aW9uOiByZXNwb25zZS5hY3Rpb24sXG4gICAgICAgIHBheWxvYWQ6IFNVQ0NFU1NcbiAgICAgIH07XG5cbiAgICBjYXNlIFVQREFURV9DSEFUX1BST1BFUlRJRVM6XG4gICAgICByZXR1cm4ge1xuICAgICAgICBhY3Rpb246IHJlc3BvbnNlLmFjdGlvbixcbiAgICAgICAgcGF5bG9hZDogU1VDQ0VTU1xuICAgICAgfTtcblxuICAgIGNhc2UgVVBEQVRFX0NVU1RPTUVSOlxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgYWN0aW9uOiByZXNwb25zZS5hY3Rpb24sXG4gICAgICAgIHBheWxvYWQ6IFNVQ0NFU1NcbiAgICAgIH07XG5cbiAgICBjYXNlIFVQREFURV9DVVNUT01FUl9QQUdFJDE6XG4gICAgICByZXR1cm4ge1xuICAgICAgICBhY3Rpb246IHJlc3BvbnNlLmFjdGlvbixcbiAgICAgICAgcGF5bG9hZDogU1VDQ0VTU1xuICAgICAgfTtcblxuICAgIGNhc2UgVVBEQVRFX0VWRU5UX1BST1BFUlRJRVM6XG4gICAgICByZXR1cm4ge1xuICAgICAgICBhY3Rpb246IHJlc3BvbnNlLmFjdGlvbixcbiAgICAgICAgcGF5bG9hZDogU1VDQ0VTU1xuICAgICAgfTtcblxuICAgIGNhc2UgVVBEQVRFX1RIUkVBRF9QUk9QRVJUSUVTOlxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgYWN0aW9uOiByZXNwb25zZS5hY3Rpb24sXG4gICAgICAgIHBheWxvYWQ6IFNVQ0NFU1NcbiAgICAgIH07XG4gIH1cbn07XG52YXIgcGFyc2VTZXJ2ZXJFcnJvciA9IGZ1bmN0aW9uIHBhcnNlU2VydmVyRXJyb3IoZXJyb3IpIHtcbiAgcmV0dXJuIHtcbiAgICBjb2RlOiBlcnJvci50eXBlLnRvVXBwZXJDYXNlKCksXG4gICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZVxuICB9O1xufTtcblxudmFyIGhhbmRsZVJlc3BvbnNlRXJyb3IgPSBmdW5jdGlvbiBoYW5kbGVSZXNwb25zZUVycm9yKF9yZWYsIHJlc3BvbnNlKSB7XG4gIHZhciBkaXNwYXRjaCA9IF9yZWYuZGlzcGF0Y2gsXG4gICAgICBnZXRTdGF0ZSA9IF9yZWYuZ2V0U3RhdGU7XG4gIHZhciByZXF1ZXN0SWQgPSByZXNwb25zZS5yZXF1ZXN0X2lkLFxuICAgICAgcGF5bG9hZCA9IHJlc3BvbnNlLnBheWxvYWQ7XG5cbiAgdmFyIF9nZXRSZXF1ZXN0ID0gZ2V0UmVxdWVzdChnZXRTdGF0ZSgpLCByZXF1ZXN0SWQpLFxuICAgICAgcmVqZWN0ID0gX2dldFJlcXVlc3QucmVqZWN0O1xuXG4gIGRpc3BhdGNoKHtcbiAgICB0eXBlOiBSRVFVRVNUX0ZBSUxFRCxcbiAgICBwYXlsb2FkOiB7XG4gICAgICBpZDogcmVxdWVzdElkLFxuICAgICAgcmVqZWN0OiByZWplY3QsXG4gICAgICBlcnJvcjogcGFyc2VTZXJ2ZXJFcnJvcihwYXlsb2FkLmVycm9yKVxuICAgIH1cbiAgfSk7XG59O1xuXG52YXIgaGFuZGxlUmVzcG9uc2UkMSA9IGZ1bmN0aW9uIGhhbmRsZVJlc3BvbnNlKF9yZWYyLCByZXNwb25zZSkge1xuICB2YXIgZGlzcGF0Y2ggPSBfcmVmMi5kaXNwYXRjaCxcbiAgICAgIGdldFN0YXRlID0gX3JlZjIuZ2V0U3RhdGU7XG4gIHZhciByZXF1ZXN0SWQgPSByZXNwb25zZS5yZXF1ZXN0X2lkO1xuXG4gIHZhciBfZ2V0UmVxdWVzdDIgPSBnZXRSZXF1ZXN0KGdldFN0YXRlKCksIHJlcXVlc3RJZCksXG4gICAgICBwcm9taXNlID0gX2dldFJlcXVlc3QyLnByb21pc2UsXG4gICAgICByZXNvbHZlID0gX2dldFJlcXVlc3QyLnJlc29sdmUsXG4gICAgICByZXF1ZXN0ID0gX2dldFJlcXVlc3QyLnJlcXVlc3Q7XG5cbiAgdmFyIHBhcnNlZFJlc3BvbnNlID0gcGFyc2VSZXNwb25zZSh7XG4gICAgcmVxdWVzdDogcmVxdWVzdCxcbiAgICByZXNwb25zZTogcmVzcG9uc2VcbiAgfSk7XG4gIGRpc3BhdGNoKHtcbiAgICB0eXBlOiBSRVNQT05TRV9SRUNFSVZFRCxcbiAgICBwYXlsb2FkOiBfZXh0ZW5kcyh7XG4gICAgICBpZDogcmVxdWVzdElkLFxuICAgICAgcHJvbWlzZTogcHJvbWlzZSxcbiAgICAgIHJlc29sdmU6IHJlc29sdmVcbiAgICB9LCBwYXJzZWRSZXNwb25zZSlcbiAgfSk7XG59O1xuXG52YXIgaGFuZGxlUHVzaFJlc3BvbnNlID0gZnVuY3Rpb24gaGFuZGxlUHVzaFJlc3BvbnNlKF9yZWYzLCByZXNwb25zZSkge1xuICB2YXIgZGlzcGF0Y2ggPSBfcmVmMy5kaXNwYXRjaCxcbiAgICAgIGdldFN0YXRlID0gX3JlZjMuZ2V0U3RhdGU7XG4gIHZhciByZXF1ZXN0SWQgPSByZXNwb25zZS5yZXF1ZXN0X2lkO1xuXG4gIHZhciBfZ2V0UmVxdWVzdDMgPSBnZXRSZXF1ZXN0KGdldFN0YXRlKCksIHJlcXVlc3RJZCksXG4gICAgICBwcm9taXNlID0gX2dldFJlcXVlc3QzLnByb21pc2UsXG4gICAgICByZXNvbHZlID0gX2dldFJlcXVlc3QzLnJlc29sdmU7XG5cbiAgdmFyIHBhcnNlZFB1c2ggPSBwYXJzZVB1c2gocmVzcG9uc2UpO1xuICBkaXNwYXRjaCh7XG4gICAgdHlwZTogUFVTSF9SRVNQT05TRV9SRUNFSVZFRCxcbiAgICBwYXlsb2FkOiBfZXh0ZW5kcyh7XG4gICAgICBpZDogcmVxdWVzdElkLFxuICAgICAgcHJvbWlzZTogcHJvbWlzZSxcbiAgICAgIHJlc29sdmU6IHJlc29sdmVcbiAgICB9LCBwYXJzZWRQdXNoKVxuICB9KTtcbn07XG5cbnZhciBoYW5kbGVQdXNoJDEgPSBmdW5jdGlvbiBoYW5kbGVQdXNoKHN0b3JlLCBwdXNoKSB7XG4gIHZhciBwYXJzZWRQdXNoID0gcGFyc2VQdXNoKHB1c2gpO1xuXG4gIGlmICghcGFyc2VkUHVzaCkge1xuICAgIC8vIGRlZmVuc2l2ZSBtZWFzdXJlIGFnYWluc3QgcmVjZWl2aW5nIHVua25vd24gcHVzaFxuICAgIHJldHVybjtcbiAgfVxuXG4gIHN0b3JlLmRpc3BhdGNoKHtcbiAgICB0eXBlOiBQVVNIX1JFQ0VJVkVELFxuICAgIHBheWxvYWQ6IHBhcnNlZFB1c2hcbiAgfSk7XG59O1xuXG52YXIgc29ja2V0TGlzdGVuZXIgPSAoZnVuY3Rpb24gKHN0b3JlLCBzb2NrZXQpIHtcbiAgdmFyIGRpc3BhdGNoID0gc3RvcmUuZGlzcGF0Y2g7XG4gIHNvY2tldC5vbignY29ubmVjdCcsIGZ1bmN0aW9uICgpIHtcbiAgICBkaXNwYXRjaCh7XG4gICAgICB0eXBlOiBTT0NLRVRfQ09OTkVDVEVEXG4gICAgfSk7XG4gIH0pO1xuICBzb2NrZXQub24oJ21lc3NhZ2UnLCBmdW5jdGlvbiAobWVzc2FnZSkge1xuICAgIGlmIChtZXNzYWdlLnR5cGUgPT09ICdyZXNwb25zZScpIHtcbiAgICAgIGlmICghbWVzc2FnZS5zdWNjZXNzKSB7XG4gICAgICAgIGhhbmRsZVJlc3BvbnNlRXJyb3Ioc3RvcmUsIG1lc3NhZ2UpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIHN3aXRjaCAobWVzc2FnZS5hY3Rpb24pIHtcbiAgICAgICAgY2FzZSBBQ1RJVkFURV9DSEFUOlxuICAgICAgICBjYXNlIERFQUNUSVZBVEVfQ0hBVDpcbiAgICAgICAgY2FzZSBTRU5EX0VWRU5UOlxuICAgICAgICBjYXNlIFNUQVJUX0NIQVQ6XG4gICAgICAgICAgLy8gdGhvc2UgYXJlIHJlcXVlc3RzIHdpdGggaW5kaXJlY3QgcmVzcG9uc2VzXG4gICAgICAgICAgcmV0dXJuO1xuXG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgaGFuZGxlUmVzcG9uc2UkMShzdG9yZSwgbWVzc2FnZSk7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmICgncmVxdWVzdF9pZCcgaW4gbWVzc2FnZSkge1xuICAgICAgc3dpdGNoIChtZXNzYWdlLmFjdGlvbikge1xuICAgICAgICBjYXNlIENIQVRfREVBQ1RJVkFURUQ6XG4gICAgICAgIGNhc2UgSU5DT01JTkdfQ0hBVDpcbiAgICAgICAgY2FzZSBJTkNPTUlOR19FVkVOVDpcbiAgICAgICAgICAvLyB0aG9zZSBhcmUgYWN0aW5nIGFzIGluZGlyZWN0IHJlc3BvbnNlc1xuICAgICAgICAgIGhhbmRsZVB1c2hSZXNwb25zZShzdG9yZSwgbWVzc2FnZSk7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgIH1cblxuICAgIGhhbmRsZVB1c2gkMShzdG9yZSwgbWVzc2FnZSk7XG4gIH0pO1xuICBzb2NrZXQub24oJ2Rpc2Nvbm5lY3QnLCBmdW5jdGlvbiAoKSB7XG4gICAgZmFpbEFsbFJlcXVlc3RzKHN0b3JlLCBDT05ORUNUSU9OX0xPU1QpO1xuXG4gICAgaWYgKGdldENvbm5lY3Rpb25TdGF0dXMoc3RvcmUuZ2V0U3RhdGUoKSkgPT09IENPTk5FQ1RFRCkge1xuICAgICAgc3RvcmUuZGlzcGF0Y2goc29ja2V0RGlzY29ubmVjdGVkKCkpO1xuICAgIH1cbiAgfSk7XG4gIHNvY2tldC5vbignY29ubmVjdGlvbl91bnN0YWJsZScsIGZ1bmN0aW9uICgpIHtcbiAgICBkaXNwYXRjaCh7XG4gICAgICB0eXBlOiBTT0NLRVRfVU5TVEFCTEVcbiAgICB9KTtcbiAgfSk7XG4gIHNvY2tldC5vbignY29ubmVjdGlvbl9yZWNvdmVyZWQnLCBmdW5jdGlvbiAoKSB7XG4gICAgZGlzcGF0Y2goe1xuICAgICAgdHlwZTogU09DS0VUX1JFQ09WRVJFRFxuICAgIH0pO1xuICB9KTtcbiAgcmV0dXJuIHNvY2tldC5vZmY7XG59KTtcblxudmFyIElOQ09SUkVDVF9SRVFVRVNURVJfU1RSVUNUVVJFID0gJ2luY29ycmVjdCByZXF1ZXN0ZXIgc3RydWN0dXJlJztcblxudmFyIGFwcGVuZFN0cmluZyA9IGZ1bmN0aW9uIGFwcGVuZFN0cmluZyhpbnB1dCwgc3RyKSB7XG4gIHJldHVybiBpbnB1dC5sZW5ndGggPyBpbnB1dCArIFwiXFxuXCIgKyBzdHIgOiBzdHI7XG59O1xuXG52YXIgY3JlYXRlVGlja2V0Qm9keSA9IGZ1bmN0aW9uIGNyZWF0ZVRpY2tldEJvZHkoc3RhdGUsIF9yZWYpIHtcbiAgdmFyIGZpZWxkcyA9IF9yZWYuZmllbGRzLFxuICAgICAgY3VzdG9tZXJJZCA9IF9yZWYuY3VzdG9tZXJJZCxcbiAgICAgIF9yZWYkZ3JvdXBJZCA9IF9yZWYuZ3JvdXBJZCxcbiAgICAgIGdyb3VwSWQgPSBfcmVmJGdyb3VwSWQgPT09IHZvaWQgMCA/IHN0YXRlLmdyb3VwSWQgOiBfcmVmJGdyb3VwSWQsXG4gICAgICB0aW1lWm9uZSA9IF9yZWYudGltZVpvbmU7XG5cbiAgdmFyIHRpY2tldEJvZHkgPSBfZXh0ZW5kcyh7XG4gICAgbGljZW5jZV9pZDogc3RhdGUubGljZW5zZUlkLFxuICAgIHRpY2tldF9tZXNzYWdlOiAnJyxcbiAgICBvZmZsaW5lX21lc3NhZ2U6ICcnLFxuICAgIHZpc2l0b3JfaWQ6IGN1c3RvbWVySWQsXG4gICAgcmVxdWVzdGVyOiB7fVxuICB9LCB0eXBlb2YgZ3JvdXBJZCA9PT0gJ251bWJlcicgJiYge1xuICAgIGdyb3VwOiBncm91cElkXG4gIH0sIHN0YXRlLnBhZ2UgJiYge1xuICAgIHNvdXJjZToge1xuICAgICAgdXJsOiBzdGF0ZS5wYWdlLnVybFxuICAgIH1cbiAgfSwgdGltZVpvbmUgJiYge1xuICAgIHRpbWV6b25lOiB0aW1lWm9uZVxuICB9KTtcblxuICByZXR1cm4gZmllbGRzLnJlZHVjZShmdW5jdGlvbiAoYm9keSwgZmllbGQpIHtcbiAgICBzd2l0Y2ggKGZpZWxkLnR5cGUpIHtcbiAgICAgIGNhc2UgJ3N1YmplY3QnOlxuICAgICAgICB7XG4gICAgICAgICAgdmFyIHZhbHVlID0gZmllbGQuYW5zd2VyO1xuICAgICAgICAgIHZhciB0ZXh0ID0gdmFsdWUgPyBmaWVsZC5sYWJlbCArIFwiIFwiICsgdmFsdWUgOiBmaWVsZC5sYWJlbDtcblxuICAgICAgICAgIGlmICh2YWx1ZSkge1xuICAgICAgICAgICAgYm9keS5zdWJqZWN0ID0gdmFsdWU7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgYm9keS5vZmZsaW5lX21lc3NhZ2UgPSBhcHBlbmRTdHJpbmcoYm9keS5vZmZsaW5lX21lc3NhZ2UsIHRleHQpO1xuICAgICAgICAgIHJldHVybiBib2R5O1xuICAgICAgICB9XG5cbiAgICAgIGNhc2UgJ25hbWUnOlxuICAgICAgICB7XG4gICAgICAgICAgdmFyIF92YWx1ZSA9IGZpZWxkLmFuc3dlcjtcblxuICAgICAgICAgIHZhciBfdGV4dCA9IF92YWx1ZSA/IGZpZWxkLmxhYmVsICsgXCIgXCIgKyBfdmFsdWUgOiBmaWVsZC5sYWJlbDtcblxuICAgICAgICAgIGlmIChfdmFsdWUpIHtcbiAgICAgICAgICAgIGJvZHkucmVxdWVzdGVyLm5hbWUgPSBfdmFsdWU7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgYm9keS5vZmZsaW5lX21lc3NhZ2UgPSBhcHBlbmRTdHJpbmcoYm9keS5vZmZsaW5lX21lc3NhZ2UsIF90ZXh0KTtcbiAgICAgICAgICByZXR1cm4gYm9keTtcbiAgICAgICAgfVxuXG4gICAgICBjYXNlICdlbWFpbCc6XG4gICAgICAgIHtcbiAgICAgICAgICB2YXIgX3ZhbHVlMiA9IGZpZWxkLmFuc3dlcjtcblxuICAgICAgICAgIHZhciBfdGV4dDIgPSBfdmFsdWUyID8gZmllbGQubGFiZWwgKyBcIiBcIiArIF92YWx1ZTIgOiBmaWVsZC5sYWJlbDtcblxuICAgICAgICAgIGJvZHkucmVxdWVzdGVyLm1haWwgPSBfdmFsdWUyO1xuICAgICAgICAgIGJvZHkub2ZmbGluZV9tZXNzYWdlID0gYXBwZW5kU3RyaW5nKGJvZHkub2ZmbGluZV9tZXNzYWdlLCBfdGV4dDIpO1xuICAgICAgICAgIHJldHVybiBib2R5O1xuICAgICAgICB9XG5cbiAgICAgIGNhc2UgJ3F1ZXN0aW9uJzpcbiAgICAgIGNhc2UgJ3RleHRhcmVhJzpcbiAgICAgICAge1xuICAgICAgICAgIHZhciBfdmFsdWUzID0gZmllbGQuYW5zd2VyO1xuXG4gICAgICAgICAgdmFyIF90ZXh0MyA9IF92YWx1ZTMgPyBmaWVsZC5sYWJlbCArIFwiIFwiICsgX3ZhbHVlMyA6IGZpZWxkLmxhYmVsO1xuXG4gICAgICAgICAgYm9keS5vZmZsaW5lX21lc3NhZ2UgPSBhcHBlbmRTdHJpbmcoYm9keS5vZmZsaW5lX21lc3NhZ2UsIF90ZXh0Myk7XG4gICAgICAgICAgYm9keS50aWNrZXRfbWVzc2FnZSA9IGFwcGVuZFN0cmluZyhib2R5LnRpY2tldF9tZXNzYWdlLCBfdGV4dDMpO1xuICAgICAgICAgIHJldHVybiBib2R5O1xuICAgICAgICB9XG5cbiAgICAgIGNhc2UgJ3JhZGlvJzpcbiAgICAgIGNhc2UgJ3NlbGVjdCc6XG4gICAgICAgIHtcbiAgICAgICAgICB2YXIgX3ZhbHVlNCA9IGZpZWxkLmFuc3dlciAmJiBmaWVsZC5hbnN3ZXIubGFiZWw7XG5cbiAgICAgICAgICB2YXIgX3RleHQ0ID0gX3ZhbHVlNCA/IGZpZWxkLmxhYmVsICsgXCIgXCIgKyBfdmFsdWU0IDogZmllbGQubGFiZWw7XG5cbiAgICAgICAgICBib2R5Lm9mZmxpbmVfbWVzc2FnZSA9IGFwcGVuZFN0cmluZyhib2R5Lm9mZmxpbmVfbWVzc2FnZSwgX3RleHQ0KTtcbiAgICAgICAgICBib2R5LnRpY2tldF9tZXNzYWdlID0gYXBwZW5kU3RyaW5nKGJvZHkudGlja2V0X21lc3NhZ2UsIF90ZXh0NCk7XG4gICAgICAgICAgcmV0dXJuIGJvZHk7XG4gICAgICAgIH1cblxuICAgICAgY2FzZSAnY2hlY2tib3gnOlxuICAgICAgICB7XG4gICAgICAgICAgdmFyIF92YWx1ZTUgPSBmaWVsZC5hbnN3ZXJzICYmIGZpZWxkLmFuc3dlcnMubWFwKGZ1bmN0aW9uIChhbnN3ZXIpIHtcbiAgICAgICAgICAgIHJldHVybiBhbnN3ZXIubGFiZWw7XG4gICAgICAgICAgfSkuam9pbignLCAnKTtcblxuICAgICAgICAgIHZhciBfdGV4dDUgPSBfdmFsdWU1ID8gZmllbGQubGFiZWwgKyBcIiBcIiArIF92YWx1ZTUgOiBmaWVsZC5sYWJlbDtcblxuICAgICAgICAgIGJvZHkub2ZmbGluZV9tZXNzYWdlID0gYXBwZW5kU3RyaW5nKGJvZHkub2ZmbGluZV9tZXNzYWdlLCBfdGV4dDUpO1xuICAgICAgICAgIGJvZHkudGlja2V0X21lc3NhZ2UgPSBhcHBlbmRTdHJpbmcoYm9keS50aWNrZXRfbWVzc2FnZSwgX3RleHQ1KTtcbiAgICAgICAgICByZXR1cm4gYm9keTtcbiAgICAgICAgfVxuXG4gICAgICBkZWZhdWx0OlxuICAgICAgICByZXR1cm4gYm9keTtcbiAgICB9XG4gIH0sIHRpY2tldEJvZHkpO1xufTtcblxudmFyIHNlbmRUaWNrZXRGb3JtID0gZnVuY3Rpb24gc2VuZFRpY2tldEZvcm0oc3RvcmUsIGF1dGgsIF9yZWYyKSB7XG4gIHZhciBmaWxsZWRGb3JtID0gX3JlZjIuZmlsbGVkRm9ybSxcbiAgICAgIGdyb3VwSWQgPSBfcmVmMi5ncm91cElkLFxuICAgICAgdGltZVpvbmUgPSBfcmVmMi50aW1lWm9uZTtcbiAgcmV0dXJuIGF1dGguZ2V0VG9rZW4oKS50aGVuKGZ1bmN0aW9uICh0b2tlbikge1xuICAgIHZhciBzdGF0ZSA9IHN0b3JlLmdldFN0YXRlKCk7XG5cbiAgICBpZiAoZ2V0U2VsZklkKHN0YXRlKSA9PT0gbnVsbCkge1xuICAgICAgc3RvcmUuZGlzcGF0Y2goc2V0U2VsZklkKHRva2VuLmVudGl0eUlkKSk7XG4gICAgfVxuXG4gICAgdmFyIHVybCA9IGdldEFwaU9yaWdpbihzdGF0ZSkgKyBcIi92Mi90aWNrZXRzL25ld1wiO1xuICAgIHZhciBib2R5ID0gY3JlYXRlVGlja2V0Qm9keShzdGF0ZSwge1xuICAgICAgZmllbGRzOiBmaWxsZWRGb3JtLmZpZWxkcyxcbiAgICAgIGN1c3RvbWVySWQ6IHRva2VuLmVudGl0eUlkLFxuICAgICAgZ3JvdXBJZDogZ3JvdXBJZCxcbiAgICAgIHRpbWVab25lOiB0aW1lWm9uZVxuICAgIH0pO1xuICAgIHJldHVybiB1bmZldGNoKHVybCwge1xuICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbidcbiAgICAgIH0sXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShib2R5KVxuICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICBpZiAocmVzcG9uc2Uub2spIHtcbiAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKS50aGVuKGZ1bmN0aW9uIChyZXMpIHtcbiAgICAgICAgICByZXR1cm4gX2V4dGVuZHMoe30sIHJlcywge1xuICAgICAgICAgICAgdGV4dDogYm9keS50aWNrZXRfbWVzc2FnZVxuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH0gLy8gd2UgYWN0dWFsbHkgc2hvdWxkIG5vcm1hbGl6ZSB0aGlzIHNvbWVob3dcblxuXG4gICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSA0MDAgfHwgcmVzcG9uc2Uuc3RhdHVzID09PSA0MjIpIHtcbiAgICAgICAgdmFyIGVyckhhbmRsZXIgPSBmdW5jdGlvbiBlcnJIYW5kbGVyKGVycm9yKSB7XG4gICAgICAgICAgaWYgKCFlcnJvciB8fCAhZXJyb3IuZXJyb3JzKSB7XG4gICAgICAgICAgICAvLyBUT0RPOiBJIGhvbmVzdGx5IGRvbid0IGtub3cgaWYgdGhpcyBjYW4gZXZlbiBiZSByZWFjaGVkIGFuZCBldmVuIGlmIGl0IGlzIC0gV2hhdCBlcnJvciBzaG91bGQgYmUgdGhyb3duIGhlcmVcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigpO1xuICAgICAgICAgIH0gLy8gd2UgcmVjZWl2ZSBzb21lIGhhcmRjb3JlIGFnZ3JlZ2F0ZSBlcnJvciBoZXJlIPCfmLFcblxuXG4gICAgICAgICAgdmFyIGZpcnN0RXJyb3IgPSBlcnJvci5lcnJvcnNbMF07XG4gICAgICAgICAgdmFyIHR5cGUgPSBPYmplY3Qua2V5cyhmaXJzdEVycm9yKVswXTtcblxuICAgICAgICAgIGlmICh0eXBlID09PSBJTkNPUlJFQ1RfUkVRVUVTVEVSX1NUUlVDVFVSRSkge1xuICAgICAgICAgICAgdGhyb3cgY3JlYXRlRXJyb3Ioe1xuICAgICAgICAgICAgICBtZXNzYWdlOiBmaXJzdEVycm9yW0lOQ09SUkVDVF9SRVFVRVNURVJfU1RSVUNUVVJFXVswXSxcbiAgICAgICAgICAgICAgY29kZTogJ1ZBTElEQVRJT04nXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoKTtcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpLnRoZW4oZXJySGFuZGxlciwgZXJySGFuZGxlcik7XG4gICAgICB9XG5cbiAgICAgIHRocm93IG5ldyBFcnJvcigpO1xuICAgIH0pO1xuICB9KTtcbn07XG5cbnZhciBLSUxPQllURSA9IDEwMjQ7XG52YXIgTUVHQUJZVEUgPSAxMDI0ICogS0lMT0JZVEU7XG52YXIgR0lHQUJZVEUgPSAxMDI0ICogTUVHQUJZVEU7XG52YXIgU0laRV9MSU1JVCA9IDEwICogTUVHQUJZVEU7XG5cbnZhciBmb3JtYXRCeXRlcyA9IGZ1bmN0aW9uIGZvcm1hdEJ5dGVzKGJ5dGVzLCBwcmVjaXNpb24pIHtcbiAgaWYgKHByZWNpc2lvbiA9PT0gdm9pZCAwKSB7XG4gICAgcHJlY2lzaW9uID0gMjtcbiAgfVxuXG4gIGlmIChieXRlcyA8IEtJTE9CWVRFKSB7XG4gICAgcmV0dXJuIGJ5dGVzICsgXCIgYlwiO1xuICB9XG5cbiAgdmFyIGtpbG9ieXRlcyA9IGJ5dGVzIC8gMTAyNDtcblxuICBpZiAoYnl0ZXMgPCBNRUdBQllURSkge1xuICAgIHJldHVybiBraWxvYnl0ZXMudG9GaXhlZChwcmVjaXNpb24pICsgXCIga2JcIjtcbiAgfVxuXG4gIHZhciBtZWdhYnl0ZXMgPSBraWxvYnl0ZXMgLyAxMDI0O1xuXG4gIGlmIChieXRlcyA8IEdJR0FCWVRFKSB7XG4gICAgcmV0dXJuIG1lZ2FieXRlcy50b0ZpeGVkKHByZWNpc2lvbikgKyBcIiBNQlwiO1xuICB9XG5cbiAgdmFyIGdpZ2FieXRlcyA9IG1lZ2FieXRlcyAvIDEwMjQ7XG4gIHJldHVybiBnaWdhYnl0ZXMudG9GaXhlZChwcmVjaXNpb24pICsgXCIgR0JcIjtcbn07XG5cbnZhciB2YWxpZGF0ZUZpbGUgPSBmdW5jdGlvbiB2YWxpZGF0ZUZpbGUoZmlsZSkge1xuICBpZiAoZmlsZS5zaXplID4gU0laRV9MSU1JVCkge1xuICAgIHRocm93IGNyZWF0ZUVycm9yKHtcbiAgICAgIG1lc3NhZ2U6IFwiVGhlIGZpbGUgaXMgdG9vIGJpZyAobWF4IHNpemUgaXMgXCIgKyBmb3JtYXRCeXRlcyhTSVpFX0xJTUlUKSArIFwiKS5cIixcbiAgICAgIGNvZGU6ICdUT09fQklHX0ZJTEUnXG4gICAgfSk7XG4gIH1cbn07XG5cbnZhciB1cGxvYWRGaWxlID0gZnVuY3Rpb24gdXBsb2FkRmlsZShfcmVmLCBfcmVmMikge1xuICB2YXIgYXV0aCA9IF9yZWYuYXV0aCxcbiAgICAgIHN0b3JlID0gX3JlZi5zdG9yZTtcbiAgdmFyIGZpbGUgPSBfcmVmMi5maWxlLFxuICAgICAgb25Qcm9ncmVzcyA9IF9yZWYyLm9uUHJvZ3Jlc3M7XG4gIHZhciB1cGxvYWQ7XG4gIHZhciBjYW5jZWxsZWQgPSBmYWxzZTtcbiAgdmFyIHNlbmQgPSBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgdmFsaWRhdGVGaWxlKGZpbGUpO1xuICAgIHZhciBzdGF0ZSA9IHN0b3JlLmdldFN0YXRlKCk7XG4gICAgdmFyIHF1ZXJ5ID0gYnVpbGRRdWVyeVN0cmluZyh7XG4gICAgICBsaWNlbnNlX2lkOiBzdGF0ZS5saWNlbnNlSWRcbiAgICB9KTtcbiAgICB2YXIgdXJsID0gZ2V0U2VydmVyVXJsKHN0YXRlKSArIFwiL2FjdGlvbi9cIiArIFVQTE9BRF9GSUxFICsgXCI/XCIgKyBxdWVyeTtcbiAgICB2YXIgcGF5bG9hZCA9IHtcbiAgICAgIGZpbGU6IGZpbGVcbiAgICB9O1xuICAgIGF1dGguZ2V0VG9rZW4oKS50aGVuKGZ1bmN0aW9uICh0b2tlbikge1xuICAgICAgaWYgKGNhbmNlbGxlZCkge1xuICAgICAgICByZWplY3QobmV3IEVycm9yKCdVcGxvYWQgY2FuY2VsbGVkLicpKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICB1cGxvYWQgPSByYXdVcGxvYWRGaWxlKHVybCwgcGF5bG9hZCwge1xuICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgQXV0aG9yaXphdGlvbjogdG9rZW4udG9rZW5UeXBlICsgXCIgXCIgKyB0b2tlbi5hY2Nlc3NUb2tlblxuICAgICAgICB9LFxuICAgICAgICBvblByb2dyZXNzOiBvblByb2dyZXNzXG4gICAgICB9KTtcbiAgICAgIHVwbG9hZC5wcm9taXNlLnRoZW4ocmVzb2x2ZSwgZnVuY3Rpb24gKHVwbG9hZEVycm9yKSB7XG4gICAgICAgIC8vIGFuIGVycm9yIG1pZ2h0IG5vdCBjb21lIGZyb20gYSBzZXJ2ZXJcbiAgICAgICAgaWYgKCF1cGxvYWRFcnJvci5yZXNwb25zZSkge1xuICAgICAgICAgIHJlamVjdCh1cGxvYWRFcnJvcik7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIF91cGxvYWRFcnJvciRyZXNwb25zZSA9IHVwbG9hZEVycm9yLnJlc3BvbnNlLmVycm9yLFxuICAgICAgICAgICAgdHlwZSA9IF91cGxvYWRFcnJvciRyZXNwb25zZS50eXBlLFxuICAgICAgICAgICAgbWVzc2FnZSA9IF91cGxvYWRFcnJvciRyZXNwb25zZS5tZXNzYWdlO1xuICAgICAgICByZWplY3QoY3JlYXRlRXJyb3Ioe1xuICAgICAgICAgIG1lc3NhZ2U6IG1lc3NhZ2UsXG4gICAgICAgICAgY29kZTogdHlwZS50b1VwcGVyQ2FzZSgpXG4gICAgICAgIH0pKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcbiAgcmV0dXJuIHtcbiAgICBwcm9taXNlOiBzZW5kLFxuICAgIGNhbmNlbDogZnVuY3Rpb24gY2FuY2VsKCkge1xuICAgICAgaWYgKGNhbmNlbGxlZCkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGNhbmNlbGxlZCA9IHRydWU7XG5cbiAgICAgIGlmICh1cGxvYWQpIHtcbiAgICAgICAgdXBsb2FkLmNhbmNlbCgpO1xuICAgICAgfVxuICAgIH1cbiAgfTtcbn07XG5cbnZhciBtYWtlR3JheWxvZ1JlcXVlc3QgPSBmdW5jdGlvbiBtYWtlR3JheWxvZ1JlcXVlc3QodXJsLCBib2R5KSB7XG4gIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSkge1xuICAgIHZhciBpbWcgPSBuZXcgSW1hZ2UoKTtcbiAgICBpbWcuc3JjID0gdXJsICsgXCI/XCIgKyBib2R5O1xuICAgIGltZy5vbmVycm9yID0gbm9vcDtcblxuICAgIGltZy5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gcmVzb2x2ZSgpO1xuICAgIH07XG4gIH0pO1xufTtcblxuLyoqXG4gKiBMb2dzIGV2ZW50IHRvIEdyYXlsb2cgd2l0aCBwcm92aWRlZCBjb25maWcgZGF0YS5cbiAqIExvZ2dpbmcgcmVxdWVzdCBpcyBmaXJlZCBvbmx5IHdoZW4gYWxsIG9mIHRob3NlIGNvbmRpdGlvbnMgYXJlIHRydWU6XG4gKiAxLiBwYWNrYWdlIGlzIHVzZWQgaW4gbGMgcHJvZHVjdGlvbiBlbnZpcm9ubWVudFxuICogMi4gcGFja2FnZSBpcyB1c2VkIHN0YW5kYWxvbmUgYmVjYXVzZSBvbmx5IHRoZW4gXCJjdXN0b21lcl9zZGtcIiB3aWxsIGJlIHNldCB0byBjdXN0b21lcl9zZGtcbiAqL1xudmFyIGxvZyA9IGZ1bmN0aW9uIGxvZyhfcmVmKSB7XG4gIHZhciBlbnYgPSBfcmVmLmVudixcbiAgICAgIGxpY2Vuc2VJZCA9IF9yZWYubGljZW5zZUlkLFxuICAgICAgZXZlbnROYW1lID0gX3JlZi5ldmVudE5hbWU7XG5cbiAgaWYgKGVudiAhPT0gJ3Byb2R1Y3Rpb24nIHx8IFwiY3VzdG9tZXJfc2RrXCIgIT09ICdjdXN0b21lcl9zZGsnKSB7XG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpO1xuICB9XG5cbiAgdmFyIG1lc3NhZ2UgPSB7XG4gICAgZXZlbnRfbmFtZTogZXZlbnROYW1lLFxuICAgIHNldmVyaXR5OiAnSW5mb3JtYXRpb25hbCcsXG4gICAgc2RrVmVyc2lvbjogXCIyLjAuNFwiXG4gIH07XG4gIHZhciBib2R5ID0ge1xuICAgIGxpY2VuY2VfaWQ6IGxpY2Vuc2VJZCxcbiAgICBldmVudF9pZDogJ2NoYXRfd2lkZ2V0X2N1c3RvbWVyX3NkaycsXG4gICAgbWVzc2FnZTogSlNPTi5zdHJpbmdpZnkobWVzc2FnZSlcbiAgfTtcbiAgcmV0dXJuIG1ha2VHcmF5bG9nUmVxdWVzdCgnaHR0cHM6Ly9xdWV1ZS5saXZlY2hhdGluYy5jb20vbG9ncycsIGJ1aWxkUXVlcnlTdHJpbmcoYm9keSkpO1xufTtcblxudmFyIExJU1RFTkVSX0lERU5USVRZID0gJ0xJU1RFTkVSX0lERU5USVRZJztcbnZhciBsaXN0ZW5lcnNNYXAgPSB7fTtcblxudmFyIGNyZWF0ZURlYnVnZ2VkTWV0aG9kcyA9IGZ1bmN0aW9uIGNyZWF0ZURlYnVnZ2VkTWV0aG9kcyhtZXRob2RzLCBwcmVmaXgpIHtcbiAgaWYgKHByZWZpeCA9PT0gdm9pZCAwKSB7XG4gICAgcHJlZml4ID0gJyc7XG4gIH1cblxuICB2YXIgbWV0aG9kTmFtZXMgPSBPYmplY3Qua2V5cyhtZXRob2RzKTtcbiAgcmV0dXJuIG1ldGhvZE5hbWVzLm1hcChmdW5jdGlvbiAobWV0aG9kTmFtZSkge1xuICAgIHZhciBtZXRob2QgPSBtZXRob2RzW21ldGhvZE5hbWVdO1xuICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgX2NvbnNvbGU7XG5cbiAgICAgIGZvciAodmFyIF9sZW4gPSBhcmd1bWVudHMubGVuZ3RoLCBhcmdzID0gbmV3IEFycmF5KF9sZW4pLCBfa2V5ID0gMDsgX2tleSA8IF9sZW47IF9rZXkrKykge1xuICAgICAgICBhcmdzW19rZXldID0gYXJndW1lbnRzW19rZXldO1xuICAgICAgfVxuXG4gICAgICAoX2NvbnNvbGUgPSBjb25zb2xlKS5pbmZvLmFwcGx5KF9jb25zb2xlLCBbcHJlZml4ICsgXCIuXCIgKyBtZXRob2ROYW1lICsgXCIoKSA9PT0+XCJdLmNvbmNhdChhcmdzKSk7XG5cbiAgICAgIHZhciByZXN1bHQgPSBtZXRob2QuYXBwbHkodm9pZCAwLCBhcmdzKTtcblxuICAgICAgaWYgKHJlc3VsdCAmJiB0eXBlb2YgcmVzdWx0LnRoZW4gPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgcmVzdWx0LnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICBjb25zb2xlLmluZm8ocHJlZml4ICsgXCIuXCIgKyBtZXRob2ROYW1lICsgXCIoKSA8PT09XCIsIGRhdGEpO1xuICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcihwcmVmaXggKyBcIi5cIiArIG1ldGhvZE5hbWUgKyBcIigpIDw9PT1cIiwgZXJyKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfTtcbiAgfSkucmVkdWNlKGZ1bmN0aW9uIChhY2MsIG1ldGhvZCwgaW5kZXgpIHtcbiAgICBhY2NbbWV0aG9kTmFtZXNbaW5kZXhdXSA9IG1ldGhvZDtcbiAgICByZXR1cm4gYWNjO1xuICB9LCB7fSk7XG59O1xuXG52YXIgY3JlYXRlRW5oYW5jZWRMaXN0ZW5lciA9IGZ1bmN0aW9uIGNyZWF0ZUVuaGFuY2VkTGlzdGVuZXIobGFiZWwsIGV2ZW50LCBsaXN0ZW5lcikge1xuICBpZiAobGlzdGVuZXJbTElTVEVORVJfSURFTlRJVFldID09PSB1bmRlZmluZWQpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobGlzdGVuZXIsIExJU1RFTkVSX0lERU5USVRZLCB7XG4gICAgICB2YWx1ZToge31cbiAgICB9KTtcbiAgfVxuXG4gIGlmIChsaXN0ZW5lcltMSVNURU5FUl9JREVOVElUWV1bZXZlbnRdKSB7XG4gICAgdmFyIGVuaGFuY2VkTGlzdGVuZXJJZCA9IGxpc3RlbmVyW0xJU1RFTkVSX0lERU5USVRZXVtldmVudF07XG4gICAgcmV0dXJuIGxpc3RlbmVyc01hcFtlbmhhbmNlZExpc3RlbmVySWRdO1xuICB9XG5cbiAgdmFyIGVuaGFuY2VkTGlzdGVuZXIgPSBmdW5jdGlvbiBlbmhhbmNlZExpc3RlbmVyKGRhdGEpIHtcbiAgICBjb25zb2xlLmluZm8oXCIuXCIgKyBsYWJlbCArIFwiKFxcXCJcIiArIGV2ZW50ICsgXCJcXFwiKSA8PT09XCIsIGRhdGEpO1xuICAgIGxpc3RlbmVyKGRhdGEpO1xuICB9O1xuXG4gIHZhciB1bmlxdWVJZCA9IGdlbmVyYXRlVW5pcXVlSWQobGlzdGVuZXJzTWFwKTtcbiAgbGlzdGVuZXJbTElTVEVORVJfSURFTlRJVFldW2V2ZW50XSA9IHVuaXF1ZUlkO1xuICBsaXN0ZW5lcnNNYXBbdW5pcXVlSWRdID0gZW5oYW5jZWRMaXN0ZW5lcjtcbiAgcmV0dXJuIGVuaGFuY2VkTGlzdGVuZXI7XG59OyAvLyBUT0RPOiB0aGlzIHJlYWxseSBzaG91bGQganVzdCBhY2NlcHQgJiByZXR1cm4gQ3VzdG9tZXJTZGsgdHlwZVxuXG5cbnZhciBkZWJ1ZyA9IChmdW5jdGlvbiAoX3Nkaykge1xuICB2YXIgc2RrID0gX3NkaztcblxuICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdwcm9kdWN0aW9uJykge1xuICAgIGNvbnNvbGUud2FybignWW91IHByb2JhYmx5IGRvIG5vdCB3YW50IHRvIHVzZSBkZWJ1ZyhjdXN0b21lclNESykgaW4geW91ciBwcm9kdWN0aW9uIGVudmlyb25tZW50LicpO1xuICB9XG5cbiAgdmFyIF9vbiA9IHNkay5vbixcbiAgICAgIF9vbmNlID0gc2RrLm9uY2UsXG4gICAgICBfb2ZmID0gc2RrLm9mZixcbiAgICAgIF9nZXRDaGF0SGlzdG9yeSA9IHNkay5nZXRDaGF0SGlzdG9yeSxcbiAgICAgIGF1dGggPSBzZGsuYXV0aCxcbiAgICAgIHJlc3QgPSBfb2JqZWN0V2l0aG91dFByb3BlcnRpZXNMb29zZShzZGssIFtcIm9uXCIsIFwib25jZVwiLCBcIm9mZlwiLCBcImdldENoYXRIaXN0b3J5XCIsIFwiYXV0aFwiXSk7XG5cbiAgdmFyIG1ldGhvZHMgPSBjcmVhdGVEZWJ1Z2dlZE1ldGhvZHMocmVzdCk7XG4gIHJldHVybiBPYmplY3QuZnJlZXplKF9leHRlbmRzKHtcbiAgICBhdXRoOiBPYmplY3QuZnJlZXplKGNyZWF0ZURlYnVnZ2VkTWV0aG9kcyhhdXRoLCAnLmF1dGgnKSlcbiAgfSwgbWV0aG9kcywge1xuICAgIGdldENoYXRIaXN0b3J5OiBmdW5jdGlvbiBnZXRDaGF0SGlzdG9yeSgpIHtcbiAgICAgIHZhciBfY29uc29sZTI7XG5cbiAgICAgIGZvciAodmFyIF9sZW4yID0gYXJndW1lbnRzLmxlbmd0aCwgYXJncyA9IG5ldyBBcnJheShfbGVuMiksIF9rZXkyID0gMDsgX2tleTIgPCBfbGVuMjsgX2tleTIrKykge1xuICAgICAgICBhcmdzW19rZXkyXSA9IGFyZ3VtZW50c1tfa2V5Ml07XG4gICAgICB9XG5cbiAgICAgIChfY29uc29sZTIgPSBjb25zb2xlKS5pbmZvLmFwcGx5KF9jb25zb2xlMiwgW1wiLmdldENoYXRIaXN0b3J5KClcIl0uY29uY2F0KGFyZ3MpKTtcblxuICAgICAgdmFyIGhpc3RvcnkgPSBfZ2V0Q2hhdEhpc3RvcnkuYXBwbHkodm9pZCAwLCBhcmdzKTtcblxuICAgICAgdmFyIGxvZ0xhYmVsID0gJ2hpc3RvcnkubmV4dCgpJztcbiAgICAgIHJldHVybiB7XG4gICAgICAgIG5leHQ6IGZ1bmN0aW9uIG5leHQoKSB7XG4gICAgICAgICAgdmFyIF9jb25zb2xlMztcblxuICAgICAgICAgIChfY29uc29sZTMgPSBjb25zb2xlKS5pbmZvLmFwcGx5KF9jb25zb2xlMywgW2xvZ0xhYmVsICsgXCIgPT09PlwiXS5jb25jYXQoYXJncykpO1xuXG4gICAgICAgICAgdmFyIHJlc3VsdCA9IGhpc3RvcnkubmV4dCgpO1xuICAgICAgICAgIHJlc3VsdC50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICB2YXIgX2NvbnNvbGU0O1xuXG4gICAgICAgICAgICAoX2NvbnNvbGU0ID0gY29uc29sZSkuaW5mby5hcHBseShfY29uc29sZTQsIFtsb2dMYWJlbCArIFwiIDw9PT1cIl0uY29uY2F0KGFyZ3MsIFtkYXRhXSkpO1xuICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgIHZhciBfY29uc29sZTU7XG5cbiAgICAgICAgICAgIChfY29uc29sZTUgPSBjb25zb2xlKS5lcnJvci5hcHBseShfY29uc29sZTUsIFtsb2dMYWJlbCArIFwiIDw9PT1cIl0uY29uY2F0KGFyZ3MsIFtlcnJdKSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICB9LFxuICAgIG9mZjogZnVuY3Rpb24gb2ZmKGV2ZW50LCBsaXN0ZW5lcikge1xuICAgICAgY29uc29sZS5pbmZvKFwiLm9mZihcXFwiXCIgKyBldmVudCArIFwiXFxcIiwgXCIgKyAobGlzdGVuZXIubmFtZSB8fCAnYW5vbnltb3VzJykgKyBcIilcIik7XG4gICAgICB2YXIgZW5oYW5jZWRMaXN0ZW5lciA9IGxpc3RlbmVyO1xuXG4gICAgICBpZiAobGlzdGVuZXJbTElTVEVORVJfSURFTlRJVFldICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgdmFyIGVuaGFuY2VkTGlzdGVuZXJJZCA9IGxpc3RlbmVyW0xJU1RFTkVSX0lERU5USVRZXVtldmVudF07XG4gICAgICAgIGVuaGFuY2VkTGlzdGVuZXIgPSBsaXN0ZW5lcnNNYXBbZW5oYW5jZWRMaXN0ZW5lcklkXTtcbiAgICAgIH1cblxuICAgICAgX29mZihldmVudCwgZW5oYW5jZWRMaXN0ZW5lcik7XG4gICAgfSxcbiAgICBvbjogZnVuY3Rpb24gb24oZXZlbnQsIGxpc3RlbmVyKSB7XG4gICAgICBfb24oZXZlbnQsIGNyZWF0ZUVuaGFuY2VkTGlzdGVuZXIoJ29uJywgZXZlbnQsIGxpc3RlbmVyKSk7XG4gICAgfSxcbiAgICBvbmNlOiBmdW5jdGlvbiBvbmNlKGV2ZW50LCBsaXN0ZW5lcikge1xuICAgICAgX29uY2UoZXZlbnQsIGNyZWF0ZUVuaGFuY2VkTGlzdGVuZXIoJ29uY2UnLCBldmVudCwgbGlzdGVuZXIpKTtcbiAgICB9XG4gIH0pKTtcbn0pO1xuXG52YXIgQ0hBVFNfUEFHSU5BVElPTl9NQVhfTElNSVQgPSAyNTtcbnZhciBpbml0ID0gZnVuY3Rpb24gaW5pdChjb25maWcsIGVudikge1xuICBpZiAoZW52ID09PSB2b2lkIDApIHtcbiAgICBlbnYgPSAncHJvZHVjdGlvbic7XG4gIH1cblxuICB2YWxpZGF0ZUNvbmZpZyhjb25maWcpO1xuXG4gIHZhciBfY29uZmlnJGF1dG9Db25uZWN0ID0gY29uZmlnLmF1dG9Db25uZWN0LFxuICAgICAgYXV0b0Nvbm5lY3QgPSBfY29uZmlnJGF1dG9Db25uZWN0ID09PSB2b2lkIDAgPyB0cnVlIDogX2NvbmZpZyRhdXRvQ29ubmVjdCxcbiAgICAgIGN1c3RvbWVyRGF0YVByb3ZpZGVyID0gY29uZmlnLmN1c3RvbWVyRGF0YVByb3ZpZGVyLFxuICAgICAgaW5zdGFuY2VDb25maWcgPSBfb2JqZWN0V2l0aG91dFByb3BlcnRpZXNMb29zZShjb25maWcsIFtcImF1dG9Db25uZWN0XCIsIFwiY3VzdG9tZXJEYXRhUHJvdmlkZXJcIl0pO1xuXG4gIHZhciBzdG9yZSA9IGZpbmFsQ3JlYXRlU3RvcmUoX2V4dGVuZHMoe30sIGluc3RhbmNlQ29uZmlnLCB7XG4gICAgZW52OiBlbnZcbiAgfSkpO1xuICB2YXIgZW1pdHRlciA9IG1pdHQoKTtcbiAgdmFyIHNvY2tldCA9IGNyZWF0ZVNvY2tldENsaWVudChzdG9yZSk7XG4gIHZhciBhdXRoID0gY3JlYXRlQXV0aChpbnN0YW5jZUNvbmZpZywgZW52KTtcbiAgc3RvcmUuYWRkU2lkZUVmZmVjdHNIYW5kbGVyKGNyZWF0ZVNpZGVFZmZlY3RzSGFuZGxlcih7XG4gICAgZW1pdHRlcjogZW1pdHRlcixcbiAgICBzb2NrZXQ6IHNvY2tldCxcbiAgICBhdXRoOiBhdXRoLFxuICAgIGN1c3RvbWVyRGF0YVByb3ZpZGVyOiBjdXN0b21lckRhdGFQcm92aWRlclxuICB9KSk7XG4gIHNvY2tldExpc3RlbmVyKHN0b3JlLCBzb2NrZXQpO1xuXG4gIHZhciBzZW5kUmVxdWVzdEFjdGlvbiQkMSA9IHNlbmRSZXF1ZXN0QWN0aW9uLmJpbmQobnVsbCwgc3RvcmUpO1xuXG4gIHZhciBzdGFydENvbm5lY3Rpb24gPSBmdW5jdGlvbiBzdGFydENvbm5lY3Rpb24oKSB7XG4gICAgc3RvcmUuZGlzcGF0Y2goe1xuICAgICAgdHlwZTogU1RBUlRfQ09OTkVDVElPTlxuICAgIH0pO1xuICB9O1xuXG4gIHZhciBhcGkgPSBPYmplY3QuZnJlZXplKHtcbiAgICBhY2NlcHRHcmVldGluZzogZnVuY3Rpb24gYWNjZXB0R3JlZXRpbmcoX3JlZikge1xuICAgICAgdmFyIGdyZWV0aW5nSWQgPSBfcmVmLmdyZWV0aW5nSWQsXG4gICAgICAgICAgdW5pcXVlSWQgPSBfcmVmLnVuaXF1ZUlkO1xuICAgICAgcmV0dXJuIHNlbmRSZXF1ZXN0QWN0aW9uJCQxKHNlbmRSZXF1ZXN0KEFDQ0VQVF9HUkVFVElORywge1xuICAgICAgICBncmVldGluZ19pZDogZ3JlZXRpbmdJZCxcbiAgICAgICAgdW5pcXVlX2lkOiB1bmlxdWVJZFxuICAgICAgfSkpO1xuICAgIH0sXG4gICAgYWN0aXZhdGVDaGF0OiBmdW5jdGlvbiBhY3RpdmF0ZUNoYXQoZGF0YSkge1xuICAgICAgbG9nKHtcbiAgICAgICAgZW52OiBlbnYsXG4gICAgICAgIGxpY2Vuc2VJZDogY29uZmlnLmxpY2Vuc2VJZCxcbiAgICAgICAgZXZlbnROYW1lOiAnY2hhdF9zdGFydGVkJ1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gc2VuZFJlcXVlc3RBY3Rpb24kJDEoc2VuZFJlcXVlc3QoQUNUSVZBVEVfQ0hBVCwgcGFyc2VBY3RpdmF0ZUNoYXREYXRhKGRhdGEpKSk7XG4gICAgfSxcbiAgICBhdXRoOiBhdXRoLFxuICAgIGNhbmNlbEdyZWV0aW5nOiBmdW5jdGlvbiBjYW5jZWxHcmVldGluZyhfcmVmMikge1xuICAgICAgdmFyIHVuaXF1ZUlkID0gX3JlZjIudW5pcXVlSWQ7XG4gICAgICByZXR1cm4gc2VuZFJlcXVlc3RBY3Rpb24kJDEoc2VuZFJlcXVlc3QoQ0FOQ0VMX0dSRUVUSU5HLCB7XG4gICAgICAgIHVuaXF1ZV9pZDogdW5pcXVlSWRcbiAgICAgIH0pKTtcbiAgICB9LFxuICAgIGNhbmNlbFJhdGU6IGZ1bmN0aW9uIGNhbmNlbFJhdGUocGFyYW1zKSB7XG4gICAgICB2YXIgY2hhdElkID0gcGFyYW1zLmNoYXRJZCxcbiAgICAgICAgICBfcGFyYW1zJHByb3BlcnRpZXMgPSBwYXJhbXMucHJvcGVydGllcyxcbiAgICAgICAgICBwcm9wZXJ0aWVzID0gX3BhcmFtcyRwcm9wZXJ0aWVzID09PSB2b2lkIDAgPyBbJ3Njb3JlJ10gOiBfcGFyYW1zJHByb3BlcnRpZXM7XG4gICAgICByZXR1cm4gYXBpLmxpc3RUaHJlYWRzKHtcbiAgICAgICAgY2hhdElkOiBjaGF0SWRcbiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKF9yZWYzKSB7XG4gICAgICAgIHZhciB0aHJlYWRzID0gX3JlZjMudGhyZWFkcztcblxuICAgICAgICBpZiAoIXRocmVhZHMubGVuZ3RoKSB7XG4gICAgICAgICAgdGhyb3cgY3JlYXRlRXJyb3Ioe1xuICAgICAgICAgICAgbWVzc2FnZTogXCJUaGVyZSBpcyBubyB0aHJlYWQgaW4gXFxcIlwiICsgY2hhdElkICsgXCJcXFwiLlwiLFxuICAgICAgICAgICAgY29kZTogTUlTU0lOR19DSEFUX1RIUkVBRFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGFwaS5kZWxldGVUaHJlYWRQcm9wZXJ0aWVzKHtcbiAgICAgICAgICBjaGF0SWQ6IGNoYXRJZCxcbiAgICAgICAgICB0aHJlYWRJZDogdGhyZWFkc1swXS5pZCxcbiAgICAgICAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgICAgICByYXRpbmc6IHByb3BlcnRpZXNcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfSxcbiAgICBjb25uZWN0OiBzdGFydENvbm5lY3Rpb24sXG4gICAgZGVhY3RpdmF0ZUNoYXQ6IGZ1bmN0aW9uIGRlYWN0aXZhdGVDaGF0KF9yZWY0KSB7XG4gICAgICB2YXIgY2hhdElkID0gX3JlZjQuY2hhdElkO1xuICAgICAgcmV0dXJuIHNlbmRSZXF1ZXN0QWN0aW9uJCQxKHNlbmRSZXF1ZXN0KERFQUNUSVZBVEVfQ0hBVCwge1xuICAgICAgICBjaGF0X2lkOiBjaGF0SWRcbiAgICAgIH0pKTtcbiAgICB9LFxuICAgIGRlbGV0ZUNoYXRQcm9wZXJ0aWVzOiBmdW5jdGlvbiBkZWxldGVDaGF0UHJvcGVydGllcyhfcmVmNSkge1xuICAgICAgdmFyIGNoYXRJZCA9IF9yZWY1LmNoYXRJZCxcbiAgICAgICAgICBwcm9wZXJ0aWVzID0gX3JlZjUucHJvcGVydGllcztcbiAgICAgIHJldHVybiBzZW5kUmVxdWVzdEFjdGlvbiQkMShzZW5kUmVxdWVzdChERUxFVEVfQ0hBVF9QUk9QRVJUSUVTLCB7XG4gICAgICAgIGNoYXRfaWQ6IGNoYXRJZCxcbiAgICAgICAgcHJvcGVydGllczogcHJvcGVydGllc1xuICAgICAgfSkpO1xuICAgIH0sXG4gICAgZGVsZXRlRXZlbnRQcm9wZXJ0aWVzOiBmdW5jdGlvbiBkZWxldGVFdmVudFByb3BlcnRpZXMoX3JlZjYpIHtcbiAgICAgIHZhciBjaGF0SWQgPSBfcmVmNi5jaGF0SWQsXG4gICAgICAgICAgdGhyZWFkSWQgPSBfcmVmNi50aHJlYWRJZCxcbiAgICAgICAgICBldmVudElkID0gX3JlZjYuZXZlbnRJZCxcbiAgICAgICAgICBwcm9wZXJ0aWVzID0gX3JlZjYucHJvcGVydGllcztcbiAgICAgIHJldHVybiBzZW5kUmVxdWVzdEFjdGlvbiQkMShzZW5kUmVxdWVzdChERUxFVEVfRVZFTlRfUFJPUEVSVElFUywge1xuICAgICAgICBjaGF0X2lkOiBjaGF0SWQsXG4gICAgICAgIHRocmVhZF9pZDogdGhyZWFkSWQsXG4gICAgICAgIGV2ZW50X2lkOiBldmVudElkLFxuICAgICAgICBwcm9wZXJ0aWVzOiBwcm9wZXJ0aWVzXG4gICAgICB9KSk7XG4gICAgfSxcbiAgICBkZWxldGVUaHJlYWRQcm9wZXJ0aWVzOiBmdW5jdGlvbiBkZWxldGVUaHJlYWRQcm9wZXJ0aWVzKF9yZWY3KSB7XG4gICAgICB2YXIgY2hhdElkID0gX3JlZjcuY2hhdElkLFxuICAgICAgICAgIHRocmVhZElkID0gX3JlZjcudGhyZWFkSWQsXG4gICAgICAgICAgcHJvcGVydGllcyA9IF9yZWY3LnByb3BlcnRpZXM7XG4gICAgICByZXR1cm4gc2VuZFJlcXVlc3RBY3Rpb24kJDEoc2VuZFJlcXVlc3QoREVMRVRFX1RIUkVBRF9QUk9QRVJUSUVTLCB7XG4gICAgICAgIGNoYXRfaWQ6IGNoYXRJZCxcbiAgICAgICAgdGhyZWFkX2lkOiB0aHJlYWRJZCxcbiAgICAgICAgcHJvcGVydGllczogcHJvcGVydGllc1xuICAgICAgfSkpO1xuICAgIH0sXG4gICAgZGVzdHJveTogZnVuY3Rpb24gZGVzdHJveSQkMSgpIHtcbiAgICAgIHN0b3JlLmRpc3BhdGNoKGRlc3Ryb3koJ21hbnVhbCcpKTtcbiAgICB9LFxuICAgIGRpc2Nvbm5lY3Q6IGZ1bmN0aW9uIGRpc2Nvbm5lY3QoKSB7XG4gICAgICBzdG9yZS5kaXNwYXRjaCh7XG4gICAgICAgIHR5cGU6IFBBVVNFX0NPTk5FQ1RJT05cbiAgICAgIH0pO1xuICAgIH0sXG4gICAgZ2V0Q2hhdDogZnVuY3Rpb24gZ2V0Q2hhdChfcmVmOCkge1xuICAgICAgdmFyIGNoYXRJZCA9IF9yZWY4LmNoYXRJZCxcbiAgICAgICAgICB0aHJlYWRJZCA9IF9yZWY4LnRocmVhZElkO1xuICAgICAgcmV0dXJuIHNlbmRSZXF1ZXN0QWN0aW9uJCQxKHNlbmRSZXF1ZXN0KEdFVF9DSEFULCB7XG4gICAgICAgIGNoYXRfaWQ6IGNoYXRJZCxcbiAgICAgICAgdGhyZWFkX2lkOiB0aHJlYWRJZFxuICAgICAgfSkpO1xuICAgIH0sXG4gICAgZ2V0Q2hhdEhpc3Rvcnk6IGZ1bmN0aW9uIGdldENoYXRIaXN0b3J5KF9yZWY5KSB7XG4gICAgICB2YXIgY2hhdElkID0gX3JlZjkuY2hhdElkO1xuICAgICAgcmV0dXJuIGNyZWF0ZUNoYXRIaXN0b3J5SXRlcmF0b3IoYXBpLCBjaGF0SWQpO1xuICAgIH0sXG4gICAgZ2V0Q3VzdG9tZXI6IGZ1bmN0aW9uIGdldEN1c3RvbWVyKCkge1xuICAgICAgcmV0dXJuIHNlbmRSZXF1ZXN0QWN0aW9uJCQxKHNlbmRSZXF1ZXN0KEdFVF9DVVNUT01FUiwge30pKTtcbiAgICB9LFxuICAgIGdldEZvcm06IGZ1bmN0aW9uIGdldEZvcm0oX3JlZjEwKSB7XG4gICAgICB2YXIgZ3JvdXBJZCA9IF9yZWYxMC5ncm91cElkLFxuICAgICAgICAgIHR5cGUgPSBfcmVmMTAudHlwZTtcbiAgICAgIHJldHVybiBzZW5kUmVxdWVzdEFjdGlvbiQkMShzZW5kUmVxdWVzdChHRVRfRk9STSwge1xuICAgICAgICBncm91cF9pZDogZ3JvdXBJZCxcbiAgICAgICAgdHlwZTogdHlwZVxuICAgICAgfSkpO1xuICAgIH0sXG4gICAgZ2V0UHJlZGljdGVkQWdlbnQ6IGZ1bmN0aW9uIGdldFByZWRpY3RlZEFnZW50KHBhcmFtcykge1xuICAgICAgaWYgKHBhcmFtcyA9PT0gdm9pZCAwKSB7XG4gICAgICAgIHBhcmFtcyA9IHt9O1xuICAgICAgfVxuXG4gICAgICB2YXIgX3BhcmFtcyA9IHBhcmFtcyxcbiAgICAgICAgICBncm91cElkID0gX3BhcmFtcy5ncm91cElkO1xuICAgICAgcmV0dXJuIHNlbmRSZXF1ZXN0QWN0aW9uJCQxKHNlbmRSZXF1ZXN0KEdFVF9QUkVESUNURURfQUdFTlQsIHR5cGVvZiBncm91cElkID09PSAnbnVtYmVyJyA/IHtcbiAgICAgICAgZ3JvdXBfaWQ6IGdyb3VwSWRcbiAgICAgIH0gOiB7fSkpO1xuICAgIH0sXG4gICAgZ2V0VXJsSW5mbzogZnVuY3Rpb24gZ2V0VXJsSW5mbyhfcmVmMTEpIHtcbiAgICAgIHZhciB1cmwgPSBfcmVmMTEudXJsO1xuICAgICAgcmV0dXJuIHNlbmRSZXF1ZXN0QWN0aW9uJCQxKHNlbmRSZXF1ZXN0KEdFVF9VUkxfSU5GTywge1xuICAgICAgICB1cmw6IHVybFxuICAgICAgfSkpO1xuICAgIH0sXG4gICAgbGlzdENoYXRzOiBmdW5jdGlvbiBsaXN0Q2hhdHMoX3RlbXApIHtcbiAgICAgIHZhciBfcmVmMTIgPSBfdGVtcCA9PT0gdm9pZCAwID8ge30gOiBfdGVtcCxcbiAgICAgICAgICBfcmVmMTIkbGltaXQgPSBfcmVmMTIubGltaXQsXG4gICAgICAgICAgbGltaXQgPSBfcmVmMTIkbGltaXQgPT09IHZvaWQgMCA/IDEwIDogX3JlZjEyJGxpbWl0LFxuICAgICAgICAgIHBhZ2VJZCA9IF9yZWYxMi5wYWdlSWQ7XG5cbiAgICAgIGlmIChsaW1pdCA+IENIQVRTX1BBR0lOQVRJT05fTUFYX0xJTUlUKSB7XG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChuZXcgRXJyb3IoXCJTcGVjaWZpZWQgbGltaXQgaXMgdG9vIGhpZ2ggKG1heCBcIiArIENIQVRTX1BBR0lOQVRJT05fTUFYX0xJTUlUICsgXCIpLlwiKSk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBzZW5kUmVxdWVzdEFjdGlvbiQkMShzZW5kUmVxdWVzdChMSVNUX0NIQVRTLCB7XG4gICAgICAgIGxpbWl0OiBsaW1pdCxcbiAgICAgICAgcGFnZV9pZDogcGFnZUlkXG4gICAgICB9KSk7XG4gICAgfSxcbiAgICBsaXN0R3JvdXBTdGF0dXNlczogZnVuY3Rpb24gbGlzdEdyb3VwU3RhdHVzZXMoX3RlbXAyKSB7XG4gICAgICB2YXIgX3JlZjEzID0gX3RlbXAyID09PSB2b2lkIDAgPyB7fSA6IF90ZW1wMixcbiAgICAgICAgICBncm91cElkcyA9IF9yZWYxMy5ncm91cElkcztcblxuICAgICAgcmV0dXJuIHNlbmRSZXF1ZXN0QWN0aW9uJCQxKHNlbmRSZXF1ZXN0KExJU1RfR1JPVVBfU1RBVFVTRVMsIGdyb3VwSWRzID8ge1xuICAgICAgICBncm91cF9pZHM6IGdyb3VwSWRzXG4gICAgICB9IDoge1xuICAgICAgICBhbGw6IHRydWVcbiAgICAgIH0pKTtcbiAgICB9LFxuICAgIGxpc3RUaHJlYWRzOiBmdW5jdGlvbiBsaXN0VGhyZWFkcyhfcmVmMTQpIHtcbiAgICAgIHZhciBjaGF0SWQgPSBfcmVmMTQuY2hhdElkLFxuICAgICAgICAgIF9yZWYxNCRzb3J0T3JkZXIgPSBfcmVmMTQuc29ydE9yZGVyLFxuICAgICAgICAgIHNvcnRPcmRlciA9IF9yZWYxNCRzb3J0T3JkZXIgPT09IHZvaWQgMCA/IERFU0MgOiBfcmVmMTQkc29ydE9yZGVyLFxuICAgICAgICAgIGxpbWl0ID0gX3JlZjE0LmxpbWl0LFxuICAgICAgICAgIHBhZ2VJZCA9IF9yZWYxNC5wYWdlSWQsXG4gICAgICAgICAgbWluRXZlbnRzQ291bnQgPSBfcmVmMTQubWluRXZlbnRzQ291bnQ7XG4gICAgICByZXR1cm4gc2VuZFJlcXVlc3RBY3Rpb24kJDEoc2VuZFJlcXVlc3QoTElTVF9USFJFQURTLCB7XG4gICAgICAgIGNoYXRfaWQ6IGNoYXRJZCxcbiAgICAgICAgc29ydF9vcmRlcjogc29ydE9yZGVyLFxuICAgICAgICBsaW1pdDogbGltaXQsXG4gICAgICAgIHBhZ2VfaWQ6IHBhZ2VJZCxcbiAgICAgICAgbWluX2V2ZW50c19jb3VudDogbWluRXZlbnRzQ291bnRcbiAgICAgIH0pKTtcbiAgICB9LFxuICAgIG1hcmtFdmVudHNBc1NlZW46IGZ1bmN0aW9uIG1hcmtFdmVudHNBc1NlZW4oX3JlZjE1KSB7XG4gICAgICB2YXIgY2hhdElkID0gX3JlZjE1LmNoYXRJZCxcbiAgICAgICAgICBzZWVuVXBUbyA9IF9yZWYxNS5zZWVuVXBUbztcbiAgICAgIHJldHVybiBzZW5kUmVxdWVzdEFjdGlvbiQkMShzZW5kUmVxdWVzdChNQVJLX0VWRU5UU19BU19TRUVOLCB7XG4gICAgICAgIGNoYXRfaWQ6IGNoYXRJZCxcbiAgICAgICAgc2Vlbl91cF90bzogc2VlblVwVG9cbiAgICAgIH0pKTtcbiAgICB9LFxuICAgIG9uOiBlbWl0dGVyLm9uLFxuICAgIG9uY2U6IGVtaXR0ZXIub25jZSxcbiAgICBvZmY6IGVtaXR0ZXIub2ZmLFxuICAgIHJhdGVDaGF0OiBmdW5jdGlvbiByYXRlQ2hhdChwYXJhbXMpIHtcbiAgICAgIHZhciBjaGF0SWQgPSBwYXJhbXMuY2hhdElkLFxuICAgICAgICAgIHJhdGluZyA9IHBhcmFtcy5yYXRpbmc7XG4gICAgICByZXR1cm4gYXBpLmxpc3RUaHJlYWRzKHtcbiAgICAgICAgY2hhdElkOiBjaGF0SWRcbiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKF9yZWYxNikge1xuICAgICAgICB2YXIgdGhyZWFkcyA9IF9yZWYxNi50aHJlYWRzO1xuXG4gICAgICAgIGlmICghdGhyZWFkcy5sZW5ndGgpIHtcbiAgICAgICAgICB0aHJvdyBjcmVhdGVFcnJvcih7XG4gICAgICAgICAgICBtZXNzYWdlOiBcIlRoZXJlIGlzIG5vIHRocmVhZCBpbiBcXFwiXCIgKyBjaGF0SWQgKyBcIlxcXCIuXCIsXG4gICAgICAgICAgICBjb2RlOiBNSVNTSU5HX0NIQVRfVEhSRUFEXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gYXBpLnVwZGF0ZVRocmVhZFByb3BlcnRpZXMoe1xuICAgICAgICAgIGNoYXRJZDogY2hhdElkLFxuICAgICAgICAgIHRocmVhZElkOiB0aHJlYWRzWzBdLmlkLFxuICAgICAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgICAgIHJhdGluZzogcmF0aW5nXG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgc2VuZEV2ZW50OiBmdW5jdGlvbiAoX3NlbmRFdmVudCkge1xuICAgICAgZnVuY3Rpb24gc2VuZEV2ZW50JCQxKF94KSB7XG4gICAgICAgIHJldHVybiBfc2VuZEV2ZW50LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICB9XG5cbiAgICAgIHNlbmRFdmVudCQkMS50b1N0cmluZyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIF9zZW5kRXZlbnQudG9TdHJpbmcoKTtcbiAgICAgIH07XG5cbiAgICAgIHJldHVybiBzZW5kRXZlbnQkJDE7XG4gICAgfShmdW5jdGlvbiAocGFyYW1zKSB7XG4gICAgICByZXR1cm4gc2VuZFJlcXVlc3RBY3Rpb24kJDEoc2VuZEV2ZW50KHBhcmFtcykpO1xuICAgIH0pLFxuICAgIHNlbmRUaWNrZXRGb3JtOiBmdW5jdGlvbiBzZW5kVGlja2V0Rm9ybSQkMShvcHRpb25zKSB7XG4gICAgICByZXR1cm4gc2VuZFRpY2tldEZvcm0oc3RvcmUsIGF1dGgsIG9wdGlvbnMpO1xuICAgIH0sXG4gICAgc2VuZFJpY2hNZXNzYWdlUG9zdGJhY2s6IGZ1bmN0aW9uIHNlbmRSaWNoTWVzc2FnZVBvc3RiYWNrKF9yZWYxNykge1xuICAgICAgdmFyIGNoYXRJZCA9IF9yZWYxNy5jaGF0SWQsXG4gICAgICAgICAgdGhyZWFkSWQgPSBfcmVmMTcudGhyZWFkSWQsXG4gICAgICAgICAgZXZlbnRJZCA9IF9yZWYxNy5ldmVudElkLFxuICAgICAgICAgIHBvc3RiYWNrID0gX3JlZjE3LnBvc3RiYWNrO1xuICAgICAgcmV0dXJuIHNlbmRSZXF1ZXN0QWN0aW9uJCQxKHNlbmRSZXF1ZXN0KFNFTkRfUklDSF9NRVNTQUdFX1BPU1RCQUNLLCB7XG4gICAgICAgIGNoYXRfaWQ6IGNoYXRJZCxcbiAgICAgICAgZXZlbnRfaWQ6IGV2ZW50SWQsXG4gICAgICAgIHRocmVhZF9pZDogdGhyZWFkSWQsXG4gICAgICAgIHBvc3RiYWNrOiBwb3N0YmFja1xuICAgICAgfSkpO1xuICAgIH0sXG4gICAgc2V0Q3VzdG9tZXJTZXNzaW9uRmllbGRzOiBmdW5jdGlvbiBzZXRDdXN0b21lclNlc3Npb25GaWVsZHMoX3JlZjE4KSB7XG4gICAgICB2YXIgc2Vzc2lvbkZpZWxkcyA9IF9yZWYxOC5zZXNzaW9uRmllbGRzO1xuICAgICAgcmV0dXJuIHNlbmRSZXF1ZXN0QWN0aW9uJCQxKHNlbmRSZXF1ZXN0KFNFVF9DVVNUT01FUl9TRVNTSU9OX0ZJRUxEUywge1xuICAgICAgICBzZXNzaW9uX2ZpZWxkczogcGFyc2VDdXN0b21lclNlc3Npb25GaWVsZHMoc2Vzc2lvbkZpZWxkcylcbiAgICAgIH0pKTtcbiAgICB9LFxuICAgIHNldFNuZWFrUGVlazogZnVuY3Rpb24gc2V0U25lYWtQZWVrKF9yZWYxOSkge1xuICAgICAgdmFyIGNoYXRJZCA9IF9yZWYxOS5jaGF0SWQsXG4gICAgICAgICAgc25lYWtQZWVrVGV4dCA9IF9yZWYxOS5zbmVha1BlZWtUZXh0O1xuICAgICAgdmFyIHN0YXRlID0gc3RvcmUuZ2V0U3RhdGUoKTtcblxuICAgICAgaWYgKCFpc0NoYXRBY3RpdmUoc3RhdGUsIGNoYXRJZCkgfHwgIWlzQ29ubmVjdGVkKHN0YXRlKSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIHNlbmRSZXF1ZXN0QWN0aW9uJCQxKHNlbmRSZXF1ZXN0KFNFTkRfU05FQUtfUEVFSywge1xuICAgICAgICBjaGF0X2lkOiBjaGF0SWQsXG4gICAgICAgIHNuZWFrX3BlZWtfdGV4dDogc25lYWtQZWVrVGV4dFxuICAgICAgfSkpLmNhdGNoKG5vb3ApO1xuICAgIH0sXG4gICAgc3RhcnRDaGF0OiBmdW5jdGlvbiBzdGFydENoYXQoZGF0YSkge1xuICAgICAgaWYgKGRhdGEgPT09IHZvaWQgMCkge1xuICAgICAgICBkYXRhID0ge307XG4gICAgICB9XG5cbiAgICAgIGxvZyh7XG4gICAgICAgIGVudjogZW52LFxuICAgICAgICBsaWNlbnNlSWQ6IGNvbmZpZy5saWNlbnNlSWQsXG4gICAgICAgIGV2ZW50TmFtZTogJ2NoYXRfc3RhcnRlZCdcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHNlbmRSZXF1ZXN0QWN0aW9uJCQxKHNlbmRSZXF1ZXN0KFNUQVJUX0NIQVQsIHBhcnNlU3RhcnRDaGF0RGF0YShkYXRhKSkpO1xuICAgIH0sXG4gICAgdXBkYXRlQ2hhdFByb3BlcnRpZXM6IGZ1bmN0aW9uIHVwZGF0ZUNoYXRQcm9wZXJ0aWVzKF9yZWYyMCkge1xuICAgICAgdmFyIGNoYXRJZCA9IF9yZWYyMC5jaGF0SWQsXG4gICAgICAgICAgcHJvcGVydGllcyA9IF9yZWYyMC5wcm9wZXJ0aWVzO1xuICAgICAgcmV0dXJuIHNlbmRSZXF1ZXN0QWN0aW9uJCQxKHNlbmRSZXF1ZXN0KFVQREFURV9DSEFUX1BST1BFUlRJRVMsIHtcbiAgICAgICAgY2hhdF9pZDogY2hhdElkLFxuICAgICAgICBwcm9wZXJ0aWVzOiBwcm9wZXJ0aWVzXG4gICAgICB9KSk7XG4gICAgfSxcbiAgICB1cGRhdGVDdXN0b21lcjogZnVuY3Rpb24gdXBkYXRlQ3VzdG9tZXIodXBkYXRlKSB7XG4gICAgICByZXR1cm4gc2VuZFJlcXVlc3RBY3Rpb24kJDEoc2VuZFJlcXVlc3QoVVBEQVRFX0NVU1RPTUVSLCBwYXJzZUN1c3RvbWVyVXBkYXRlKHVwZGF0ZSkpKTtcbiAgICB9LFxuICAgIHVwZGF0ZUN1c3RvbWVyUGFnZTogZnVuY3Rpb24gdXBkYXRlQ3VzdG9tZXJQYWdlKHBhZ2UpIHtcbiAgICAgIHN0b3JlLmRpc3BhdGNoKHtcbiAgICAgICAgdHlwZTogVVBEQVRFX0NVU1RPTUVSX1BBR0UsXG4gICAgICAgIHBheWxvYWQ6IHBpY2tPd24oWyd0aXRsZScsICd1cmwnXSwgcGFnZSlcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgdXBkYXRlRXZlbnRQcm9wZXJ0aWVzOiBmdW5jdGlvbiB1cGRhdGVFdmVudFByb3BlcnRpZXMoX3JlZjIxKSB7XG4gICAgICB2YXIgY2hhdElkID0gX3JlZjIxLmNoYXRJZCxcbiAgICAgICAgICB0aHJlYWRJZCA9IF9yZWYyMS50aHJlYWRJZCxcbiAgICAgICAgICBldmVudElkID0gX3JlZjIxLmV2ZW50SWQsXG4gICAgICAgICAgcHJvcGVydGllcyA9IF9yZWYyMS5wcm9wZXJ0aWVzO1xuICAgICAgcmV0dXJuIHNlbmRSZXF1ZXN0QWN0aW9uJCQxKHNlbmRSZXF1ZXN0KFVQREFURV9FVkVOVF9QUk9QRVJUSUVTLCB7XG4gICAgICAgIGNoYXRfaWQ6IGNoYXRJZCxcbiAgICAgICAgZXZlbnRfaWQ6IGV2ZW50SWQsXG4gICAgICAgIHRocmVhZF9pZDogdGhyZWFkSWQsXG4gICAgICAgIHByb3BlcnRpZXM6IHByb3BlcnRpZXNcbiAgICAgIH0pKTtcbiAgICB9LFxuICAgIHVwZGF0ZVRocmVhZFByb3BlcnRpZXM6IGZ1bmN0aW9uIHVwZGF0ZVRocmVhZFByb3BlcnRpZXMoX3JlZjIyKSB7XG4gICAgICB2YXIgY2hhdElkID0gX3JlZjIyLmNoYXRJZCxcbiAgICAgICAgICB0aHJlYWRJZCA9IF9yZWYyMi50aHJlYWRJZCxcbiAgICAgICAgICBwcm9wZXJ0aWVzID0gX3JlZjIyLnByb3BlcnRpZXM7XG4gICAgICByZXR1cm4gc2VuZFJlcXVlc3RBY3Rpb24kJDEoc2VuZFJlcXVlc3QoVVBEQVRFX1RIUkVBRF9QUk9QRVJUSUVTLCB7XG4gICAgICAgIGNoYXRfaWQ6IGNoYXRJZCxcbiAgICAgICAgdGhyZWFkX2lkOiB0aHJlYWRJZCxcbiAgICAgICAgcHJvcGVydGllczogcHJvcGVydGllc1xuICAgICAgfSkpO1xuICAgIH0sXG4gICAgdXBsb2FkRmlsZTogZnVuY3Rpb24gdXBsb2FkRmlsZSQkMShvcHRpb25zKSB7XG4gICAgICByZXR1cm4gdXBsb2FkRmlsZSh7XG4gICAgICAgIGF1dGg6IGF1dGgsXG4gICAgICAgIHN0b3JlOiBzdG9yZVxuICAgICAgfSwgb3B0aW9ucyk7XG4gICAgfVxuICB9KTtcblxuICBpZiAoYXV0b0Nvbm5lY3QpIHtcbiAgICBzdGFydENvbm5lY3Rpb24oKTtcbiAgfSBlbHNlIHtcbiAgICBzdG9yZS5kaXNwYXRjaCh7XG4gICAgICB0eXBlOiBDSEVDS19HT0FMUyxcbiAgICAgIHBheWxvYWQ6IHtcbiAgICAgICAgc2Vzc2lvbkZpZWxkczogdHlwZW9mIGN1c3RvbWVyRGF0YVByb3ZpZGVyID09PSAnZnVuY3Rpb24nID8gY3VzdG9tZXJEYXRhUHJvdmlkZXIoKS5zZXNzaW9uRmllbGRzIDoge31cbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIHJldHVybiBhcGk7XG59O1xuXG5leHBvcnQgeyBpbml0LCBkZWJ1ZywgcGFyc2VGaWxlLCBwYXJzZUZpbGxlZEZvcm0sIHBhcnNlTWVzc2FnZSwgcGFyc2VSaWNoTWVzc2FnZSwgcGFyc2VTeXN0ZW1NZXNzYWdlLCBwYXJzZUV2ZW50JDEgYXMgcGFyc2VFdmVudCwgcGFyc2VHcmVldGluZyB9O1xuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxlQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxlQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///../../../node_modules/@livechat/customer-sdk/dist/customer-sdk.esm.js\n");

/***/ }),

/***/ "../../../node_modules/@livechat/data-utils/dist/data-utils.es.js":
/*!************************************************************************!*\
  !*** ../../../node_modules/@livechat/data-utils/dist/data-utils.es.js ***!
  \************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"add\": () => (/* binding */ add),\n/* harmony export */   \"assign\": () => (/* binding */ assign),\n/* harmony export */   \"camelCase\": () => (/* binding */ camelCase),\n/* harmony export */   \"capitalizeFirstLetter\": () => (/* binding */ capitalizeFirstLetter),\n/* harmony export */   \"chain\": () => (/* binding */ chain),\n/* harmony export */   \"cloneDeep\": () => (/* binding */ cloneDeep),\n/* harmony export */   \"compact\": () => (/* binding */ compact),\n/* harmony export */   \"compose\": () => (/* binding */ compose),\n/* harmony export */   \"debounce\": () => (/* binding */ debounce),\n/* harmony export */   \"deepMerge\": () => (/* binding */ deepMerge),\n/* harmony export */   \"defaultTo\": () => (/* binding */ defaultTo),\n/* harmony export */   \"drop\": () => (/* binding */ drop),\n/* harmony export */   \"dropRight\": () => (/* binding */ dropRight),\n/* harmony export */   \"ensureArray\": () => (/* binding */ ensureArray),\n/* harmony export */   \"entries\": () => (/* binding */ entries),\n/* harmony export */   \"filledArray\": () => (/* binding */ filledArray),\n/* harmony export */   \"find\": () => (/* binding */ find),\n/* harmony export */   \"findIndex\": () => (/* binding */ findIndex),\n/* harmony export */   \"findKey\": () => (/* binding */ findKey),\n/* harmony export */   \"findLast\": () => (/* binding */ findLast),\n/* harmony export */   \"findLastIndex\": () => (/* binding */ findLastIndex),\n/* harmony export */   \"findLastIndexFrom\": () => (/* binding */ findLastIndexFrom),\n/* harmony export */   \"flatMap\": () => (/* binding */ flatMap),\n/* harmony export */   \"flatten\": () => (/* binding */ flatten),\n/* harmony export */   \"forOwn\": () => (/* binding */ forOwn),\n/* harmony export */   \"fromPairs\": () => (/* binding */ fromPairs),\n/* harmony export */   \"generateRandomId\": () => (/* binding */ generateRandomId),\n/* harmony export */   \"generateUniqueId\": () => (/* binding */ generateUniqueId),\n/* harmony export */   \"get\": () => (/* binding */ get),\n/* harmony export */   \"getOr\": () => (/* binding */ getOr),\n/* harmony export */   \"groupBy\": () => (/* binding */ groupBy),\n/* harmony export */   \"groupKeys\": () => (/* binding */ groupKeys),\n/* harmony export */   \"hasOwn\": () => (/* binding */ hasOwn),\n/* harmony export */   \"identity\": () => (/* binding */ identity),\n/* harmony export */   \"includes\": () => (/* binding */ includes),\n/* harmony export */   \"isArray\": () => (/* binding */ isArray),\n/* harmony export */   \"isEmpty\": () => (/* binding */ isEmpty),\n/* harmony export */   \"isFalsy\": () => (/* binding */ isFalsy),\n/* harmony export */   \"isNil\": () => (/* binding */ isNil),\n/* harmony export */   \"isObject\": () => (/* binding */ isObject),\n/* harmony export */   \"isPromise\": () => (/* binding */ isPromise),\n/* harmony export */   \"isTruthy\": () => (/* binding */ isTruthy),\n/* harmony export */   \"keyBy\": () => (/* binding */ keyBy),\n/* harmony export */   \"keys\": () => (/* binding */ keys),\n/* harmony export */   \"last\": () => (/* binding */ last),\n/* harmony export */   \"leadingThrottle\": () => (/* binding */ leadingThrottle),\n/* harmony export */   \"mapKeys\": () => (/* binding */ mapKeys),\n/* harmony export */   \"mapValues\": () => (/* binding */ mapValues),\n/* harmony export */   \"mapValuesIndexed\": () => (/* binding */ mapValuesIndexed),\n/* harmony export */   \"memoize\": () => (/* binding */ memoize),\n/* harmony export */   \"memoizeOne\": () => (/* binding */ memoizeOne),\n/* harmony export */   \"memoizeWith\": () => (/* binding */ memoizeWith),\n/* harmony export */   \"merge\": () => (/* binding */ merge),\n/* harmony export */   \"mergeAll\": () => (/* binding */ mergeAll),\n/* harmony export */   \"noop\": () => (/* binding */ noop),\n/* harmony export */   \"numericSortBy\": () => (/* binding */ numericSortBy),\n/* harmony export */   \"omit\": () => (/* binding */ omit),\n/* harmony export */   \"omitBy\": () => (/* binding */ omitBy),\n/* harmony export */   \"omitByIndexed\": () => (/* binding */ omitByIndexed),\n/* harmony export */   \"once\": () => (/* binding */ once),\n/* harmony export */   \"over\": () => (/* binding */ over),\n/* harmony export */   \"overArgs\": () => (/* binding */ overArgs),\n/* harmony export */   \"pair\": () => (/* binding */ pair),\n/* harmony export */   \"partitionObject\": () => (/* binding */ partitionObject),\n/* harmony export */   \"pick\": () => (/* binding */ pick),\n/* harmony export */   \"pickBy\": () => (/* binding */ pickBy),\n/* harmony export */   \"pickByIndexed\": () => (/* binding */ pickByIndexed),\n/* harmony export */   \"pickOwn\": () => (/* binding */ pickOwn),\n/* harmony export */   \"randomInt\": () => (/* binding */ randomInt),\n/* harmony export */   \"range\": () => (/* binding */ range),\n/* harmony export */   \"reject\": () => (/* binding */ reject),\n/* harmony export */   \"removeAt\": () => (/* binding */ removeAt),\n/* harmony export */   \"repeat\": () => (/* binding */ repeat),\n/* harmony export */   \"set\": () => (/* binding */ set),\n/* harmony export */   \"shallowEqual\": () => (/* binding */ shallowEqual),\n/* harmony export */   \"shuffle\": () => (/* binding */ shuffle),\n/* harmony export */   \"sign\": () => (/* binding */ sign),\n/* harmony export */   \"sliceDiff\": () => (/* binding */ sliceDiff),\n/* harmony export */   \"snakeCase\": () => (/* binding */ snakeCase),\n/* harmony export */   \"someAreTruthy\": () => (/* binding */ someAreTruthy),\n/* harmony export */   \"splitAt\": () => (/* binding */ splitAt),\n/* harmony export */   \"splitRightWhenAccum\": () => (/* binding */ splitRightWhenAccum),\n/* harmony export */   \"spread\": () => (/* binding */ spread),\n/* harmony export */   \"stringCompare\": () => (/* binding */ stringCompare),\n/* harmony export */   \"sum\": () => (/* binding */ sum),\n/* harmony export */   \"take\": () => (/* binding */ take),\n/* harmony export */   \"takeLast\": () => (/* binding */ takeLast),\n/* harmony export */   \"takeRightWhile\": () => (/* binding */ takeRightWhile),\n/* harmony export */   \"takeRightWhileFrom\": () => (/* binding */ takeRightWhileFrom),\n/* harmony export */   \"throttle\": () => (/* binding */ throttle),\n/* harmony export */   \"toArray\": () => (/* binding */ toArray),\n/* harmony export */   \"toFixedNumber\": () => (/* binding */ toFixedNumber),\n/* harmony export */   \"toPairs\": () => (/* binding */ toPairs),\n/* harmony export */   \"trailingThrottle\": () => (/* binding */ trailingThrottle),\n/* harmony export */   \"trimEnd\": () => (/* binding */ trimEnd),\n/* harmony export */   \"trimStart\": () => (/* binding */ trimStart),\n/* harmony export */   \"uniq\": () => (/* binding */ uniq),\n/* harmony export */   \"uniqBy\": () => (/* binding */ uniqBy),\n/* harmony export */   \"update\": () => (/* binding */ update),\n/* harmony export */   \"values\": () => (/* binding */ values),\n/* harmony export */   \"without\": () => (/* binding */ without),\n/* harmony export */   \"zip\": () => (/* binding */ zip),\n/* harmony export */   \"zipWith\": () => (/* binding */ zipWith)\n/* harmony export */ });\nfunction add(first, second) {\n  return first + second;\n}\n\nvar _ref = {},\n    hasOwnProperty = _ref.hasOwnProperty;\nfunction hasOwn(prop, obj) {\n  return hasOwnProperty.call(obj, prop);\n}\n\nfunction assign() {\n  // eslint-disable-next-line no-func-assign\n  assign = Object.assign || function (target) {\n    for (var _len = arguments.length, sources = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n      sources[_key - 1] = arguments[_key];\n    }\n\n    sources.forEach(function (source) {\n      // false positive\n      // eslint-disable-next-line no-unused-vars\n      for (var key in source) {\n        if (hasOwn(key, source)) {\n          target[key] = source[key];\n        }\n      }\n    });\n    return target;\n  };\n\n  return assign.apply(void 0, arguments);\n}\n\nvar capitalizeFirstLetter = function capitalizeFirstLetter(text) {\n  return text.charAt(0).toUpperCase() + text.slice(1);\n};\n\nfunction flatMap(iteratee, arr) {\n  var _ref;\n\n  return (_ref = []).concat.apply(_ref, arr.map(iteratee));\n}\n\nfunction chain(fn, listOrFn) {\n  if (typeof listOrFn === 'function') {\n    return function (list) {\n      return fn(listOrFn(list))(list);\n    };\n  }\n\n  return flatMap(fn, listOrFn);\n}\n\nvar isArray = Array.isArray;\n\nfunction isObject(obj) {\n  return typeof obj === 'object' && obj !== null && !isArray(obj);\n}\n\nfunction mapValues(mapper, obj) {\n  return Object.keys(obj).reduce(function (acc, key) {\n    acc[key] = mapper(obj[key]);\n    return acc;\n  }, {});\n}\n\nfunction cloneDeep(value) {\n  if (isArray(value)) {\n    return value.map(cloneDeep);\n  }\n\n  if (isObject(value)) {\n    return mapValues(cloneDeep, value);\n  }\n\n  return value;\n}\n\n// slightly simplified version of https://github.com/sindresorhus/camelcase/blob/a526ef0399f9a1310eaacafa0ae4a69da4a2f1ad/index.js\n// TODO: possibly could be rewritten using short-ish regexp\nvar preserveCamelCase = function preserveCamelCase(input) {\n  var text = input;\n  var isLastCharLower = false;\n  var isLastCharUpper = false;\n  var isLastLastCharUpper = false;\n\n  for (var index = 0; index < text.length; index++) {\n    var _char = text[index];\n\n    if (isLastCharLower && /[a-zA-Z]/.test(_char) && _char.toUpperCase() === _char) {\n      text = text.slice(0, index) + '-' + text.slice(index);\n      isLastCharLower = false;\n      isLastLastCharUpper = isLastCharUpper;\n      isLastCharUpper = true;\n      index++;\n    } else if (isLastCharUpper && isLastLastCharUpper && /[a-zA-Z]/.test(_char) && _char.toLowerCase() === _char) {\n      text = text.slice(0, index - 1) + '-' + text.slice(index - 1);\n      isLastLastCharUpper = isLastCharUpper;\n      isLastCharUpper = false;\n      isLastCharLower = true;\n    } else {\n      isLastCharLower = _char.toLowerCase() === _char;\n      isLastLastCharUpper = isLastCharUpper;\n      isLastCharUpper = _char.toUpperCase() === _char;\n    }\n  }\n\n  return text;\n};\n\nfunction camelCase(input) {\n  var text = input.trim();\n\n  if (text.length === 0) {\n    return '';\n  }\n\n  if (text.length === 1) {\n    return text.toLowerCase();\n  }\n\n  if (/^[a-z\\d]+$/.test(text)) {\n    return text;\n  }\n\n  var hasUpperCase = text !== text.toLowerCase();\n\n  if (hasUpperCase) {\n    text = preserveCamelCase(text);\n  }\n\n  text = text.replace(/^[_.\\- ]+/, '').toLowerCase().replace(/[_.\\- ]+(\\w|$)/g, function (match, p1) {\n    return p1.toUpperCase();\n  });\n  return text;\n}\n\nfunction compact(collection) {\n  return isArray(collection) ? collection.filter(function (value) {\n    return value !== null && value !== undefined;\n  }) : Object.keys(collection).reduce(function (result, key) {\n    var value = collection[key];\n\n    if (value !== null && value !== undefined) {\n      result[key] = value;\n    }\n\n    return result;\n  }, {});\n}\n\nfunction compose() {\n  for (var _len = arguments.length, funcs = new Array(_len), _key = 0; _key < _len; _key++) {\n    funcs[_key] = arguments[_key];\n  }\n\n  return funcs.reduce(function (composed, next) {\n    return function () {\n      return composed(next.apply(void 0, arguments));\n    };\n  });\n}\n\nfunction debounce(ms, fn) {\n  // actual return type of setTimeout differs per platform (browser vs node)\n  var timeoutId;\n  return function () {\n    clearTimeout(timeoutId);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    timeoutId = setTimeout.apply(void 0, [fn, ms].concat(args));\n  };\n}\n\nfunction deepMerge(target) {\n  for (var _len = arguments.length, sources = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n    sources[_key - 1] = arguments[_key];\n  }\n\n  if (!sources.length) return target;\n  var source = sources.shift();\n\n  if (isObject(target) && isObject(source)) {\n    // false negative\n    // eslint-disable-next-line no-unused-vars\n    for (var key in source) {\n      if (isObject(source[key])) {\n        var _Object$assign;\n\n        if (!target[key]) Object.assign(target, (_Object$assign = {}, _Object$assign[key] = {}, _Object$assign));\n        deepMerge(target[key], source[key]);\n      } else {\n        var _Object$assign2;\n\n        Object.assign(target, (_Object$assign2 = {}, _Object$assign2[key] = source[key], _Object$assign2));\n      }\n    }\n  }\n\n  return deepMerge.apply(void 0, [target].concat(sources));\n}\n\nfunction isNil(value) {\n  return value === null || value === undefined;\n}\n\nfunction defaultTo(defaultValue) {\n  return function (value) {\n    return isNil(value) ? defaultValue : value;\n  };\n}\n\nfunction drop(count, arr) {\n  return arr.slice(count);\n}\n\nfunction dropRight(count, arr) {\n  return arr.slice(0, -count);\n}\n\nfunction ensureArray(maybeArr) {\n  return isArray(maybeArr) ? maybeArr : [maybeArr];\n}\n\nfunction entries(obj) {\n  return Object.keys(obj).map(function (key) {\n    return [key, obj[key]];\n  });\n}\n\nfunction find(predicate, arr) {\n  for (var index = 0; index < arr.length; index++) {\n    var element = arr[index];\n\n    if (predicate(element)) {\n      return element;\n    }\n  }\n}\n\nfunction findIndex(predicate, arr) {\n  for (var index = 0; index < arr.length; index++) {\n    if (predicate(arr[index])) {\n      return index;\n    }\n  }\n\n  return -1;\n}\n\nfunction findKey(predicate, obj) {\n  return find(function (key) {\n    return predicate(obj[key]);\n  }, Object.keys(obj));\n}\n\nfunction findLast(predicate, arr) {\n  for (var index = arr.length - 1; index >= 0; index--) {\n    if (predicate(arr[index])) {\n      return arr[index];\n    }\n  }\n}\n\nfunction findLastIndexFrom(predicate, startIndex, arr) {\n  for (var index = startIndex; index >= 0; index--) {\n    if (predicate(arr[index])) {\n      return index;\n    }\n  }\n\n  return -1;\n}\n\nfunction findLastIndex(predicate, arr) {\n  return findLastIndexFrom(predicate, arr.length - 1, arr);\n}\n\nfunction filledArray(length, value) {\n  var arr = [];\n\n  while (length--) {\n    arr.push(value);\n  }\n\n  return arr;\n}\n\nfunction identity(value) {\n  return value;\n}\n\nfunction flatten(arr) {\n  return flatMap(identity, arr);\n}\n\nfunction forOwn(callback, obj) {\n  return Object.keys(obj).forEach(function (key) {\n    callback(obj[key], key);\n  });\n}\n\nfunction fromPairs(pairs) {\n  return pairs.reduce(function (obj, _ref) {\n    var key = _ref[0],\n        value = _ref[1];\n    obj[key] = value;\n    return obj;\n  }, {});\n}\n\nfunction generateRandomId() {\n  return Math.random().toString(36).substring(2);\n}\n\nfunction generateUniqueId(map) {\n  var id = generateRandomId();\n  return hasOwn(id, map) ? generateUniqueId(map) : id;\n}\n\n// based on https://github.com/developit/dlv/blob/d7ec976d12665f1c25dec2acf955dfc2e8757a9c/index.js\nfunction get(propPath, obj) {\n  var arrPath = typeof propPath === 'string' ? propPath.split('.') : propPath;\n  var pathPartIndex = 0;\n  var result = obj;\n\n  while (result && pathPartIndex < arrPath.length) {\n    result = result[arrPath[pathPartIndex++]];\n  }\n\n  return result;\n}\n\nfunction getOr(defaultValue, prop, obj) {\n  var propValue = get(prop, obj);\n  return propValue !== undefined && propValue !== null ? propValue : defaultValue;\n}\n\nfunction groupBy(mapper, collection) {\n  return Object.keys(collection).reduce(function (grouped, key) {\n    var element = collection[key];\n    var groupKey = mapper(element);\n    grouped[groupKey] = grouped[groupKey] || [];\n    grouped[groupKey].push(element);\n    return grouped;\n  }, {});\n}\n\nfunction groupKeys(mapper, obj) {\n  return Object.keys(obj).reduce(function (grouped, key) {\n    var groupKey = mapper(key);\n    grouped[groupKey] = grouped[groupKey] || {};\n    grouped[groupKey][key] = obj[key];\n    return grouped;\n  }, {});\n}\n\nfunction includes(value, arrOrStr) {\n  return arrOrStr.indexOf(value) !== -1;\n}\n\nfunction isEmpty(collection) {\n  return (isArray(collection) ? collection : Object.keys(collection)).length === 0;\n}\n\nfunction isFalsy (value) {\n  return !value;\n}\n\nfunction isTruthy (value) {\n  return !!value;\n}\n\nvar isPromise = function isPromise(promise) {\n  return !!promise && typeof promise.then === 'function';\n};\n\nfunction keyBy(prop, arr) {\n  return arr.reduce(function (acc, el) {\n    acc[el[prop]] = el;\n    return acc;\n  }, {});\n}\n\nfunction keys(obj) {\n  var keysArray = []; // eslint-disable-next-line @typescript-eslint/no-unused-vars\n\n  for (var property in obj) {\n    if (Object.prototype.hasOwnProperty.call(obj, property)) {\n      keysArray.push(property);\n    }\n  }\n\n  return keysArray;\n}\n\n// TODO: this  should return `T | undefined` to match native behavior\nfunction last(arr) {\n  return arr.length > 0 ? arr[arr.length - 1] : null;\n}\n\nfunction mapKeys(mapper, obj) {\n  return Object.keys(obj).reduce(function (acc, key) {\n    acc[mapper(key)] = obj[key];\n    return acc;\n  }, {});\n}\n\nfunction mapValuesIndexed(iteratee, obj) {\n  return Object.keys(obj).reduce(function (acc, key) {\n    acc[key] = iteratee(obj[key], key);\n    return acc;\n  }, {});\n}\n\nfunction merge(objA, objB) {\n  if (isEmpty(objB)) {\n    return objA;\n  }\n\n  var result = {};\n  forOwn(function (value, key) {\n    if (hasOwn(key, objB)) {\n      if (isObject(objA[key]) && isObject(objB[key])) {\n        result[key] = merge(objA[key], objB[key]);\n      } else if (isArray(objA[key]) && isArray(objB[key])) {\n        var length = Math.max(objA[key].length, objB[key].length);\n        result[key] = new Array(length);\n\n        for (var i = 0; i < length; i++) {\n          if (i in objB[key]) {\n            result[key][i] = objB[key][i];\n          } else if (i in objA[key]) {\n            result[key][i] = objA[key][i];\n          }\n        }\n      } else {\n        result[key] = objB[key];\n      }\n    } else {\n      result[key] = objA[key];\n    }\n  }, objA);\n  forOwn(function (value, key) {\n    if (!hasOwn(key, result)) {\n      result[key] = objB[key];\n    }\n  }, objB);\n  return result;\n}\n\nfunction mergeAll(objs) {\n  if (objs.length === 0) {\n    return {};\n  }\n\n  var first = objs[0],\n      rest = objs.slice(1);\n  return rest.reduce(function (merged, obj) {\n    return merge(merged, obj);\n  }, first);\n}\n\nfunction memoizeWith(keyResolver, func) {\n  var cache = {};\n  return function () {\n    var key = keyResolver.apply(void 0, arguments);\n\n    if (hasOwn(key, cache)) {\n      return cache[key];\n    }\n\n    var value = func.apply(void 0, arguments);\n    cache[key] = value;\n    return value;\n  };\n}\n\n// TODO: technically this should accept AnyFunction but it doesn't type check currently with that for some reason\nfunction memoize(func) {\n  return memoizeWith(identity, func);\n}\n\nfunction memoizeOne(fn) {\n  var called = false;\n  var memoized;\n  var cacheKey;\n  return function () {\n    if (called && (arguments.length <= 0 ? undefined : arguments[0]) === cacheKey) {\n      return memoized;\n    }\n\n    called = true;\n    cacheKey = arguments.length <= 0 ? undefined : arguments[0];\n    memoized = fn.apply(void 0, arguments);\n    return memoized;\n  };\n}\n\nfunction noop() {}\n\nfunction values(obj) {\n  return Object.keys(obj).map(function (key) {\n    return obj[key];\n  });\n}\n\nfunction numericSortBy(propOrMapper, collection) {\n  var mapper = typeof propOrMapper === 'function' ? propOrMapper : function (element) {\n    return get(propOrMapper, element);\n  };\n  return (isArray(collection) ? [].concat(collection) : values(collection)).sort(function (elementA, elementB) {\n    return mapper(elementA) - mapper(elementB);\n  });\n}\n\nfunction omitByIndexed(predicate, obj) {\n  return Object.keys(obj).reduce(function (acc, key) {\n    if (!predicate(obj[key], key)) {\n      acc[key] = obj[key];\n    }\n\n    return acc;\n  }, {});\n}\n\nfunction omit(keys, obj) {\n  return omitByIndexed(function (_, key) {\n    return keys.indexOf(key) !== -1;\n  }, obj);\n}\n\nfunction omitBy(predicate, obj) {\n  return Object.keys(obj).reduce(function (acc, key) {\n    if (!predicate(obj[key])) {\n      acc[key] = obj[key];\n    }\n\n    return acc;\n  }, {});\n}\n\nfunction once(fn) {\n  var called = false;\n  var result;\n  return function () {\n    if (called) {\n      return result;\n    }\n\n    called = true;\n    return result = fn.apply(void 0, arguments);\n  };\n}\n\nfunction over(fns) {\n  return function () {\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    return fns.map(function (fn) {\n      return fn.apply(void 0, args);\n    });\n  };\n}\n\nfunction takeLast(count, arr) {\n  return arr.slice(-count);\n}\n\nfunction overArgs(fn, transformers) {\n  return function () {\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    var transformed = transformers.map(function (transform, index) {\n      return transform(args[index]);\n    });\n    return args.length > transformed.length ? fn.apply(void 0, transformed.concat(takeLast(args.length - transformed.length, args))) : fn.apply(void 0, transformed);\n  };\n}\n\nfunction pair(a, b) {\n  return [a, b];\n}\n\nfunction partitionObject(predicate, obj) {\n  return Object.keys(obj).reduce(function (acc, key) {\n    acc[predicate(obj[key]) ? 0 : 1][key] = obj[key];\n    return acc;\n  }, [{}, {}]);\n}\n\nfunction pick(props, obj) {\n  return props.reduce(function (acc, prop) {\n    acc[prop] = obj[prop];\n    return acc;\n  }, {});\n}\n\nfunction pickBy(predicate, obj) {\n  return Object.keys(obj).reduce(function (acc, key) {\n    if (predicate(obj[key])) {\n      acc[key] = obj[key];\n    }\n\n    return acc;\n  }, {});\n}\n\nfunction pickByIndexed(predicate, obj) {\n  return Object.keys(obj).reduce(function (acc, key) {\n    if (predicate(obj[key], key)) {\n      acc[key] = obj[key];\n    }\n\n    return acc;\n  }, {});\n}\n\nfunction pickOwn(props, obj) {\n  return props.reduce(function (acc, prop) {\n    if (hasOwn(prop, obj)) {\n      acc[prop] = obj[prop];\n    }\n\n    return acc;\n  }, {});\n}\n\nfunction randomInt(min, max) {\n  return min + Math.floor(Math.random() * (max - min + 1));\n}\n\nfunction range(max) {\n  var arr = [];\n  var counter = 0;\n\n  while (counter <= max) {\n    arr.push(counter++);\n  }\n\n  return arr;\n}\n\nfunction reject(predicate, arr) {\n  return arr.filter(function (element) {\n    return !predicate(element);\n  });\n}\n\nfunction removeAt(index, arr) {\n  var copy = [].concat(arr);\n  copy.splice(index, 1);\n  return copy;\n}\n\nfunction _extends() {\n  _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n\n  return _extends.apply(this, arguments);\n}\n\nfunction set(_keys, val, obj) {\n  var _extends2;\n\n  var keys = _keys.split ? _keys.split('.') : _keys;\n  var index = keys[0];\n  var finalVal = val;\n\n  if (keys.length > 1) {\n    // eslint-disable-next-line eqeqeq\n    var nextObj = obj != null && hasOwn(index, obj) ? obj[index] : {};\n    finalVal = set(keys.slice(1), val, nextObj);\n  }\n\n  return _extends({}, obj, (_extends2 = {}, _extends2[index] = finalVal, _extends2));\n}\n\n// https://github.com/reactjs/react-redux/blob/5d792a283554cff3d2f54fad1be1f79cbcab33fe/src/utils/shallowEqual.js\n\nfunction is(first, second) {\n  if (first === second) {\n    return first !== 0 || second !== 0 || 1 / first === 1 / second;\n  } // eslint-disable-next-line no-self-compare\n\n\n  return first !== first && second !== second;\n}\n\nfunction shallowEqual(objA, objB) {\n  if (is(objA, objB)) return true;\n\n  if (typeof objA !== 'object' || objA === null || typeof objB !== 'object' || objB === null) {\n    return false;\n  }\n\n  var keysA = Object.keys(objA);\n  var keysB = Object.keys(objB);\n  if (keysA.length !== keysB.length) return false;\n\n  for (var index = 0; index < keysA.length; index++) {\n    if (!hasOwn(keysA[index], objB) || !is(objA[keysA[index]], objB[keysA[index]])) {\n      return false;\n    }\n  }\n\n  return true;\n}\n\nfunction sign(value) {\n  if (typeof value !== 'number' || isNaN(value)) {\n    return NaN;\n  }\n\n  if (value === 0) {\n    return 0;\n  } // eslint-disable-next-line no-compare-neg-zero\n\n\n  if (value === -0) {\n    return -0;\n  }\n\n  return value > 0 ? 1 : -1;\n}\n\nfunction shuffle(arr) {\n  var copy = arr.slice();\n  var lastIndex = arr.length - 1;\n\n  for (var i = 0; i < arr.length; i++) {\n    var randomIndex = randomInt(i, lastIndex);\n    var randomValue = copy[randomIndex];\n    copy[randomIndex] = copy[i];\n    copy[i] = randomValue;\n  }\n\n  return copy;\n}\n\nfunction sliceDiff(slice, obj) {\n  var picked = pickByIndexed(function (value, key) {\n    return value !== obj[key];\n  }, slice);\n  return isEmpty(picked) ? null : picked;\n}\n\n// TODO: this could be written a lot better\nfunction snakeCase(str) {\n  var snakeCased = str.replace(/[A-Z]|([-_ ]+)/g, function (match) {\n    var code = match.charCodeAt(0);\n    var upperCased = code > 64 && code < 91;\n    return upperCased ? \"_\" + match.toLowerCase() : '_';\n  });\n  return snakeCased[0] === '_' ? snakeCased.substr(1) : snakeCased;\n}\n\nfunction someAreTruthy(arr) {\n  return arr.some(identity);\n}\n\nfunction splitAt(splitPoint, arrOrStr) {\n  return [arrOrStr.slice(0, splitPoint), arrOrStr.slice(splitPoint, arrOrStr.length)];\n}\n\nfunction splitRightWhenAccum(fn, acc, arr) {\n  var result = false;\n\n  for (var index = arr.length; index > 0; index--) {\n\n    var _fn = fn(arr[index - 1], acc);\n\n    result = _fn[0];\n    acc = _fn[1];\n\n    if (result) {\n      return splitAt(index - 1, arr);\n    }\n  }\n\n  return [[], arr];\n}\n\nfunction spread(fn) {\n  return function (args) {\n    return fn.apply(void 0, args);\n  };\n}\n\nfunction sum(numbers) {\n  return numbers.reduce(add, 0);\n}\n\nfunction take(count, arr) {\n  return arr.slice(0, count);\n}\n\nfunction takeRightWhileFrom(predicate, startIndex, arr) {\n  var endIndex = findLastIndexFrom(function (element) {\n    return !predicate(element);\n  }, startIndex, arr);\n  return endIndex === startIndex ? [] : arr.slice(endIndex + 1, startIndex + 1);\n}\n\nfunction takeRightWhile(predicate, arr) {\n  return takeRightWhileFrom(predicate, arr.length - 1, arr);\n}\n\nfunction throttle(ms, fn) {\n  var lastCall = Date.now() - 2 * ms;\n  var trailingId;\n\n  var invoke = function invoke() {\n    lastCall = Date.now();\n    fn.apply(void 0, arguments);\n  };\n\n  return function () {\n    var now = Date.now();\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    if (now - lastCall >= ms) {\n      invoke.apply(void 0, args);\n      return;\n    }\n\n    clearTimeout(trailingId);\n    trailingId = setTimeout.apply(void 0, [invoke, lastCall - now + ms].concat(args));\n  };\n}\n\nfunction toArray(arrayLike) {\n  return Array.prototype.slice.call(arrayLike);\n}\n\nvar toFixedNumber = function toFixedNumber(num, digits) {\n  return Number(num.toFixed(digits));\n};\n\nvar toPairs = function toPairs(obj) {\n  return Object.keys(obj).map(function (key) {\n    return [key, obj[key]];\n  });\n};\n\nfunction trailingThrottle(ms, fn) {\n  var lastCall = Date.now() - 2 * ms;\n  var trailingId;\n\n  var invoke = function invoke() {\n    lastCall = Date.now();\n    return fn.apply(void 0, arguments);\n  };\n\n  return function () {\n    var now = Date.now();\n\n    if (now - lastCall >= ms) {\n      lastCall = Date.now();\n    }\n\n    clearTimeout(trailingId);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    trailingId = setTimeout.apply(void 0, [invoke, lastCall - now + ms].concat(args));\n  };\n}\n\nfunction leadingThrottle(ms, fn) {\n  var lastCall = 0;\n  return function () {\n    var now = Date.now();\n\n    if (now - lastCall >= ms) {\n      lastCall = Date.now();\n      fn.apply(void 0, arguments);\n    }\n  };\n}\n\nvar stringCompare = function stringCompare(strA, strB) {\n  if (strA === strB) {\n    return 0;\n  }\n\n  return strA < strB ? -1 : 1;\n};\n\nvar leadingWhiteSpace = /^\\s+/;\nfunction trimStart(str) {\n  return str.replace(leadingWhiteSpace, '');\n}\n\nvar trailingWhiteSpace = /\\s+$/;\nfunction trimEnd(str) {\n  return str.replace(trailingWhiteSpace, '');\n}\n\nfunction repeat(count, text) {\n  return Array(count + 1).join(text);\n}\n\nfunction uniqBy(iteratee, arr) {\n  // with polyfills this could be just: return Array.from(new Set(arr.map(iteratee)))\n  var seen = [];\n  return arr.filter(function (element) {\n    var key = iteratee(element);\n\n    if (seen.indexOf(key) === -1) {\n      seen.push(key);\n      return true;\n    }\n\n    return false;\n  });\n}\n\nfunction uniq(arr) {\n  return uniqBy(identity, arr);\n}\n\nfunction update(index, newElement, arr) {\n  return [].concat(arr.slice(0, index), [newElement], arr.slice(index + 1, arr.length));\n}\n\nfunction without(removed, arr) {\n  return arr.filter(function (element) {\n    return removed.indexOf(element) === -1;\n  });\n}\n\nfunction zipWith(zipper, arrayA, arrayB) {\n  return arrayA.map(function (elementA, index) {\n    return zipper(elementA, arrayB[index]);\n  });\n}\n\nfunction zip(arrayA, arrayB) {\n  return zipWith(pair, arrayA, arrayB);\n}\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi4vLi4vLi4vbm9kZV9tb2R1bGVzL0BsaXZlY2hhdC9kYXRhLXV0aWxzL2Rpc3QvZGF0YS11dGlscy5lcy5qcy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uLi8uLi8uLi9ub2RlX21vZHVsZXMvQGxpdmVjaGF0L2RhdGEtdXRpbHMvZGlzdC9kYXRhLXV0aWxzLmVzLmpzP2Q1Y2MiXSwic291cmNlc0NvbnRlbnQiOlsiZnVuY3Rpb24gYWRkKGZpcnN0LCBzZWNvbmQpIHtcbiAgcmV0dXJuIGZpcnN0ICsgc2Vjb25kO1xufVxuXG52YXIgX3JlZiA9IHt9LFxuICAgIGhhc093blByb3BlcnR5ID0gX3JlZi5oYXNPd25Qcm9wZXJ0eTtcbmZ1bmN0aW9uIGhhc093bihwcm9wLCBvYmopIHtcbiAgcmV0dXJuIGhhc093blByb3BlcnR5LmNhbGwob2JqLCBwcm9wKTtcbn1cblxuZnVuY3Rpb24gYXNzaWduKCkge1xuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tZnVuYy1hc3NpZ25cbiAgYXNzaWduID0gT2JqZWN0LmFzc2lnbiB8fCBmdW5jdGlvbiAodGFyZ2V0KSB7XG4gICAgZm9yICh2YXIgX2xlbiA9IGFyZ3VtZW50cy5sZW5ndGgsIHNvdXJjZXMgPSBuZXcgQXJyYXkoX2xlbiA+IDEgPyBfbGVuIC0gMSA6IDApLCBfa2V5ID0gMTsgX2tleSA8IF9sZW47IF9rZXkrKykge1xuICAgICAgc291cmNlc1tfa2V5IC0gMV0gPSBhcmd1bWVudHNbX2tleV07XG4gICAgfVxuXG4gICAgc291cmNlcy5mb3JFYWNoKGZ1bmN0aW9uIChzb3VyY2UpIHtcbiAgICAgIC8vIGZhbHNlIHBvc2l0aXZlXG4gICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tdW51c2VkLXZhcnNcbiAgICAgIGZvciAodmFyIGtleSBpbiBzb3VyY2UpIHtcbiAgICAgICAgaWYgKGhhc093bihrZXksIHNvdXJjZSkpIHtcbiAgICAgICAgICB0YXJnZXRba2V5XSA9IHNvdXJjZVtrZXldO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuIHRhcmdldDtcbiAgfTtcblxuICByZXR1cm4gYXNzaWduLmFwcGx5KHZvaWQgMCwgYXJndW1lbnRzKTtcbn1cblxudmFyIGNhcGl0YWxpemVGaXJzdExldHRlciA9IGZ1bmN0aW9uIGNhcGl0YWxpemVGaXJzdExldHRlcih0ZXh0KSB7XG4gIHJldHVybiB0ZXh0LmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgdGV4dC5zbGljZSgxKTtcbn07XG5cbmZ1bmN0aW9uIGZsYXRNYXAoaXRlcmF0ZWUsIGFycikge1xuICB2YXIgX3JlZjtcblxuICByZXR1cm4gKF9yZWYgPSBbXSkuY29uY2F0LmFwcGx5KF9yZWYsIGFyci5tYXAoaXRlcmF0ZWUpKTtcbn1cblxuZnVuY3Rpb24gY2hhaW4oZm4sIGxpc3RPckZuKSB7XG4gIGlmICh0eXBlb2YgbGlzdE9yRm4gPT09ICdmdW5jdGlvbicpIHtcbiAgICByZXR1cm4gZnVuY3Rpb24gKGxpc3QpIHtcbiAgICAgIHJldHVybiBmbihsaXN0T3JGbihsaXN0KSkobGlzdCk7XG4gICAgfTtcbiAgfVxuXG4gIHJldHVybiBmbGF0TWFwKGZuLCBsaXN0T3JGbik7XG59XG5cbnZhciBpc0FycmF5ID0gQXJyYXkuaXNBcnJheTtcblxuZnVuY3Rpb24gaXNPYmplY3Qob2JqKSB7XG4gIHJldHVybiB0eXBlb2Ygb2JqID09PSAnb2JqZWN0JyAmJiBvYmogIT09IG51bGwgJiYgIWlzQXJyYXkob2JqKTtcbn1cblxuZnVuY3Rpb24gbWFwVmFsdWVzKG1hcHBlciwgb2JqKSB7XG4gIHJldHVybiBPYmplY3Qua2V5cyhvYmopLnJlZHVjZShmdW5jdGlvbiAoYWNjLCBrZXkpIHtcbiAgICBhY2Nba2V5XSA9IG1hcHBlcihvYmpba2V5XSk7XG4gICAgcmV0dXJuIGFjYztcbiAgfSwge30pO1xufVxuXG5mdW5jdGlvbiBjbG9uZURlZXAodmFsdWUpIHtcbiAgaWYgKGlzQXJyYXkodmFsdWUpKSB7XG4gICAgcmV0dXJuIHZhbHVlLm1hcChjbG9uZURlZXApO1xuICB9XG5cbiAgaWYgKGlzT2JqZWN0KHZhbHVlKSkge1xuICAgIHJldHVybiBtYXBWYWx1ZXMoY2xvbmVEZWVwLCB2YWx1ZSk7XG4gIH1cblxuICByZXR1cm4gdmFsdWU7XG59XG5cbi8vIHNsaWdodGx5IHNpbXBsaWZpZWQgdmVyc2lvbiBvZiBodHRwczovL2dpdGh1Yi5jb20vc2luZHJlc29yaHVzL2NhbWVsY2FzZS9ibG9iL2E1MjZlZjAzOTlmOWExMzEwZWFhY2FmYTBhZTRhNjlkYTRhMmYxYWQvaW5kZXguanNcbi8vIFRPRE86IHBvc3NpYmx5IGNvdWxkIGJlIHJld3JpdHRlbiB1c2luZyBzaG9ydC1pc2ggcmVnZXhwXG52YXIgcHJlc2VydmVDYW1lbENhc2UgPSBmdW5jdGlvbiBwcmVzZXJ2ZUNhbWVsQ2FzZShpbnB1dCkge1xuICB2YXIgdGV4dCA9IGlucHV0O1xuICB2YXIgaXNMYXN0Q2hhckxvd2VyID0gZmFsc2U7XG4gIHZhciBpc0xhc3RDaGFyVXBwZXIgPSBmYWxzZTtcbiAgdmFyIGlzTGFzdExhc3RDaGFyVXBwZXIgPSBmYWxzZTtcblxuICBmb3IgKHZhciBpbmRleCA9IDA7IGluZGV4IDwgdGV4dC5sZW5ndGg7IGluZGV4KyspIHtcbiAgICB2YXIgX2NoYXIgPSB0ZXh0W2luZGV4XTtcblxuICAgIGlmIChpc0xhc3RDaGFyTG93ZXIgJiYgL1thLXpBLVpdLy50ZXN0KF9jaGFyKSAmJiBfY2hhci50b1VwcGVyQ2FzZSgpID09PSBfY2hhcikge1xuICAgICAgdGV4dCA9IHRleHQuc2xpY2UoMCwgaW5kZXgpICsgJy0nICsgdGV4dC5zbGljZShpbmRleCk7XG4gICAgICBpc0xhc3RDaGFyTG93ZXIgPSBmYWxzZTtcbiAgICAgIGlzTGFzdExhc3RDaGFyVXBwZXIgPSBpc0xhc3RDaGFyVXBwZXI7XG4gICAgICBpc0xhc3RDaGFyVXBwZXIgPSB0cnVlO1xuICAgICAgaW5kZXgrKztcbiAgICB9IGVsc2UgaWYgKGlzTGFzdENoYXJVcHBlciAmJiBpc0xhc3RMYXN0Q2hhclVwcGVyICYmIC9bYS16QS1aXS8udGVzdChfY2hhcikgJiYgX2NoYXIudG9Mb3dlckNhc2UoKSA9PT0gX2NoYXIpIHtcbiAgICAgIHRleHQgPSB0ZXh0LnNsaWNlKDAsIGluZGV4IC0gMSkgKyAnLScgKyB0ZXh0LnNsaWNlKGluZGV4IC0gMSk7XG4gICAgICBpc0xhc3RMYXN0Q2hhclVwcGVyID0gaXNMYXN0Q2hhclVwcGVyO1xuICAgICAgaXNMYXN0Q2hhclVwcGVyID0gZmFsc2U7XG4gICAgICBpc0xhc3RDaGFyTG93ZXIgPSB0cnVlO1xuICAgIH0gZWxzZSB7XG4gICAgICBpc0xhc3RDaGFyTG93ZXIgPSBfY2hhci50b0xvd2VyQ2FzZSgpID09PSBfY2hhcjtcbiAgICAgIGlzTGFzdExhc3RDaGFyVXBwZXIgPSBpc0xhc3RDaGFyVXBwZXI7XG4gICAgICBpc0xhc3RDaGFyVXBwZXIgPSBfY2hhci50b1VwcGVyQ2FzZSgpID09PSBfY2hhcjtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gdGV4dDtcbn07XG5cbmZ1bmN0aW9uIGNhbWVsQ2FzZShpbnB1dCkge1xuICB2YXIgdGV4dCA9IGlucHV0LnRyaW0oKTtcblxuICBpZiAodGV4dC5sZW5ndGggPT09IDApIHtcbiAgICByZXR1cm4gJyc7XG4gIH1cblxuICBpZiAodGV4dC5sZW5ndGggPT09IDEpIHtcbiAgICByZXR1cm4gdGV4dC50b0xvd2VyQ2FzZSgpO1xuICB9XG5cbiAgaWYgKC9eW2EtelxcZF0rJC8udGVzdCh0ZXh0KSkge1xuICAgIHJldHVybiB0ZXh0O1xuICB9XG5cbiAgdmFyIGhhc1VwcGVyQ2FzZSA9IHRleHQgIT09IHRleHQudG9Mb3dlckNhc2UoKTtcblxuICBpZiAoaGFzVXBwZXJDYXNlKSB7XG4gICAgdGV4dCA9IHByZXNlcnZlQ2FtZWxDYXNlKHRleHQpO1xuICB9XG5cbiAgdGV4dCA9IHRleHQucmVwbGFjZSgvXltfLlxcLSBdKy8sICcnKS50b0xvd2VyQ2FzZSgpLnJlcGxhY2UoL1tfLlxcLSBdKyhcXHd8JCkvZywgZnVuY3Rpb24gKG1hdGNoLCBwMSkge1xuICAgIHJldHVybiBwMS50b1VwcGVyQ2FzZSgpO1xuICB9KTtcbiAgcmV0dXJuIHRleHQ7XG59XG5cbmZ1bmN0aW9uIGNvbXBhY3QoY29sbGVjdGlvbikge1xuICByZXR1cm4gaXNBcnJheShjb2xsZWN0aW9uKSA/IGNvbGxlY3Rpb24uZmlsdGVyKGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgIHJldHVybiB2YWx1ZSAhPT0gbnVsbCAmJiB2YWx1ZSAhPT0gdW5kZWZpbmVkO1xuICB9KSA6IE9iamVjdC5rZXlzKGNvbGxlY3Rpb24pLnJlZHVjZShmdW5jdGlvbiAocmVzdWx0LCBrZXkpIHtcbiAgICB2YXIgdmFsdWUgPSBjb2xsZWN0aW9uW2tleV07XG5cbiAgICBpZiAodmFsdWUgIT09IG51bGwgJiYgdmFsdWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgcmVzdWx0W2tleV0gPSB2YWx1ZTtcbiAgICB9XG5cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9LCB7fSk7XG59XG5cbmZ1bmN0aW9uIGNvbXBvc2UoKSB7XG4gIGZvciAodmFyIF9sZW4gPSBhcmd1bWVudHMubGVuZ3RoLCBmdW5jcyA9IG5ldyBBcnJheShfbGVuKSwgX2tleSA9IDA7IF9rZXkgPCBfbGVuOyBfa2V5KyspIHtcbiAgICBmdW5jc1tfa2V5XSA9IGFyZ3VtZW50c1tfa2V5XTtcbiAgfVxuXG4gIHJldHVybiBmdW5jcy5yZWR1Y2UoZnVuY3Rpb24gKGNvbXBvc2VkLCBuZXh0KSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiBjb21wb3NlZChuZXh0LmFwcGx5KHZvaWQgMCwgYXJndW1lbnRzKSk7XG4gICAgfTtcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIGRlYm91bmNlKG1zLCBmbikge1xuICAvLyBhY3R1YWwgcmV0dXJuIHR5cGUgb2Ygc2V0VGltZW91dCBkaWZmZXJzIHBlciBwbGF0Zm9ybSAoYnJvd3NlciB2cyBub2RlKVxuICB2YXIgdGltZW91dElkO1xuICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgIGNsZWFyVGltZW91dCh0aW1lb3V0SWQpO1xuXG4gICAgZm9yICh2YXIgX2xlbiA9IGFyZ3VtZW50cy5sZW5ndGgsIGFyZ3MgPSBuZXcgQXJyYXkoX2xlbiksIF9rZXkgPSAwOyBfa2V5IDwgX2xlbjsgX2tleSsrKSB7XG4gICAgICBhcmdzW19rZXldID0gYXJndW1lbnRzW19rZXldO1xuICAgIH1cblxuICAgIHRpbWVvdXRJZCA9IHNldFRpbWVvdXQuYXBwbHkodm9pZCAwLCBbZm4sIG1zXS5jb25jYXQoYXJncykpO1xuICB9O1xufVxuXG5mdW5jdGlvbiBkZWVwTWVyZ2UodGFyZ2V0KSB7XG4gIGZvciAodmFyIF9sZW4gPSBhcmd1bWVudHMubGVuZ3RoLCBzb3VyY2VzID0gbmV3IEFycmF5KF9sZW4gPiAxID8gX2xlbiAtIDEgOiAwKSwgX2tleSA9IDE7IF9rZXkgPCBfbGVuOyBfa2V5KyspIHtcbiAgICBzb3VyY2VzW19rZXkgLSAxXSA9IGFyZ3VtZW50c1tfa2V5XTtcbiAgfVxuXG4gIGlmICghc291cmNlcy5sZW5ndGgpIHJldHVybiB0YXJnZXQ7XG4gIHZhciBzb3VyY2UgPSBzb3VyY2VzLnNoaWZ0KCk7XG5cbiAgaWYgKGlzT2JqZWN0KHRhcmdldCkgJiYgaXNPYmplY3Qoc291cmNlKSkge1xuICAgIC8vIGZhbHNlIG5lZ2F0aXZlXG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXVudXNlZC12YXJzXG4gICAgZm9yICh2YXIga2V5IGluIHNvdXJjZSkge1xuICAgICAgaWYgKGlzT2JqZWN0KHNvdXJjZVtrZXldKSkge1xuICAgICAgICB2YXIgX09iamVjdCRhc3NpZ247XG5cbiAgICAgICAgaWYgKCF0YXJnZXRba2V5XSkgT2JqZWN0LmFzc2lnbih0YXJnZXQsIChfT2JqZWN0JGFzc2lnbiA9IHt9LCBfT2JqZWN0JGFzc2lnbltrZXldID0ge30sIF9PYmplY3QkYXNzaWduKSk7XG4gICAgICAgIGRlZXBNZXJnZSh0YXJnZXRba2V5XSwgc291cmNlW2tleV0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFyIF9PYmplY3QkYXNzaWduMjtcblxuICAgICAgICBPYmplY3QuYXNzaWduKHRhcmdldCwgKF9PYmplY3QkYXNzaWduMiA9IHt9LCBfT2JqZWN0JGFzc2lnbjJba2V5XSA9IHNvdXJjZVtrZXldLCBfT2JqZWN0JGFzc2lnbjIpKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICByZXR1cm4gZGVlcE1lcmdlLmFwcGx5KHZvaWQgMCwgW3RhcmdldF0uY29uY2F0KHNvdXJjZXMpKTtcbn1cblxuZnVuY3Rpb24gaXNOaWwodmFsdWUpIHtcbiAgcmV0dXJuIHZhbHVlID09PSBudWxsIHx8IHZhbHVlID09PSB1bmRlZmluZWQ7XG59XG5cbmZ1bmN0aW9uIGRlZmF1bHRUbyhkZWZhdWx0VmFsdWUpIHtcbiAgcmV0dXJuIGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgIHJldHVybiBpc05pbCh2YWx1ZSkgPyBkZWZhdWx0VmFsdWUgOiB2YWx1ZTtcbiAgfTtcbn1cblxuZnVuY3Rpb24gZHJvcChjb3VudCwgYXJyKSB7XG4gIHJldHVybiBhcnIuc2xpY2UoY291bnQpO1xufVxuXG5mdW5jdGlvbiBkcm9wUmlnaHQoY291bnQsIGFycikge1xuICByZXR1cm4gYXJyLnNsaWNlKDAsIC1jb3VudCk7XG59XG5cbmZ1bmN0aW9uIGVuc3VyZUFycmF5KG1heWJlQXJyKSB7XG4gIHJldHVybiBpc0FycmF5KG1heWJlQXJyKSA/IG1heWJlQXJyIDogW21heWJlQXJyXTtcbn1cblxuZnVuY3Rpb24gZW50cmllcyhvYmopIHtcbiAgcmV0dXJuIE9iamVjdC5rZXlzKG9iaikubWFwKGZ1bmN0aW9uIChrZXkpIHtcbiAgICByZXR1cm4gW2tleSwgb2JqW2tleV1dO1xuICB9KTtcbn1cblxuZnVuY3Rpb24gZmluZChwcmVkaWNhdGUsIGFycikge1xuICBmb3IgKHZhciBpbmRleCA9IDA7IGluZGV4IDwgYXJyLmxlbmd0aDsgaW5kZXgrKykge1xuICAgIHZhciBlbGVtZW50ID0gYXJyW2luZGV4XTtcblxuICAgIGlmIChwcmVkaWNhdGUoZWxlbWVudCkpIHtcbiAgICAgIHJldHVybiBlbGVtZW50O1xuICAgIH1cbiAgfVxufVxuXG5mdW5jdGlvbiBmaW5kSW5kZXgocHJlZGljYXRlLCBhcnIpIHtcbiAgZm9yICh2YXIgaW5kZXggPSAwOyBpbmRleCA8IGFyci5sZW5ndGg7IGluZGV4KyspIHtcbiAgICBpZiAocHJlZGljYXRlKGFycltpbmRleF0pKSB7XG4gICAgICByZXR1cm4gaW5kZXg7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIC0xO1xufVxuXG5mdW5jdGlvbiBmaW5kS2V5KHByZWRpY2F0ZSwgb2JqKSB7XG4gIHJldHVybiBmaW5kKGZ1bmN0aW9uIChrZXkpIHtcbiAgICByZXR1cm4gcHJlZGljYXRlKG9ialtrZXldKTtcbiAgfSwgT2JqZWN0LmtleXMob2JqKSk7XG59XG5cbmZ1bmN0aW9uIGZpbmRMYXN0KHByZWRpY2F0ZSwgYXJyKSB7XG4gIGZvciAodmFyIGluZGV4ID0gYXJyLmxlbmd0aCAtIDE7IGluZGV4ID49IDA7IGluZGV4LS0pIHtcbiAgICBpZiAocHJlZGljYXRlKGFycltpbmRleF0pKSB7XG4gICAgICByZXR1cm4gYXJyW2luZGV4XTtcbiAgICB9XG4gIH1cbn1cblxuZnVuY3Rpb24gZmluZExhc3RJbmRleEZyb20ocHJlZGljYXRlLCBzdGFydEluZGV4LCBhcnIpIHtcbiAgZm9yICh2YXIgaW5kZXggPSBzdGFydEluZGV4OyBpbmRleCA+PSAwOyBpbmRleC0tKSB7XG4gICAgaWYgKHByZWRpY2F0ZShhcnJbaW5kZXhdKSkge1xuICAgICAgcmV0dXJuIGluZGV4O1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiAtMTtcbn1cblxuZnVuY3Rpb24gZmluZExhc3RJbmRleChwcmVkaWNhdGUsIGFycikge1xuICByZXR1cm4gZmluZExhc3RJbmRleEZyb20ocHJlZGljYXRlLCBhcnIubGVuZ3RoIC0gMSwgYXJyKTtcbn1cblxuZnVuY3Rpb24gZmlsbGVkQXJyYXkobGVuZ3RoLCB2YWx1ZSkge1xuICB2YXIgYXJyID0gW107XG5cbiAgd2hpbGUgKGxlbmd0aC0tKSB7XG4gICAgYXJyLnB1c2godmFsdWUpO1xuICB9XG5cbiAgcmV0dXJuIGFycjtcbn1cblxuZnVuY3Rpb24gaWRlbnRpdHkodmFsdWUpIHtcbiAgcmV0dXJuIHZhbHVlO1xufVxuXG5mdW5jdGlvbiBmbGF0dGVuKGFycikge1xuICByZXR1cm4gZmxhdE1hcChpZGVudGl0eSwgYXJyKTtcbn1cblxuZnVuY3Rpb24gZm9yT3duKGNhbGxiYWNrLCBvYmopIHtcbiAgcmV0dXJuIE9iamVjdC5rZXlzKG9iaikuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgY2FsbGJhY2sob2JqW2tleV0sIGtleSk7XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBmcm9tUGFpcnMocGFpcnMpIHtcbiAgcmV0dXJuIHBhaXJzLnJlZHVjZShmdW5jdGlvbiAob2JqLCBfcmVmKSB7XG4gICAgdmFyIGtleSA9IF9yZWZbMF0sXG4gICAgICAgIHZhbHVlID0gX3JlZlsxXTtcbiAgICBvYmpba2V5XSA9IHZhbHVlO1xuICAgIHJldHVybiBvYmo7XG4gIH0sIHt9KTtcbn1cblxuZnVuY3Rpb24gZ2VuZXJhdGVSYW5kb21JZCgpIHtcbiAgcmV0dXJuIE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cmluZygyKTtcbn1cblxuZnVuY3Rpb24gZ2VuZXJhdGVVbmlxdWVJZChtYXApIHtcbiAgdmFyIGlkID0gZ2VuZXJhdGVSYW5kb21JZCgpO1xuICByZXR1cm4gaGFzT3duKGlkLCBtYXApID8gZ2VuZXJhdGVVbmlxdWVJZChtYXApIDogaWQ7XG59XG5cbi8vIGJhc2VkIG9uIGh0dHBzOi8vZ2l0aHViLmNvbS9kZXZlbG9waXQvZGx2L2Jsb2IvZDdlYzk3NmQxMjY2NWYxYzI1ZGVjMmFjZjk1NWRmYzJlODc1N2E5Yy9pbmRleC5qc1xuZnVuY3Rpb24gZ2V0KHByb3BQYXRoLCBvYmopIHtcbiAgdmFyIGFyclBhdGggPSB0eXBlb2YgcHJvcFBhdGggPT09ICdzdHJpbmcnID8gcHJvcFBhdGguc3BsaXQoJy4nKSA6IHByb3BQYXRoO1xuICB2YXIgcGF0aFBhcnRJbmRleCA9IDA7XG4gIHZhciByZXN1bHQgPSBvYmo7XG5cbiAgd2hpbGUgKHJlc3VsdCAmJiBwYXRoUGFydEluZGV4IDwgYXJyUGF0aC5sZW5ndGgpIHtcbiAgICByZXN1bHQgPSByZXN1bHRbYXJyUGF0aFtwYXRoUGFydEluZGV4KytdXTtcbiAgfVxuXG4gIHJldHVybiByZXN1bHQ7XG59XG5cbmZ1bmN0aW9uIGdldE9yKGRlZmF1bHRWYWx1ZSwgcHJvcCwgb2JqKSB7XG4gIHZhciBwcm9wVmFsdWUgPSBnZXQocHJvcCwgb2JqKTtcbiAgcmV0dXJuIHByb3BWYWx1ZSAhPT0gdW5kZWZpbmVkICYmIHByb3BWYWx1ZSAhPT0gbnVsbCA/IHByb3BWYWx1ZSA6IGRlZmF1bHRWYWx1ZTtcbn1cblxuZnVuY3Rpb24gZ3JvdXBCeShtYXBwZXIsIGNvbGxlY3Rpb24pIHtcbiAgcmV0dXJuIE9iamVjdC5rZXlzKGNvbGxlY3Rpb24pLnJlZHVjZShmdW5jdGlvbiAoZ3JvdXBlZCwga2V5KSB7XG4gICAgdmFyIGVsZW1lbnQgPSBjb2xsZWN0aW9uW2tleV07XG4gICAgdmFyIGdyb3VwS2V5ID0gbWFwcGVyKGVsZW1lbnQpO1xuICAgIGdyb3VwZWRbZ3JvdXBLZXldID0gZ3JvdXBlZFtncm91cEtleV0gfHwgW107XG4gICAgZ3JvdXBlZFtncm91cEtleV0ucHVzaChlbGVtZW50KTtcbiAgICByZXR1cm4gZ3JvdXBlZDtcbiAgfSwge30pO1xufVxuXG5mdW5jdGlvbiBncm91cEtleXMobWFwcGVyLCBvYmopIHtcbiAgcmV0dXJuIE9iamVjdC5rZXlzKG9iaikucmVkdWNlKGZ1bmN0aW9uIChncm91cGVkLCBrZXkpIHtcbiAgICB2YXIgZ3JvdXBLZXkgPSBtYXBwZXIoa2V5KTtcbiAgICBncm91cGVkW2dyb3VwS2V5XSA9IGdyb3VwZWRbZ3JvdXBLZXldIHx8IHt9O1xuICAgIGdyb3VwZWRbZ3JvdXBLZXldW2tleV0gPSBvYmpba2V5XTtcbiAgICByZXR1cm4gZ3JvdXBlZDtcbiAgfSwge30pO1xufVxuXG5mdW5jdGlvbiBpbmNsdWRlcyh2YWx1ZSwgYXJyT3JTdHIpIHtcbiAgcmV0dXJuIGFyck9yU3RyLmluZGV4T2YodmFsdWUpICE9PSAtMTtcbn1cblxuZnVuY3Rpb24gaXNFbXB0eShjb2xsZWN0aW9uKSB7XG4gIHJldHVybiAoaXNBcnJheShjb2xsZWN0aW9uKSA/IGNvbGxlY3Rpb24gOiBPYmplY3Qua2V5cyhjb2xsZWN0aW9uKSkubGVuZ3RoID09PSAwO1xufVxuXG5mdW5jdGlvbiBpc0ZhbHN5ICh2YWx1ZSkge1xuICByZXR1cm4gIXZhbHVlO1xufVxuXG5mdW5jdGlvbiBpc1RydXRoeSAodmFsdWUpIHtcbiAgcmV0dXJuICEhdmFsdWU7XG59XG5cbnZhciBpc1Byb21pc2UgPSBmdW5jdGlvbiBpc1Byb21pc2UocHJvbWlzZSkge1xuICByZXR1cm4gISFwcm9taXNlICYmIHR5cGVvZiBwcm9taXNlLnRoZW4gPT09ICdmdW5jdGlvbic7XG59O1xuXG5mdW5jdGlvbiBrZXlCeShwcm9wLCBhcnIpIHtcbiAgcmV0dXJuIGFyci5yZWR1Y2UoZnVuY3Rpb24gKGFjYywgZWwpIHtcbiAgICBhY2NbZWxbcHJvcF1dID0gZWw7XG4gICAgcmV0dXJuIGFjYztcbiAgfSwge30pO1xufVxuXG5mdW5jdGlvbiBrZXlzKG9iaikge1xuICB2YXIga2V5c0FycmF5ID0gW107IC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tdW51c2VkLXZhcnNcblxuICBmb3IgKHZhciBwcm9wZXJ0eSBpbiBvYmopIHtcbiAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwgcHJvcGVydHkpKSB7XG4gICAgICBrZXlzQXJyYXkucHVzaChwcm9wZXJ0eSk7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIGtleXNBcnJheTtcbn1cblxuLy8gVE9ETzogdGhpcyAgc2hvdWxkIHJldHVybiBgVCB8IHVuZGVmaW5lZGAgdG8gbWF0Y2ggbmF0aXZlIGJlaGF2aW9yXG5mdW5jdGlvbiBsYXN0KGFycikge1xuICByZXR1cm4gYXJyLmxlbmd0aCA+IDAgPyBhcnJbYXJyLmxlbmd0aCAtIDFdIDogbnVsbDtcbn1cblxuZnVuY3Rpb24gbWFwS2V5cyhtYXBwZXIsIG9iaikge1xuICByZXR1cm4gT2JqZWN0LmtleXMob2JqKS5yZWR1Y2UoZnVuY3Rpb24gKGFjYywga2V5KSB7XG4gICAgYWNjW21hcHBlcihrZXkpXSA9IG9ialtrZXldO1xuICAgIHJldHVybiBhY2M7XG4gIH0sIHt9KTtcbn1cblxuZnVuY3Rpb24gbWFwVmFsdWVzSW5kZXhlZChpdGVyYXRlZSwgb2JqKSB7XG4gIHJldHVybiBPYmplY3Qua2V5cyhvYmopLnJlZHVjZShmdW5jdGlvbiAoYWNjLCBrZXkpIHtcbiAgICBhY2Nba2V5XSA9IGl0ZXJhdGVlKG9ialtrZXldLCBrZXkpO1xuICAgIHJldHVybiBhY2M7XG4gIH0sIHt9KTtcbn1cblxuZnVuY3Rpb24gbWVyZ2Uob2JqQSwgb2JqQikge1xuICBpZiAoaXNFbXB0eShvYmpCKSkge1xuICAgIHJldHVybiBvYmpBO1xuICB9XG5cbiAgdmFyIHJlc3VsdCA9IHt9O1xuICBmb3JPd24oZnVuY3Rpb24gKHZhbHVlLCBrZXkpIHtcbiAgICBpZiAoaGFzT3duKGtleSwgb2JqQikpIHtcbiAgICAgIGlmIChpc09iamVjdChvYmpBW2tleV0pICYmIGlzT2JqZWN0KG9iakJba2V5XSkpIHtcbiAgICAgICAgcmVzdWx0W2tleV0gPSBtZXJnZShvYmpBW2tleV0sIG9iakJba2V5XSk7XG4gICAgICB9IGVsc2UgaWYgKGlzQXJyYXkob2JqQVtrZXldKSAmJiBpc0FycmF5KG9iakJba2V5XSkpIHtcbiAgICAgICAgdmFyIGxlbmd0aCA9IE1hdGgubWF4KG9iakFba2V5XS5sZW5ndGgsIG9iakJba2V5XS5sZW5ndGgpO1xuICAgICAgICByZXN1bHRba2V5XSA9IG5ldyBBcnJheShsZW5ndGgpO1xuXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICBpZiAoaSBpbiBvYmpCW2tleV0pIHtcbiAgICAgICAgICAgIHJlc3VsdFtrZXldW2ldID0gb2JqQltrZXldW2ldO1xuICAgICAgICAgIH0gZWxzZSBpZiAoaSBpbiBvYmpBW2tleV0pIHtcbiAgICAgICAgICAgIHJlc3VsdFtrZXldW2ldID0gb2JqQVtrZXldW2ldO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmVzdWx0W2tleV0gPSBvYmpCW2tleV07XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHJlc3VsdFtrZXldID0gb2JqQVtrZXldO1xuICAgIH1cbiAgfSwgb2JqQSk7XG4gIGZvck93bihmdW5jdGlvbiAodmFsdWUsIGtleSkge1xuICAgIGlmICghaGFzT3duKGtleSwgcmVzdWx0KSkge1xuICAgICAgcmVzdWx0W2tleV0gPSBvYmpCW2tleV07XG4gICAgfVxuICB9LCBvYmpCKTtcbiAgcmV0dXJuIHJlc3VsdDtcbn1cblxuZnVuY3Rpb24gbWVyZ2VBbGwob2Jqcykge1xuICBpZiAob2Jqcy5sZW5ndGggPT09IDApIHtcbiAgICByZXR1cm4ge307XG4gIH1cblxuICB2YXIgZmlyc3QgPSBvYmpzWzBdLFxuICAgICAgcmVzdCA9IG9ianMuc2xpY2UoMSk7XG4gIHJldHVybiByZXN0LnJlZHVjZShmdW5jdGlvbiAobWVyZ2VkLCBvYmopIHtcbiAgICByZXR1cm4gbWVyZ2UobWVyZ2VkLCBvYmopO1xuICB9LCBmaXJzdCk7XG59XG5cbmZ1bmN0aW9uIG1lbW9pemVXaXRoKGtleVJlc29sdmVyLCBmdW5jKSB7XG4gIHZhciBjYWNoZSA9IHt9O1xuICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgIHZhciBrZXkgPSBrZXlSZXNvbHZlci5hcHBseSh2b2lkIDAsIGFyZ3VtZW50cyk7XG5cbiAgICBpZiAoaGFzT3duKGtleSwgY2FjaGUpKSB7XG4gICAgICByZXR1cm4gY2FjaGVba2V5XTtcbiAgICB9XG5cbiAgICB2YXIgdmFsdWUgPSBmdW5jLmFwcGx5KHZvaWQgMCwgYXJndW1lbnRzKTtcbiAgICBjYWNoZVtrZXldID0gdmFsdWU7XG4gICAgcmV0dXJuIHZhbHVlO1xuICB9O1xufVxuXG4vLyBUT0RPOiB0ZWNobmljYWxseSB0aGlzIHNob3VsZCBhY2NlcHQgQW55RnVuY3Rpb24gYnV0IGl0IGRvZXNuJ3QgdHlwZSBjaGVjayBjdXJyZW50bHkgd2l0aCB0aGF0IGZvciBzb21lIHJlYXNvblxuZnVuY3Rpb24gbWVtb2l6ZShmdW5jKSB7XG4gIHJldHVybiBtZW1vaXplV2l0aChpZGVudGl0eSwgZnVuYyk7XG59XG5cbmZ1bmN0aW9uIG1lbW9pemVPbmUoZm4pIHtcbiAgdmFyIGNhbGxlZCA9IGZhbHNlO1xuICB2YXIgbWVtb2l6ZWQ7XG4gIHZhciBjYWNoZUtleTtcbiAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICBpZiAoY2FsbGVkICYmIChhcmd1bWVudHMubGVuZ3RoIDw9IDAgPyB1bmRlZmluZWQgOiBhcmd1bWVudHNbMF0pID09PSBjYWNoZUtleSkge1xuICAgICAgcmV0dXJuIG1lbW9pemVkO1xuICAgIH1cblxuICAgIGNhbGxlZCA9IHRydWU7XG4gICAgY2FjaGVLZXkgPSBhcmd1bWVudHMubGVuZ3RoIDw9IDAgPyB1bmRlZmluZWQgOiBhcmd1bWVudHNbMF07XG4gICAgbWVtb2l6ZWQgPSBmbi5hcHBseSh2b2lkIDAsIGFyZ3VtZW50cyk7XG4gICAgcmV0dXJuIG1lbW9pemVkO1xuICB9O1xufVxuXG5mdW5jdGlvbiBub29wKCkge31cblxuZnVuY3Rpb24gdmFsdWVzKG9iaikge1xuICByZXR1cm4gT2JqZWN0LmtleXMob2JqKS5tYXAoZnVuY3Rpb24gKGtleSkge1xuICAgIHJldHVybiBvYmpba2V5XTtcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIG51bWVyaWNTb3J0QnkocHJvcE9yTWFwcGVyLCBjb2xsZWN0aW9uKSB7XG4gIHZhciBtYXBwZXIgPSB0eXBlb2YgcHJvcE9yTWFwcGVyID09PSAnZnVuY3Rpb24nID8gcHJvcE9yTWFwcGVyIDogZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICByZXR1cm4gZ2V0KHByb3BPck1hcHBlciwgZWxlbWVudCk7XG4gIH07XG4gIHJldHVybiAoaXNBcnJheShjb2xsZWN0aW9uKSA/IFtdLmNvbmNhdChjb2xsZWN0aW9uKSA6IHZhbHVlcyhjb2xsZWN0aW9uKSkuc29ydChmdW5jdGlvbiAoZWxlbWVudEEsIGVsZW1lbnRCKSB7XG4gICAgcmV0dXJuIG1hcHBlcihlbGVtZW50QSkgLSBtYXBwZXIoZWxlbWVudEIpO1xuICB9KTtcbn1cblxuZnVuY3Rpb24gb21pdEJ5SW5kZXhlZChwcmVkaWNhdGUsIG9iaikge1xuICByZXR1cm4gT2JqZWN0LmtleXMob2JqKS5yZWR1Y2UoZnVuY3Rpb24gKGFjYywga2V5KSB7XG4gICAgaWYgKCFwcmVkaWNhdGUob2JqW2tleV0sIGtleSkpIHtcbiAgICAgIGFjY1trZXldID0gb2JqW2tleV07XG4gICAgfVxuXG4gICAgcmV0dXJuIGFjYztcbiAgfSwge30pO1xufVxuXG5mdW5jdGlvbiBvbWl0KGtleXMsIG9iaikge1xuICByZXR1cm4gb21pdEJ5SW5kZXhlZChmdW5jdGlvbiAoXywga2V5KSB7XG4gICAgcmV0dXJuIGtleXMuaW5kZXhPZihrZXkpICE9PSAtMTtcbiAgfSwgb2JqKTtcbn1cblxuZnVuY3Rpb24gb21pdEJ5KHByZWRpY2F0ZSwgb2JqKSB7XG4gIHJldHVybiBPYmplY3Qua2V5cyhvYmopLnJlZHVjZShmdW5jdGlvbiAoYWNjLCBrZXkpIHtcbiAgICBpZiAoIXByZWRpY2F0ZShvYmpba2V5XSkpIHtcbiAgICAgIGFjY1trZXldID0gb2JqW2tleV07XG4gICAgfVxuXG4gICAgcmV0dXJuIGFjYztcbiAgfSwge30pO1xufVxuXG5mdW5jdGlvbiBvbmNlKGZuKSB7XG4gIHZhciBjYWxsZWQgPSBmYWxzZTtcbiAgdmFyIHJlc3VsdDtcbiAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICBpZiAoY2FsbGVkKSB7XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cblxuICAgIGNhbGxlZCA9IHRydWU7XG4gICAgcmV0dXJuIHJlc3VsdCA9IGZuLmFwcGx5KHZvaWQgMCwgYXJndW1lbnRzKTtcbiAgfTtcbn1cblxuZnVuY3Rpb24gb3ZlcihmbnMpIHtcbiAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICBmb3IgKHZhciBfbGVuID0gYXJndW1lbnRzLmxlbmd0aCwgYXJncyA9IG5ldyBBcnJheShfbGVuKSwgX2tleSA9IDA7IF9rZXkgPCBfbGVuOyBfa2V5KyspIHtcbiAgICAgIGFyZ3NbX2tleV0gPSBhcmd1bWVudHNbX2tleV07XG4gICAgfVxuXG4gICAgcmV0dXJuIGZucy5tYXAoZnVuY3Rpb24gKGZuKSB7XG4gICAgICByZXR1cm4gZm4uYXBwbHkodm9pZCAwLCBhcmdzKTtcbiAgICB9KTtcbiAgfTtcbn1cblxuZnVuY3Rpb24gdGFrZUxhc3QoY291bnQsIGFycikge1xuICByZXR1cm4gYXJyLnNsaWNlKC1jb3VudCk7XG59XG5cbmZ1bmN0aW9uIG92ZXJBcmdzKGZuLCB0cmFuc2Zvcm1lcnMpIHtcbiAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICBmb3IgKHZhciBfbGVuID0gYXJndW1lbnRzLmxlbmd0aCwgYXJncyA9IG5ldyBBcnJheShfbGVuKSwgX2tleSA9IDA7IF9rZXkgPCBfbGVuOyBfa2V5KyspIHtcbiAgICAgIGFyZ3NbX2tleV0gPSBhcmd1bWVudHNbX2tleV07XG4gICAgfVxuXG4gICAgdmFyIHRyYW5zZm9ybWVkID0gdHJhbnNmb3JtZXJzLm1hcChmdW5jdGlvbiAodHJhbnNmb3JtLCBpbmRleCkge1xuICAgICAgcmV0dXJuIHRyYW5zZm9ybShhcmdzW2luZGV4XSk7XG4gICAgfSk7XG4gICAgcmV0dXJuIGFyZ3MubGVuZ3RoID4gdHJhbnNmb3JtZWQubGVuZ3RoID8gZm4uYXBwbHkodm9pZCAwLCB0cmFuc2Zvcm1lZC5jb25jYXQodGFrZUxhc3QoYXJncy5sZW5ndGggLSB0cmFuc2Zvcm1lZC5sZW5ndGgsIGFyZ3MpKSkgOiBmbi5hcHBseSh2b2lkIDAsIHRyYW5zZm9ybWVkKTtcbiAgfTtcbn1cblxuZnVuY3Rpb24gcGFpcihhLCBiKSB7XG4gIHJldHVybiBbYSwgYl07XG59XG5cbmZ1bmN0aW9uIHBhcnRpdGlvbk9iamVjdChwcmVkaWNhdGUsIG9iaikge1xuICByZXR1cm4gT2JqZWN0LmtleXMob2JqKS5yZWR1Y2UoZnVuY3Rpb24gKGFjYywga2V5KSB7XG4gICAgYWNjW3ByZWRpY2F0ZShvYmpba2V5XSkgPyAwIDogMV1ba2V5XSA9IG9ialtrZXldO1xuICAgIHJldHVybiBhY2M7XG4gIH0sIFt7fSwge31dKTtcbn1cblxuZnVuY3Rpb24gcGljayhwcm9wcywgb2JqKSB7XG4gIHJldHVybiBwcm9wcy5yZWR1Y2UoZnVuY3Rpb24gKGFjYywgcHJvcCkge1xuICAgIGFjY1twcm9wXSA9IG9ialtwcm9wXTtcbiAgICByZXR1cm4gYWNjO1xuICB9LCB7fSk7XG59XG5cbmZ1bmN0aW9uIHBpY2tCeShwcmVkaWNhdGUsIG9iaikge1xuICByZXR1cm4gT2JqZWN0LmtleXMob2JqKS5yZWR1Y2UoZnVuY3Rpb24gKGFjYywga2V5KSB7XG4gICAgaWYgKHByZWRpY2F0ZShvYmpba2V5XSkpIHtcbiAgICAgIGFjY1trZXldID0gb2JqW2tleV07XG4gICAgfVxuXG4gICAgcmV0dXJuIGFjYztcbiAgfSwge30pO1xufVxuXG5mdW5jdGlvbiBwaWNrQnlJbmRleGVkKHByZWRpY2F0ZSwgb2JqKSB7XG4gIHJldHVybiBPYmplY3Qua2V5cyhvYmopLnJlZHVjZShmdW5jdGlvbiAoYWNjLCBrZXkpIHtcbiAgICBpZiAocHJlZGljYXRlKG9ialtrZXldLCBrZXkpKSB7XG4gICAgICBhY2Nba2V5XSA9IG9ialtrZXldO1xuICAgIH1cblxuICAgIHJldHVybiBhY2M7XG4gIH0sIHt9KTtcbn1cblxuZnVuY3Rpb24gcGlja093bihwcm9wcywgb2JqKSB7XG4gIHJldHVybiBwcm9wcy5yZWR1Y2UoZnVuY3Rpb24gKGFjYywgcHJvcCkge1xuICAgIGlmIChoYXNPd24ocHJvcCwgb2JqKSkge1xuICAgICAgYWNjW3Byb3BdID0gb2JqW3Byb3BdO1xuICAgIH1cblxuICAgIHJldHVybiBhY2M7XG4gIH0sIHt9KTtcbn1cblxuZnVuY3Rpb24gcmFuZG9tSW50KG1pbiwgbWF4KSB7XG4gIHJldHVybiBtaW4gKyBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAobWF4IC0gbWluICsgMSkpO1xufVxuXG5mdW5jdGlvbiByYW5nZShtYXgpIHtcbiAgdmFyIGFyciA9IFtdO1xuICB2YXIgY291bnRlciA9IDA7XG5cbiAgd2hpbGUgKGNvdW50ZXIgPD0gbWF4KSB7XG4gICAgYXJyLnB1c2goY291bnRlcisrKTtcbiAgfVxuXG4gIHJldHVybiBhcnI7XG59XG5cbmZ1bmN0aW9uIHJlamVjdChwcmVkaWNhdGUsIGFycikge1xuICByZXR1cm4gYXJyLmZpbHRlcihmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgIHJldHVybiAhcHJlZGljYXRlKGVsZW1lbnQpO1xuICB9KTtcbn1cblxuZnVuY3Rpb24gcmVtb3ZlQXQoaW5kZXgsIGFycikge1xuICB2YXIgY29weSA9IFtdLmNvbmNhdChhcnIpO1xuICBjb3B5LnNwbGljZShpbmRleCwgMSk7XG4gIHJldHVybiBjb3B5O1xufVxuXG5mdW5jdGlvbiBfZXh0ZW5kcygpIHtcbiAgX2V4dGVuZHMgPSBPYmplY3QuYXNzaWduIHx8IGZ1bmN0aW9uICh0YXJnZXQpIHtcbiAgICBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykge1xuICAgICAgdmFyIHNvdXJjZSA9IGFyZ3VtZW50c1tpXTtcblxuICAgICAgZm9yICh2YXIga2V5IGluIHNvdXJjZSkge1xuICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHNvdXJjZSwga2V5KSkge1xuICAgICAgICAgIHRhcmdldFtrZXldID0gc291cmNlW2tleV07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gdGFyZ2V0O1xuICB9O1xuXG4gIHJldHVybiBfZXh0ZW5kcy5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xufVxuXG5mdW5jdGlvbiBzZXQoX2tleXMsIHZhbCwgb2JqKSB7XG4gIHZhciBfZXh0ZW5kczI7XG5cbiAgdmFyIGtleXMgPSBfa2V5cy5zcGxpdCA/IF9rZXlzLnNwbGl0KCcuJykgOiBfa2V5cztcbiAgdmFyIGluZGV4ID0ga2V5c1swXTtcbiAgdmFyIGZpbmFsVmFsID0gdmFsO1xuXG4gIGlmIChrZXlzLmxlbmd0aCA+IDEpIHtcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgZXFlcWVxXG4gICAgdmFyIG5leHRPYmogPSBvYmogIT0gbnVsbCAmJiBoYXNPd24oaW5kZXgsIG9iaikgPyBvYmpbaW5kZXhdIDoge307XG4gICAgZmluYWxWYWwgPSBzZXQoa2V5cy5zbGljZSgxKSwgdmFsLCBuZXh0T2JqKTtcbiAgfVxuXG4gIHJldHVybiBfZXh0ZW5kcyh7fSwgb2JqLCAoX2V4dGVuZHMyID0ge30sIF9leHRlbmRzMltpbmRleF0gPSBmaW5hbFZhbCwgX2V4dGVuZHMyKSk7XG59XG5cbi8vIGh0dHBzOi8vZ2l0aHViLmNvbS9yZWFjdGpzL3JlYWN0LXJlZHV4L2Jsb2IvNWQ3OTJhMjgzNTU0Y2ZmM2QyZjU0ZmFkMWJlMWY3OWNiY2FiMzNmZS9zcmMvdXRpbHMvc2hhbGxvd0VxdWFsLmpzXG5cbmZ1bmN0aW9uIGlzKGZpcnN0LCBzZWNvbmQpIHtcbiAgaWYgKGZpcnN0ID09PSBzZWNvbmQpIHtcbiAgICByZXR1cm4gZmlyc3QgIT09IDAgfHwgc2Vjb25kICE9PSAwIHx8IDEgLyBmaXJzdCA9PT0gMSAvIHNlY29uZDtcbiAgfSAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tc2VsZi1jb21wYXJlXG5cblxuICByZXR1cm4gZmlyc3QgIT09IGZpcnN0ICYmIHNlY29uZCAhPT0gc2Vjb25kO1xufVxuXG5mdW5jdGlvbiBzaGFsbG93RXF1YWwob2JqQSwgb2JqQikge1xuICBpZiAoaXMob2JqQSwgb2JqQikpIHJldHVybiB0cnVlO1xuXG4gIGlmICh0eXBlb2Ygb2JqQSAhPT0gJ29iamVjdCcgfHwgb2JqQSA9PT0gbnVsbCB8fCB0eXBlb2Ygb2JqQiAhPT0gJ29iamVjdCcgfHwgb2JqQiA9PT0gbnVsbCkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIHZhciBrZXlzQSA9IE9iamVjdC5rZXlzKG9iakEpO1xuICB2YXIga2V5c0IgPSBPYmplY3Qua2V5cyhvYmpCKTtcbiAgaWYgKGtleXNBLmxlbmd0aCAhPT0ga2V5c0IubGVuZ3RoKSByZXR1cm4gZmFsc2U7XG5cbiAgZm9yICh2YXIgaW5kZXggPSAwOyBpbmRleCA8IGtleXNBLmxlbmd0aDsgaW5kZXgrKykge1xuICAgIGlmICghaGFzT3duKGtleXNBW2luZGV4XSwgb2JqQikgfHwgIWlzKG9iakFba2V5c0FbaW5kZXhdXSwgb2JqQltrZXlzQVtpbmRleF1dKSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiB0cnVlO1xufVxuXG5mdW5jdGlvbiBzaWduKHZhbHVlKSB7XG4gIGlmICh0eXBlb2YgdmFsdWUgIT09ICdudW1iZXInIHx8IGlzTmFOKHZhbHVlKSkge1xuICAgIHJldHVybiBOYU47XG4gIH1cblxuICBpZiAodmFsdWUgPT09IDApIHtcbiAgICByZXR1cm4gMDtcbiAgfSAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tY29tcGFyZS1uZWctemVyb1xuXG5cbiAgaWYgKHZhbHVlID09PSAtMCkge1xuICAgIHJldHVybiAtMDtcbiAgfVxuXG4gIHJldHVybiB2YWx1ZSA+IDAgPyAxIDogLTE7XG59XG5cbmZ1bmN0aW9uIHNodWZmbGUoYXJyKSB7XG4gIHZhciBjb3B5ID0gYXJyLnNsaWNlKCk7XG4gIHZhciBsYXN0SW5kZXggPSBhcnIubGVuZ3RoIC0gMTtcblxuICBmb3IgKHZhciBpID0gMDsgaSA8IGFyci5sZW5ndGg7IGkrKykge1xuICAgIHZhciByYW5kb21JbmRleCA9IHJhbmRvbUludChpLCBsYXN0SW5kZXgpO1xuICAgIHZhciByYW5kb21WYWx1ZSA9IGNvcHlbcmFuZG9tSW5kZXhdO1xuICAgIGNvcHlbcmFuZG9tSW5kZXhdID0gY29weVtpXTtcbiAgICBjb3B5W2ldID0gcmFuZG9tVmFsdWU7XG4gIH1cblxuICByZXR1cm4gY29weTtcbn1cblxuZnVuY3Rpb24gc2xpY2VEaWZmKHNsaWNlLCBvYmopIHtcbiAgdmFyIHBpY2tlZCA9IHBpY2tCeUluZGV4ZWQoZnVuY3Rpb24gKHZhbHVlLCBrZXkpIHtcbiAgICByZXR1cm4gdmFsdWUgIT09IG9ialtrZXldO1xuICB9LCBzbGljZSk7XG4gIHJldHVybiBpc0VtcHR5KHBpY2tlZCkgPyBudWxsIDogcGlja2VkO1xufVxuXG4vLyBUT0RPOiB0aGlzIGNvdWxkIGJlIHdyaXR0ZW4gYSBsb3QgYmV0dGVyXG5mdW5jdGlvbiBzbmFrZUNhc2Uoc3RyKSB7XG4gIHZhciBzbmFrZUNhc2VkID0gc3RyLnJlcGxhY2UoL1tBLVpdfChbLV8gXSspL2csIGZ1bmN0aW9uIChtYXRjaCkge1xuICAgIHZhciBjb2RlID0gbWF0Y2guY2hhckNvZGVBdCgwKTtcbiAgICB2YXIgdXBwZXJDYXNlZCA9IGNvZGUgPiA2NCAmJiBjb2RlIDwgOTE7XG4gICAgcmV0dXJuIHVwcGVyQ2FzZWQgPyBcIl9cIiArIG1hdGNoLnRvTG93ZXJDYXNlKCkgOiAnXyc7XG4gIH0pO1xuICByZXR1cm4gc25ha2VDYXNlZFswXSA9PT0gJ18nID8gc25ha2VDYXNlZC5zdWJzdHIoMSkgOiBzbmFrZUNhc2VkO1xufVxuXG5mdW5jdGlvbiBzb21lQXJlVHJ1dGh5KGFycikge1xuICByZXR1cm4gYXJyLnNvbWUoaWRlbnRpdHkpO1xufVxuXG5mdW5jdGlvbiBzcGxpdEF0KHNwbGl0UG9pbnQsIGFyck9yU3RyKSB7XG4gIHJldHVybiBbYXJyT3JTdHIuc2xpY2UoMCwgc3BsaXRQb2ludCksIGFyck9yU3RyLnNsaWNlKHNwbGl0UG9pbnQsIGFyck9yU3RyLmxlbmd0aCldO1xufVxuXG5mdW5jdGlvbiBzcGxpdFJpZ2h0V2hlbkFjY3VtKGZuLCBhY2MsIGFycikge1xuICB2YXIgcmVzdWx0ID0gZmFsc2U7XG5cbiAgZm9yICh2YXIgaW5kZXggPSBhcnIubGVuZ3RoOyBpbmRleCA+IDA7IGluZGV4LS0pIHtcblxuICAgIHZhciBfZm4gPSBmbihhcnJbaW5kZXggLSAxXSwgYWNjKTtcblxuICAgIHJlc3VsdCA9IF9mblswXTtcbiAgICBhY2MgPSBfZm5bMV07XG5cbiAgICBpZiAocmVzdWx0KSB7XG4gICAgICByZXR1cm4gc3BsaXRBdChpbmRleCAtIDEsIGFycik7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIFtbXSwgYXJyXTtcbn1cblxuZnVuY3Rpb24gc3ByZWFkKGZuKSB7XG4gIHJldHVybiBmdW5jdGlvbiAoYXJncykge1xuICAgIHJldHVybiBmbi5hcHBseSh2b2lkIDAsIGFyZ3MpO1xuICB9O1xufVxuXG5mdW5jdGlvbiBzdW0obnVtYmVycykge1xuICByZXR1cm4gbnVtYmVycy5yZWR1Y2UoYWRkLCAwKTtcbn1cblxuZnVuY3Rpb24gdGFrZShjb3VudCwgYXJyKSB7XG4gIHJldHVybiBhcnIuc2xpY2UoMCwgY291bnQpO1xufVxuXG5mdW5jdGlvbiB0YWtlUmlnaHRXaGlsZUZyb20ocHJlZGljYXRlLCBzdGFydEluZGV4LCBhcnIpIHtcbiAgdmFyIGVuZEluZGV4ID0gZmluZExhc3RJbmRleEZyb20oZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICByZXR1cm4gIXByZWRpY2F0ZShlbGVtZW50KTtcbiAgfSwgc3RhcnRJbmRleCwgYXJyKTtcbiAgcmV0dXJuIGVuZEluZGV4ID09PSBzdGFydEluZGV4ID8gW10gOiBhcnIuc2xpY2UoZW5kSW5kZXggKyAxLCBzdGFydEluZGV4ICsgMSk7XG59XG5cbmZ1bmN0aW9uIHRha2VSaWdodFdoaWxlKHByZWRpY2F0ZSwgYXJyKSB7XG4gIHJldHVybiB0YWtlUmlnaHRXaGlsZUZyb20ocHJlZGljYXRlLCBhcnIubGVuZ3RoIC0gMSwgYXJyKTtcbn1cblxuZnVuY3Rpb24gdGhyb3R0bGUobXMsIGZuKSB7XG4gIHZhciBsYXN0Q2FsbCA9IERhdGUubm93KCkgLSAyICogbXM7XG4gIHZhciB0cmFpbGluZ0lkO1xuXG4gIHZhciBpbnZva2UgPSBmdW5jdGlvbiBpbnZva2UoKSB7XG4gICAgbGFzdENhbGwgPSBEYXRlLm5vdygpO1xuICAgIGZuLmFwcGx5KHZvaWQgMCwgYXJndW1lbnRzKTtcbiAgfTtcblxuICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgIHZhciBub3cgPSBEYXRlLm5vdygpO1xuXG4gICAgZm9yICh2YXIgX2xlbiA9IGFyZ3VtZW50cy5sZW5ndGgsIGFyZ3MgPSBuZXcgQXJyYXkoX2xlbiksIF9rZXkgPSAwOyBfa2V5IDwgX2xlbjsgX2tleSsrKSB7XG4gICAgICBhcmdzW19rZXldID0gYXJndW1lbnRzW19rZXldO1xuICAgIH1cblxuICAgIGlmIChub3cgLSBsYXN0Q2FsbCA+PSBtcykge1xuICAgICAgaW52b2tlLmFwcGx5KHZvaWQgMCwgYXJncyk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY2xlYXJUaW1lb3V0KHRyYWlsaW5nSWQpO1xuICAgIHRyYWlsaW5nSWQgPSBzZXRUaW1lb3V0LmFwcGx5KHZvaWQgMCwgW2ludm9rZSwgbGFzdENhbGwgLSBub3cgKyBtc10uY29uY2F0KGFyZ3MpKTtcbiAgfTtcbn1cblxuZnVuY3Rpb24gdG9BcnJheShhcnJheUxpa2UpIHtcbiAgcmV0dXJuIEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFycmF5TGlrZSk7XG59XG5cbnZhciB0b0ZpeGVkTnVtYmVyID0gZnVuY3Rpb24gdG9GaXhlZE51bWJlcihudW0sIGRpZ2l0cykge1xuICByZXR1cm4gTnVtYmVyKG51bS50b0ZpeGVkKGRpZ2l0cykpO1xufTtcblxudmFyIHRvUGFpcnMgPSBmdW5jdGlvbiB0b1BhaXJzKG9iaikge1xuICByZXR1cm4gT2JqZWN0LmtleXMob2JqKS5tYXAoZnVuY3Rpb24gKGtleSkge1xuICAgIHJldHVybiBba2V5LCBvYmpba2V5XV07XG4gIH0pO1xufTtcblxuZnVuY3Rpb24gdHJhaWxpbmdUaHJvdHRsZShtcywgZm4pIHtcbiAgdmFyIGxhc3RDYWxsID0gRGF0ZS5ub3coKSAtIDIgKiBtcztcbiAgdmFyIHRyYWlsaW5nSWQ7XG5cbiAgdmFyIGludm9rZSA9IGZ1bmN0aW9uIGludm9rZSgpIHtcbiAgICBsYXN0Q2FsbCA9IERhdGUubm93KCk7XG4gICAgcmV0dXJuIGZuLmFwcGx5KHZvaWQgMCwgYXJndW1lbnRzKTtcbiAgfTtcblxuICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgIHZhciBub3cgPSBEYXRlLm5vdygpO1xuXG4gICAgaWYgKG5vdyAtIGxhc3RDYWxsID49IG1zKSB7XG4gICAgICBsYXN0Q2FsbCA9IERhdGUubm93KCk7XG4gICAgfVxuXG4gICAgY2xlYXJUaW1lb3V0KHRyYWlsaW5nSWQpO1xuXG4gICAgZm9yICh2YXIgX2xlbiA9IGFyZ3VtZW50cy5sZW5ndGgsIGFyZ3MgPSBuZXcgQXJyYXkoX2xlbiksIF9rZXkgPSAwOyBfa2V5IDwgX2xlbjsgX2tleSsrKSB7XG4gICAgICBhcmdzW19rZXldID0gYXJndW1lbnRzW19rZXldO1xuICAgIH1cblxuICAgIHRyYWlsaW5nSWQgPSBzZXRUaW1lb3V0LmFwcGx5KHZvaWQgMCwgW2ludm9rZSwgbGFzdENhbGwgLSBub3cgKyBtc10uY29uY2F0KGFyZ3MpKTtcbiAgfTtcbn1cblxuZnVuY3Rpb24gbGVhZGluZ1Rocm90dGxlKG1zLCBmbikge1xuICB2YXIgbGFzdENhbGwgPSAwO1xuICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgIHZhciBub3cgPSBEYXRlLm5vdygpO1xuXG4gICAgaWYgKG5vdyAtIGxhc3RDYWxsID49IG1zKSB7XG4gICAgICBsYXN0Q2FsbCA9IERhdGUubm93KCk7XG4gICAgICBmbi5hcHBseSh2b2lkIDAsIGFyZ3VtZW50cyk7XG4gICAgfVxuICB9O1xufVxuXG52YXIgc3RyaW5nQ29tcGFyZSA9IGZ1bmN0aW9uIHN0cmluZ0NvbXBhcmUoc3RyQSwgc3RyQikge1xuICBpZiAoc3RyQSA9PT0gc3RyQikge1xuICAgIHJldHVybiAwO1xuICB9XG5cbiAgcmV0dXJuIHN0ckEgPCBzdHJCID8gLTEgOiAxO1xufTtcblxudmFyIGxlYWRpbmdXaGl0ZVNwYWNlID0gL15cXHMrLztcbmZ1bmN0aW9uIHRyaW1TdGFydChzdHIpIHtcbiAgcmV0dXJuIHN0ci5yZXBsYWNlKGxlYWRpbmdXaGl0ZVNwYWNlLCAnJyk7XG59XG5cbnZhciB0cmFpbGluZ1doaXRlU3BhY2UgPSAvXFxzKyQvO1xuZnVuY3Rpb24gdHJpbUVuZChzdHIpIHtcbiAgcmV0dXJuIHN0ci5yZXBsYWNlKHRyYWlsaW5nV2hpdGVTcGFjZSwgJycpO1xufVxuXG5mdW5jdGlvbiByZXBlYXQoY291bnQsIHRleHQpIHtcbiAgcmV0dXJuIEFycmF5KGNvdW50ICsgMSkuam9pbih0ZXh0KTtcbn1cblxuZnVuY3Rpb24gdW5pcUJ5KGl0ZXJhdGVlLCBhcnIpIHtcbiAgLy8gd2l0aCBwb2x5ZmlsbHMgdGhpcyBjb3VsZCBiZSBqdXN0OiByZXR1cm4gQXJyYXkuZnJvbShuZXcgU2V0KGFyci5tYXAoaXRlcmF0ZWUpKSlcbiAgdmFyIHNlZW4gPSBbXTtcbiAgcmV0dXJuIGFyci5maWx0ZXIoZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICB2YXIga2V5ID0gaXRlcmF0ZWUoZWxlbWVudCk7XG5cbiAgICBpZiAoc2Vlbi5pbmRleE9mKGtleSkgPT09IC0xKSB7XG4gICAgICBzZWVuLnB1c2goa2V5KTtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIHJldHVybiBmYWxzZTtcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIHVuaXEoYXJyKSB7XG4gIHJldHVybiB1bmlxQnkoaWRlbnRpdHksIGFycik7XG59XG5cbmZ1bmN0aW9uIHVwZGF0ZShpbmRleCwgbmV3RWxlbWVudCwgYXJyKSB7XG4gIHJldHVybiBbXS5jb25jYXQoYXJyLnNsaWNlKDAsIGluZGV4KSwgW25ld0VsZW1lbnRdLCBhcnIuc2xpY2UoaW5kZXggKyAxLCBhcnIubGVuZ3RoKSk7XG59XG5cbmZ1bmN0aW9uIHdpdGhvdXQocmVtb3ZlZCwgYXJyKSB7XG4gIHJldHVybiBhcnIuZmlsdGVyKGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgcmV0dXJuIHJlbW92ZWQuaW5kZXhPZihlbGVtZW50KSA9PT0gLTE7XG4gIH0pO1xufVxuXG5mdW5jdGlvbiB6aXBXaXRoKHppcHBlciwgYXJyYXlBLCBhcnJheUIpIHtcbiAgcmV0dXJuIGFycmF5QS5tYXAoZnVuY3Rpb24gKGVsZW1lbnRBLCBpbmRleCkge1xuICAgIHJldHVybiB6aXBwZXIoZWxlbWVudEEsIGFycmF5QltpbmRleF0pO1xuICB9KTtcbn1cblxuZnVuY3Rpb24gemlwKGFycmF5QSwgYXJyYXlCKSB7XG4gIHJldHVybiB6aXBXaXRoKHBhaXIsIGFycmF5QSwgYXJyYXlCKTtcbn1cblxuZXhwb3J0IHsgYWRkLCBhc3NpZ24sIGNhbWVsQ2FzZSwgY2FwaXRhbGl6ZUZpcnN0TGV0dGVyLCBjaGFpbiwgY2xvbmVEZWVwLCBjb21wYWN0LCBjb21wb3NlLCBkZWJvdW5jZSwgZGVlcE1lcmdlLCBkZWZhdWx0VG8sIGRyb3AsIGRyb3BSaWdodCwgZW5zdXJlQXJyYXksIGVudHJpZXMsIGZpbGxlZEFycmF5LCBmaW5kLCBmaW5kSW5kZXgsIGZpbmRLZXksIGZpbmRMYXN0LCBmaW5kTGFzdEluZGV4LCBmaW5kTGFzdEluZGV4RnJvbSwgZmxhdE1hcCwgZmxhdHRlbiwgZm9yT3duLCBmcm9tUGFpcnMsIGdlbmVyYXRlUmFuZG9tSWQsIGdlbmVyYXRlVW5pcXVlSWQsIGdldCwgZ2V0T3IsIGdyb3VwQnksIGdyb3VwS2V5cywgaGFzT3duLCBpZGVudGl0eSwgaW5jbHVkZXMsIGlzQXJyYXksIGlzRW1wdHksIGlzRmFsc3ksIGlzTmlsLCBpc09iamVjdCwgaXNQcm9taXNlLCBpc1RydXRoeSwga2V5QnksIGtleXMsIGxhc3QsIGxlYWRpbmdUaHJvdHRsZSwgbWFwS2V5cywgbWFwVmFsdWVzLCBtYXBWYWx1ZXNJbmRleGVkLCBtZW1vaXplLCBtZW1vaXplT25lLCBtZW1vaXplV2l0aCwgbWVyZ2UsIG1lcmdlQWxsLCBub29wLCBudW1lcmljU29ydEJ5LCBvbWl0LCBvbWl0QnksIG9taXRCeUluZGV4ZWQsIG9uY2UsIG92ZXIsIG92ZXJBcmdzLCBwYWlyLCBwYXJ0aXRpb25PYmplY3QsIHBpY2ssIHBpY2tCeSwgcGlja0J5SW5kZXhlZCwgcGlja093biwgcmFuZG9tSW50LCByYW5nZSwgcmVqZWN0LCByZW1vdmVBdCwgcmVwZWF0LCBzZXQsIHNoYWxsb3dFcXVhbCwgc2h1ZmZsZSwgc2lnbiwgc2xpY2VEaWZmLCBzbmFrZUNhc2UsIHNvbWVBcmVUcnV0aHksIHNwbGl0QXQsIHNwbGl0UmlnaHRXaGVuQWNjdW0sIHNwcmVhZCwgc3RyaW5nQ29tcGFyZSwgc3VtLCB0YWtlLCB0YWtlTGFzdCwgdGFrZVJpZ2h0V2hpbGUsIHRha2VSaWdodFdoaWxlRnJvbSwgdGhyb3R0bGUsIHRvQXJyYXksIHRvRml4ZWROdW1iZXIsIHRvUGFpcnMsIHRyYWlsaW5nVGhyb3R0bGUsIHRyaW1FbmQsIHRyaW1TdGFydCwgdW5pcSwgdW5pcUJ5LCB1cGRhdGUsIHZhbHVlcywgd2l0aG91dCwgemlwLCB6aXBXaXRoIH07XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///../../../node_modules/@livechat/data-utils/dist/data-utils.es.js\n");

/***/ }),

/***/ "../../../node_modules/@livechat/deferred/dist/deferred.esm.js":
/*!*********************************************************************!*\
  !*** ../../../node_modules/@livechat/deferred/dist/deferred.esm.js ***!
  \*********************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\nfunction deferred() {\n  var def = {};\n  def.promise = new Promise(function (resolve, reject) {\n    def.resolve = resolve;\n    def.reject = reject;\n  });\n  return def;\n}\n\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (deferred);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi4vLi4vLi4vbm9kZV9tb2R1bGVzL0BsaXZlY2hhdC9kZWZlcnJlZC9kaXN0L2RlZmVycmVkLmVzbS5qcy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uLi8uLi8uLi9ub2RlX21vZHVsZXMvQGxpdmVjaGF0L2RlZmVycmVkL2Rpc3QvZGVmZXJyZWQuZXNtLmpzP2ZkYTYiXSwic291cmNlc0NvbnRlbnQiOlsiZnVuY3Rpb24gZGVmZXJyZWQoKSB7XG4gIHZhciBkZWYgPSB7fTtcbiAgZGVmLnByb21pc2UgPSBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgZGVmLnJlc29sdmUgPSByZXNvbHZlO1xuICAgIGRlZi5yZWplY3QgPSByZWplY3Q7XG4gIH0pO1xuICByZXR1cm4gZGVmO1xufVxuXG5leHBvcnQgZGVmYXVsdCBkZWZlcnJlZDtcbiJdLCJtYXBwaW5ncyI6Ijs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///../../../node_modules/@livechat/deferred/dist/deferred.esm.js\n");

/***/ }),

/***/ "../../../node_modules/@livechat/dom-utils/dist/dom-utils.es.js":
/*!**********************************************************************!*\
  !*** ../../../node_modules/@livechat/dom-utils/dist/dom-utils.es.js ***!
  \**********************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"focusable\": () => (/* reexport safe */ tabbable__WEBPACK_IMPORTED_MODULE_1__.focusable),\n/* harmony export */   \"isFocusable\": () => (/* reexport safe */ tabbable__WEBPACK_IMPORTED_MODULE_1__.isFocusable),\n/* harmony export */   \"isTabbable\": () => (/* reexport safe */ tabbable__WEBPACK_IMPORTED_MODULE_1__.isTabbable),\n/* harmony export */   \"tabbable\": () => (/* reexport safe */ tabbable__WEBPACK_IMPORTED_MODULE_1__.tabbable),\n/* harmony export */   \"applyElementSpec\": () => (/* binding */ applyElementSpec),\n/* harmony export */   \"applyStyle\": () => (/* binding */ applyStyle),\n/* harmony export */   \"getComputedStyle\": () => (/* binding */ getComputedStyle),\n/* harmony export */   \"getNextTabbable\": () => (/* binding */ getNextTabbable),\n/* harmony export */   \"getRTLOffsetType\": () => (/* binding */ getRTLOffsetType),\n/* harmony export */   \"getRoot\": () => (/* binding */ getRoot),\n/* harmony export */   \"isScrollOnBottom\": () => (/* binding */ isScrollOnBottom),\n/* harmony export */   \"isScrollOnTop\": () => (/* binding */ isScrollOnTop),\n/* harmony export */   \"prependChild\": () => (/* binding */ prependChild),\n/* harmony export */   \"removeNode\": () => (/* binding */ removeNode),\n/* harmony export */   \"scrollToBottom\": () => (/* binding */ scrollToBottom),\n/* harmony export */   \"scrollToTop\": () => (/* binding */ scrollToTop)\n/* harmony export */ });\n/* harmony import */ var _livechat_data_utils__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @livechat/data-utils */ \"../../../node_modules/@livechat/data-utils/dist/data-utils.es.js\");\n/* harmony import */ var tabbable__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! tabbable */ \"../../../node_modules/tabbable/dist/index.esm.js\");\n\n\n\n\nvar applyStyle = (function (style, element) {\n  (0,_livechat_data_utils__WEBPACK_IMPORTED_MODULE_0__.forOwn)(function (value, key) {\n    element.style[key] = value;\n  }, style);\n});\n\nvar applyElementSpec = (function (attributes, element) {\n  var iteratee = function iteratee(value, key) {\n    if (key === 'style') {\n      applyStyle(value, element);\n      return;\n    }\n\n    element.setAttribute(key, value);\n  };\n\n  (0,_livechat_data_utils__WEBPACK_IMPORTED_MODULE_0__.forOwn)(iteratee, attributes);\n});\n\nvar isIE = !!document.documentElement.currentStyle;\n\nvar getComputedStyle = function getComputedStyle(props, element) {\n  var styles = window.getComputedStyle(element);\n  var borderBox = styles.boxSizing === 'border-box';\n  var picked = (0,_livechat_data_utils__WEBPACK_IMPORTED_MODULE_0__.pick)(props, styles);\n\n  if (isIE && borderBox && (0,_livechat_data_utils__WEBPACK_IMPORTED_MODULE_0__.hasOwn)('width', picked) && picked.width !== null) {\n    var widths = [picked.width, styles.paddingLeft, styles.paddingRight, styles.borderLeftWidth, styles.borderRightWidth];\n    picked.width = (0,_livechat_data_utils__WEBPACK_IMPORTED_MODULE_0__.sum)(widths.map(parseFloat)) + 'px';\n  }\n\n  if (isIE && borderBox && (0,_livechat_data_utils__WEBPACK_IMPORTED_MODULE_0__.hasOwn)('height', picked) && picked.height !== null) {\n    var heights = [picked.height, styles.paddingTop, styles.paddingBottom, styles.borderTopWidth, styles.borderBottomWidth];\n    picked.height = (0,_livechat_data_utils__WEBPACK_IMPORTED_MODULE_0__.sum)(heights.map(parseFloat)) + 'px';\n  }\n\n  return picked;\n};\n\nfunction getNextTabbable(element, container) {\n  if (container === void 0) {\n    container = document.body;\n  }\n\n  var tabbables = (0,tabbable__WEBPACK_IMPORTED_MODULE_1__.tabbable)(container);\n  var elementIndex = (0,_livechat_data_utils__WEBPACK_IMPORTED_MODULE_0__.findIndex)(function (el) {\n    return el === element;\n  }, tabbables);\n  var isElementLast = elementIndex === tabbables.length - 1;\n  return tabbables[isElementLast ? 0 : elementIndex + 1];\n}\n\nfunction getRoot() {\n  return new Promise(function (resolve) {\n    var next = function next() {\n      if (!document.body) {\n        setTimeout(next, 100);\n        return;\n      }\n\n      resolve(document.body);\n    };\n\n    next();\n  });\n}\n\nvar cachedRTLOffsetType = null; // https://github.com/bvaughn/react-window/blob/c035eee067ea89029c89ecffd9eade1fc2ecb2dd/src/domHelpers.js#L31-L36\n\nvar getRTLOffsetType = function getRTLOffsetType() {\n  if (cachedRTLOffsetType) {\n    return cachedRTLOffsetType;\n  }\n\n  var outerDiv = document.createElement('div');\n  var outerStyle = outerDiv.style;\n  outerStyle.width = '50px';\n  outerStyle.height = '50px';\n  outerStyle.overflow = 'scroll';\n  outerStyle.direction = 'rtl';\n  var innerDiv = document.createElement('div');\n  var innerStyle = innerDiv.style;\n  innerStyle.width = '100px';\n  innerStyle.height = '50px';\n  outerDiv.appendChild(innerDiv);\n  document.body.appendChild(outerDiv);\n\n  if (outerDiv.scrollLeft > 0) {\n    // Chrome 😩\n    // it renders initially with max scrollLeft and to shift it to the left we need to subtract the distance\n    cachedRTLOffsetType = 'positive-descending';\n  } else {\n    outerDiv.scrollLeft = 1;\n\n    if (outerDiv.scrollLeft === 0) {\n      // spec-compliant\n      // it renders initially with 0 and to shift it to the left we need to subtract the distance\n      cachedRTLOffsetType = 'negative';\n    } else {\n      // non-chromium Edge 🤦‍♂️\n      // it renders initially with 0 and to shift it to the left we need to add the distance\n      cachedRTLOffsetType = 'positive-ascending';\n    }\n  }\n\n  document.body.removeChild(outerDiv);\n  return cachedRTLOffsetType;\n};\n\nfunction isScrollOnBottom(node, threshold) {\n  if (threshold === void 0) {\n    threshold = 0;\n  }\n\n  return Math.abs(node.scrollTop + node.clientHeight - node.scrollHeight) <= threshold;\n}\n\nfunction isScrollOnTop(node, threshold) {\n  if (threshold === void 0) {\n    threshold = 0;\n  }\n\n  return node.scrollTop <= threshold;\n}\n\nfunction prependChild(parentElement, newElement) {\n  parentElement.insertBefore(newElement, parentElement.children[0]);\n}\n\nfunction scrollToBottom(node) {\n  node.scrollTop = node.scrollHeight;\n}\n\nfunction scrollToTop(node) {\n  node.scrollTop = 0;\n}\n\nfunction removeNode(node) {\n  var parentNode = node.parentNode;\n\n  if (parentNode) {\n    parentNode.removeChild(node);\n  }\n}\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi4vLi4vLi4vbm9kZV9tb2R1bGVzL0BsaXZlY2hhdC9kb20tdXRpbHMvZGlzdC9kb20tdXRpbHMuZXMuanMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi4vLi4vLi4vbm9kZV9tb2R1bGVzL0BsaXZlY2hhdC9kb20tdXRpbHMvZGlzdC9kb20tdXRpbHMuZXMuanM/ZDk3NyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBmb3JPd24sIHBpY2ssIGhhc093biwgc3VtLCBmaW5kSW5kZXggfSBmcm9tICdAbGl2ZWNoYXQvZGF0YS11dGlscyc7XG5pbXBvcnQgeyB0YWJiYWJsZSBhcyB0YWJiYWJsZSQxIH0gZnJvbSAndGFiYmFibGUnO1xuZXhwb3J0ICogZnJvbSAndGFiYmFibGUnO1xuXG52YXIgYXBwbHlTdHlsZSA9IChmdW5jdGlvbiAoc3R5bGUsIGVsZW1lbnQpIHtcbiAgZm9yT3duKGZ1bmN0aW9uICh2YWx1ZSwga2V5KSB7XG4gICAgZWxlbWVudC5zdHlsZVtrZXldID0gdmFsdWU7XG4gIH0sIHN0eWxlKTtcbn0pO1xuXG52YXIgYXBwbHlFbGVtZW50U3BlYyA9IChmdW5jdGlvbiAoYXR0cmlidXRlcywgZWxlbWVudCkge1xuICB2YXIgaXRlcmF0ZWUgPSBmdW5jdGlvbiBpdGVyYXRlZSh2YWx1ZSwga2V5KSB7XG4gICAgaWYgKGtleSA9PT0gJ3N0eWxlJykge1xuICAgICAgYXBwbHlTdHlsZSh2YWx1ZSwgZWxlbWVudCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgZWxlbWVudC5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gIH07XG5cbiAgZm9yT3duKGl0ZXJhdGVlLCBhdHRyaWJ1dGVzKTtcbn0pO1xuXG52YXIgaXNJRSA9ICEhZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmN1cnJlbnRTdHlsZTtcblxudmFyIGdldENvbXB1dGVkU3R5bGUgPSBmdW5jdGlvbiBnZXRDb21wdXRlZFN0eWxlKHByb3BzLCBlbGVtZW50KSB7XG4gIHZhciBzdHlsZXMgPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShlbGVtZW50KTtcbiAgdmFyIGJvcmRlckJveCA9IHN0eWxlcy5ib3hTaXppbmcgPT09ICdib3JkZXItYm94JztcbiAgdmFyIHBpY2tlZCA9IHBpY2socHJvcHMsIHN0eWxlcyk7XG5cbiAgaWYgKGlzSUUgJiYgYm9yZGVyQm94ICYmIGhhc093bignd2lkdGgnLCBwaWNrZWQpICYmIHBpY2tlZC53aWR0aCAhPT0gbnVsbCkge1xuICAgIHZhciB3aWR0aHMgPSBbcGlja2VkLndpZHRoLCBzdHlsZXMucGFkZGluZ0xlZnQsIHN0eWxlcy5wYWRkaW5nUmlnaHQsIHN0eWxlcy5ib3JkZXJMZWZ0V2lkdGgsIHN0eWxlcy5ib3JkZXJSaWdodFdpZHRoXTtcbiAgICBwaWNrZWQud2lkdGggPSBzdW0od2lkdGhzLm1hcChwYXJzZUZsb2F0KSkgKyAncHgnO1xuICB9XG5cbiAgaWYgKGlzSUUgJiYgYm9yZGVyQm94ICYmIGhhc093bignaGVpZ2h0JywgcGlja2VkKSAmJiBwaWNrZWQuaGVpZ2h0ICE9PSBudWxsKSB7XG4gICAgdmFyIGhlaWdodHMgPSBbcGlja2VkLmhlaWdodCwgc3R5bGVzLnBhZGRpbmdUb3AsIHN0eWxlcy5wYWRkaW5nQm90dG9tLCBzdHlsZXMuYm9yZGVyVG9wV2lkdGgsIHN0eWxlcy5ib3JkZXJCb3R0b21XaWR0aF07XG4gICAgcGlja2VkLmhlaWdodCA9IHN1bShoZWlnaHRzLm1hcChwYXJzZUZsb2F0KSkgKyAncHgnO1xuICB9XG5cbiAgcmV0dXJuIHBpY2tlZDtcbn07XG5cbmZ1bmN0aW9uIGdldE5leHRUYWJiYWJsZShlbGVtZW50LCBjb250YWluZXIpIHtcbiAgaWYgKGNvbnRhaW5lciA9PT0gdm9pZCAwKSB7XG4gICAgY29udGFpbmVyID0gZG9jdW1lbnQuYm9keTtcbiAgfVxuXG4gIHZhciB0YWJiYWJsZXMgPSB0YWJiYWJsZSQxKGNvbnRhaW5lcik7XG4gIHZhciBlbGVtZW50SW5kZXggPSBmaW5kSW5kZXgoZnVuY3Rpb24gKGVsKSB7XG4gICAgcmV0dXJuIGVsID09PSBlbGVtZW50O1xuICB9LCB0YWJiYWJsZXMpO1xuICB2YXIgaXNFbGVtZW50TGFzdCA9IGVsZW1lbnRJbmRleCA9PT0gdGFiYmFibGVzLmxlbmd0aCAtIDE7XG4gIHJldHVybiB0YWJiYWJsZXNbaXNFbGVtZW50TGFzdCA/IDAgOiBlbGVtZW50SW5kZXggKyAxXTtcbn1cblxuZnVuY3Rpb24gZ2V0Um9vdCgpIHtcbiAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlKSB7XG4gICAgdmFyIG5leHQgPSBmdW5jdGlvbiBuZXh0KCkge1xuICAgICAgaWYgKCFkb2N1bWVudC5ib2R5KSB7XG4gICAgICAgIHNldFRpbWVvdXQobmV4dCwgMTAwKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICByZXNvbHZlKGRvY3VtZW50LmJvZHkpO1xuICAgIH07XG5cbiAgICBuZXh0KCk7XG4gIH0pO1xufVxuXG52YXIgY2FjaGVkUlRMT2Zmc2V0VHlwZSA9IG51bGw7IC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9idmF1Z2huL3JlYWN0LXdpbmRvdy9ibG9iL2MwMzVlZWUwNjdlYTg5MDI5Yzg5ZWNmZmQ5ZWFkZTFmYzJlY2IyZGQvc3JjL2RvbUhlbHBlcnMuanMjTDMxLUwzNlxuXG52YXIgZ2V0UlRMT2Zmc2V0VHlwZSA9IGZ1bmN0aW9uIGdldFJUTE9mZnNldFR5cGUoKSB7XG4gIGlmIChjYWNoZWRSVExPZmZzZXRUeXBlKSB7XG4gICAgcmV0dXJuIGNhY2hlZFJUTE9mZnNldFR5cGU7XG4gIH1cblxuICB2YXIgb3V0ZXJEaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgdmFyIG91dGVyU3R5bGUgPSBvdXRlckRpdi5zdHlsZTtcbiAgb3V0ZXJTdHlsZS53aWR0aCA9ICc1MHB4JztcbiAgb3V0ZXJTdHlsZS5oZWlnaHQgPSAnNTBweCc7XG4gIG91dGVyU3R5bGUub3ZlcmZsb3cgPSAnc2Nyb2xsJztcbiAgb3V0ZXJTdHlsZS5kaXJlY3Rpb24gPSAncnRsJztcbiAgdmFyIGlubmVyRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gIHZhciBpbm5lclN0eWxlID0gaW5uZXJEaXYuc3R5bGU7XG4gIGlubmVyU3R5bGUud2lkdGggPSAnMTAwcHgnO1xuICBpbm5lclN0eWxlLmhlaWdodCA9ICc1MHB4JztcbiAgb3V0ZXJEaXYuYXBwZW5kQ2hpbGQoaW5uZXJEaXYpO1xuICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKG91dGVyRGl2KTtcblxuICBpZiAob3V0ZXJEaXYuc2Nyb2xsTGVmdCA+IDApIHtcbiAgICAvLyBDaHJvbWUg8J+YqVxuICAgIC8vIGl0IHJlbmRlcnMgaW5pdGlhbGx5IHdpdGggbWF4IHNjcm9sbExlZnQgYW5kIHRvIHNoaWZ0IGl0IHRvIHRoZSBsZWZ0IHdlIG5lZWQgdG8gc3VidHJhY3QgdGhlIGRpc3RhbmNlXG4gICAgY2FjaGVkUlRMT2Zmc2V0VHlwZSA9ICdwb3NpdGl2ZS1kZXNjZW5kaW5nJztcbiAgfSBlbHNlIHtcbiAgICBvdXRlckRpdi5zY3JvbGxMZWZ0ID0gMTtcblxuICAgIGlmIChvdXRlckRpdi5zY3JvbGxMZWZ0ID09PSAwKSB7XG4gICAgICAvLyBzcGVjLWNvbXBsaWFudFxuICAgICAgLy8gaXQgcmVuZGVycyBpbml0aWFsbHkgd2l0aCAwIGFuZCB0byBzaGlmdCBpdCB0byB0aGUgbGVmdCB3ZSBuZWVkIHRvIHN1YnRyYWN0IHRoZSBkaXN0YW5jZVxuICAgICAgY2FjaGVkUlRMT2Zmc2V0VHlwZSA9ICduZWdhdGl2ZSc7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIG5vbi1jaHJvbWl1bSBFZGdlIPCfpKbigI3imYLvuI9cbiAgICAgIC8vIGl0IHJlbmRlcnMgaW5pdGlhbGx5IHdpdGggMCBhbmQgdG8gc2hpZnQgaXQgdG8gdGhlIGxlZnQgd2UgbmVlZCB0byBhZGQgdGhlIGRpc3RhbmNlXG4gICAgICBjYWNoZWRSVExPZmZzZXRUeXBlID0gJ3Bvc2l0aXZlLWFzY2VuZGluZyc7XG4gICAgfVxuICB9XG5cbiAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChvdXRlckRpdik7XG4gIHJldHVybiBjYWNoZWRSVExPZmZzZXRUeXBlO1xufTtcblxuZnVuY3Rpb24gaXNTY3JvbGxPbkJvdHRvbShub2RlLCB0aHJlc2hvbGQpIHtcbiAgaWYgKHRocmVzaG9sZCA9PT0gdm9pZCAwKSB7XG4gICAgdGhyZXNob2xkID0gMDtcbiAgfVxuXG4gIHJldHVybiBNYXRoLmFicyhub2RlLnNjcm9sbFRvcCArIG5vZGUuY2xpZW50SGVpZ2h0IC0gbm9kZS5zY3JvbGxIZWlnaHQpIDw9IHRocmVzaG9sZDtcbn1cblxuZnVuY3Rpb24gaXNTY3JvbGxPblRvcChub2RlLCB0aHJlc2hvbGQpIHtcbiAgaWYgKHRocmVzaG9sZCA9PT0gdm9pZCAwKSB7XG4gICAgdGhyZXNob2xkID0gMDtcbiAgfVxuXG4gIHJldHVybiBub2RlLnNjcm9sbFRvcCA8PSB0aHJlc2hvbGQ7XG59XG5cbmZ1bmN0aW9uIHByZXBlbmRDaGlsZChwYXJlbnRFbGVtZW50LCBuZXdFbGVtZW50KSB7XG4gIHBhcmVudEVsZW1lbnQuaW5zZXJ0QmVmb3JlKG5ld0VsZW1lbnQsIHBhcmVudEVsZW1lbnQuY2hpbGRyZW5bMF0pO1xufVxuXG5mdW5jdGlvbiBzY3JvbGxUb0JvdHRvbShub2RlKSB7XG4gIG5vZGUuc2Nyb2xsVG9wID0gbm9kZS5zY3JvbGxIZWlnaHQ7XG59XG5cbmZ1bmN0aW9uIHNjcm9sbFRvVG9wKG5vZGUpIHtcbiAgbm9kZS5zY3JvbGxUb3AgPSAwO1xufVxuXG5mdW5jdGlvbiByZW1vdmVOb2RlKG5vZGUpIHtcbiAgdmFyIHBhcmVudE5vZGUgPSBub2RlLnBhcmVudE5vZGU7XG5cbiAgaWYgKHBhcmVudE5vZGUpIHtcbiAgICBwYXJlbnROb2RlLnJlbW92ZUNoaWxkKG5vZGUpO1xuICB9XG59XG5cbmV4cG9ydCB7IGFwcGx5RWxlbWVudFNwZWMsIGFwcGx5U3R5bGUsIGdldENvbXB1dGVkU3R5bGUsIGdldE5leHRUYWJiYWJsZSwgZ2V0UlRMT2Zmc2V0VHlwZSwgZ2V0Um9vdCwgaXNTY3JvbGxPbkJvdHRvbSwgaXNTY3JvbGxPblRvcCwgcHJlcGVuZENoaWxkLCByZW1vdmVOb2RlLCBzY3JvbGxUb0JvdHRvbSwgc2Nyb2xsVG9Ub3AgfTtcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///../../../node_modules/@livechat/dom-utils/dist/dom-utils.es.js\n");

/***/ }),

/***/ "../../../node_modules/@livechat/file-upload/dist/file-upload.es.js":
/*!**************************************************************************!*\
  !*** ../../../node_modules/@livechat/file-upload/dist/file-upload.es.js ***!
  \**************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\nvar toFormData = function toFormData(object) {\n  var formData = new FormData();\n  Object.keys(object).forEach(function (key) {\n    return formData.append(key, object[key]);\n  });\n  return formData;\n};\n\nvar UPLOAD_FAILED = 'UPLOAD_FAILED';\nvar UPLOAD_CANCELED = 'UPLOAD_CANCELED';\n\nvar uploadFile = function uploadFile(url, data, _temp) {\n  var _ref = _temp === void 0 ? {} : _temp,\n      headers = _ref.headers,\n      _ref$method = _ref.method,\n      method = _ref$method === void 0 ? 'POST' : _ref$method,\n      onProgress = _ref.onProgress,\n      _ref$withCredentials = _ref.withCredentials,\n      withCredentials = _ref$withCredentials === void 0 ? false : _ref$withCredentials;\n\n  var xhr = new XMLHttpRequest();\n  var upload = new Promise(function (resolve, reject) {\n    if (typeof onProgress === 'function') {\n      xhr.upload.onprogress = function (event) {\n        onProgress(event.loaded / event.total);\n      };\n    }\n\n    xhr.onload = function () {\n      var response;\n\n      try {\n        response = JSON.parse(xhr.response);\n      } catch (err) {\n        response = xhr.response;\n      }\n\n      if (xhr.status >= 200 && xhr.status < 300) {\n        resolve(response);\n        return;\n      }\n\n      var err = new Error('Upload failed.');\n      err.code = UPLOAD_FAILED;\n      err.response = response;\n      reject(err);\n    };\n\n    xhr.onerror = function () {\n      var err = new Error('Upload failed.');\n      err.code = UPLOAD_FAILED;\n      reject(err);\n    };\n\n    xhr.onabort = function () {\n      var err = new Error('Upload canceled.');\n      err.code = UPLOAD_CANCELED;\n      reject(err);\n    };\n\n    xhr.open(method, url);\n    xhr.withCredentials = withCredentials;\n\n    if (headers) {\n      Object.keys(headers).forEach(function (header) {\n        return xhr.setRequestHeader(header, headers[header]);\n      });\n    }\n\n    xhr.send(toFormData(data));\n  });\n  return {\n    promise: upload,\n    cancel: function cancel() {\n      xhr.abort();\n    }\n  };\n};\n\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (uploadFile);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi4vLi4vLi4vbm9kZV9tb2R1bGVzL0BsaXZlY2hhdC9maWxlLXVwbG9hZC9kaXN0L2ZpbGUtdXBsb2FkLmVzLmpzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4uLy4uLy4uL25vZGVfbW9kdWxlcy9AbGl2ZWNoYXQvZmlsZS11cGxvYWQvZGlzdC9maWxlLXVwbG9hZC5lcy5qcz8zMDJmIl0sInNvdXJjZXNDb250ZW50IjpbInZhciB0b0Zvcm1EYXRhID0gZnVuY3Rpb24gdG9Gb3JtRGF0YShvYmplY3QpIHtcbiAgdmFyIGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCk7XG4gIE9iamVjdC5rZXlzKG9iamVjdCkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgcmV0dXJuIGZvcm1EYXRhLmFwcGVuZChrZXksIG9iamVjdFtrZXldKTtcbiAgfSk7XG4gIHJldHVybiBmb3JtRGF0YTtcbn07XG5cbnZhciBVUExPQURfRkFJTEVEID0gJ1VQTE9BRF9GQUlMRUQnO1xudmFyIFVQTE9BRF9DQU5DRUxFRCA9ICdVUExPQURfQ0FOQ0VMRUQnO1xuXG52YXIgdXBsb2FkRmlsZSA9IGZ1bmN0aW9uIHVwbG9hZEZpbGUodXJsLCBkYXRhLCBfdGVtcCkge1xuICB2YXIgX3JlZiA9IF90ZW1wID09PSB2b2lkIDAgPyB7fSA6IF90ZW1wLFxuICAgICAgaGVhZGVycyA9IF9yZWYuaGVhZGVycyxcbiAgICAgIF9yZWYkbWV0aG9kID0gX3JlZi5tZXRob2QsXG4gICAgICBtZXRob2QgPSBfcmVmJG1ldGhvZCA9PT0gdm9pZCAwID8gJ1BPU1QnIDogX3JlZiRtZXRob2QsXG4gICAgICBvblByb2dyZXNzID0gX3JlZi5vblByb2dyZXNzLFxuICAgICAgX3JlZiR3aXRoQ3JlZGVudGlhbHMgPSBfcmVmLndpdGhDcmVkZW50aWFscyxcbiAgICAgIHdpdGhDcmVkZW50aWFscyA9IF9yZWYkd2l0aENyZWRlbnRpYWxzID09PSB2b2lkIDAgPyBmYWxzZSA6IF9yZWYkd2l0aENyZWRlbnRpYWxzO1xuXG4gIHZhciB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcbiAgdmFyIHVwbG9hZCA9IG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICBpZiAodHlwZW9mIG9uUHJvZ3Jlc3MgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgIHhoci51cGxvYWQub25wcm9ncmVzcyA9IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICBvblByb2dyZXNzKGV2ZW50LmxvYWRlZCAvIGV2ZW50LnRvdGFsKTtcbiAgICAgIH07XG4gICAgfVxuXG4gICAgeGhyLm9ubG9hZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciByZXNwb25zZTtcblxuICAgICAgdHJ5IHtcbiAgICAgICAgcmVzcG9uc2UgPSBKU09OLnBhcnNlKHhoci5yZXNwb25zZSk7XG4gICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgcmVzcG9uc2UgPSB4aHIucmVzcG9uc2U7XG4gICAgICB9XG5cbiAgICAgIGlmICh4aHIuc3RhdHVzID49IDIwMCAmJiB4aHIuc3RhdHVzIDwgMzAwKSB7XG4gICAgICAgIHJlc29sdmUocmVzcG9uc2UpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIHZhciBlcnIgPSBuZXcgRXJyb3IoJ1VwbG9hZCBmYWlsZWQuJyk7XG4gICAgICBlcnIuY29kZSA9IFVQTE9BRF9GQUlMRUQ7XG4gICAgICBlcnIucmVzcG9uc2UgPSByZXNwb25zZTtcbiAgICAgIHJlamVjdChlcnIpO1xuICAgIH07XG5cbiAgICB4aHIub25lcnJvciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciBlcnIgPSBuZXcgRXJyb3IoJ1VwbG9hZCBmYWlsZWQuJyk7XG4gICAgICBlcnIuY29kZSA9IFVQTE9BRF9GQUlMRUQ7XG4gICAgICByZWplY3QoZXJyKTtcbiAgICB9O1xuXG4gICAgeGhyLm9uYWJvcnQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgZXJyID0gbmV3IEVycm9yKCdVcGxvYWQgY2FuY2VsZWQuJyk7XG4gICAgICBlcnIuY29kZSA9IFVQTE9BRF9DQU5DRUxFRDtcbiAgICAgIHJlamVjdChlcnIpO1xuICAgIH07XG5cbiAgICB4aHIub3BlbihtZXRob2QsIHVybCk7XG4gICAgeGhyLndpdGhDcmVkZW50aWFscyA9IHdpdGhDcmVkZW50aWFscztcblxuICAgIGlmIChoZWFkZXJzKSB7XG4gICAgICBPYmplY3Qua2V5cyhoZWFkZXJzKS5mb3JFYWNoKGZ1bmN0aW9uIChoZWFkZXIpIHtcbiAgICAgICAgcmV0dXJuIHhoci5zZXRSZXF1ZXN0SGVhZGVyKGhlYWRlciwgaGVhZGVyc1toZWFkZXJdKTtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIHhoci5zZW5kKHRvRm9ybURhdGEoZGF0YSkpO1xuICB9KTtcbiAgcmV0dXJuIHtcbiAgICBwcm9taXNlOiB1cGxvYWQsXG4gICAgY2FuY2VsOiBmdW5jdGlvbiBjYW5jZWwoKSB7XG4gICAgICB4aHIuYWJvcnQoKTtcbiAgICB9XG4gIH07XG59O1xuXG5leHBvcnQgZGVmYXVsdCB1cGxvYWRGaWxlO1xuIl0sIm1hcHBpbmdzIjoiOzs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///../../../node_modules/@livechat/file-upload/dist/file-upload.es.js\n");

/***/ }),

/***/ "../../../node_modules/@livechat/isomorphic-storage/dist/isomorphic-storage.es.js":
/*!****************************************************************************************!*\
  !*** ../../../node_modules/@livechat/isomorphic-storage/dist/isomorphic-storage.es.js ***!
  \****************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var memory_web_storage__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! memory-web-storage */ \"../../../node_modules/memory-web-storage/es/index.js\");\n\n\nvar storage = (0,memory_web_storage__WEBPACK_IMPORTED_MODULE_0__.testStorageSupport)() ? window.localStorage : memory_web_storage__WEBPACK_IMPORTED_MODULE_0__.default;\n\nvar index = {\n\tsetItem: function setItem(key, data) {\n\t\treturn new Promise(function (resolve) {\n\t\t\treturn resolve(storage.setItem(key, data));\n\t\t});\n\t},\n\tgetItem: function getItem(key) {\n\t\treturn new Promise(function (resolve) {\n\t\t\treturn resolve(storage.getItem(key));\n\t\t});\n\t},\n\tremoveItem: function removeItem(key) {\n\t\treturn new Promise(function (resolve) {\n\t\t\treturn resolve(storage.removeItem(key));\n\t\t});\n\t}\n};\n\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (index);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi4vLi4vLi4vbm9kZV9tb2R1bGVzL0BsaXZlY2hhdC9pc29tb3JwaGljLXN0b3JhZ2UvZGlzdC9pc29tb3JwaGljLXN0b3JhZ2UuZXMuanMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi4vLi4vLi4vbm9kZV9tb2R1bGVzL0BsaXZlY2hhdC9pc29tb3JwaGljLXN0b3JhZ2UvZGlzdC9pc29tb3JwaGljLXN0b3JhZ2UuZXMuanM/N2NhMSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgbWVtb3J5U3RvcmFnZSwgeyB0ZXN0U3RvcmFnZVN1cHBvcnQgfSBmcm9tICdtZW1vcnktd2ViLXN0b3JhZ2UnO1xuXG52YXIgc3RvcmFnZSA9IHRlc3RTdG9yYWdlU3VwcG9ydCgpID8gd2luZG93LmxvY2FsU3RvcmFnZSA6IG1lbW9yeVN0b3JhZ2U7XG5cbnZhciBpbmRleCA9IHtcblx0c2V0SXRlbTogZnVuY3Rpb24gc2V0SXRlbShrZXksIGRhdGEpIHtcblx0XHRyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUpIHtcblx0XHRcdHJldHVybiByZXNvbHZlKHN0b3JhZ2Uuc2V0SXRlbShrZXksIGRhdGEpKTtcblx0XHR9KTtcblx0fSxcblx0Z2V0SXRlbTogZnVuY3Rpb24gZ2V0SXRlbShrZXkpIHtcblx0XHRyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUpIHtcblx0XHRcdHJldHVybiByZXNvbHZlKHN0b3JhZ2UuZ2V0SXRlbShrZXkpKTtcblx0XHR9KTtcblx0fSxcblx0cmVtb3ZlSXRlbTogZnVuY3Rpb24gcmVtb3ZlSXRlbShrZXkpIHtcblx0XHRyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUpIHtcblx0XHRcdHJldHVybiByZXNvbHZlKHN0b3JhZ2UucmVtb3ZlSXRlbShrZXkpKTtcblx0XHR9KTtcblx0fVxufTtcblxuZXhwb3J0IGRlZmF1bHQgaW5kZXg7XG4iXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///../../../node_modules/@livechat/isomorphic-storage/dist/isomorphic-storage.es.js\n");

/***/ }),

/***/ "../../../node_modules/@livechat/mitt/dist/livechat-mitt.es.js":
/*!*********************************************************************!*\
  !*** ../../../node_modules/@livechat/mitt/dist/livechat-mitt.es.js ***!
  \*********************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var mitt__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! mitt */ \"../../../node_modules/mitt/dist/mitt.es.js\");\n\n\nfunction _extends() {\n  _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n\n  return _extends.apply(this, arguments);\n}\n\nvar mitt = mitt__WEBPACK_IMPORTED_MODULE_0__.default;\n\n// Our wrapper over `mitt` starts here\nvar createMitt = function createMitt() {\n  var eventsMap = Object.create(null);\n  var instance = mitt(eventsMap);\n\n  var off = function off(type, handler) {\n    if (!type) {\n      Object.keys(eventsMap).forEach(function (key) {\n        delete eventsMap[key];\n      });\n      return;\n    }\n\n    instance.off(type, handler);\n  };\n\n  var once = function once(type, handler) {\n    // for '*' type handler is invoked with 2 arguments - type, evt\n    instance.on(type, function onceHandler(data, maybeSecondArg) {\n      instance.off(type, onceHandler);\n      handler(data, maybeSecondArg);\n    });\n  };\n\n  return _extends({}, instance, {\n    off: off,\n    once: once\n  });\n};\n\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (createMitt);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi4vLi4vLi4vbm9kZV9tb2R1bGVzL0BsaXZlY2hhdC9taXR0L2Rpc3QvbGl2ZWNoYXQtbWl0dC5lcy5qcy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uLi8uLi8uLi9ub2RlX21vZHVsZXMvQGxpdmVjaGF0L21pdHQvZGlzdC9saXZlY2hhdC1taXR0LmVzLmpzP2U2ZDMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IF9taXR0IGZyb20gJ21pdHQnO1xuXG5mdW5jdGlvbiBfZXh0ZW5kcygpIHtcbiAgX2V4dGVuZHMgPSBPYmplY3QuYXNzaWduIHx8IGZ1bmN0aW9uICh0YXJnZXQpIHtcbiAgICBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykge1xuICAgICAgdmFyIHNvdXJjZSA9IGFyZ3VtZW50c1tpXTtcblxuICAgICAgZm9yICh2YXIga2V5IGluIHNvdXJjZSkge1xuICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHNvdXJjZSwga2V5KSkge1xuICAgICAgICAgIHRhcmdldFtrZXldID0gc291cmNlW2tleV07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gdGFyZ2V0O1xuICB9O1xuXG4gIHJldHVybiBfZXh0ZW5kcy5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xufVxuXG52YXIgbWl0dCA9IF9taXR0O1xuXG4vLyBPdXIgd3JhcHBlciBvdmVyIGBtaXR0YCBzdGFydHMgaGVyZVxudmFyIGNyZWF0ZU1pdHQgPSBmdW5jdGlvbiBjcmVhdGVNaXR0KCkge1xuICB2YXIgZXZlbnRzTWFwID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiAgdmFyIGluc3RhbmNlID0gbWl0dChldmVudHNNYXApO1xuXG4gIHZhciBvZmYgPSBmdW5jdGlvbiBvZmYodHlwZSwgaGFuZGxlcikge1xuICAgIGlmICghdHlwZSkge1xuICAgICAgT2JqZWN0LmtleXMoZXZlbnRzTWFwKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgZGVsZXRlIGV2ZW50c01hcFtrZXldO1xuICAgICAgfSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaW5zdGFuY2Uub2ZmKHR5cGUsIGhhbmRsZXIpO1xuICB9O1xuXG4gIHZhciBvbmNlID0gZnVuY3Rpb24gb25jZSh0eXBlLCBoYW5kbGVyKSB7XG4gICAgLy8gZm9yICcqJyB0eXBlIGhhbmRsZXIgaXMgaW52b2tlZCB3aXRoIDIgYXJndW1lbnRzIC0gdHlwZSwgZXZ0XG4gICAgaW5zdGFuY2Uub24odHlwZSwgZnVuY3Rpb24gb25jZUhhbmRsZXIoZGF0YSwgbWF5YmVTZWNvbmRBcmcpIHtcbiAgICAgIGluc3RhbmNlLm9mZih0eXBlLCBvbmNlSGFuZGxlcik7XG4gICAgICBoYW5kbGVyKGRhdGEsIG1heWJlU2Vjb25kQXJnKTtcbiAgICB9KTtcbiAgfTtcblxuICByZXR1cm4gX2V4dGVuZHMoe30sIGluc3RhbmNlLCB7XG4gICAgb2ZmOiBvZmYsXG4gICAgb25jZTogb25jZVxuICB9KTtcbn07XG5cbmV4cG9ydCBkZWZhdWx0IGNyZWF0ZU1pdHQ7XG4iXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///../../../node_modules/@livechat/mitt/dist/livechat-mitt.es.js\n");

/***/ }),

/***/ "../../../node_modules/@livechat/platform-client/dist/platform-client.esm.js":
/*!***********************************************************************************!*\
  !*** ../../../node_modules/@livechat/platform-client/dist/platform-client.esm.js ***!
  \***********************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var _livechat_data_utils__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @livechat/data-utils */ \"../../../node_modules/@livechat/data-utils/dist/data-utils.es.js\");\n/* harmony import */ var _livechat_deferred__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @livechat/deferred */ \"../../../node_modules/@livechat/deferred/dist/deferred.esm.js\");\n/* harmony import */ var _livechat_sockjs_manager__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @livechat/sockjs-manager */ \"../../../node_modules/@livechat/sockjs-manager/dist/sockjs-manager.esm.js\");\n/* harmony import */ var _livechat_mitt__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @livechat/mitt */ \"../../../node_modules/@livechat/mitt/dist/livechat-mitt.es.js\");\n\n\n\n\n\nfunction _extends() {\n  _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n\n  return _extends.apply(this, arguments);\n}\n\nvar createConnectionHero = function createConnectionHero() {\n  var resolve = _livechat_data_utils__WEBPACK_IMPORTED_MODULE_0__.noop;\n  var timer;\n  return {\n    cancel: function cancel() {\n      clearTimeout(timer);\n      resolve = _livechat_data_utils__WEBPACK_IMPORTED_MODULE_0__.noop;\n    },\n    check: function check() {\n      var deferred = (0,_livechat_deferred__WEBPACK_IMPORTED_MODULE_1__.default)();\n      resolve = deferred.resolve;\n      timer = setTimeout(function () {\n        var err = new Error('Timeout.');\n        err.code = 'TIMEOUT';\n        deferred.reject(err);\n      }, 2000);\n      return deferred.promise;\n    },\n    resolve: function (_resolve) {\n      function resolve() {\n        return _resolve.apply(this, arguments);\n      }\n\n      resolve.toString = function () {\n        return _resolve.toString();\n      };\n\n      return resolve;\n    }(function () {\n      clearTimeout(timer);\n      resolve();\n    })\n  };\n};\n\n// based on server heartbeat interval - which is 25s\nvar DEFAULT_RESCHEDULE_PING_TIMEOUT = 30 * 1000;\n\n// this is not quite type-safe (it doesn't constraint soure & sink types that much)\n// it's generic and really simple though, so we don't waste time to make this completely type-safe\nvar forwardEvents = function forwardEvents(source, sink, types) {\n  types.forEach(function (type) {\n    source.on(type, function (data) {\n      sink.emit(type, data);\n    });\n  });\n};\n\nvar createPlatformClient = function createPlatformClient(url, _temp) {\n  var _ref = _temp === void 0 ? {} : _temp,\n      _ref$query = _ref.query,\n      query = _ref$query === void 0 ? {} : _ref$query,\n      _ref$rescheduleTimeou = _ref.rescheduleTimeout,\n      rescheduleTimeout = _ref$rescheduleTimeou === void 0 ? DEFAULT_RESCHEDULE_PING_TIMEOUT : _ref$rescheduleTimeou,\n      transports = _ref.transports,\n      _ref$emitter = _ref.emitter,\n      emitter = _ref$emitter === void 0 ? (0,_livechat_mitt__WEBPACK_IMPORTED_MODULE_3__.default)() : _ref$emitter;\n\n  var manager = (0,_livechat_sockjs_manager__WEBPACK_IMPORTED_MODULE_2__.default)(url, {\n    query: _extends({\n      // needed for HAProxy sticky sessions\n      bh: (0,_livechat_data_utils__WEBPACK_IMPORTED_MODULE_0__.generateRandomId)()\n    }, query),\n    transports: transports\n  });\n  var pingTimer;\n  var connectionHero = createConnectionHero();\n\n  var isSocketOpen = function isSocketOpen() {\n    return manager.getReadyState() === 1;\n  };\n\n  var emit = function emit(frame) {\n    manager.emit(JSON.stringify(frame));\n    reschedulePing();\n  };\n\n  var ping = function ping() {\n    // ping action doesn't extend Outgoing - it's internal, so doesn't have to be specified by a consumer\n    // but it's safe to use emit with it\n    emit({\n      action: 'ping'\n    });\n  }; // extra measure to keep the connection alive\n  // in theory this timer should never fire though\n  // because we ping after each received heartbeat & sent request\n\n\n  var reschedulePing = function reschedulePing() {\n    clearTimeout(pingTimer);\n    pingTimer = setTimeout(ping, rescheduleTimeout);\n  };\n\n  var cleanupPossiblyPendingTasks = function cleanupPossiblyPendingTasks() {\n    connectionHero.cancel();\n    clearTimeout(pingTimer);\n  };\n\n  forwardEvents(manager, emitter, ['connect', 'disconnect']);\n  manager.on('connect', reschedulePing);\n  manager.on('disconnect', cleanupPossiblyPendingTasks); // ping has to be sent back upon receiving heartbeat\n  // this is somewhat guaranteed to be executed asap unlike browser timers\n\n  manager.on('heartbeat', ping);\n  manager.on('message', function (data) {\n    connectionHero.resolve();\n    var message = JSON.parse(data);\n\n    if (message.action === 'ping') {\n      return;\n    } // Incoming requires `action` property to be a string, we cannot forbid in typings `ping` as valid action though\n    // so TS cannot narrow the type down to `Incoming` here (it stays `Incoming | Ping`), that's why we are using `any` here\n\n\n    emitter.emit('message', message);\n  }); // React Native uses window as global object, but without addEventListener method\n\n  if (typeof window !== 'undefined' && typeof window.addEventListener !== 'undefined') {\n    window.addEventListener('online', function () {\n      if (!isSocketOpen()) {\n        return;\n      }\n\n      connectionHero.check().then(function () {\n        connectionHero.cancel();\n        emitter.emit('connection_recovered');\n      }, function (err) {\n        connectionHero.cancel();\n\n        if (err.code !== 'TIMEOUT') {\n          throw err;\n        }\n\n        manager.reconnect();\n      });\n      ping();\n    });\n    window.addEventListener('offline', function () {\n      connectionHero.cancel();\n\n      if (!isSocketOpen()) {\n        return;\n      }\n\n      emitter.emit('connection_unstable');\n    });\n  }\n\n  return _extends({}, manager, {\n    destroy: function destroy() {\n      cleanupPossiblyPendingTasks();\n      manager.destroy();\n    },\n    disconnect: function disconnect() {\n      cleanupPossiblyPendingTasks();\n      manager.disconnect();\n    },\n    reconnect: function reconnect(delay) {\n      cleanupPossiblyPendingTasks();\n      manager.reconnect(delay);\n    },\n    emit: emit,\n    on: emitter.on,\n    off: emitter.off\n  });\n};\n\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (createPlatformClient);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi4vLi4vLi4vbm9kZV9tb2R1bGVzL0BsaXZlY2hhdC9wbGF0Zm9ybS1jbGllbnQvZGlzdC9wbGF0Zm9ybS1jbGllbnQuZXNtLmpzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4uLy4uLy4uL25vZGVfbW9kdWxlcy9AbGl2ZWNoYXQvcGxhdGZvcm0tY2xpZW50L2Rpc3QvcGxhdGZvcm0tY2xpZW50LmVzbS5qcz9mYTU1Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IG5vb3AsIGdlbmVyYXRlUmFuZG9tSWQgfSBmcm9tICdAbGl2ZWNoYXQvZGF0YS11dGlscyc7XG5pbXBvcnQgY3JlYXRlRGVmZXJyZWQgZnJvbSAnQGxpdmVjaGF0L2RlZmVycmVkJztcbmltcG9ydCBjcmVhdGVTb2NrSlNNYW5hZ2VyIGZyb20gJ0BsaXZlY2hhdC9zb2NranMtbWFuYWdlcic7XG5pbXBvcnQgbWl0dCBmcm9tICdAbGl2ZWNoYXQvbWl0dCc7XG5cbmZ1bmN0aW9uIF9leHRlbmRzKCkge1xuICBfZXh0ZW5kcyA9IE9iamVjdC5hc3NpZ24gfHwgZnVuY3Rpb24gKHRhcmdldCkge1xuICAgIGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldO1xuXG4gICAgICBmb3IgKHZhciBrZXkgaW4gc291cmNlKSB7XG4gICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoc291cmNlLCBrZXkpKSB7XG4gICAgICAgICAgdGFyZ2V0W2tleV0gPSBzb3VyY2Vba2V5XTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB0YXJnZXQ7XG4gIH07XG5cbiAgcmV0dXJuIF9leHRlbmRzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG59XG5cbnZhciBjcmVhdGVDb25uZWN0aW9uSGVybyA9IGZ1bmN0aW9uIGNyZWF0ZUNvbm5lY3Rpb25IZXJvKCkge1xuICB2YXIgcmVzb2x2ZSA9IG5vb3A7XG4gIHZhciB0aW1lcjtcbiAgcmV0dXJuIHtcbiAgICBjYW5jZWw6IGZ1bmN0aW9uIGNhbmNlbCgpIHtcbiAgICAgIGNsZWFyVGltZW91dCh0aW1lcik7XG4gICAgICByZXNvbHZlID0gbm9vcDtcbiAgICB9LFxuICAgIGNoZWNrOiBmdW5jdGlvbiBjaGVjaygpIHtcbiAgICAgIHZhciBkZWZlcnJlZCA9IGNyZWF0ZURlZmVycmVkKCk7XG4gICAgICByZXNvbHZlID0gZGVmZXJyZWQucmVzb2x2ZTtcbiAgICAgIHRpbWVyID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBlcnIgPSBuZXcgRXJyb3IoJ1RpbWVvdXQuJyk7XG4gICAgICAgIGVyci5jb2RlID0gJ1RJTUVPVVQnO1xuICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyKTtcbiAgICAgIH0sIDIwMDApO1xuICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG4gICAgfSxcbiAgICByZXNvbHZlOiBmdW5jdGlvbiAoX3Jlc29sdmUpIHtcbiAgICAgIGZ1bmN0aW9uIHJlc29sdmUoKSB7XG4gICAgICAgIHJldHVybiBfcmVzb2x2ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgfVxuXG4gICAgICByZXNvbHZlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gX3Jlc29sdmUudG9TdHJpbmcoKTtcbiAgICAgIH07XG5cbiAgICAgIHJldHVybiByZXNvbHZlO1xuICAgIH0oZnVuY3Rpb24gKCkge1xuICAgICAgY2xlYXJUaW1lb3V0KHRpbWVyKTtcbiAgICAgIHJlc29sdmUoKTtcbiAgICB9KVxuICB9O1xufTtcblxuLy8gYmFzZWQgb24gc2VydmVyIGhlYXJ0YmVhdCBpbnRlcnZhbCAtIHdoaWNoIGlzIDI1c1xudmFyIERFRkFVTFRfUkVTQ0hFRFVMRV9QSU5HX1RJTUVPVVQgPSAzMCAqIDEwMDA7XG5cbi8vIHRoaXMgaXMgbm90IHF1aXRlIHR5cGUtc2FmZSAoaXQgZG9lc24ndCBjb25zdHJhaW50IHNvdXJlICYgc2luayB0eXBlcyB0aGF0IG11Y2gpXG4vLyBpdCdzIGdlbmVyaWMgYW5kIHJlYWxseSBzaW1wbGUgdGhvdWdoLCBzbyB3ZSBkb24ndCB3YXN0ZSB0aW1lIHRvIG1ha2UgdGhpcyBjb21wbGV0ZWx5IHR5cGUtc2FmZVxudmFyIGZvcndhcmRFdmVudHMgPSBmdW5jdGlvbiBmb3J3YXJkRXZlbnRzKHNvdXJjZSwgc2luaywgdHlwZXMpIHtcbiAgdHlwZXMuZm9yRWFjaChmdW5jdGlvbiAodHlwZSkge1xuICAgIHNvdXJjZS5vbih0eXBlLCBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgc2luay5lbWl0KHR5cGUsIGRhdGEpO1xuICAgIH0pO1xuICB9KTtcbn07XG5cbnZhciBjcmVhdGVQbGF0Zm9ybUNsaWVudCA9IGZ1bmN0aW9uIGNyZWF0ZVBsYXRmb3JtQ2xpZW50KHVybCwgX3RlbXApIHtcbiAgdmFyIF9yZWYgPSBfdGVtcCA9PT0gdm9pZCAwID8ge30gOiBfdGVtcCxcbiAgICAgIF9yZWYkcXVlcnkgPSBfcmVmLnF1ZXJ5LFxuICAgICAgcXVlcnkgPSBfcmVmJHF1ZXJ5ID09PSB2b2lkIDAgPyB7fSA6IF9yZWYkcXVlcnksXG4gICAgICBfcmVmJHJlc2NoZWR1bGVUaW1lb3UgPSBfcmVmLnJlc2NoZWR1bGVUaW1lb3V0LFxuICAgICAgcmVzY2hlZHVsZVRpbWVvdXQgPSBfcmVmJHJlc2NoZWR1bGVUaW1lb3UgPT09IHZvaWQgMCA/IERFRkFVTFRfUkVTQ0hFRFVMRV9QSU5HX1RJTUVPVVQgOiBfcmVmJHJlc2NoZWR1bGVUaW1lb3UsXG4gICAgICB0cmFuc3BvcnRzID0gX3JlZi50cmFuc3BvcnRzLFxuICAgICAgX3JlZiRlbWl0dGVyID0gX3JlZi5lbWl0dGVyLFxuICAgICAgZW1pdHRlciA9IF9yZWYkZW1pdHRlciA9PT0gdm9pZCAwID8gbWl0dCgpIDogX3JlZiRlbWl0dGVyO1xuXG4gIHZhciBtYW5hZ2VyID0gY3JlYXRlU29ja0pTTWFuYWdlcih1cmwsIHtcbiAgICBxdWVyeTogX2V4dGVuZHMoe1xuICAgICAgLy8gbmVlZGVkIGZvciBIQVByb3h5IHN0aWNreSBzZXNzaW9uc1xuICAgICAgYmg6IGdlbmVyYXRlUmFuZG9tSWQoKVxuICAgIH0sIHF1ZXJ5KSxcbiAgICB0cmFuc3BvcnRzOiB0cmFuc3BvcnRzXG4gIH0pO1xuICB2YXIgcGluZ1RpbWVyO1xuICB2YXIgY29ubmVjdGlvbkhlcm8gPSBjcmVhdGVDb25uZWN0aW9uSGVybygpO1xuXG4gIHZhciBpc1NvY2tldE9wZW4gPSBmdW5jdGlvbiBpc1NvY2tldE9wZW4oKSB7XG4gICAgcmV0dXJuIG1hbmFnZXIuZ2V0UmVhZHlTdGF0ZSgpID09PSAxO1xuICB9O1xuXG4gIHZhciBlbWl0ID0gZnVuY3Rpb24gZW1pdChmcmFtZSkge1xuICAgIG1hbmFnZXIuZW1pdChKU09OLnN0cmluZ2lmeShmcmFtZSkpO1xuICAgIHJlc2NoZWR1bGVQaW5nKCk7XG4gIH07XG5cbiAgdmFyIHBpbmcgPSBmdW5jdGlvbiBwaW5nKCkge1xuICAgIC8vIHBpbmcgYWN0aW9uIGRvZXNuJ3QgZXh0ZW5kIE91dGdvaW5nIC0gaXQncyBpbnRlcm5hbCwgc28gZG9lc24ndCBoYXZlIHRvIGJlIHNwZWNpZmllZCBieSBhIGNvbnN1bWVyXG4gICAgLy8gYnV0IGl0J3Mgc2FmZSB0byB1c2UgZW1pdCB3aXRoIGl0XG4gICAgZW1pdCh7XG4gICAgICBhY3Rpb246ICdwaW5nJ1xuICAgIH0pO1xuICB9OyAvLyBleHRyYSBtZWFzdXJlIHRvIGtlZXAgdGhlIGNvbm5lY3Rpb24gYWxpdmVcbiAgLy8gaW4gdGhlb3J5IHRoaXMgdGltZXIgc2hvdWxkIG5ldmVyIGZpcmUgdGhvdWdoXG4gIC8vIGJlY2F1c2Ugd2UgcGluZyBhZnRlciBlYWNoIHJlY2VpdmVkIGhlYXJ0YmVhdCAmIHNlbnQgcmVxdWVzdFxuXG5cbiAgdmFyIHJlc2NoZWR1bGVQaW5nID0gZnVuY3Rpb24gcmVzY2hlZHVsZVBpbmcoKSB7XG4gICAgY2xlYXJUaW1lb3V0KHBpbmdUaW1lcik7XG4gICAgcGluZ1RpbWVyID0gc2V0VGltZW91dChwaW5nLCByZXNjaGVkdWxlVGltZW91dCk7XG4gIH07XG5cbiAgdmFyIGNsZWFudXBQb3NzaWJseVBlbmRpbmdUYXNrcyA9IGZ1bmN0aW9uIGNsZWFudXBQb3NzaWJseVBlbmRpbmdUYXNrcygpIHtcbiAgICBjb25uZWN0aW9uSGVyby5jYW5jZWwoKTtcbiAgICBjbGVhclRpbWVvdXQocGluZ1RpbWVyKTtcbiAgfTtcblxuICBmb3J3YXJkRXZlbnRzKG1hbmFnZXIsIGVtaXR0ZXIsIFsnY29ubmVjdCcsICdkaXNjb25uZWN0J10pO1xuICBtYW5hZ2VyLm9uKCdjb25uZWN0JywgcmVzY2hlZHVsZVBpbmcpO1xuICBtYW5hZ2VyLm9uKCdkaXNjb25uZWN0JywgY2xlYW51cFBvc3NpYmx5UGVuZGluZ1Rhc2tzKTsgLy8gcGluZyBoYXMgdG8gYmUgc2VudCBiYWNrIHVwb24gcmVjZWl2aW5nIGhlYXJ0YmVhdFxuICAvLyB0aGlzIGlzIHNvbWV3aGF0IGd1YXJhbnRlZWQgdG8gYmUgZXhlY3V0ZWQgYXNhcCB1bmxpa2UgYnJvd3NlciB0aW1lcnNcblxuICBtYW5hZ2VyLm9uKCdoZWFydGJlYXQnLCBwaW5nKTtcbiAgbWFuYWdlci5vbignbWVzc2FnZScsIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgY29ubmVjdGlvbkhlcm8ucmVzb2x2ZSgpO1xuICAgIHZhciBtZXNzYWdlID0gSlNPTi5wYXJzZShkYXRhKTtcblxuICAgIGlmIChtZXNzYWdlLmFjdGlvbiA9PT0gJ3BpbmcnKSB7XG4gICAgICByZXR1cm47XG4gICAgfSAvLyBJbmNvbWluZyByZXF1aXJlcyBgYWN0aW9uYCBwcm9wZXJ0eSB0byBiZSBhIHN0cmluZywgd2UgY2Fubm90IGZvcmJpZCBpbiB0eXBpbmdzIGBwaW5nYCBhcyB2YWxpZCBhY3Rpb24gdGhvdWdoXG4gICAgLy8gc28gVFMgY2Fubm90IG5hcnJvdyB0aGUgdHlwZSBkb3duIHRvIGBJbmNvbWluZ2AgaGVyZSAoaXQgc3RheXMgYEluY29taW5nIHwgUGluZ2ApLCB0aGF0J3Mgd2h5IHdlIGFyZSB1c2luZyBgYW55YCBoZXJlXG5cblxuICAgIGVtaXR0ZXIuZW1pdCgnbWVzc2FnZScsIG1lc3NhZ2UpO1xuICB9KTsgLy8gUmVhY3QgTmF0aXZlIHVzZXMgd2luZG93IGFzIGdsb2JhbCBvYmplY3QsIGJ1dCB3aXRob3V0IGFkZEV2ZW50TGlzdGVuZXIgbWV0aG9kXG5cbiAgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnICYmIHR5cGVvZiB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lciAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignb25saW5lJywgZnVuY3Rpb24gKCkge1xuICAgICAgaWYgKCFpc1NvY2tldE9wZW4oKSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGNvbm5lY3Rpb25IZXJvLmNoZWNrKCkudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgIGNvbm5lY3Rpb25IZXJvLmNhbmNlbCgpO1xuICAgICAgICBlbWl0dGVyLmVtaXQoJ2Nvbm5lY3Rpb25fcmVjb3ZlcmVkJyk7XG4gICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgIGNvbm5lY3Rpb25IZXJvLmNhbmNlbCgpO1xuXG4gICAgICAgIGlmIChlcnIuY29kZSAhPT0gJ1RJTUVPVVQnKSB7XG4gICAgICAgICAgdGhyb3cgZXJyO1xuICAgICAgICB9XG5cbiAgICAgICAgbWFuYWdlci5yZWNvbm5lY3QoKTtcbiAgICAgIH0pO1xuICAgICAgcGluZygpO1xuICAgIH0pO1xuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdvZmZsaW5lJywgZnVuY3Rpb24gKCkge1xuICAgICAgY29ubmVjdGlvbkhlcm8uY2FuY2VsKCk7XG5cbiAgICAgIGlmICghaXNTb2NrZXRPcGVuKCkpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBlbWl0dGVyLmVtaXQoJ2Nvbm5lY3Rpb25fdW5zdGFibGUnKTtcbiAgICB9KTtcbiAgfVxuXG4gIHJldHVybiBfZXh0ZW5kcyh7fSwgbWFuYWdlciwge1xuICAgIGRlc3Ryb3k6IGZ1bmN0aW9uIGRlc3Ryb3koKSB7XG4gICAgICBjbGVhbnVwUG9zc2libHlQZW5kaW5nVGFza3MoKTtcbiAgICAgIG1hbmFnZXIuZGVzdHJveSgpO1xuICAgIH0sXG4gICAgZGlzY29ubmVjdDogZnVuY3Rpb24gZGlzY29ubmVjdCgpIHtcbiAgICAgIGNsZWFudXBQb3NzaWJseVBlbmRpbmdUYXNrcygpO1xuICAgICAgbWFuYWdlci5kaXNjb25uZWN0KCk7XG4gICAgfSxcbiAgICByZWNvbm5lY3Q6IGZ1bmN0aW9uIHJlY29ubmVjdChkZWxheSkge1xuICAgICAgY2xlYW51cFBvc3NpYmx5UGVuZGluZ1Rhc2tzKCk7XG4gICAgICBtYW5hZ2VyLnJlY29ubmVjdChkZWxheSk7XG4gICAgfSxcbiAgICBlbWl0OiBlbWl0LFxuICAgIG9uOiBlbWl0dGVyLm9uLFxuICAgIG9mZjogZW1pdHRlci5vZmZcbiAgfSk7XG59O1xuXG5leHBvcnQgZGVmYXVsdCBjcmVhdGVQbGF0Zm9ybUNsaWVudDtcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///../../../node_modules/@livechat/platform-client/dist/platform-client.esm.js\n");

/***/ }),

/***/ "../../../node_modules/@livechat/promise-try/dist/promise-try.es.js":
/*!**************************************************************************!*\
  !*** ../../../node_modules/@livechat/promise-try/dist/promise-try.es.js ***!
  \**************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\nvar index = (function (fn) {\n\treturn new Promise(function (resolve) {\n\t\tresolve(fn());\n\t});\n});\n\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (index);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi4vLi4vLi4vbm9kZV9tb2R1bGVzL0BsaXZlY2hhdC9wcm9taXNlLXRyeS9kaXN0L3Byb21pc2UtdHJ5LmVzLmpzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4uLy4uLy4uL25vZGVfbW9kdWxlcy9AbGl2ZWNoYXQvcHJvbWlzZS10cnkvZGlzdC9wcm9taXNlLXRyeS5lcy5qcz82OWJhIl0sInNvdXJjZXNDb250ZW50IjpbInZhciBpbmRleCA9IChmdW5jdGlvbiAoZm4pIHtcblx0cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlKSB7XG5cdFx0cmVzb2x2ZShmbigpKTtcblx0fSk7XG59KTtcblxuZXhwb3J0IGRlZmF1bHQgaW5kZXg7XG4iXSwibWFwcGluZ3MiOiI7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///../../../node_modules/@livechat/promise-try/dist/promise-try.es.js\n");

/***/ }),

/***/ "../../../node_modules/@livechat/side-effects-middleware/es/index.js":
/*!***************************************************************************!*\
  !*** ../../../node_modules/@livechat/side-effects-middleware/es/index.js ***!
  \***************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (function () {\n\tvar handlers = [];\n\n\tvar sideEffectsMiddleware = function sideEffectsMiddleware(store) {\n\t\treturn function (next) {\n\t\t\treturn function (action) {\n\t\t\t\tvar result = next(action);\n\n\t\t\t\thandlers.forEach(function (handler) {\n\t\t\t\t\thandler(action, store);\n\t\t\t\t});\n\n\t\t\t\treturn result;\n\t\t\t};\n\t\t};\n\t};\n\n\tsideEffectsMiddleware.add = function (handler) {\n\t\thandlers.push(handler);\n\t};\n\n\treturn sideEffectsMiddleware;\n});//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi4vLi4vLi4vbm9kZV9tb2R1bGVzL0BsaXZlY2hhdC9zaWRlLWVmZmVjdHMtbWlkZGxld2FyZS9lcy9pbmRleC5qcy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uLi8uLi8uLi9ub2RlX21vZHVsZXMvQGxpdmVjaGF0L3NpZGUtZWZmZWN0cy1taWRkbGV3YXJlL2VzL2luZGV4LmpzP2UxZWMiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGRlZmF1bHQgKGZ1bmN0aW9uICgpIHtcblx0dmFyIGhhbmRsZXJzID0gW107XG5cblx0dmFyIHNpZGVFZmZlY3RzTWlkZGxld2FyZSA9IGZ1bmN0aW9uIHNpZGVFZmZlY3RzTWlkZGxld2FyZShzdG9yZSkge1xuXHRcdHJldHVybiBmdW5jdGlvbiAobmV4dCkge1xuXHRcdFx0cmV0dXJuIGZ1bmN0aW9uIChhY3Rpb24pIHtcblx0XHRcdFx0dmFyIHJlc3VsdCA9IG5leHQoYWN0aW9uKTtcblxuXHRcdFx0XHRoYW5kbGVycy5mb3JFYWNoKGZ1bmN0aW9uIChoYW5kbGVyKSB7XG5cdFx0XHRcdFx0aGFuZGxlcihhY3Rpb24sIHN0b3JlKTtcblx0XHRcdFx0fSk7XG5cblx0XHRcdFx0cmV0dXJuIHJlc3VsdDtcblx0XHRcdH07XG5cdFx0fTtcblx0fTtcblxuXHRzaWRlRWZmZWN0c01pZGRsZXdhcmUuYWRkID0gZnVuY3Rpb24gKGhhbmRsZXIpIHtcblx0XHRoYW5kbGVycy5wdXNoKGhhbmRsZXIpO1xuXHR9O1xuXG5cdHJldHVybiBzaWRlRWZmZWN0c01pZGRsZXdhcmU7XG59KTsiXSwibWFwcGluZ3MiOiI7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///../../../node_modules/@livechat/side-effects-middleware/es/index.js\n");

/***/ }),

/***/ "../../../node_modules/@livechat/sockjs-manager/dist/sockjs-manager.esm.js":
/*!*********************************************************************************!*\
  !*** ../../../node_modules/@livechat/sockjs-manager/dist/sockjs-manager.esm.js ***!
  \*********************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var sockjs_client__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! sockjs-client */ \"../../../node_modules/sockjs-client/lib/entry.js\");\n/* harmony import */ var sockjs_client__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(sockjs_client__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _livechat_mitt__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @livechat/mitt */ \"../../../node_modules/@livechat/mitt/dist/livechat-mitt.es.js\");\n/* harmony import */ var _livechat_url_utils__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @livechat/url-utils */ \"../../../node_modules/@livechat/url-utils/dist/url-utils.esm.js\");\n\n\n\n\nvar backo = function backo(_ref) {\n  var _ref$min = _ref.min,\n      min = _ref$min === void 0 ? 1000 : _ref$min,\n      _ref$max = _ref.max,\n      max = _ref$max === void 0 ? 5000 : _ref$max,\n      _ref$jitter = _ref.jitter,\n      jitter = _ref$jitter === void 0 ? 0.5 : _ref$jitter;\n  var attempts = 0;\n  return {\n    duration: function duration() {\n      var ms = min * Math.pow(2, attempts++);\n\n      if (jitter) {\n        var rand = Math.random();\n        var deviation = Math.floor(rand * jitter * ms);\n        ms = (Math.floor(rand * 10) & 1) == 0 ? ms - deviation : ms + deviation;\n      }\n\n      return Math.min(ms, max) | 0;\n    },\n    reset: function reset() {\n      attempts = 0;\n    }\n  };\n};\n\n// based on WebSocket's readyState - https://www.w3.org/TR/websockets/#the-websocket-interface\nvar CONNECTING = 0;\nvar OPEN = 1;\nvar CLOSED = 3;\n\nvar createSockJSManager = function createSockJSManager(url, _temp) {\n  var _ref = _temp === void 0 ? {} : _temp,\n      query = _ref.query,\n      _ref$transports = _ref.transports,\n      transports = _ref$transports === void 0 ? ['websocket', 'xhr-polling'] : _ref$transports;\n\n  var finalUrl = \"\" + url + (!query ? '' : '?' + (0,_livechat_url_utils__WEBPACK_IMPORTED_MODULE_2__.buildQueryString)(query));\n  var emitter = (0,_livechat_mitt__WEBPACK_IMPORTED_MODULE_1__.default)();\n  var backoff = backo({\n    min: 1000,\n    max: 5000,\n    jitter: 0.5\n  });\n  var state = CLOSED;\n  var reconnectTimer;\n  var socket = null;\n\n  var openListener = function openListener() {\n    state = OPEN;\n    backoff.reset();\n    emitter.emit('connect');\n  };\n\n  var closeListener = function closeListener() {\n    state = CLOSED;\n    socket = null;\n    emitter.emit('disconnect'); // eslint-disable-next-line no-use-before-define\n\n    reconnect();\n  };\n\n  var messageListener = function messageListener(_ref2) {\n    var data = _ref2.data;\n    emitter.emit(\"message\", data);\n  };\n\n  var heartbeatListener = function heartbeatListener() {\n    emitter.emit('heartbeat');\n  };\n\n  var addEventListeners = function addEventListeners(instance) {\n    instance.addEventListener('open', openListener);\n    instance.addEventListener('close', closeListener);\n    instance.addEventListener('message', messageListener);\n    instance.addEventListener('heartbeat', heartbeatListener);\n  };\n\n  var removeEventListeners = function removeEventListeners(instance) {\n    instance.removeEventListener('open', openListener);\n    instance.removeEventListener('close', closeListener);\n    instance.removeEventListener('message', messageListener);\n    instance.removeEventListener('heartbeat', heartbeatListener);\n  };\n\n  var close = function close() {\n    state = CLOSED;\n\n    if (!socket) {\n      return;\n    }\n\n    removeEventListeners(socket);\n    socket.close();\n    socket = null;\n  };\n\n  var connect = function connect() {\n    state = CONNECTING;\n    socket = new (sockjs_client__WEBPACK_IMPORTED_MODULE_0___default())(finalUrl, undefined, {\n      transports: transports\n    });\n    addEventListeners(socket);\n  };\n\n  var reconnect = function reconnect(delay) {\n    if (delay === void 0) {\n      delay = backoff.duration();\n    }\n\n    clearTimeout(reconnectTimer);\n\n    if (delay === 0) {\n      connect();\n      return;\n    }\n\n    reconnectTimer = setTimeout(connect, delay);\n  };\n\n  var managedSocket = {\n    connect: function (_connect) {\n      function connect() {\n        return _connect.apply(this, arguments);\n      }\n\n      connect.toString = function () {\n        return _connect.toString();\n      };\n\n      return connect;\n    }(function () {\n      if (state !== CLOSED) {\n        throw new Error('Socket is already open or connecting.');\n      }\n\n      clearTimeout(reconnectTimer);\n      connect();\n    }),\n    destroy: function destroy() {\n      managedSocket.off();\n      managedSocket.disconnect();\n    },\n    disconnect: function disconnect() {\n      state = CLOSED;\n      clearTimeout(reconnectTimer);\n      close();\n    },\n    reconnect: function (_reconnect) {\n      function reconnect(_x) {\n        return _reconnect.apply(this, arguments);\n      }\n\n      reconnect.toString = function () {\n        return _reconnect.toString();\n      };\n\n      return reconnect;\n    }(function (delay) {\n      close();\n      reconnect(delay);\n    }),\n    emit: function emit(data) {\n      if (state !== OPEN) {\n        throw new Error('Socket is not connected.');\n      } // if we are connected we can be sure that socket is defined\n\n\n      socket.send(data);\n    },\n    getReadyState: function getReadyState() {\n      return state;\n    },\n    on: emitter.on,\n    off: emitter.off\n  };\n  return managedSocket;\n};\n\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (createSockJSManager);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi4vLi4vLi4vbm9kZV9tb2R1bGVzL0BsaXZlY2hhdC9zb2NranMtbWFuYWdlci9kaXN0L3NvY2tqcy1tYW5hZ2VyLmVzbS5qcy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uLi8uLi8uLi9ub2RlX21vZHVsZXMvQGxpdmVjaGF0L3NvY2tqcy1tYW5hZ2VyL2Rpc3Qvc29ja2pzLW1hbmFnZXIuZXNtLmpzP2I0ZTAiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFNvY2tKUyBmcm9tICdzb2NranMtY2xpZW50JztcbmltcG9ydCBtaXR0IGZyb20gJ0BsaXZlY2hhdC9taXR0JztcbmltcG9ydCB7IGJ1aWxkUXVlcnlTdHJpbmcgfSBmcm9tICdAbGl2ZWNoYXQvdXJsLXV0aWxzJztcblxudmFyIGJhY2tvID0gZnVuY3Rpb24gYmFja28oX3JlZikge1xuICB2YXIgX3JlZiRtaW4gPSBfcmVmLm1pbixcbiAgICAgIG1pbiA9IF9yZWYkbWluID09PSB2b2lkIDAgPyAxMDAwIDogX3JlZiRtaW4sXG4gICAgICBfcmVmJG1heCA9IF9yZWYubWF4LFxuICAgICAgbWF4ID0gX3JlZiRtYXggPT09IHZvaWQgMCA/IDUwMDAgOiBfcmVmJG1heCxcbiAgICAgIF9yZWYkaml0dGVyID0gX3JlZi5qaXR0ZXIsXG4gICAgICBqaXR0ZXIgPSBfcmVmJGppdHRlciA9PT0gdm9pZCAwID8gMC41IDogX3JlZiRqaXR0ZXI7XG4gIHZhciBhdHRlbXB0cyA9IDA7XG4gIHJldHVybiB7XG4gICAgZHVyYXRpb246IGZ1bmN0aW9uIGR1cmF0aW9uKCkge1xuICAgICAgdmFyIG1zID0gbWluICogTWF0aC5wb3coMiwgYXR0ZW1wdHMrKyk7XG5cbiAgICAgIGlmIChqaXR0ZXIpIHtcbiAgICAgICAgdmFyIHJhbmQgPSBNYXRoLnJhbmRvbSgpO1xuICAgICAgICB2YXIgZGV2aWF0aW9uID0gTWF0aC5mbG9vcihyYW5kICogaml0dGVyICogbXMpO1xuICAgICAgICBtcyA9IChNYXRoLmZsb29yKHJhbmQgKiAxMCkgJiAxKSA9PSAwID8gbXMgLSBkZXZpYXRpb24gOiBtcyArIGRldmlhdGlvbjtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIE1hdGgubWluKG1zLCBtYXgpIHwgMDtcbiAgICB9LFxuICAgIHJlc2V0OiBmdW5jdGlvbiByZXNldCgpIHtcbiAgICAgIGF0dGVtcHRzID0gMDtcbiAgICB9XG4gIH07XG59O1xuXG4vLyBiYXNlZCBvbiBXZWJTb2NrZXQncyByZWFkeVN0YXRlIC0gaHR0cHM6Ly93d3cudzMub3JnL1RSL3dlYnNvY2tldHMvI3RoZS13ZWJzb2NrZXQtaW50ZXJmYWNlXG52YXIgQ09OTkVDVElORyA9IDA7XG52YXIgT1BFTiA9IDE7XG52YXIgQ0xPU0VEID0gMztcblxudmFyIGNyZWF0ZVNvY2tKU01hbmFnZXIgPSBmdW5jdGlvbiBjcmVhdGVTb2NrSlNNYW5hZ2VyKHVybCwgX3RlbXApIHtcbiAgdmFyIF9yZWYgPSBfdGVtcCA9PT0gdm9pZCAwID8ge30gOiBfdGVtcCxcbiAgICAgIHF1ZXJ5ID0gX3JlZi5xdWVyeSxcbiAgICAgIF9yZWYkdHJhbnNwb3J0cyA9IF9yZWYudHJhbnNwb3J0cyxcbiAgICAgIHRyYW5zcG9ydHMgPSBfcmVmJHRyYW5zcG9ydHMgPT09IHZvaWQgMCA/IFsnd2Vic29ja2V0JywgJ3hoci1wb2xsaW5nJ10gOiBfcmVmJHRyYW5zcG9ydHM7XG5cbiAgdmFyIGZpbmFsVXJsID0gXCJcIiArIHVybCArICghcXVlcnkgPyAnJyA6ICc/JyArIGJ1aWxkUXVlcnlTdHJpbmcocXVlcnkpKTtcbiAgdmFyIGVtaXR0ZXIgPSBtaXR0KCk7XG4gIHZhciBiYWNrb2ZmID0gYmFja28oe1xuICAgIG1pbjogMTAwMCxcbiAgICBtYXg6IDUwMDAsXG4gICAgaml0dGVyOiAwLjVcbiAgfSk7XG4gIHZhciBzdGF0ZSA9IENMT1NFRDtcbiAgdmFyIHJlY29ubmVjdFRpbWVyO1xuICB2YXIgc29ja2V0ID0gbnVsbDtcblxuICB2YXIgb3Blbkxpc3RlbmVyID0gZnVuY3Rpb24gb3Blbkxpc3RlbmVyKCkge1xuICAgIHN0YXRlID0gT1BFTjtcbiAgICBiYWNrb2ZmLnJlc2V0KCk7XG4gICAgZW1pdHRlci5lbWl0KCdjb25uZWN0Jyk7XG4gIH07XG5cbiAgdmFyIGNsb3NlTGlzdGVuZXIgPSBmdW5jdGlvbiBjbG9zZUxpc3RlbmVyKCkge1xuICAgIHN0YXRlID0gQ0xPU0VEO1xuICAgIHNvY2tldCA9IG51bGw7XG4gICAgZW1pdHRlci5lbWl0KCdkaXNjb25uZWN0Jyk7IC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby11c2UtYmVmb3JlLWRlZmluZVxuXG4gICAgcmVjb25uZWN0KCk7XG4gIH07XG5cbiAgdmFyIG1lc3NhZ2VMaXN0ZW5lciA9IGZ1bmN0aW9uIG1lc3NhZ2VMaXN0ZW5lcihfcmVmMikge1xuICAgIHZhciBkYXRhID0gX3JlZjIuZGF0YTtcbiAgICBlbWl0dGVyLmVtaXQoXCJtZXNzYWdlXCIsIGRhdGEpO1xuICB9O1xuXG4gIHZhciBoZWFydGJlYXRMaXN0ZW5lciA9IGZ1bmN0aW9uIGhlYXJ0YmVhdExpc3RlbmVyKCkge1xuICAgIGVtaXR0ZXIuZW1pdCgnaGVhcnRiZWF0Jyk7XG4gIH07XG5cbiAgdmFyIGFkZEV2ZW50TGlzdGVuZXJzID0gZnVuY3Rpb24gYWRkRXZlbnRMaXN0ZW5lcnMoaW5zdGFuY2UpIHtcbiAgICBpbnN0YW5jZS5hZGRFdmVudExpc3RlbmVyKCdvcGVuJywgb3Blbkxpc3RlbmVyKTtcbiAgICBpbnN0YW5jZS5hZGRFdmVudExpc3RlbmVyKCdjbG9zZScsIGNsb3NlTGlzdGVuZXIpO1xuICAgIGluc3RhbmNlLmFkZEV2ZW50TGlzdGVuZXIoJ21lc3NhZ2UnLCBtZXNzYWdlTGlzdGVuZXIpO1xuICAgIGluc3RhbmNlLmFkZEV2ZW50TGlzdGVuZXIoJ2hlYXJ0YmVhdCcsIGhlYXJ0YmVhdExpc3RlbmVyKTtcbiAgfTtcblxuICB2YXIgcmVtb3ZlRXZlbnRMaXN0ZW5lcnMgPSBmdW5jdGlvbiByZW1vdmVFdmVudExpc3RlbmVycyhpbnN0YW5jZSkge1xuICAgIGluc3RhbmNlLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ29wZW4nLCBvcGVuTGlzdGVuZXIpO1xuICAgIGluc3RhbmNlLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2Nsb3NlJywgY2xvc2VMaXN0ZW5lcik7XG4gICAgaW5zdGFuY2UucmVtb3ZlRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIG1lc3NhZ2VMaXN0ZW5lcik7XG4gICAgaW5zdGFuY2UucmVtb3ZlRXZlbnRMaXN0ZW5lcignaGVhcnRiZWF0JywgaGVhcnRiZWF0TGlzdGVuZXIpO1xuICB9O1xuXG4gIHZhciBjbG9zZSA9IGZ1bmN0aW9uIGNsb3NlKCkge1xuICAgIHN0YXRlID0gQ0xPU0VEO1xuXG4gICAgaWYgKCFzb2NrZXQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICByZW1vdmVFdmVudExpc3RlbmVycyhzb2NrZXQpO1xuICAgIHNvY2tldC5jbG9zZSgpO1xuICAgIHNvY2tldCA9IG51bGw7XG4gIH07XG5cbiAgdmFyIGNvbm5lY3QgPSBmdW5jdGlvbiBjb25uZWN0KCkge1xuICAgIHN0YXRlID0gQ09OTkVDVElORztcbiAgICBzb2NrZXQgPSBuZXcgU29ja0pTKGZpbmFsVXJsLCB1bmRlZmluZWQsIHtcbiAgICAgIHRyYW5zcG9ydHM6IHRyYW5zcG9ydHNcbiAgICB9KTtcbiAgICBhZGRFdmVudExpc3RlbmVycyhzb2NrZXQpO1xuICB9O1xuXG4gIHZhciByZWNvbm5lY3QgPSBmdW5jdGlvbiByZWNvbm5lY3QoZGVsYXkpIHtcbiAgICBpZiAoZGVsYXkgPT09IHZvaWQgMCkge1xuICAgICAgZGVsYXkgPSBiYWNrb2ZmLmR1cmF0aW9uKCk7XG4gICAgfVxuXG4gICAgY2xlYXJUaW1lb3V0KHJlY29ubmVjdFRpbWVyKTtcblxuICAgIGlmIChkZWxheSA9PT0gMCkge1xuICAgICAgY29ubmVjdCgpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHJlY29ubmVjdFRpbWVyID0gc2V0VGltZW91dChjb25uZWN0LCBkZWxheSk7XG4gIH07XG5cbiAgdmFyIG1hbmFnZWRTb2NrZXQgPSB7XG4gICAgY29ubmVjdDogZnVuY3Rpb24gKF9jb25uZWN0KSB7XG4gICAgICBmdW5jdGlvbiBjb25uZWN0KCkge1xuICAgICAgICByZXR1cm4gX2Nvbm5lY3QuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgIH1cblxuICAgICAgY29ubmVjdC50b1N0cmluZyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIF9jb25uZWN0LnRvU3RyaW5nKCk7XG4gICAgICB9O1xuXG4gICAgICByZXR1cm4gY29ubmVjdDtcbiAgICB9KGZ1bmN0aW9uICgpIHtcbiAgICAgIGlmIChzdGF0ZSAhPT0gQ0xPU0VEKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignU29ja2V0IGlzIGFscmVhZHkgb3BlbiBvciBjb25uZWN0aW5nLicpO1xuICAgICAgfVxuXG4gICAgICBjbGVhclRpbWVvdXQocmVjb25uZWN0VGltZXIpO1xuICAgICAgY29ubmVjdCgpO1xuICAgIH0pLFxuICAgIGRlc3Ryb3k6IGZ1bmN0aW9uIGRlc3Ryb3koKSB7XG4gICAgICBtYW5hZ2VkU29ja2V0Lm9mZigpO1xuICAgICAgbWFuYWdlZFNvY2tldC5kaXNjb25uZWN0KCk7XG4gICAgfSxcbiAgICBkaXNjb25uZWN0OiBmdW5jdGlvbiBkaXNjb25uZWN0KCkge1xuICAgICAgc3RhdGUgPSBDTE9TRUQ7XG4gICAgICBjbGVhclRpbWVvdXQocmVjb25uZWN0VGltZXIpO1xuICAgICAgY2xvc2UoKTtcbiAgICB9LFxuICAgIHJlY29ubmVjdDogZnVuY3Rpb24gKF9yZWNvbm5lY3QpIHtcbiAgICAgIGZ1bmN0aW9uIHJlY29ubmVjdChfeCkge1xuICAgICAgICByZXR1cm4gX3JlY29ubmVjdC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgfVxuXG4gICAgICByZWNvbm5lY3QudG9TdHJpbmcgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBfcmVjb25uZWN0LnRvU3RyaW5nKCk7XG4gICAgICB9O1xuXG4gICAgICByZXR1cm4gcmVjb25uZWN0O1xuICAgIH0oZnVuY3Rpb24gKGRlbGF5KSB7XG4gICAgICBjbG9zZSgpO1xuICAgICAgcmVjb25uZWN0KGRlbGF5KTtcbiAgICB9KSxcbiAgICBlbWl0OiBmdW5jdGlvbiBlbWl0KGRhdGEpIHtcbiAgICAgIGlmIChzdGF0ZSAhPT0gT1BFTikge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1NvY2tldCBpcyBub3QgY29ubmVjdGVkLicpO1xuICAgICAgfSAvLyBpZiB3ZSBhcmUgY29ubmVjdGVkIHdlIGNhbiBiZSBzdXJlIHRoYXQgc29ja2V0IGlzIGRlZmluZWRcblxuXG4gICAgICBzb2NrZXQuc2VuZChkYXRhKTtcbiAgICB9LFxuICAgIGdldFJlYWR5U3RhdGU6IGZ1bmN0aW9uIGdldFJlYWR5U3RhdGUoKSB7XG4gICAgICByZXR1cm4gc3RhdGU7XG4gICAgfSxcbiAgICBvbjogZW1pdHRlci5vbixcbiAgICBvZmY6IGVtaXR0ZXIub2ZmXG4gIH07XG4gIHJldHVybiBtYW5hZ2VkU29ja2V0O1xufTtcblxuZXhwb3J0IGRlZmF1bHQgY3JlYXRlU29ja0pTTWFuYWdlcjtcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///../../../node_modules/@livechat/sockjs-manager/dist/sockjs-manager.esm.js\n");

/***/ }),

/***/ "../../../node_modules/@livechat/url-utils/dist/url-utils.esm.js":
/*!***********************************************************************!*\
  !*** ../../../node_modules/@livechat/url-utils/dist/url-utils.esm.js ***!
  \***********************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"buildQueryString\": () => (/* binding */ buildQueryString),\n/* harmony export */   \"decodeQueryString\": () => (/* binding */ decodeQueryString),\n/* harmony export */   \"getHostname\": () => (/* binding */ getHostname),\n/* harmony export */   \"getOrigin\": () => (/* binding */ getOrigin),\n/* harmony export */   \"getPathname\": () => (/* binding */ getPathname),\n/* harmony export */   \"getProtocol\": () => (/* binding */ getProtocol),\n/* harmony export */   \"getQueryParam\": () => (/* binding */ getQueryParam),\n/* harmony export */   \"getQueryParams\": () => (/* binding */ getQueryParams),\n/* harmony export */   \"getSearch\": () => (/* binding */ getSearch),\n/* harmony export */   \"hasUnsafeProtocol\": () => (/* binding */ hasUnsafeProtocol),\n/* harmony export */   \"removeProtocol\": () => (/* binding */ removeProtocol),\n/* harmony export */   \"trimSearch\": () => (/* binding */ trimSearch)\n/* harmony export */ });\n/* harmony import */ var _livechat_data_utils__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @livechat/data-utils */ \"../../../node_modules/@livechat/data-utils/dist/data-utils.es.js\");\n\n\nvar buildQueryString = function buildQueryString(obj) {\n  return (0,_livechat_data_utils__WEBPACK_IMPORTED_MODULE_0__.toPairs)(obj).map(function (pair) {\n    return pair.map(encodeURIComponent).join('=');\n  }).join('&');\n};\n\nvar decodeQueryString = function decodeQueryString(query) {\n  var pairs = query.split('&').map(function (pair) {\n    return pair.split('=').map(function (value) {\n      return decodeURIComponent(value.replace('+', '%20'));\n    });\n  });\n  var decoded = (0,_livechat_data_utils__WEBPACK_IMPORTED_MODULE_0__.fromPairs)(pairs);\n  return decoded;\n};\n\nvar hostnameRegexp = /(?:[^:]+:\\/\\/)?([^/\\s]+)/;\nfunction getHostname(url) {\n  var hostnameMatch = url.match(hostnameRegexp);\n  return hostnameMatch && hostnameMatch[1];\n}\n\nvar originRegexp = /[^:]+:\\/\\/[^(/|?)\\s]+/;\n\nvar getOrigin = function getOrigin(url) {\n  var domain = url.match(originRegexp);\n  return domain && domain[0];\n};\n\nvar searchRegexp = /.*?\\?([^#]+)/;\n\nvar getSearch = function getSearch(url) {\n  var match = url.match(searchRegexp);\n  return match ? \"?\" + match[1] : '';\n};\n\nvar trimSearch = function trimSearch(search) {\n  return search.replace(/^\\?/, '');\n};\n\nvar getQueryParams = function getQueryParams(url) {\n  var search = trimSearch(getSearch(url));\n  return decodeQueryString(search ? search : url);\n};\n\nvar getQueryParam = function getQueryParam(name, url) {\n  return getQueryParams(url)[name];\n};\n\nvar pathnameRegexp = /^(?:https?:)?\\/\\/[^/]+\\/([^?#]+)/;\n\nvar getPathname = function getPathname(url) {\n  var pathname = url.match(pathnameRegexp);\n  return \"/\" + (pathname && pathname[1] || '');\n};\n\n// URL can contain leading C0 control or \\u0020 SPACE,\n// and any newline or tab are filtered out as if they're not part of the URL.\n// https://url.spec.whatwg.org/#url-parsing\n// Tab or newline are defined as \\r\\n\\t:\n// https://infra.spec.whatwg.org/#ascii-tab-or-newline\n// A C0 control is a code point in the range \\u0000 NULL to \\u001F\n// INFORMATION SEPARATOR ONE, inclusive:\n// https://infra.spec.whatwg.org/#c0-control-or-space\nvar intersperseWithTabOrNewline = function intersperseWithTabOrNewline(str) {\n  return str.replace(/\\w/g, '$&[\\\\r\\\\n\\\\t]*');\n};\n\nvar unsafeProtocol = new RegExp(\"^[\\0-\\x1F]*(\" + intersperseWithTabOrNewline('javascript') + \"|\" + intersperseWithTabOrNewline('data') + \"):\", 'i'); // would be better to whitelist things\n// but people might paste in protocolless URLs\n// and we would filter them out\n\nvar hasUnsafeProtocol = function hasUnsafeProtocol(url) {\n  return unsafeProtocol.test(url);\n};\n\nvar protocolRegexp = /^((http(s)?:)?\\/\\/)/;\n\nvar removeProtocol = function removeProtocol(url) {\n  return url.replace(protocolRegexp, '');\n};\n\nvar protocolRegexp$1 = /^((http(s)?:)?\\/\\/)/;\n\nvar getProtocol = function getProtocol(url) {\n  var match = url.match(protocolRegexp$1);\n  return match ? match[2] : null;\n};\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi4vLi4vLi4vbm9kZV9tb2R1bGVzL0BsaXZlY2hhdC91cmwtdXRpbHMvZGlzdC91cmwtdXRpbHMuZXNtLmpzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4uLy4uLy4uL25vZGVfbW9kdWxlcy9AbGl2ZWNoYXQvdXJsLXV0aWxzL2Rpc3QvdXJsLXV0aWxzLmVzbS5qcz9lMDJkIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHRvUGFpcnMsIGZyb21QYWlycyB9IGZyb20gJ0BsaXZlY2hhdC9kYXRhLXV0aWxzJztcblxudmFyIGJ1aWxkUXVlcnlTdHJpbmcgPSBmdW5jdGlvbiBidWlsZFF1ZXJ5U3RyaW5nKG9iaikge1xuICByZXR1cm4gdG9QYWlycyhvYmopLm1hcChmdW5jdGlvbiAocGFpcikge1xuICAgIHJldHVybiBwYWlyLm1hcChlbmNvZGVVUklDb21wb25lbnQpLmpvaW4oJz0nKTtcbiAgfSkuam9pbignJicpO1xufTtcblxudmFyIGRlY29kZVF1ZXJ5U3RyaW5nID0gZnVuY3Rpb24gZGVjb2RlUXVlcnlTdHJpbmcocXVlcnkpIHtcbiAgdmFyIHBhaXJzID0gcXVlcnkuc3BsaXQoJyYnKS5tYXAoZnVuY3Rpb24gKHBhaXIpIHtcbiAgICByZXR1cm4gcGFpci5zcGxpdCgnPScpLm1hcChmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgIHJldHVybiBkZWNvZGVVUklDb21wb25lbnQodmFsdWUucmVwbGFjZSgnKycsICclMjAnKSk7XG4gICAgfSk7XG4gIH0pO1xuICB2YXIgZGVjb2RlZCA9IGZyb21QYWlycyhwYWlycyk7XG4gIHJldHVybiBkZWNvZGVkO1xufTtcblxudmFyIGhvc3RuYW1lUmVnZXhwID0gLyg/OlteOl0rOlxcL1xcLyk/KFteL1xcc10rKS87XG5mdW5jdGlvbiBnZXRIb3N0bmFtZSh1cmwpIHtcbiAgdmFyIGhvc3RuYW1lTWF0Y2ggPSB1cmwubWF0Y2goaG9zdG5hbWVSZWdleHApO1xuICByZXR1cm4gaG9zdG5hbWVNYXRjaCAmJiBob3N0bmFtZU1hdGNoWzFdO1xufVxuXG52YXIgb3JpZ2luUmVnZXhwID0gL1teOl0rOlxcL1xcL1teKC98PylcXHNdKy87XG5cbnZhciBnZXRPcmlnaW4gPSBmdW5jdGlvbiBnZXRPcmlnaW4odXJsKSB7XG4gIHZhciBkb21haW4gPSB1cmwubWF0Y2gob3JpZ2luUmVnZXhwKTtcbiAgcmV0dXJuIGRvbWFpbiAmJiBkb21haW5bMF07XG59O1xuXG52YXIgc2VhcmNoUmVnZXhwID0gLy4qP1xcPyhbXiNdKykvO1xuXG52YXIgZ2V0U2VhcmNoID0gZnVuY3Rpb24gZ2V0U2VhcmNoKHVybCkge1xuICB2YXIgbWF0Y2ggPSB1cmwubWF0Y2goc2VhcmNoUmVnZXhwKTtcbiAgcmV0dXJuIG1hdGNoID8gXCI/XCIgKyBtYXRjaFsxXSA6ICcnO1xufTtcblxudmFyIHRyaW1TZWFyY2ggPSBmdW5jdGlvbiB0cmltU2VhcmNoKHNlYXJjaCkge1xuICByZXR1cm4gc2VhcmNoLnJlcGxhY2UoL15cXD8vLCAnJyk7XG59O1xuXG52YXIgZ2V0UXVlcnlQYXJhbXMgPSBmdW5jdGlvbiBnZXRRdWVyeVBhcmFtcyh1cmwpIHtcbiAgdmFyIHNlYXJjaCA9IHRyaW1TZWFyY2goZ2V0U2VhcmNoKHVybCkpO1xuICByZXR1cm4gZGVjb2RlUXVlcnlTdHJpbmcoc2VhcmNoID8gc2VhcmNoIDogdXJsKTtcbn07XG5cbnZhciBnZXRRdWVyeVBhcmFtID0gZnVuY3Rpb24gZ2V0UXVlcnlQYXJhbShuYW1lLCB1cmwpIHtcbiAgcmV0dXJuIGdldFF1ZXJ5UGFyYW1zKHVybClbbmFtZV07XG59O1xuXG52YXIgcGF0aG5hbWVSZWdleHAgPSAvXig/Omh0dHBzPzopP1xcL1xcL1teL10rXFwvKFtePyNdKykvO1xuXG52YXIgZ2V0UGF0aG5hbWUgPSBmdW5jdGlvbiBnZXRQYXRobmFtZSh1cmwpIHtcbiAgdmFyIHBhdGhuYW1lID0gdXJsLm1hdGNoKHBhdGhuYW1lUmVnZXhwKTtcbiAgcmV0dXJuIFwiL1wiICsgKHBhdGhuYW1lICYmIHBhdGhuYW1lWzFdIHx8ICcnKTtcbn07XG5cbi8vIFVSTCBjYW4gY29udGFpbiBsZWFkaW5nIEMwIGNvbnRyb2wgb3IgXFx1MDAyMCBTUEFDRSxcbi8vIGFuZCBhbnkgbmV3bGluZSBvciB0YWIgYXJlIGZpbHRlcmVkIG91dCBhcyBpZiB0aGV5J3JlIG5vdCBwYXJ0IG9mIHRoZSBVUkwuXG4vLyBodHRwczovL3VybC5zcGVjLndoYXR3Zy5vcmcvI3VybC1wYXJzaW5nXG4vLyBUYWIgb3IgbmV3bGluZSBhcmUgZGVmaW5lZCBhcyBcXHJcXG5cXHQ6XG4vLyBodHRwczovL2luZnJhLnNwZWMud2hhdHdnLm9yZy8jYXNjaWktdGFiLW9yLW5ld2xpbmVcbi8vIEEgQzAgY29udHJvbCBpcyBhIGNvZGUgcG9pbnQgaW4gdGhlIHJhbmdlIFxcdTAwMDAgTlVMTCB0byBcXHUwMDFGXG4vLyBJTkZPUk1BVElPTiBTRVBBUkFUT1IgT05FLCBpbmNsdXNpdmU6XG4vLyBodHRwczovL2luZnJhLnNwZWMud2hhdHdnLm9yZy8jYzAtY29udHJvbC1vci1zcGFjZVxudmFyIGludGVyc3BlcnNlV2l0aFRhYk9yTmV3bGluZSA9IGZ1bmN0aW9uIGludGVyc3BlcnNlV2l0aFRhYk9yTmV3bGluZShzdHIpIHtcbiAgcmV0dXJuIHN0ci5yZXBsYWNlKC9cXHcvZywgJyQmW1xcXFxyXFxcXG5cXFxcdF0qJyk7XG59O1xuXG52YXIgdW5zYWZlUHJvdG9jb2wgPSBuZXcgUmVnRXhwKFwiXltcXDAtXFx4MUZdKihcIiArIGludGVyc3BlcnNlV2l0aFRhYk9yTmV3bGluZSgnamF2YXNjcmlwdCcpICsgXCJ8XCIgKyBpbnRlcnNwZXJzZVdpdGhUYWJPck5ld2xpbmUoJ2RhdGEnKSArIFwiKTpcIiwgJ2knKTsgLy8gd291bGQgYmUgYmV0dGVyIHRvIHdoaXRlbGlzdCB0aGluZ3Ncbi8vIGJ1dCBwZW9wbGUgbWlnaHQgcGFzdGUgaW4gcHJvdG9jb2xsZXNzIFVSTHNcbi8vIGFuZCB3ZSB3b3VsZCBmaWx0ZXIgdGhlbSBvdXRcblxudmFyIGhhc1Vuc2FmZVByb3RvY29sID0gZnVuY3Rpb24gaGFzVW5zYWZlUHJvdG9jb2wodXJsKSB7XG4gIHJldHVybiB1bnNhZmVQcm90b2NvbC50ZXN0KHVybCk7XG59O1xuXG52YXIgcHJvdG9jb2xSZWdleHAgPSAvXigoaHR0cChzKT86KT9cXC9cXC8pLztcblxudmFyIHJlbW92ZVByb3RvY29sID0gZnVuY3Rpb24gcmVtb3ZlUHJvdG9jb2wodXJsKSB7XG4gIHJldHVybiB1cmwucmVwbGFjZShwcm90b2NvbFJlZ2V4cCwgJycpO1xufTtcblxudmFyIHByb3RvY29sUmVnZXhwJDEgPSAvXigoaHR0cChzKT86KT9cXC9cXC8pLztcblxudmFyIGdldFByb3RvY29sID0gZnVuY3Rpb24gZ2V0UHJvdG9jb2wodXJsKSB7XG4gIHZhciBtYXRjaCA9IHVybC5tYXRjaChwcm90b2NvbFJlZ2V4cCQxKTtcbiAgcmV0dXJuIG1hdGNoID8gbWF0Y2hbMl0gOiBudWxsO1xufTtcblxuZXhwb3J0IHsgYnVpbGRRdWVyeVN0cmluZywgZGVjb2RlUXVlcnlTdHJpbmcsIGdldEhvc3RuYW1lLCBnZXRPcmlnaW4sIGdldFBhdGhuYW1lLCBnZXRQcm90b2NvbCwgZ2V0UXVlcnlQYXJhbSwgZ2V0UXVlcnlQYXJhbXMsIGdldFNlYXJjaCwgaGFzVW5zYWZlUHJvdG9jb2wsIHJlbW92ZVByb3RvY29sLCB0cmltU2VhcmNoIH07XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///../../../node_modules/@livechat/url-utils/dist/url-utils.esm.js\n");

/***/ })

}]);